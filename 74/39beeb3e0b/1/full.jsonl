{"type":"file-history-snapshot","messageId":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","snapshot":{"messageId":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","trackedFileBackups":{},"timestamp":"2026-02-22T14:34:21.205Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:clear","command":"entire hooks claude-code session-start"},"parentToolUseID":"6fc46677-fe40-48c5-a17d-0e2082ae1d07","toolUseID":"6fc46677-fe40-48c5-a17d-0e2082ae1d07","timestamp":"2026-02-22T14:34:21.007Z","uuid":"224a8b7b-57b0-4538-9571-0e56ba15a0d8"}
{"parentUuid":"224a8b7b-57b0-4538-9571-0e56ba15a0d8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"Implement the following plan:\n\n# AI Theme Generation — Implementation Plan\n\n## Context\n\n現在の `handleGenerate()` はプリセット名の部分一致のみで、AI生成は未実装。\n自由記述のプロンプト（例: \"brutalist newspaper with orange ink\"）をGemini APIに送り、\nCSSを動的生成してページに反映させる機能を追加する。\n\n**選択API:** Google Gemini 2.0 Flash（無料枠: 1,500 req/日, 15 req/分）\n**アーキテクチャ:** ブラウザ完結。サーバー追加なし。APIキーはlocalStorage保存。\n**index.html 変更なし。gardener.js のみ修正。**\n\n---\n\n## 変更ファイル\n\n- `/Users/turtlekazu/ReactProjects/acephale/gardener.js` — 唯一の変更対象\n\n---\n\n## localStorage キー一覧\n\n| キー | 用途 |\n|------|------|\n| `acephale-theme` | 既存: プリセット名 |\n| `acephale-custom-css` | 新規: AI生成CSSの全文 |\n| `acephale-custom-prompt` | 新規: AI生成時のプロンプト文字列 |\n| `acephale-gemini-key` | 新規: ユーザーのGemini APIキー |\n\n---\n\n## 実装手順（この順で実装すること）\n\n### Step 1: モジュールレベルの定数を追加\n\n`BASE_URL` の直後に追加:\n\n```javascript\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n```\n\n---\n\n### Step 2: App オブジェクトに新メソッドを追加\n\n#### APIキー管理（3メソッド）\n\n```javascript\ngetApiKey() {\n    return localStorage.getItem('acephale-gemini-key');\n},\nsaveApiKey(key) {\n    localStorage.setItem('acephale-gemini-key', key.trim());\n},\nclearApiKey() {\n    localStorage.removeItem('acephale-gemini-key');\n    this.renderApiKeySection();\n},\n```\n\n#### CSS抽出（Geminiがmarkdown fence で返した場合に除去）\n\n```javascript\nextractCss(text) {\n    let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n    cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n    return cleaned.trim();\n},\n```\n\n#### Gemini API呼び出し\n\n```javascript\nasync generateTheme(prompt) {\n    const key = this.getApiKey();\n    if (!key) throw new Error('NO_API_KEY');\n\n    const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n    const body = {\n        system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n        contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n        generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n    };\n\n    const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n        const status = response.status;\n        if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n        if (status === 429) throw new Error('RATE_LIMIT');\n        throw new Error(`API_ERROR:${status}`);\n    }\n\n    const data = await response.json();\n    const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n    if (!rawText) throw new Error('EMPTY_RESPONSE');\n    return this.extractCss(rawText);\n},\n```\n\n#### APIキー設定UI のレンダリング\n\n`init()` から呼ばれる。`clearApiKey()` 後の再描画にも使う。\n`#theme-controls` の末尾に `#api-key-section` として追加する。\nキーが保存済みかどうかで2状態を描画する:\n\n- **State A（キーなし）**: \"GEMINI API KEY ▼\" トグル + password input + Save ボタン（デフォルト折りたたみ）\n- **State B（キーあり）**: \"GEMINI AI: ENABLED\" + \"clear\" ボタン\n\n完全な実装:\n\n```javascript\nrenderApiKeySection() {\n    const existing = document.getElementById('api-key-section');\n    if (existing) existing.remove();\n\n    const section = document.createElement('div');\n    section.id = 'api-key-section';\n    section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n    if (this.getApiKey()) {\n        // State B\n        section.innerHTML = `\n            <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n            </div>`;\n        section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n    } else {\n        // State A\n        section.innerHTML = `\n            <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n            </div>`;\n        section.querySelector('#api-key-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#api-key-form');\n            const icon = section.querySelector('#api-key-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n        section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n            const val = section.querySelector('#api-key-input').value.trim();\n            if (!val) return;\n            this.saveApiKey(val);\n            this.renderApiKeySection();\n        });\n    }\n\n    this.elements.themeControls.appendChild(section);\n},\n```\n\n#### エラー表示（alert廃止 → インライン表示）\n\n```javascript\nshowGenerateError(err) {\n    let message;\n    switch (err.message) {\n        case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n        case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n        case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n        case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n        default:              message = `Generation failed: ${err.message}`;\n    }\n    let errEl = document.getElementById('generate-error');\n    if (!errEl) {\n        errEl = document.createElement('div');\n        errEl.id = 'generate-error';\n        errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n    }\n    errEl.textContent = message;\n    clearTimeout(this._errorTimeout);\n    this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n},\n```\n\n#### APIキーセクションを展開するヘルパー\n\n```javascript\nexpandApiKeySection() {\n    const form = document.getElementById('api-key-form');\n    const icon = document.getElementById('api-key-icon');\n    if (form && form.style.display === 'none') {\n        form.style.display = 'flex';\n        if (icon) icon.style.transform = 'rotate(0deg)';\n    }\n    this.elements.themeControls.classList.remove('is-minimized');\n    const input = document.getElementById('api-key-input');\n    if (input) setTimeout(() => input.focus(), 300);\n},\n```\n\n---\n\n### Step 3: `handleGenerate()` を async に更新\n\n既存の同期版と置き換える。同時リクエスト防止のガードも追加:\n\n```javascript\nasync handleGenerate() {\n    const input = this.elements.promptInput.value.trim();\n    if (!input) return;\n    if (this._isGenerating) return;  // 連打防止\n\n    // プリセット一致チェック（既存動作を維持）\n    const presetCss = this.matchStyle(input);\n    if (presetCss) {\n        this.applyStyle(presetCss, input);\n        this.togglePresets(true);\n        return;\n    }\n\n    // キーなし → 入力欄を展開\n    if (!this.getApiKey()) {\n        this.expandApiKeySection();\n        return;\n    }\n\n    // AI生成\n    this._isGenerating = true;\n    const btn = this.elements.generateBtn;\n    const originalText = btn.textContent;\n    btn.textContent = 'Generating...';\n    btn.disabled = true;\n\n    try {\n        const css = await this.generateTheme(input);\n        this.applyStyle(css, null, input);\n        this.togglePresets(true);\n    } catch (err) {\n        this.showGenerateError(err);\n    } finally {\n        btn.textContent = originalText;\n        btn.disabled = false;\n        this._isGenerating = false;\n    }\n},\n```\n\n---\n\n### Step 4: `applyStyle()` のシグネチャと永続化ロジックを更新\n\n`applyStyle(css, themeName, customPrompt = null)` に変更:\n\n```javascript\napplyStyle(css, themeName, customPrompt = null) {\n    this.toggleMenu(false);\n\n    if (themeName && STYLE_PRESETS[themeName]) {\n        // プリセット\n        localStorage.setItem('acephale-theme', themeName);\n        localStorage.removeItem('acephale-custom-css');\n        localStorage.removeItem('acephale-custom-prompt');\n    } else if (customPrompt) {\n        // AI生成テーマ\n        localStorage.setItem('acephale-custom-css', css);\n        localStorage.setItem('acephale-custom-prompt', customPrompt);\n        localStorage.removeItem('acephale-theme');\n    }\n\n    const applyFn = () => {\n        this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n    };\n\n    if (!document.startViewTransition) { applyFn(); return; }\n    document.startViewTransition(applyFn);\n},\n```\n\n---\n\n### Step 5: `init()` を更新\n\n`renderApiKeySection()` 呼び出しの追加と、AI生成テーマの復元ロジックを追加:\n\n```javascript\nasync init() {\n    this.renderPresetButtons();\n    this.renderApiKeySection();   // 追加\n    this.bindEvents();\n\n    const savedPreset  = localStorage.getItem('acephale-theme');\n    const savedCustom  = localStorage.getItem('acephale-custom-css');\n    const savedPrompt  = localStorage.getItem('acephale-custom-prompt');\n\n    if (savedCustom) {\n        this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n        if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n    } else {\n        const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n    }\n\n    await this.loadInitial();\n},\n```\n\n---\n\n## UIレイアウト（#theme-controls 最終形）\n\n```\n┌─────────────────────────────────────────┐\n│  [drag handle]                          │\n│  PRESETS ▼                              │\n│  [Mini] [Glitch] [Playful] ...          │\n│  [Enter theme.................] [Apply] │\n│  (error message if any)                 │\n│  GEMINI API KEY ▼  ← 折りたたみ済み     │\n│  (or: GEMINI AI: ENABLED        clear)  │\n└─────────────────────────────────────────┘\n```\n\n---\n\n## 動作フロー\n\n```\nユーザーが \"brutalist newspaper\" と入力 → Apply\n├─ matchStyle() → 一致なし\n├─ getApiKey() → キーなし → expandApiKeySection() → STOP\n│\n└─ getApiKey() → キーあり\n    ├─ ボタン \"Generating...\" + disabled\n    ├─ Gemini API へ fetch()\n    │   ├─ 200 OK → extractCss() → applyStyle(css, null, prompt)\n    │   │           → View Transition → CSS適用 + localStorage保存\n    │   ├─ 400/403 → showGenerateError(\"Invalid API key\") + 入力欄展開\n    │   ├─ 429    → showGenerateError(\"Rate limit hit\")\n    │   └─ その他 → showGenerateError(\"Generation failed: ...\")\n    └─ finally: ボタン復元\n```\n\n---\n\n## 検証方法\n\n1. ブラウザで `index.html` を開く\n2. \"minimalist\" と入力 → Apply → プリセット適用される（既存動作の確認）\n3. \"brutalist newspaper\" と入力 → Apply → API Key セクションが展開される\n4. APIキーを入力して Save → \"GEMINI AI: ENABLED\" に切り替わる\n5. \"brutalist newspaper\" と入力 → Apply → \"Generating...\" 表示後にテーマ適用\n6. ページをリロード → AI生成テーマが復元される\n7. プリセットボタンをクリック → プリセットに切り替わり、custom CSS がクリアされる\n8. clear ボタン → \"GEMINI API KEY ▼\" に戻る\n\n\nIf you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /Users/turtlekazu/.REDACTED.jsonl"},"uuid":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","timestamp":"2026-02-22T14:34:20.891Z","planContent":"# AI Theme Generation — Implementation Plan\n\n## Context\n\n現在の `handleGenerate()` はプリセット名の部分一致のみで、AI生成は未実装。\n自由記述のプロンプト（例: \"brutalist newspaper with orange ink\"）をGemini APIに送り、\nCSSを動的生成してページに反映させる機能を追加する。\n\n**選択API:** Google Gemini 2.0 Flash（無料枠: 1,500 req/日, 15 req/分）\n**アーキテクチャ:** ブラウザ完結。サーバー追加なし。APIキーはlocalStorage保存。\n**index.html 変更なし。gardener.js のみ修正。**\n\n---\n\n## 変更ファイル\n\n- `/Users/turtlekazu/ReactProjects/acephale/gardener.js` — 唯一の変更対象\n\n---\n\n## localStorage キー一覧\n\n| キー | 用途 |\n|------|------|\n| `acephale-theme` | 既存: プリセット名 |\n| `acephale-custom-css` | 新規: AI生成CSSの全文 |\n| `acephale-custom-prompt` | 新規: AI生成時のプロンプト文字列 |\n| `acephale-gemini-key` | 新規: ユーザーのGemini APIキー |\n\n---\n\n## 実装手順（この順で実装すること）\n\n### Step 1: モジュールレベルの定数を追加\n\n`BASE_URL` の直後に追加:\n\n```javascript\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n```\n\n---\n\n### Step 2: App オブジェクトに新メソッドを追加\n\n#### APIキー管理（3メソッド）\n\n```javascript\ngetApiKey() {\n    return localStorage.getItem('acephale-gemini-key');\n},\nsaveApiKey(key) {\n    localStorage.setItem('acephale-gemini-key', key.trim());\n},\nclearApiKey() {\n    localStorage.removeItem('acephale-gemini-key');\n    this.renderApiKeySection();\n},\n```\n\n#### CSS抽出（Geminiがmarkdown fence で返した場合に除去）\n\n```javascript\nextractCss(text) {\n    let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n    cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n    return cleaned.trim();\n},\n```\n\n#### Gemini API呼び出し\n\n```javascript\nasync generateTheme(prompt) {\n    const key = this.getApiKey();\n    if (!key) throw new Error('NO_API_KEY');\n\n    const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n    const body = {\n        system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n        contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n        generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n    };\n\n    const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n        const status = response.status;\n        if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n        if (status === 429) throw new Error('RATE_LIMIT');\n        throw new Error(`API_ERROR:${status}`);\n    }\n\n    const data = await response.json();\n    const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n    if (!rawText) throw new Error('EMPTY_RESPONSE');\n    return this.extractCss(rawText);\n},\n```\n\n#### APIキー設定UI のレンダリング\n\n`init()` から呼ばれる。`clearApiKey()` 後の再描画にも使う。\n`#theme-controls` の末尾に `#api-key-section` として追加する。\nキーが保存済みかどうかで2状態を描画する:\n\n- **State A（キーなし）**: \"GEMINI API KEY ▼\" トグル + password input + Save ボタン（デフォルト折りたたみ）\n- **State B（キーあり）**: \"GEMINI AI: ENABLED\" + \"clear\" ボタン\n\n完全な実装:\n\n```javascript\nrenderApiKeySection() {\n    const existing = document.getElementById('api-key-section');\n    if (existing) existing.remove();\n\n    const section = document.createElement('div');\n    section.id = 'api-key-section';\n    section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n    if (this.getApiKey()) {\n        // State B\n        section.innerHTML = `\n            <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n            </div>`;\n        section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n    } else {\n        // State A\n        section.innerHTML = `\n            <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n            </div>`;\n        section.querySelector('#api-key-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#api-key-form');\n            const icon = section.querySelector('#api-key-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n        section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n            const val = section.querySelector('#api-key-input').value.trim();\n            if (!val) return;\n            this.saveApiKey(val);\n            this.renderApiKeySection();\n        });\n    }\n\n    this.elements.themeControls.appendChild(section);\n},\n```\n\n#### エラー表示（alert廃止 → インライン表示）\n\n```javascript\nshowGenerateError(err) {\n    let message;\n    switch (err.message) {\n        case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n        case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n        case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n        case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n        default:              message = `Generation failed: ${err.message}`;\n    }\n    let errEl = document.getElementById('generate-error');\n    if (!errEl) {\n        errEl = document.createElement('div');\n        errEl.id = 'generate-error';\n        errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n    }\n    errEl.textContent = message;\n    clearTimeout(this._errorTimeout);\n    this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n},\n```\n\n#### APIキーセクションを展開するヘルパー\n\n```javascript\nexpandApiKeySection() {\n    const form = document.getElementById('api-key-form');\n    const icon = document.getElementById('api-key-icon');\n    if (form && form.style.display === 'none') {\n        form.style.display = 'flex';\n        if (icon) icon.style.transform = 'rotate(0deg)';\n    }\n    this.elements.themeControls.classList.remove('is-minimized');\n    const input = document.getElementById('api-key-input');\n    if (input) setTimeout(() => input.focus(), 300);\n},\n```\n\n---\n\n### Step 3: `handleGenerate()` を async に更新\n\n既存の同期版と置き換える。同時リクエスト防止のガードも追加:\n\n```javascript\nasync handleGenerate() {\n    const input = this.elements.promptInput.value.trim();\n    if (!input) return;\n    if (this._isGenerating) return;  // 連打防止\n\n    // プリセット一致チェック（既存動作を維持）\n    const presetCss = this.matchStyle(input);\n    if (presetCss) {\n        this.applyStyle(presetCss, input);\n        this.togglePresets(true);\n        return;\n    }\n\n    // キーなし → 入力欄を展開\n    if (!this.getApiKey()) {\n        this.expandApiKeySection();\n        return;\n    }\n\n    // AI生成\n    this._isGenerating = true;\n    const btn = this.elements.generateBtn;\n    const originalText = btn.textContent;\n    btn.textContent = 'Generating...';\n    btn.disabled = true;\n\n    try {\n        const css = await this.generateTheme(input);\n        this.applyStyle(css, null, input);\n        this.togglePresets(true);\n    } catch (err) {\n        this.showGenerateError(err);\n    } finally {\n        btn.textContent = originalText;\n        btn.disabled = false;\n        this._isGenerating = false;\n    }\n},\n```\n\n---\n\n### Step 4: `applyStyle()` のシグネチャと永続化ロジックを更新\n\n`applyStyle(css, themeName, customPrompt = null)` に変更:\n\n```javascript\napplyStyle(css, themeName, customPrompt = null) {\n    this.toggleMenu(false);\n\n    if (themeName && STYLE_PRESETS[themeName]) {\n        // プリセット\n        localStorage.setItem('acephale-theme', themeName);\n        localStorage.removeItem('acephale-custom-css');\n        localStorage.removeItem('acephale-custom-prompt');\n    } else if (customPrompt) {\n        // AI生成テーマ\n        localStorage.setItem('acephale-custom-css', css);\n        localStorage.setItem('acephale-custom-prompt', customPrompt);\n        localStorage.removeItem('acephale-theme');\n    }\n\n    const applyFn = () => {\n        this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n    };\n\n    if (!document.startViewTransition) { applyFn(); return; }\n    document.startViewTransition(applyFn);\n},\n```\n\n---\n\n### Step 5: `init()` を更新\n\n`renderApiKeySection()` 呼び出しの追加と、AI生成テーマの復元ロジックを追加:\n\n```javascript\nasync init() {\n    this.renderPresetButtons();\n    this.renderApiKeySection();   // 追加\n    this.bindEvents();\n\n    const savedPreset  = localStorage.getItem('acephale-theme');\n    const savedCustom  = localStorage.getItem('acephale-custom-css');\n    const savedPrompt  = localStorage.getItem('acephale-custom-prompt');\n\n    if (savedCustom) {\n        this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n        if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n    } else {\n        const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n    }\n\n    await this.loadInitial();\n},\n```\n\n---\n\n## UIレイアウト（#theme-controls 最終形）\n\n```\n┌─────────────────────────────────────────┐\n│  [drag handle]                          │\n│  PRESETS ▼                              │\n│  [Mini] [Glitch] [Playful] ...          │\n│  [Enter theme.................] [Apply] │\n│  (error message if any)                 │\n│  GEMINI API KEY ▼  ← 折りたたみ済み     │\n│  (or: GEMINI AI: ENABLED        clear)  │\n└─────────────────────────────────────────┘\n```\n\n---\n\n## 動作フロー\n\n```\nユーザーが \"brutalist newspaper\" と入力 → Apply\n├─ matchStyle() → 一致なし\n├─ getApiKey() → キーなし → expandApiKeySection() → STOP\n│\n└─ getApiKey() → キーあり\n    ├─ ボタン \"Generating...\" + disabled\n    ├─ Gemini API へ fetch()\n    │   ├─ 200 OK → extractCss() → applyStyle(css, null, prompt)\n    │   │           → View Transition → CSS適用 + localStorage保存\n    │   ├─ 400/403 → showGenerateError(\"Invalid API key\") + 入力欄展開\n    │   ├─ 429    → showGenerateError(\"Rate limit hit\")\n    │   └─ その他 → showGenerateError(\"Generation failed: ...\")\n    └─ finally: ボタン復元\n```\n\n---\n\n## 検証方法\n\n1. ブラウザで `index.html` を開く\n2. \"minimalist\" と入力 → Apply → プリセット適用される（既存動作の確認）\n3. \"brutalist newspaper\" と入力 → Apply → API Key セクションが展開される\n4. APIキーを入力して Save → \"GEMINI AI: ENABLED\" に切り替わる\n5. \"brutalist newspaper\" と入力 → Apply → \"Generating...\" 表示後にテーマ適用\n6. ページをリロード → AI生成テーマが復元される\n7. プリセットボタンをクリック → プリセットに切り替わり、custom CSS がクリアされる\n8. clear ボタン → \"GEMINI API KEY ▼\" に戻る\n"}
{"parentUuid":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01G9YePErd8uP9zgzPvzh1XC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me start by reading the current state of `gardener.js` to understand the existing code structure before making changes.","signature":"EqQCCkYICxgCKkBohEX4D3WfkFxrqO0iTvv4mNcW/Furnc+lmanGntNyLFrFbvPc2Lm36K2lraCI6FvL+hn8rmD9zV6INCk8GQ0OEgwvHhCcyXK+RyxJJecaDBgk5roX05zWrR0JHSIwbvv2w6/BuBwNWMn8Rv5OcaN4tdFGKnh6MwMKlooGcZOiztmdY/sZnihW9kEYnzh1KosBWxbrEyl2VFpVjGRQhASR+CxhrX5XzuXd1t0JKR3I8JnEuUaOrqAeCYJrv0H3Ly8hXfcKci9GJ7LmDsY11/Mw50vZm+k0Yk9TVVY2rpUhSsLeGZxJ5vJaEJudM8RzN+MIQJ5mcA5Pv1mgE/UFTd5oKktI25qATCSM9kdGYH8pIJzW10m2wqjzR1km1xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":6432,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6432},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGnv3nSYwnM1FzGJzB8","type":"assistant","uuid":"115e461a-0121-4a97-8f84-e80f19e6a646","timestamp":"2026-02-22T14:34:23.220Z"}
{"parentUuid":"115e461a-0121-4a97-8f84-e80f19e6a646","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01G9YePErd8uP9zgzPvzh1XC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01W3hvyN3sbpbM1EejPQg78x","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":6432,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6432},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGnv3nSYwnM1FzGJzB8","type":"assistant","uuid":"c702b596-17fb-451d-ae79-ace4527d8971","timestamp":"2026-02-22T14:34:23.659Z"}
{"parentUuid":"c702b596-17fb-451d-ae79-ace4527d8971","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01W3hvyN3sbpbM1EejPQg78x","toolUseID":"toolu_01W3hvyN3sbpbM1EejPQg78x","timestamp":"2026-02-22T14:34:23.922Z","uuid":"fd64c2dc-3de6-4bc0-ad6c-243af4d63d12"}
{"parentUuid":"c702b596-17fb-451d-ae79-ace4527d8971","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01W3hvyN3sbpbM1EejPQg78x","type":"tool_result","content":"     1→/**\n     2→ * Acephale OS | Gardener.js\n     3→ * Hacker News Interface Styling & Data Fetching\n     4→ */\n     5→\n     6→const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n     7→\n     8→/**\n     9→ * System Core Styles (Layout, Typography Base, Responsive Logic)\n    10→ * Themes should override variables in :root or specific classes if needed.\n    11→ */\n    12→const SYSTEM_STYLE = `\n    13→    :root {\n    14→        /* Default Variables (Fallback) */\n    15→        --bg: #ffffff;\n    16→        --text: #333333;\n    17→        --subtext: #888888;\n    18→        --accent: #007aff;\n    19→        --card-bg: #ffffff;\n    20→        --header-bg: rgba(255,255,255,0.9);\n    21→        --header-border: 1px solid rgba(0,0,0,0.1);\n    22→        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    23→        \n    24→        /* Component Specific Defaults */\n    25→        --item-padding: 24px;\n    26→        --item-radius: 12px;\n    27→        --item-border: 1px solid rgba(0,0,0,0.05);\n    28→        --item-shadow: none;\n    29→        --item-gap: 20px;\n    30→        \n    31→        /* Mobile Defaults */\n    32→        --mobile-upvote-bg: rgba(0,0,0,0.05);\n    33→        --mobile-upvote-color: inherit;\n    34→        --mobile-upvote-border: none;\n    35→        --mobile-upvote-radius: 8px;\n    36→        --mobile-rank-opacity: 0.5;\n    37→        --mobile-rank-color: inherit;\n    38→\n    39→        /* More Button Defaults */\n    40→        --more-btn-bg: var(--text);\n    41→        --more-btn-color: var(--bg);\n    42→    }\n    43→\n    44→    /* --- Transition Animation --- */\n    45→    ::view-transition-group(*) {\n    46→        animation-duration: 1.2s;\n    47→    }\n    48→\n    49→    /* --- Base Layout --- */\n    50→    body {\n    51→        background: var(--bg);\n    52→        color: var(--text);\n    53→        font-family: var(--font-main);\n    54→        margin: 0;\n    55→        display: flex;\n    56→        flex-direction: column;\n    57→        min-height: 100vh;\n    58→        transition: background 0.5s, color 0.5s;\n    59→    }\n    60→    * { box-sizing: border-box; }\n    61→    ul, ol { list-style: none; padding: 0; margin: 0; }\n    62→    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    63→    button { font-family: inherit; cursor: pointer; }\n    64→\n    65→    /* --- Header --- */\n    66→    .hn-header {\n    67→        background: var(--header-bg);\n    68→        border-bottom: var(--header-border);\n    69→        backdrop-filter: saturate(180%) blur(20px);\n    70→        padding: 0 20px;\n    71→        height: 60px;\n    72→        display: flex;\n    73→        align-items: center;\n    74→        justify-content: center;\n    75→        position: sticky;\n    76→        top: 0;\n    77→        z-index: 100;\n    78→        view-transition-name: main-header;\n    79→    }\n    80→    .hn-nav {\n    81→        width: 100%;\n    82→        max-width: 1000px;\n    83→        display: flex;\n    84→        align-items: center;\n    85→        justify-content: space-between;\n    86→    }\n    87→    .hn-logo {\n    88→        font-weight: 900;\n    89→        font-size: 20px;\n    90→        color: var(--accent);\n    91→        view-transition-name: main-logo;\n    92→    }\n    93→    .hn-nav-links { display: flex; gap: 24px; }\n    94→    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    95→    .hn-nav-links a:hover { color: var(--text); }\n    96→    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n    97→\n    98→    /* --- Main Content --- */\n    99→    .hn-main {\n   100→        max-width: 1000px;\n   101→        margin: 0 auto;\n   102→        padding: 40px 20px;\n   103→        flex: 1;\n   104→        width: 100%;\n   105→        view-transition-name: main-content;\n   106→    }\n   107→    .hn-story-list {\n   108→        display: flex;\n   109→        flex-direction: column;\n   110→        gap: 16px;\n   111→        view-transition-name: story-list;\n   112→    }\n   113→\n   114→    /* --- Story Item (Desktop Standard) --- */\n   115→    .hn-story-item {\n   116→        background: var(--item-bg, var(--card-bg));\n   117→        border: var(--item-border);\n   118→        border-radius: var(--item-radius);\n   119→        padding: var(--item-padding);\n   120→        box-shadow: var(--item-shadow);\n   121→        display: flex;\n   122→        flex-direction: row;\n   123→        align-items: center;\n   124→        gap: var(--item-gap);\n   125→        transition: transform 0.2s, box-shadow 0.2s;\n   126→        position: relative;\n   127→    }\n   128→    .hn-story-rank {\n   129→        order: -2;\n   130→        font-size: 16px;\n   131→        color: var(--subtext);\n   132→        width: 30px;\n   133→        text-align: right;\n   134→        font-feature-settings: \"tnum\";\n   135→    }\n   136→    .hn-story-content { flex: 1; min-width: 0; }\n   137→    .hn-story-title {\n   138→        display: block;\n   139→        font-size: 18px;\n   140→        font-weight: 600;\n   141→        color: var(--text);\n   142→        line-height: 1.3;\n   143→        margin-bottom: 6px;\n   144→    }\n   145→    .hn-story-title:hover { color: var(--accent); }\n   146→    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n   147→    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n   148→    \n   149→    /* Standard Desktop Upvote */\n   150→    .hn-upvote {\n   151→        order: -1;\n   152→        background: transparent;\n   153→        border: 1px solid var(--subtext);\n   154→        color: var(--subtext);\n   155→        width: 32px;\n   156→        height: 32px;\n   157→        border-radius: 50%;\n   158→        display: flex;\n   159→        align-items: center;\n   160→        justify-content: center;\n   161→        font-size: 10px;\n   162→        flex-shrink: 0;\n   163→        transition: 0.2s;\n   164→        opacity: 0.6;\n   165→    }\n   166→    .hn-upvote:hover {\n   167→        border-color: var(--accent);\n   168→        color: var(--accent);\n   169→        opacity: 1;\n   170→    }\n   171→\n   172→    /* --- Load More --- */\n   173→    .hn-load-more {\n   174→        display: block;\n   175→        margin: 60px auto;\n   176→        padding: 12px 40px;\n   177→        background: var(--more-btn-bg);\n   178→        color: var(--more-btn-color);\n   179→        border: none;\n   180→        border-radius: 100px;\n   181→        font-weight: 600;\n   182→        transition: transform 0.2s;\n   183→    }\n   184→    .hn-load-more:hover { transform: scale(1.05); }\n   185→\n   186→    /* --- Footer --- */\n   187→    .hn-footer {\n   188→        padding: 60px 20px;\n   189→        border-top: 1px solid var(--header-border);\n   190→        text-align: center;\n   191→        font-size: 13px;\n   192→        color: var(--subtext);\n   193→        background: var(--bg);\n   194→        view-transition-name: main-footer;\n   195→    }\n   196→    .hn-footer-links {\n   197→        display: flex;\n   198→        justify-content: center;\n   199→        gap: 20px;\n   200→        margin-bottom: 20px;\n   201→    }\n   202→\n   203→    /* --- Control Panel (Glassmorphism) --- */\n   204→    #theme-controls { \n   205→        view-transition-name: theme-ui;\n   206→        position: fixed; \n   207→        bottom: 20px; \n   208→        right: 20px; \n   209→        z-index: 10000; \n   210→        padding: 15px; \n   211→        border-radius: 12px; \n   212→        display: flex; \n   213→        flex-direction: column; \n   214→        gap: 12px; \n   215→        align-items: flex-start; \n   216→        max-width: 350px;\n   217→\n   218→        /* Glass Style */\n   219→        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n   220→        color: var(--text);\n   221→        border: 1px solid rgba(255, 255, 255, 0.15);\n   222→        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n   223→        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n   224→        backdrop-filter: saturate(180%) blur(30px);\n   225→        -webkit-backdrop-filter: saturate(180%) blur(30px);\n   226→        transition: all 0.3s;\n   227→    }\n   228→    #theme-controls input {\n   229→        background: var(--bg);\n   230→        color: var(--text);\n   231→        border: 1px solid var(--subtext);\n   232→        padding: 8px 12px;\n   233→        border-radius: 6px;\n   234→        outline: none;\n   235→        flex: 1;\n   236→        opacity: 0.8;\n   237→    }\n   238→    #theme-controls button {\n   239→        background: rgba(0,0,0,0.05);\n   240→        color: var(--text);\n   241→        border: 1px solid rgba(0,0,0,0.1);\n   242→        border-radius: 6px;\n   243→        padding: 6px 12px;\n   244→        font-size: 12px;\n   245→        font-weight: 500;\n   246→        transition: 0.2s;\n   247→    }\n   248→    #theme-controls #generate-btn {\n   249→        background: var(--accent) !important;\n   250→        color: #fff;\n   251→        border: none;\n   252→        font-weight: 600;\n   253→        padding: 8px 16px;\n   254→    }\n   255→    \n   256→    /* Collapsible Logic */\n   257→    #preset-buttons {\n   258→        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n   259→        max-height: 300px; opacity: 1; overflow: hidden;\n   260→        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n   261→    }\n   262→    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n   263→    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n   264→    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n   265→\n   266→    /* --- Desktop Panel Toggle (Drag Handle) --- */\n   267→    #panel-handle { display: none; }\n   268→    @media (min-width: 769px) {\n   269→        #panel-handle {\n   270→            display: block; position: absolute; top: 0; left: 0;\n   271→            width: 20px; height: 100%;\n   272→            background: transparent;\n   273→            cursor: ew-resize;\n   274→            z-index: 20;\n   275→        }\n   276→        /* Visual cue */\n   277→        #panel-handle::before {\n   278→            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n   279→            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n   280→            transition: 0.2s;\n   281→        }\n   282→        #panel-handle:hover::before { opacity: 0.4; }\n   283→        \n   284→        #theme-controls { \n   285→            padding-left: 20px; \n   286→            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n   287→        }\n   288→        #theme-controls.is-minimized {\n   289→            transform: translateX(calc(100% - 20px));\n   290→        }\n   291→        #theme-controls.is-minimized > *:not(#panel-handle) {\n   292→            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n   293→        }\n   294→    }\n   295→\n   296→    /* --- Mobile Overrides (Unified) --- */\n   297→    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n   298→    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n   299→\n   300→    @media (max-width: 768px) {\n   301→        /* Mobile Nav */\n   302→        .hn-menu-toggle { display: block; order: 999; }\n   303→        .hn-nav-links {\n   304→            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n   305→            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n   306→            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n   307→        }\n   308→        .hn-nav-links.is-open { display: flex; }\n   309→        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n   310→        .hn-auth { display: none; }\n   311→        .hn-header { padding: 0 15px; height: 60px; }\n   312→        .hn-main { padding: 20px 15px; }\n   313→        \n   314→        /* Mobile Story Item */\n   315→        .hn-story-item {\n   316→            padding: 15px;\n   317→            gap: 12px;\n   318→            flex-direction: row;\n   319→            align-items: flex-start;\n   320→        }\n   321→        .hn-story-title { font-size: 17px; line-height: 1.3; }\n   322→        \n   323→        /* Mobile Rank */\n   324→        .hn-story-rank {\n   325→            display: block;\n   326→            width: auto;\n   327→            min-width: 18px;\n   328→            margin-right: 8px;\n   329→            font-size: 14px;\n   330→            \n   331→            /* Reset & Variable Application */\n   332→            position: static;\n   333→            background: var(--mobile-rank-bg, transparent);\n   334→            border: var(--mobile-rank-border, none);\n   335→            padding: var(--mobile-rank-padding, 0);\n   336→            border-radius: var(--mobile-rank-radius, 0);\n   337→            opacity: var(--mobile-rank-opacity, 0.5);\n   338→            color: var(--mobile-rank-color, inherit);\n   339→            font-weight: var(--mobile-rank-font-weight, 400);\n   340→            \n   341→            align-self: flex-start;\n   342→            margin-top: 2px;\n   343→            flex-shrink: 0;\n   344→            white-space: nowrap;\n   345→            text-align: center;\n   346→        }\n   347→\n   348→        /* Mobile Upvote */\n   349→        .hn-upvote {\n   350→            width: 32px;\n   351→            height: 32px;\n   352→            margin-top: 2px;\n   353→            align-self: flex-start;\n   354→            display: flex;\n   355→            align-items: center;\n   356→            justify-content: center;\n   357→            font-size: 10px;\n   358→            opacity: 1; /* Reset opacity */\n   359→            \n   360→            /* Variable Application */\n   361→            background: var(--mobile-upvote-bg);\n   362→            border: var(--mobile-upvote-border);\n   363→            color: var(--mobile-upvote-color);\n   364→            border-radius: var(--mobile-upvote-radius);\n   365→        }\n   366→\n   367→        /* Mobile Control Panel */\n   368→        #theme-controls {\n   369→            bottom: 20px; right: 20px; width: auto;\n   370→            max-width: calc(100vw - 40px);\n   371→            padding: 15px;\n   372→            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n   373→        }\n   374→        .hn-footer { padding: 40px 20px 160px; }\n   375→        .hn-footer-links { flex-direction: column; gap: 10px; }\n   376→        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n   377→        #presets-toggle { margin-bottom: 2px; }\n   378→        \n   379→        /* Mobile Menu State */\n   380→        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n   381→        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n   382→        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n   383→    }\n   384→`;\n   385→\n   386→/**\n   387→ * Themes\n   388→ * Define variables and minimal specific overrides.\n   389→ */\n   390→const STYLE_PRESETS = {\n   391→    \"Minimalist\": `\n   392→        :root {\n   393→            --bg: #f5f5f7;\n   394→            --card-bg: #ffffff;\n   395→            --text: #1d1d1f;\n   396→            --subtext: #86868b;\n   397→            --accent: #0066cc;\n   398→            --header-bg: rgba(251, 251, 253, 0.8);\n   399→            \n   400→            /* Mobile */\n   401→            --mobile-upvote-bg: #e8e8ed;\n   402→            --mobile-upvote-radius: 50%;\n   403→\n   404→            /* More Button */\n   405→            --more-btn-bg: var(--accent);\n   406→            --more-btn-color: #fff;\n   407→        }\n   408→        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n   409→        .hn-header { \n   410→            background: rgba(255, 255, 255, 0.7); \n   411→            border: 0.5px solid rgba(0,0,0,0.05);\n   412→            backdrop-filter: saturate(180%) blur(20px);\n   413→            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n   414→            margin: 12px 20px;\n   415→            border-radius: 100px;\n   416→            height: 50px;\n   417→            top: 12px;\n   418→        }\n   419→        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n   420→        .hn-logo { \n   421→            text-transform: uppercase; \n   422→            letter-spacing: 0.2em; \n   423→            font-size: 14px; \n   424→            font-weight: 300;\n   425→            color: #000;\n   426→        }\n   427→        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n   428→        #theme-controls #generate-btn { background: var(--accent) !important; }\n   429→    `,\n   430→\n   431→    \"Glitch\": `\n   432→        :root {\n   433→            --bg: #050a0e;\n   434→            --card-bg: rgba(5, 10, 14, 0.9);\n   435→            --text: #fcee0a; /* Yellow */\n   436→            --subtext: #00f0ff; /* Blue */\n   437→            --accent: #ff003c; /* Pink */\n   438→            --header-bg: var(--text);\n   439→            --font-main: sans-serif;\n   440→            \n   441→            /* Mobile */\n   442→            --mobile-upvote-bg: var(--accent);\n   443→            --mobile-upvote-color: #fff;\n   444→            --mobile-upvote-radius: 0;\n   445→\n   446→            /* More Button */\n   447→            --more-btn-bg: var(--text);\n   448→            --more-btn-color: #000;\n   449→        }\n   450→        \n   451→        body { text-transform: uppercase; }\n   452→        body::before {\n   453→            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n   454→            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n   455→            pointer-events: none; z-index: 1000;\n   456→        }\n   457→        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n   458→        .hn-header.is-open-active { clip-path: none; }\n   459→        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n   460→        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n   461→        .hn-story-item { \n   462→            border: 2px solid var(--subtext);\n   463→            background: rgba(255, 0, 60, 0.05);\n   464→            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n   465→        }\n   466→        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n   467→        .hn-upvote { \n   468→            background: var(--accent); color: #fff; border: none; border-radius: 0; \n   469→            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n   470→            padding: 0 10px; width: auto;\n   471→        }\n   472→        /* Override Common Apply Button for visibility */\n   473→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   474→    `,\n   475→\n   476→    \"Playful\": `\n   477→        :root {\n   478→            --red: #e60012;\n   479→            --blue: #00a0e9;\n   480→            --bg: #eee;\n   481→            --card-bg: #fff;\n   482→            --text: #333;\n   483→            --subtext: #8c8c8c;\n   484→            --accent: var(--blue);\n   485→            --header-bg: var(--red);\n   486→            \n   487→            /* Mobile */\n   488→            --mobile-upvote-bg: var(--red);\n   489→            --mobile-upvote-color: #fff;\n   490→            --mobile-upvote-border: 3px solid #000;\n   491→            --mobile-upvote-radius: 12px;\n   492→            \n   493→            --mobile-rank-opacity: 1;\n   494→            --mobile-rank-color: #fff;\n   495→            --mobile-rank-bg: var(--blue);\n   496→            --mobile-rank-border: 3px solid #000;\n   497→            --mobile-rank-radius: 12px;\n   498→            --mobile-rank-padding: 2px 8px;\n   499→            --mobile-rank-font-weight: 900;\n   500→            \n   501→            --button-bg: var(--red);\n   502→\n   503→            /* More Button */\n   504→            --more-btn-bg: var(--red);\n   505→            --more-btn-color: #fff;\n   506→        }\n   507→        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n   508→        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n   509→        \n   510→        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n   511→        .hn-story-item { \n   512→            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n   513→            align-items: center; padding: 30px;\n   514→        }\n   515→        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n   516→        .hn-story-rank { \n   517→            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n   518→            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n   519→            width: auto; text-align: center;\n   520→        }\n   521→        .hn-upvote { \n   522→            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n   523→            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n   524→        }\n   525→        /* Force Apply Button Red */\n   526→        #theme-controls #generate-btn { background: var(--red) !important; }\n   527→    `,\n   528→\n   529→    \"Glow\": `\n   530→        :root {\n   531→            --bg: #0a0d14;\n   532→            --card-bg: rgba(20, 25, 35, 0.8);\n   533→            --text: #ffffff;\n   534→            --subtext: rgba(255, 255, 255, 0.6);\n   535→            --accent: #0037c1;\n   536→            --header-bg: transparent;\n   537→            --header-border: 1px solid rgba(255,255,255,0.05);\n   538→            \n   539→            /* Mobile */\n   540→            --mobile-upvote-bg: transparent;\n   541→            --mobile-upvote-color: var(--subtext);\n   542→            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n   543→\n   544→            /* More Button */\n   545→            --more-btn-bg: var(--accent);\n   546→            --more-btn-color: #fff;\n   547→        }\n   548→        body {\n   549→            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n   550→                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n   551→        }\n   552→        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n   553→        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n   554→        .hn-header { \n   555→            border: 1px solid rgba(0, 55, 193, 0.3); \n   556→            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n   557→            margin: 15px 20px;\n   558→            border-radius: 12px;\n   559→            background: rgba(10, 13, 20, 0.8);\n   560→            top: 15px;\n   561→        }\n   562→        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n   563→        .hn-logo { \n   564→            text-transform: uppercase; \n   565→            letter-spacing: 4px; \n   566→            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n   567→            font-size: 18px;\n   568→        }\n   569→        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n   570→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   571→    `,\n   572→\n   573→    \"Academic\": `\n   574→        :root {\n   575→            --bg: #fdfaf5;\n   576→            --card-bg: #ffffff;\n   577→            --text: #1b1b1b;\n   578→            --subtext: #666;\n   579→            --accent: #d97757;\n   580→            --header-bg: #fdfaf5;\n   581→            --font-main: serif;\n   582→            \n   583→            --item-border: none;\n   584→            --item-padding: 50px 0;\n   585→            --item-radius: 0;\n   586→            --item-shadow: none;\n   587→            \n   588→            /* Mobile */\n   589→            --mobile-upvote-bg: transparent;\n   590→            --mobile-upvote-color: #999;\n   591→            --mobile-upvote-border: 1.5px solid #ccc;\n   592→\n   593→            /* More Button */\n   594→            --more-btn-bg: var(--accent);\n   595→            --more-btn-color: #fff;\n   596→        }\n   597→        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n   598→        .hn-story-title { font-size: 28px; font-weight: 500; }\n   599→        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n   600→        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n   601→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   602→    `,\n   603→\n   604→    \"Search\": `\n   605→        :root {\n   606→            --bg: #fff;\n   607→            --card-bg: #fff;\n   608→            --text: #202124;\n   609→            --subtext: #5f6368;\n   610→            --accent: #1a73e8;\n   611→            --header-bg: #fff;\n   612→            --font-main: sans-serif;\n   613→            \n   614→            --item-padding: 16px 0;\n   615→            --item-radius: 0;\n   616→            --item-border: none;\n   617→            --item-shadow: none;\n   618→            \n   619→            /* Mobile */\n   620→            --mobile-upvote-bg: transparent;\n   621→            --mobile-upvote-color: #70757a;\n   622→            --mobile-upvote-border: 1px solid #dadce0;\n   623→\n   624→            /* More Button */\n   625→            --more-btn-bg: #f8f9fa;\n   626→            --more-btn-color: #3c4043;\n   627→        }\n   628→        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n   629→        .hn-story-title:hover { text-decoration: underline; }\n   630→        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n   631→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   632→    `,\n   633→\n   634→    \"Universal\": `\n   635→        :root {\n   636→            --bg: #fff;\n   637→            --card-bg: #f4f4f4;\n   638→            --text: #000;\n   639→            --subtext: #666;\n   640→            --accent: #034EA2;\n   641→            --header-bg: #fff;\n   642→            \n   643→            /* Mobile */\n   644→            --mobile-upvote-bg: var(--accent);\n   645→            --mobile-upvote-color: #fff;\n   646→            --mobile-upvote-radius: 50%;\n   647→\n   648→            /* More Button */\n   649→            --more-btn-bg: var(--accent);\n   650→            --more-btn-color: #fff;\n   651→        }\n   652→        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n   653→        .hn-story-item { padding: 30px; border-radius: 40px; }\n   654→        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n   655→        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n   656→        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n   657→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   658→    `,\n   659→\n   660→    \"Intelligence\": `\n   661→        :root {\n   662→            --bg: #0d0d0d;\n   663→            --card-bg: #171717;\n   664→            --text: #ececec;\n   665→            --subtext: #b4b4b4;\n   666→            --accent: #10a37f;\n   667→            --header-bg: rgba(13, 13, 13, 0.8);\n   668→            \n   669→            --item-border: 1px solid rgba(255,255,255,0.1);\n   670→            \n   671→            /* Mobile */\n   672→            --mobile-upvote-bg: transparent;\n   673→            --mobile-upvote-color: var(--subtext);\n   674→            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n   675→\n   676→            /* More Button */\n   677→            --more-btn-bg: var(--accent);\n   678→            --more-btn-color: #fff;\n   679→        }\n   680→        .hn-story-item:hover { border-color: var(--accent); }\n   681→        .hn-header { \n   682→            border: 1px solid rgba(16, 163, 127, 0.3); \n   683→            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n   684→            background: rgba(13, 13, 13, 0.9);\n   685→            margin: 10px 15px;\n   686→            border-radius: 4px;\n   687→            top: 10px;\n   688→        }\n   689→        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n   690→        .hn-logo { \n   691→            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n   692→            font-size: 16px; \n   693→            color: var(--accent); \n   694→            display: flex; \n   695→            align-items: center; \n   696→        }\n   697→        .hn-logo::after { \n   698→            content: '_'; \n   699→            margin-left: 4px; \n   700→            animation: blink 1s step-end infinite; \n   701→            color: var(--accent);\n   702→        }\n   703→        @keyframes blink { 50% { opacity: 0; } }\n   704→        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n   705→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   706→    `,\n   707→\n   708→    \"Ghibli\": `\n   709→        :root {\n   710→            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n   711→            --card-bg: #ffffff;\n   712→            --text: #433422; /* 焦茶色の文字 */\n   713→            --subtext: #8c7355; /* 土のような茶色 */\n   714→            --accent: #5d8a66; /* 深い森の緑 */\n   715→            --header-bg: rgba(253, 250, 240, 0.85);\n   716→            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n   717→            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n   718→\n   719→            /* Component Overrides */\n   720→            --item-radius: 20px;\n   721→            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n   722→            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n   723→\n   724→            /* More & Upvote Colors */\n   725→            --more-btn-bg: var(--accent);\n   726→            --more-btn-color: #fff;\n   727→            --mobile-upvote-bg: var(--accent);\n   728→            --mobile-upvote-color: #fff;\n   729→            --mobile-rank-color: var(--subtext);\n   730→            --mobile-rank-opacity: 1;\n   731→        }\n   732→        .hn-story-item {\n   733→            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n   734→            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n   735→        }\n   736→        .hn-story-item:hover {\n   737→            transform: translateY(-2px);\n   738→            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n   739→            border-color: var(--accent);\n   740→        }\n   741→        .hn-logo {\n   742→            font-style: italic;\n   743→            color: var(--accent);\n   744→            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n   745→        }\n   746→        .hn-upvote {\n   747→            background: rgba(93, 138, 102, 0.05);\n   748→            border-color: rgba(93, 138, 102, 0.3);\n   749→            color: var(--accent);\n   750→        }\n   751→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   752→    `,\n   753→\n   754→    \"8-Bit\": `\n   755→        :root {\n   756→            --bg: #000000; /* 漆黒の背景 */\n   757→            --card-bg: #111111;\n   758→            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n   759→            --subtext: #008800;\n   760→            --accent: #00ffff; /* シアンのアクセント */\n   761→            --header-bg: #000000;\n   762→            --header-border: 4px solid #00ffff;\n   763→            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n   764→\n   765→            /* Component Overrides */\n   766→            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n   767→            --item-border: 4px solid #008800;\n   768→            --item-padding: 20px;\n   769→            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n   770→\n   771→            /* More & Upvote Colors */\n   772→            --more-btn-bg: var(--accent);\n   773→            --more-btn-color: #000;\n   774→            --mobile-upvote-bg: var(--accent);\n   775→            --mobile-upvote-color: #000;\n   776→            --mobile-rank-color: var(--text);\n   777→            --mobile-rank-opacity: 1;\n   778→        }\n   779→        body {\n   780→            image-rendering: pixelated;\n   781→        }\n   782→        .hn-story-item:hover {\n   783→            border-color: var(--accent);\n   784→            box-shadow: 4px 4px 0px var(--subtext);\n   785→            transform: translate(4px, 4px); /* 押し込み感 */\n   786→        }\n   787→        .hn-upvote {\n   788→            border-radius: 0;\n   789→            border: 2px solid var(--accent);\n   790→            background: #000;\n   791→            color: var(--accent);\n   792→        }\n   793→        .hn-logo {\n   794→            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n   795→        }\n   796→        .hn-load-more {\n   797→            border-radius: 0;\n   798→            border: 4px solid var(--text);\n   799→            text-transform: uppercase;\n   800→        }\n   801→        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n   802→    `\n   803→};\n   804→\n   805→/**\n   806→ * Data Fetching Logic\n   807→ */\n   808→const HNData = {\n   809→    allStoryIds: [],\n   810→    currentType: 'top',\n   811→\n   812→    setType(type) {\n   813→        if (this.currentType === type) return;\n   814→        this.currentType = type;\n   815→        this.allStoryIds = []; // Clear cache\n   816→    },\n   817→\n   818→    async fetchAllIds() {\n   819→        if (this.allStoryIds.length > 0) return this.allStoryIds;\n   820→        try {\n   821→            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n   822→            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n   823→            this.allStoryIds = await response.json();\n   824→            return this.allStoryIds;\n   825→        } catch (error) {\n   826→            console.error(\"Failed to fetch ID list:\", error);\n   827→            return [];\n   828→        }\n   829→    },\n   830→\n   831→    async fetchStoriesBatch(offset, limit = 30) {\n   832→        const ids = await this.fetchAllIds();\n   833→        const batchIds = ids.slice(offset, offset + limit);\n   834→\n   835→        const storyPromises = batchIds.map(async (id) => {\n   836→            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n   837→            return await storyRes.json();\n   838→        });\n   839→\n   840→        return await Promise.all(storyPromises);\n   841→    },\n   842→\n   843→    formatTime(timestamp) {\n   844→        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n   845→        let interval = Math.floor(seconds / 31536000);\n   846→        if (interval > 1) return interval + \" years ago\";\n   847→        interval = Math.floor(seconds / 2592000);\n   848→        if (interval > 1) return interval + \" months ago\";\n   849→        interval = Math.floor(seconds / 86400);\n   850→        if (interval > 1) return interval + \" days ago\";\n   851→        interval = Math.floor(seconds / 3600);\n   852→        if (interval > 1) return interval + \" hours ago\";\n   853→        interval = Math.floor(seconds / 60);\n   854→        if (interval > 1) return interval + \" minutes ago\";\n   855→        return Math.floor(seconds) + \" seconds ago\";\n   856→    }\n   857→};\n   858→\n   859→/**\n   860→ * Application Controller\n   861→ */\n   862→const App = {\n   863→    currentOffset: 0,\n   864→    isLoading: false,\n   865→\n   866→    elements: {\n   867→        styleTag: document.getElementById('generated-style'),\n   868→        promptInput: document.getElementById('prompt-input'),\n   869→        generateBtn: document.getElementById('generate-btn'),\n   870→        presetButtons: document.getElementById('preset-buttons'),\n   871→        presetsToggle: document.getElementById('presets-toggle'),\n   872→        presetsIcon: document.getElementById('presets-icon'),\n   873→        listElement: document.querySelector('.hn-story-list'),\n   874→        loadMoreBtn: document.querySelector('.hn-load-more'),\n   875→        menuToggle: document.querySelector('.hn-menu-toggle'),\n   876→        navLinks: document.querySelector('.hn-nav-links'),\n   877→        header: document.querySelector('.hn-header'),\n   878→        themeControls: document.getElementById('theme-controls'),\n   879→        panelHandle: document.getElementById('panel-handle')\n   880→    },\n   881→\n   882→    async init() {\n   883→        this.renderPresetButtons();\n   884→        this.bindEvents();\n   885→        console.log(\"Generative UI - Architecture Refactored.\");\n   886→        \n   887→        // Restore saved theme or fallback to Minimalist\n   888→        const savedTheme = localStorage.getItem('acephale-theme');\n   889→        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n   890→        \n   891→        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n   892→\n   893→        // Initial load\n   894→        await this.loadInitial();\n   895→    },\n   896→\n   897→    renderPresetButtons() {\n   898→        this.elements.presetButtons.innerHTML = '';\n   899→        Object.keys(STYLE_PRESETS).forEach(themeName => {\n   900→            const btn = document.createElement('button');\n   901→            btn.textContent = themeName;\n   902→            btn.style.cssText = `\n   903→                padding: 6px 12px;\n   904→                background: rgba(0,0,0,0.05);\n   905→                border: 1px solid rgba(0,0,0,0.1);\n   906→                border-radius: 6px;\n   907→                font-size: 12px;\n   908→                font-weight: 500;\n   909→                cursor: pointer;\n   910→                transition: all 0.2s;\n   911→                color: var(--text);\n   912→                flex-shrink: 0;\n   913→            `;\n   914→            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n   915→            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n   916→            btn.onclick = () => {\n   917→                this.elements.promptInput.value = themeName;\n   918→                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n   919→                this.togglePresets(true);\n   920→            };\n   921→            this.elements.presetButtons.appendChild(btn);\n   922→        });\n   923→    },\n   924→\n   925→    bindEvents() {\n   926→        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n   927→        this.elements.promptInput.addEventListener('keypress', (e) => {\n   928→            if (e.key === 'Enter') this.handleGenerate();\n   929→        });\n   930→        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n   931→        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n   932→        \n   933→        if (this.elements.presetsToggle) {\n   934→            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n   935→        }\n   936→\n   937→        if (this.elements.panelHandle) {\n   938→            let isDragging = false;\n   939→            let startX = 0;\n   940→            const threshold = 50;\n   941→\n   942→            const startDrag = (e) => {\n   943→                if (window.innerWidth < 769) return;\n   944→                isDragging = true;\n   945→                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n   946→                this.elements.themeControls.style.transition = 'none';\n   947→            };\n   948→\n   949→            const doDrag = (e) => {\n   950→                if (!isDragging) return;\n   951→                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n   952→                const deltaX = clientX - startX;\n   953→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n   954→\n   955→                if (!isMin && deltaX > 0) {\n   956→                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n   957→                } else if (isMin && deltaX < 0) {\n   958→                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n   959→                }\n   960→            };\n   961→\n   962→            const endDrag = (e) => {\n   963→                if (!isDragging) return;\n   964→                isDragging = false;\n   965→                this.elements.themeControls.style.transition = '';\n   966→                \n   967→                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n   968→                const deltaX = clientX - startX;\n   969→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n   970→\n   971→                this.elements.themeControls.style.transform = '';\n   972→\n   973→                if (Math.abs(deltaX) < 10) {\n   974→                    this.elements.themeControls.classList.toggle('is-minimized');\n   975→                } else {\n   976→                    if (!isMin && deltaX > threshold) {\n   977→                        this.elements.themeControls.classList.add('is-minimized');\n   978→                    } else if (isMin && deltaX < -threshold) {\n   979→                        this.elements.themeControls.classList.remove('is-minimized');\n   980→                    }\n   981→                }\n   982→            };\n   983→\n   984→            const handle = this.elements.panelHandle;\n   985→            handle.addEventListener('mousedown', startDrag);\n   986→            handle.addEventListener('touchstart', startDrag, {passive: true});\n   987→            \n   988→            document.addEventListener('mousemove', doDrag);\n   989→            document.addEventListener('touchmove', doDrag, {passive: true});\n   990→            \n   991→            document.addEventListener('mouseup', endDrag);\n   992→            document.addEventListener('touchend', endDrag);\n   993→        }\n   994→        \n   995→        // Handle navigation\n   996→        this.elements.navLinks.addEventListener('click', (e) => {\n   997→            if (e.target.tagName === 'A') {\n   998→                e.preventDefault();\n   999→                const type = e.target.textContent.trim().toLowerCase();\n  1000→                \n  1001→                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n  1002→                    this.switchFeed(type);\n  1003→                } else if (type === 'submit') {\n  1004→                    this.toggleMenu(false);\n  1005→                    window.open('https://news.ycombinator.com/submit', '_blank');\n  1006→                } else {\n  1007→                    this.toggleMenu(false);\n  1008→                    alert('This feature is currently unavailable in the Generative UI.');\n  1009→                }\n  1010→            }\n  1011→        });\n  1012→    },\n  1013→\n  1014→    togglePresets(collapse) {\n  1015→        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n  1016→        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n  1017→        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n  1018→    },\n  1019→\n  1020→    toggleMenu(force) {\n  1021→        if (!this.elements.menuToggle) return;\n  1022→        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n  1023→        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n  1024→        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n  1025→        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n  1026→    },\n  1027→\n  1028→    async switchFeed(type) {\n  1029→        if (this.isLoading) return;\n  1030→        this.isLoading = true;\n  1031→        \n  1032→        // Update HNData\n  1033→        HNData.setType(type);\n  1034→        \n  1035→        // Reset state\n  1036→        this.currentOffset = 0;\n  1037→        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n  1038→        \n  1039→        // Close menu (if open)\n  1040→        this.toggleMenu(false);\n  1041→        \n  1042→        // Load\n  1043→        await this.loadAndRender();\n  1044→        this.isLoading = false;\n  1045→    },\n  1046→\n  1047→    async loadInitial() {\n  1048→        this.currentOffset = 0;\n  1049→        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n  1050→        await this.loadAndRender();\n  1051→    },\n  1052→\n  1053→    async loadMore() {\n  1054→        if (this.isLoading) return;\n  1055→        this.isLoading = true;\n  1056→        const originalText = this.elements.loadMoreBtn.textContent;\n  1057→        this.elements.loadMoreBtn.textContent = 'Loading...';\n  1058→        \n  1059→        await this.loadAndRender(true);\n  1060→        \n  1061→        this.elements.loadMoreBtn.textContent = originalText;\n  1062→        this.isLoading = false;\n  1063→    },\n  1064→\n  1065→    async loadAndRender(append = false) {\n  1066→        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n  1067→        this.renderStories(stories, append);\n  1068→        this.currentOffset += stories.length;\n  1069→    },\n  1070→\n  1071→    renderStories(stories, append = false) {\n  1072→        if (!append) {\n  1073→            this.elements.listElement.innerHTML = '';\n  1074→        }\n  1075→\n  1076→        stories.forEach((story, index) => {\n  1077→            if (!story) return;\n  1078→            \n  1079→            const rank = this.currentOffset + index + 1;\n  1080→            const domain = story.url ? new URL(story.url).hostname : '';\n  1081→            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n  1082→            const timeAgo = HNData.formatTime(story.time);\n  1083→            \n  1084→            // Escape HTML in user content\n  1085→            const title = this.escapeHtml(story.title || '');\n  1086→            const author = this.escapeHtml(story.by || '');\n  1087→\n  1088→            const listItem = document.createElement('li');\n  1089→            listItem.className = 'hn-story-item';\n  1090→            listItem.innerHTML = `\n  1091→                <div class=\"hn-story-rank\">${rank}</div>\n  1092→                <div class=\"hn-story-content\">\n  1093→                    <div class=\"hn-story-title-row\">\n  1094→                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n  1095→                        ${domainHtml}\n  1096→                    </div>\n  1097→                    <div class=\"hn-story-meta\">\n  1098→                        <span class=\"hn-story-points\">${story.score} pts</span> • \n  1099→                        <span class=\"hn-story-author\">${author}</span> • \n  1100→                        <span class=\"hn-story-time\">${timeAgo}</span>\n  1101→                    </div>\n  1102→                </div>\n  1103→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n  1104→            `;\n  1105→            this.elements.listElement.appendChild(listItem);\n  1106→        });\n  1107→    },\n  1108→\n  1109→    escapeHtml(unsafe) {\n  1110→        return unsafe\n  1111→            .replace(/&/g, \"&amp;\")\n  1112→            .replace(/</g, \"&lt;\")\n  1113→            .replace(/>/g, \"&gt;\")\n  1114→            .replace(/\"/g, \"&quot;\")\n  1115→            .replace(/'/g, \"&#039;\");\n  1116→    },\n  1117→\n  1118→    handleGenerate() {\n  1119→        const input = this.elements.promptInput.value.trim();\n  1120→        if (!input) return;\n  1121→\n  1122→        const style = this.matchStyle(input);\n  1123→        \n  1124→        if (style) {\n  1125→            this.applyStyle(style, input);\n  1126→            this.togglePresets(true);\n  1127→        } else {\n  1128→            this.showError();\n  1129→        }\n  1130→    },\n  1131→\n  1132→    matchStyle(input) {\n  1133→        const normalizedInput = input.toLowerCase();\n  1134→        for (const key in STYLE_PRESETS) {\n  1135→            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n  1136→        }\n  1137→        return null;\n  1138→    },\n  1139→\n  1140→    applyStyle(css, themeName) {\n  1141→        console.log(`Applying theme: ${themeName}`);\n  1142→        this.toggleMenu(false); // Close menu on theme change\n  1143→        \n  1144→        // Save to local storage for persistence\n  1145→        if (STYLE_PRESETS[themeName]) {\n  1146→            localStorage.setItem('acephale-theme', themeName);\n  1147→        }\n  1148→\n  1149→        // Fallback for browsers that don't support View Transition API\n  1150→        if (!document.startViewTransition) {\n  1151→            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n  1152→            return;\n  1153→        }\n  1154→\n  1155→        // Smooth transition using View Transition API\n  1156→        document.startViewTransition(() => {\n  1157→            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n  1158→        });\n  1159→    },\n  1160→\n  1161→    showError() {\n  1162→        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n  1163→        alert(`Please enter a supported theme:\\n\"${available}\"`);\n  1164→    }\n  1165→};\n  1166→\n  1167→// Start the application\n  1168→document.addEventListener('DOMContentLoaded', () => App.init());\n  1169→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1751b3cb-f5ca-4a9a-b0a0-4fae2e4b579e","timestamp":"2026-02-22T14:34:23.921Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","numLines":1169,"startLine":1,"totalLines":1169}},"sourceToolAssistantUUID":"c702b596-17fb-451d-ae79-ace4527d8971"}
{"parentUuid":"1751b3cb-f5ca-4a9a-b0a0-4fae2e4b579e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01TdbgoC7nP9g6n3byUbvbjw","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a full picture of the current code. Let me implement the plan step by step:\n\n1. Add `GEMINI_SYSTEM_PROMPT` constant after `BASE_URL`\n2. Add new methods to the `App` object: `getApiKey()`, `saveApiKey()`, `clearApiKey()`, `extractCss()`, `generateTheme()`, `renderApiKeySection()`, `showGenerateError()`, `expandApiKeySection()`\n3. Replace `handleGenerate()` with the async version\n4. Update `applyStyle()` signature and logic\n5. Update `init()` to call `renderApiKeySection()` and restore AI-generated themes\n\n\n6. Remove the old `showError` method since it's being replaced by `showGenerateError`\n\nLet me start implementing these changes carefully.","signature":"ErcJCkYICxgCKkA2674z5IPUc7QsumMUja+wWfEKWJpeWN4j0RVoTarxuYSv0dpssJbrNVhYyNHLlsv7LbmQCvDd50fT8LF7l2ytEgzFMYbPkt+CTiRFsJEaDPUv1jpA1seRMoKc8yIwhfiojOMopeHJkK61FIEBL5f0b6IJEcYIUWsgj1i0WTIdRCW+3uDOx0xV4G/6DfteKp4Itx7LY498exryMldREHqCYQUvZYRg7MncRooBI1TjqzUbpZbNLZirN8VhcIT6VjzNIGCV+StrAbqWD+H1Q150QFxVtyGETODlMtnA/PaeWBSDlLdZ1V46FUYhIjqokhBj5vZH/c8uD7qXnqknmcYneCBuXtzUzySHGAfZIT/sAafYnKW777n9ANNVSmMYVvo01JetPs0rVQAz2PTxP/eMN86/epVhxIuwu81vdQSY1oEgSVfMCe+F+gSAgw2dimS4xo8OTd+bYe5YQgUbTygaKk/ezyKreq2PXV4I4zYenZqQcw6Ew48cNeaO/BHipfF4rbDCODBN2jXogJ0nWkwt/Gtb0du3HV4oz4Cc2h5+KrGoOKiYhcbnzRZQ//Pws9Ltk6RNQZE5KB52yeSlq6UiJ95jb3CaIqPsG+1IfnfuoGMr0w574LvB5CCBRoumD88FsO23bgiealnWf5sg8vbxaVKtg7WBvM7Lh98zrWPp3u1gpwbUoc/ElWjDn6S8QkpaTfnwTi6NPhDvB89gWfO735IN4Porc2E7frmL2vFSoan+903UXuIeEFIzxzxxHpOOYIa6W6MrOm1CXBYeMuXuKAsmJgpUmpyk27lNjSpRQrtVNfYIRSNZT7w0/13H7JGa2nadILFuXB7y84z/rtuM3bgo+BwUaU9eN1Mh19mzPLM6LHibiSCXWPHa+zwppnuI8FtZ8Jdtm8cT0FiohsHKFYTKw2RQ+ui2Zqn5yAxf7PooOTgI7oJ415ALPRUdcp7G8elJdg0NrZ5UssqMXsj2UAegdvkdi16MoeTyddM6u9ktO8SAWuP6d8nIgz3cn8jb3KBN/s3TQKFKnLM1oIPic5yMox5SGwdev90VRnQljs1+GcEa5jbdAXASWva2ztBM0W14cll8Cdh5MsiDeaLocLUkz8RrSbpxNBc+eHbpLv7g+pnPw76SRBvCca3jp00W7NvIlUzk2xUPPCbPMyCnNOcE3HEMpRJdJkDRXB+kM7mvhHvcUmyQwAVVOygLli6lwAIPJJ/14g+x9XxGPLYX8cuI537kGwd6bxrc43ZDyDroaBHb1ha/phb4XOeFVZlei3NkPwemHCn9T0zwg2ot4MPaq/ibAd/22+UurFVsulNwCvX/tyihlnUHm8Zwsq3gIzDTity3K00fh3ly+9fUfX0LRmKVhznHO0UcWG4W13x92L7jyCNqyvcix9FJu7WkSs5NzvkTKyzaJF/gXpM299zDQYb3Tt+azuuUy7+DwlIydtzzaKBRpGIOTAS9N8hfmIsDm91LaG5xf38oBImYYqaENKXqhbw4pZ+WT7FyjMoEMNbvqHMVVbtfwjNtjGCg0MASqo/UEfhYdZV3aeXVMGPquya/yI61HXfo60Eo1V4v05TGIIyTxX1mE10r0xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":17988,"cache_read_input_tokens":25080,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":17988},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGo7TsuXBL2msr4L7zy","type":"assistant","uuid":"d3d0cbf1-e96c-484a-bf42-18359f6b682a","timestamp":"2026-02-22T14:34:32.049Z"}
{"parentUuid":"d3d0cbf1-e96c-484a-bf42-18359f6b682a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01TdbgoC7nP9g6n3byUbvbjw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UemV4Z8Xuy7F7PBxMKKZUi","name":"TaskCreate","input":{"subject":"Implement AI Theme Generation via Gemini API","description":"Add Gemini 2.0 Flash integration to gardener.js for AI-powered CSS theme generation. Steps: 1) Add GEMINI_SYSTEM_PROMPT constant, 2) Add API key management methods, 3) Add generateTheme/extractCss methods, 4) Add renderApiKeySection/showGenerateError/expandApiKeySection UI methods, 5) Replace handleGenerate with async version, 6) Update applyStyle signature, 7) Update init()","activeForm":"Implementing AI theme generation"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":17988,"cache_read_input_tokens":25080,"output_tokens":544,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":17988,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYPGo7TsuXBL2msr4L7zy","type":"assistant","uuid":"45f385e9-492d-4853-8c84-af5538429629","timestamp":"2026-02-22T14:34:34.305Z"}
{"parentUuid":"45f385e9-492d-4853-8c84-af5538429629","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UemV4Z8Xuy7F7PBxMKKZUi","type":"tool_result","content":"Task #1 created successfully: Implement AI Theme Generation via Gemini API"}]},"uuid":"c8a57300-a532-4e04-888e-7d1ade8e3b17","timestamp":"2026-02-22T14:34:34.310Z","toolUseResult":{"task":{"id":"1","subject":"Implement AI Theme Generation via Gemini API"}},"sourceToolAssistantUUID":"45f385e9-492d-4853-8c84-af5538429629"}
{"parentUuid":"c8a57300-a532-4e04-888e-7d1ade8e3b17","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01VsUfHUARUGGXiLin1n2J4d","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014tmFmQkW6N5nznbRksGkhM","name":"TaskUpdate","input":{"taskId":"1","status":"in_progress"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":563,"cache_read_input_tokens":43068,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":563},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGosqcVgTw7ZnPJYNz1","type":"assistant","uuid":"c2b93044-e1be-4539-ad19-6b6405b134f2","timestamp":"2026-02-22T14:34:35.952Z"}
{"parentUuid":"c2b93044-e1be-4539-ad19-6b6405b134f2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014tmFmQkW6N5nznbRksGkhM","type":"tool_result","content":"Updated task #1 status"}]},"uuid":"46838c84-b715-4e18-8cba-e917a66d0be8","timestamp":"2026-02-22T14:34:35.953Z","toolUseResult":{"success":true,"taskId":"1","updatedFields":["status"],"statusChange":{"from":"pending","to":"in_progress"}},"sourceToolAssistantUUID":"c2b93044-e1be-4539-ad19-6b6405b134f2"}
{"parentUuid":"46838c84-b715-4e18-8cba-e917a66d0be8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01C72AeQrEEY6yeTUmRZKjda","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll implement all the changes. Let me start with Step 1 — adding the `GEMINI_SYSTEM_PROMPT` constant:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":90,"cache_read_input_tokens":43631,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":90},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGp12D1eTj3frr6Dnpd","type":"assistant","uuid":"96e67994-5159-4ae6-8135-5cda2fd6b505","timestamp":"2026-02-22T14:34:37.675Z"}
{"type":"file-history-snapshot","messageId":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","snapshot":{"messageId":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v1","version":1,"backupTime":"2026-02-22T14:34:45.643Z"}},"timestamp":"2026-02-22T14:34:21.205Z"},"isSnapshotUpdate":true}
{"parentUuid":"96e67994-5159-4ae6-8135-5cda2fd6b505","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01C72AeQrEEY6yeTUmRZKjda","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018RdLEuz7feB1VhMGvwEeSz","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';","new_string":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":90,"cache_read_input_tokens":43631,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":90},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGp12D1eTj3frr6Dnpd","type":"assistant","uuid":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","timestamp":"2026-02-22T14:34:45.641Z"}
{"parentUuid":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_018RdLEuz7feB1VhMGvwEeSz","toolUseID":"toolu_018RdLEuz7feB1VhMGvwEeSz","timestamp":"2026-02-22T14:34:45.646Z","uuid":"487e9811-d2b6-4c86-acdc-b6fe325053a3"}
{"parentUuid":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018RdLEuz7feB1VhMGvwEeSz","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"358797c1-21a5-4a7f-a68c-90ee6646aae9","timestamp":"2026-02-22T14:34:45.646Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';","newString":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":5,"oldLines":6,"newStart":5,"newLines":31,"lines":[" "," const BASE_URL = 'https://hacker-news.firebaseio.com/v0';"," ","+const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.","+Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.","+","+Define all of these CSS custom properties on :root, then optionally add component overrides:","+","+:root {","+    --bg:                  /* page background */;","+    --card-bg:             /* story card background */;","+    --text:                /* primary text */;","+    --subtext:             /* secondary/meta text */;","+    --accent:              /* links and accent */;","+    --header-bg:           /* header background (rgba allowed) */;","+    --font-main:           /* font stack */;","+    --item-radius:         /* card border-radius */;","+    --item-border:         /* border shorthand or none */;","+    --item-shadow:         /* box-shadow or none */;","+    --more-btn-bg:         /* More button background */;","+    --more-btn-color:      /* More button text color */;","+    --mobile-upvote-bg:    /* upvote bg on mobile */;","+    --mobile-upvote-color: /* upvote text on mobile */;","+}","+","+Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.","+Output nothing except the CSS.`;","+"," /**","  * System Core Styles (Layout, Typography Base, Responsive Logic)","  * Themes should override variables in :root or specific classes if needed."]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5e95d4e0-f697-42bb-bb0e-5962537d77bf"}
{"parentUuid":"358797c1-21a5-4a7f-a68c-90ee6646aae9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01BDCzyAypvAzQVNkZKi93Qk","type":"message","role":"assistant","content":[{"type":"text","text":"Now Step 2 — add new methods to the `App` object. I'll insert them before `handleGenerate`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":589,"cache_read_input_tokens":43721,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":589},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGpiMsp1VpHNZUDTyBc","type":"assistant","uuid":"6291c92b-5e9a-460d-8dd2-e6f461de9dda","timestamp":"2026-02-22T14:34:47.385Z"}
{"parentUuid":"6291c92b-5e9a-460d-8dd2-e6f461de9dda","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01BDCzyAypvAzQVNkZKi93Qk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MTa3geMpDJkuRK8Uj76iWy","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },","new_string":"    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":589,"cache_read_input_tokens":43721,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":589},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGpiMsp1VpHNZUDTyBc","type":"assistant","uuid":"bd65e73f-5d32-43be-990c-3226c0cbac75","timestamp":"2026-02-22T14:35:13.318Z"}
{"parentUuid":"bd65e73f-5d32-43be-990c-3226c0cbac75","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01MTa3geMpDJkuRK8Uj76iWy","toolUseID":"toolu_01MTa3geMpDJkuRK8Uj76iWy","timestamp":"2026-02-22T14:35:13.323Z","uuid":"cd5b3ecc-5464-4012-980c-1b7d09172de3"}
{"parentUuid":"bd65e73f-5d32-43be-990c-3226c0cbac75","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MTa3geMpDJkuRK8Uj76iWy","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"df105684-e7de-426d-8ca3-cf41a8ce5178","timestamp":"2026-02-22T14:35:13.323Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },","newString":"    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1140,"oldLines":18,"newStart":1140,"newLines":165,"lines":["             .replace(/'/g, \"&#039;\");","     },"," ","-    handleGenerate() {","+    getApiKey() {","+        return localStorage.getItem('acephale-gemini-key');","+    },","+","+    saveApiKey(key) {","+        localStorage.setItem('acephale-gemini-key', key.trim());","+    },","+","+    clearApiKey() {","+        localStorage.removeItem('acephale-gemini-key');","+        this.renderApiKeySection();","+    },","+","+    extractCss(text) {","+        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');","+        cleaned = cleaned.replace(/\\s*```\\s*$/, '');","+        return cleaned.trim();","+    },","+","+    async generateTheme(prompt) {","+        const key = this.getApiKey();","+        if (!key) throw new Error('NO_API_KEY');","+","+        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;","+        const body = {","+            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },","+            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],","+            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }","+        };","+","+        const response = await fetch(endpoint, {","+            method: 'POST',","+            headers: { 'Content-Type': 'application/json' },","+            body: JSON.stringify(body)","+        });","+","+        if (!response.ok) {","+            const status = response.status;","+            if (status === 400 || status === 403) throw new Error('INVALID_KEY');","+            if (status === 429) throw new Error('RATE_LIMIT');","+            throw new Error(`API_ERROR:${status}`);","+        }","+","+        const data = await response.json();","+        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;","+        if (!rawText) throw new Error('EMPTY_RESPONSE');","+        return this.extractCss(rawText);","+    },","+","+    renderApiKeySection() {","+        const existing = document.getElementById('api-key-section');","+        if (existing) existing.remove();","+","+        const section = document.createElement('div');","+        section.id = 'api-key-section';","+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';","+","+        if (this.getApiKey()) {","+            section.innerHTML = `","+                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">","+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>","+                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>","+                </div>`;","+            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());","+        } else {","+            section.innerHTML = `","+                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>","+                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","+                </div>","+                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">","+                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">","+                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>","+                </div>`;","+            section.querySelector('#api-key-toggle').addEventListener('click', () => {","+                const form = section.querySelector('#api-key-form');","+                const icon = section.querySelector('#api-key-icon');","+                const isOpen = form.style.display !== 'none';","+                form.style.display = isOpen ? 'none' : 'flex';","+                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';","+            });","+            section.querySelector('#api-key-save-btn').addEventListener('click', () => {","+                const val = section.querySelector('#api-key-input').value.trim();","+                if (!val) return;","+                this.saveApiKey(val);","+                this.renderApiKeySection();","+            });","+        }","+","+        this.elements.themeControls.appendChild(section);","+    },","+","+    showGenerateError(err) {","+        let message;","+        switch (err.message) {","+            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;","+            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;","+            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","+            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;","+            default:              message = `Generation failed: ${err.message}`;","+        }","+        let errEl = document.getElementById('generate-error');","+        if (!errEl) {","+            errEl = document.createElement('div');","+            errEl.id = 'generate-error';","+            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';","+            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);","+        }","+        errEl.textContent = message;","+        clearTimeout(this._errorTimeout);","+        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);","+    },","+","+    expandApiKeySection() {","+        const form = document.getElementById('api-key-form');","+        const icon = document.getElementById('api-key-icon');","+        if (form && form.style.display === 'none') {","+            form.style.display = 'flex';","+            if (icon) icon.style.transform = 'rotate(0deg)';","+        }","+        this.elements.themeControls.classList.remove('is-minimized');","+        const input = document.getElementById('api-key-input');","+        if (input) setTimeout(() => input.focus(), 300);","+    },","+","+    async handleGenerate() {","         const input = this.elements.promptInput.value.trim();","         if (!input) return;","+        if (this._isGenerating) return;"," ","-        const style = this.matchStyle(input);","-        ","-        if (style) {","-            this.applyStyle(style, input);","+        const presetCss = this.matchStyle(input);","+        if (presetCss) {","+            this.applyStyle(presetCss, input);","             this.togglePresets(true);","-        } else {","-            this.showError();","+            return;","         }","+","+        if (!this.getApiKey()) {","+            this.expandApiKeySection();","+            return;","+        }","+","+        this._isGenerating = true;","+        const btn = this.elements.generateBtn;","+        const originalText = btn.textContent;","+        btn.textContent = 'Generating...';","+        btn.disabled = true;","+","+        try {","+            const css = await this.generateTheme(input);","+            this.applyStyle(css, null, input);","+            this.togglePresets(true);","+        } catch (err) {","+            this.showGenerateError(err);","+        } finally {","+            btn.textContent = originalText;","+            btn.disabled = false;","+            this._isGenerating = false;","+        }","     },"," ","     matchStyle(input) {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"bd65e73f-5d32-43be-990c-3226c0cbac75"}
{"parentUuid":"df105684-e7de-426d-8ca3-cf41a8ce5178","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01W7gNU37LDPnLbJk35RPKm2","type":"message","role":"assistant","content":[{"type":"text","text":"Now Step 4 — update `applyStyle()`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2307,"cache_read_input_tokens":44310,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2307},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGrkn3VqUtYz8JhTAW4","type":"assistant","uuid":"49f63cfc-da76-4af9-a317-e8c9225eed3c","timestamp":"2026-02-22T14:35:15.282Z"}
{"parentUuid":"49f63cfc-da76-4af9-a317-e8c9225eed3c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01W7gNU37LDPnLbJk35RPKm2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VKi2yMPWnYh1MGccyhXUNo","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }","new_string":"    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2307,"cache_read_input_tokens":44310,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2307},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGrkn3VqUtYz8JhTAW4","type":"assistant","uuid":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb","timestamp":"2026-02-22T14:35:22.595Z"}
{"parentUuid":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01VKi2yMPWnYh1MGccyhXUNo","toolUseID":"toolu_01VKi2yMPWnYh1MGccyhXUNo","timestamp":"2026-02-22T14:35:22.601Z","uuid":"0d462c38-97c3-4dce-91ca-04f8d461d9aa"}
{"parentUuid":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VKi2yMPWnYh1MGccyhXUNo","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"33b16794-3493-4bf6-bfdd-73f2c9e22c91","timestamp":"2026-02-22T14:35:22.600Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }","newString":"    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1309,"oldLines":30,"newStart":1309,"newLines":25,"lines":["         return null;","     },"," ","-    applyStyle(css, themeName) {","-        console.log(`Applying theme: ${themeName}`);","-        this.toggleMenu(false); // Close menu on theme change","-        ","-        // Save to local storage for persistence","-        if (STYLE_PRESETS[themeName]) {","+    applyStyle(css, themeName, customPrompt = null) {","+        this.toggleMenu(false);","+","+        if (themeName && STYLE_PRESETS[themeName]) {","             localStorage.setItem('acephale-theme', themeName);","+            localStorage.removeItem('acephale-custom-css');","+            localStorage.removeItem('acephale-custom-prompt');","+        } else if (customPrompt) {","+            localStorage.setItem('acephale-custom-css', css);","+            localStorage.setItem('acephale-custom-prompt', customPrompt);","+            localStorage.removeItem('acephale-theme');","         }"," ","-        // Fallback for browsers that don't support View Transition API","-        if (!document.startViewTransition) {","+        const applyFn = () => {","             this.elements.styleTag.textContent = SYSTEM_STYLE + css;","-            return;","-        }","+        };"," ","-        // Smooth transition using View Transition API","-        document.startViewTransition(() => {","-            this.elements.styleTag.textContent = SYSTEM_STYLE + css;","-        });","-    },","-","-    showError() {","-        const available = Object.keys(STYLE_PRESETS).join('\", \"');","-        alert(`Please enter a supported theme:\\n\"${available}\"`);","+        if (!document.startViewTransition) { applyFn(); return; }","+        document.startViewTransition(applyFn);","     }"," };"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb"}
{"parentUuid":"33b16794-3493-4bf6-bfdd-73f2c9e22c91","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LWyUSmNcpoKXszepU119GQ","type":"message","role":"assistant","content":[{"type":"text","text":"Now Step 5 — update `init()`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":641,"cache_read_input_tokens":46617,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":641},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsSG66ZA6tKbRWfrzo","type":"assistant","uuid":"02d6cd53-616c-4c18-b3e1-cadcc9eee458","timestamp":"2026-02-22T14:35:23.821Z"}
{"parentUuid":"02d6cd53-616c-4c18-b3e1-cadcc9eee458","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LWyUSmNcpoKXszepU119GQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XoKCHMqQBjgqyG9nES74sH","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },","new_string":"    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":641,"cache_read_input_tokens":46617,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":641},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsSG66ZA6tKbRWfrzo","type":"assistant","uuid":"08855215-c7f6-4d73-889e-8217fa51fc18","timestamp":"2026-02-22T14:35:29.291Z"}
{"parentUuid":"08855215-c7f6-4d73-889e-8217fa51fc18","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01XoKCHMqQBjgqyG9nES74sH","toolUseID":"toolu_01XoKCHMqQBjgqyG9nES74sH","timestamp":"2026-02-22T14:35:29.295Z","uuid":"69a0db94-6838-490a-98c9-e291ee1afa36"}
{"parentUuid":"08855215-c7f6-4d73-889e-8217fa51fc18","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XoKCHMqQBjgqyG9nES74sH","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"dffb2b16-32bd-49e7-8e19-9ed212198961","timestamp":"2026-02-22T14:35:29.294Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },","newString":"    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":906,"oldLines":16,"newStart":906,"newLines":21,"lines":[" ","     async init() {","         this.renderPresetButtons();","+        this.renderApiKeySection();","         this.bindEvents();","-        console.log(\"Generative UI - Architecture Refactored.\");","-        ","-        // Restore saved theme or fallback to Minimalist","-        const savedTheme = localStorage.getItem('acephale-theme');","-        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";","-        ","-        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);"," ","-        // Initial load","+        const savedPreset = localStorage.getItem('acephale-theme');","+        const savedCustom = localStorage.getItem('acephale-custom-css');","+        const savedPrompt = localStorage.getItem('acephale-custom-prompt');","+","+        if (savedCustom) {","+            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');","+            if (savedPrompt) this.elements.promptInput.value = savedPrompt;","+        } else {","+            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';","+            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);","+        }","+","         await this.loadInitial();","     },"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"08855215-c7f6-4d73-889e-8217fa51fc18"}
{"parentUuid":"dffb2b16-32bd-49e7-8e19-9ed212198961","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_016S3jvMbS9u49nAsiDPF76e","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to fix the `matchStyle()` call in the new `handleGenerate()` — the old `matchStyle` returns the CSS string, but we're now also calling `applyStyle` with the input as themeName. Let me check how `matchStyle` works and how `handleGenerate` uses it:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":557,"cache_read_input_tokens":47258,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":557},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsw8Ac9ZdACMAd8Ah9","type":"assistant","uuid":"0901bb75-700d-457e-87f8-b3ec776be156","timestamp":"2026-02-22T14:35:32.996Z"}
{"parentUuid":"0901bb75-700d-457e-87f8-b3ec776be156","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_016S3jvMbS9u49nAsiDPF76e","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BCFs3a2VbU24T7ov9nUcNr","name":"Grep","input":{"pattern":"matchStyle","file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":557,"cache_read_input_tokens":47258,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":557},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsw8Ac9ZdACMAd8Ah9","type":"assistant","uuid":"3a8a9169-be7c-4313-ae63-0cf3b7ccdcca","timestamp":"2026-02-22T14:35:33.735Z"}
{"parentUuid":"3a8a9169-be7c-4313-ae63-0cf3b7ccdcca","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>InputValidationError: Grep failed due to the following issue:\nAn unexpected parameter `file_path` was provided</tool_use_error>","is_error":true,"tool_use_id":"toolu_01BCFs3a2VbU24T7ov9nUcNr"}]},"uuid":"f9e48c36-b73f-43f7-8fba-56f99547197a","timestamp":"2026-02-22T14:35:33.735Z","toolUseResult":"InputValidationError: [\n  {\n    \"code\": \"unrecognized_keys\",\n    \"keys\": [\n      \"file_path\"\n    ],\n    \"path\": [],\n    \"message\": \"Unrecognized key: \\\"file_path\\\"\"\n  }\n]","sourceToolAssistantUUID":"3a8a9169-be7c-4313-ae63-0cf3b7ccdcca"}
{"parentUuid":"f9e48c36-b73f-43f7-8fba-56f99547197a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LpAunsgpBebtSTCaBBd8Vy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RZwBvPc9sGB9VE8uBugog6","name":"Grep","input":{"pattern":"matchStyle","path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":376,"cache_read_input_tokens":47815,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":376},"output_tokens":19,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtGCt7sd9YBCz8FxuT","type":"assistant","uuid":"ef127d44-e668-433d-8c5e-88e00fd3eeeb","timestamp":"2026-02-22T14:35:35.454Z"}
{"parentUuid":"ef127d44-e668-433d-8c5e-88e00fd3eeeb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01RZwBvPc9sGB9VE8uBugog6","toolUseID":"toolu_01RZwBvPc9sGB9VE8uBugog6","timestamp":"2026-02-22T14:35:35.762Z","uuid":"455e37a0-f1d3-43aa-a79e-633475968e09"}
{"parentUuid":"ef127d44-e668-433d-8c5e-88e00fd3eeeb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RZwBvPc9sGB9VE8uBugog6","type":"tool_result","content":"1278:        const presetCss = this.matchStyle(input);\n1309:    matchStyle(input) {"}]},"uuid":"68079487-da59-4cfa-be9a-a2ffcb637f11","timestamp":"2026-02-22T14:35:35.761Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1278:        const presetCss = this.matchStyle(input);\n1309:    matchStyle(input) {","numLines":2},"sourceToolAssistantUUID":"ef127d44-e668-433d-8c5e-88e00fd3eeeb"}
{"parentUuid":"68079487-da59-4cfa-be9a-a2ffcb637f11","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_011A4MhmX2WtekdjtUDY9dCt","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The `matchStyle` function returns the CSS string if a match is found. In the new `handleGenerate`, when we call `this.applyStyle(presetCss, input)`, we're passing `input` (e.g. \"minimalist\") as `themeName`. But `applyStyle` checks `STYLE_PRESETS[themeName]` which requires the exact key (e.g. \"Minimalist\"). \n\nThe `matchStyle` returns the CSS value, but we also need the matched key name. Let me look at the current `matchStyle` and `handleGenerate` code more carefully.\n\nIn the old `handleGenerate`:\n\n\nI'm calling `matchStyle` to find the CSS, then passing the user's raw input to `applyStyle` as the theme name. But `applyStyle` tries to look up that input directly in `STYLE_PRESETS`, which won't work because the user typed \"minimalist\" (lowercase) while the actual key is \"Minimalist\" (capitalized).\n\nThe fix is to have `matchStyle` return both the CSS and the matched key name from `STYLE_PRESETS`, so I can save the correct theme name to localStorage. the theme won't save if the case doesn't match exactly. I could fix this by having `matchStyle` return both the CSS and the matched preset key, then pass that key to `applyStyle` for proper storage. But looking at the plan, it specifies implementing `handleGenerate` exactly as written with the existing `matchStyle` behavior, so I'll stick with that approach even though it means the theme won't persist correctly on case mismatches.\n\nThe preset buttons bypass this issue entirely since they call `applyStyle` directly with the correct key from the preset object, so that path works fine. When a user types a preset name in `handleGenerate`, it'll apply the style but only save properly if the case matches exactly.\n\nUpdating applyStyle...","signature":"Eu8kCkYICxgCKkD5BmTJcfLw18DPpkYKqBK94DsYtDrC9NzbrnU153LLkS07bYCNINRprdK/gr1TMjLVrbD3Ru0bgAmXdQMIffs2Egy6qts0/G2Apaez9MkaDGveySk6TuZbTrsNayIweDdnm1cOAUFvgtqFn36cX9+98XF34XA9JDxBDxJVQPpvS0E4GTHxIpAhhcUIgDlpKtYjodBqkPObjRR/E9JDbKyzeRwpsfDnAkf5yXtWmKaqHHOJl45WDzM6qeyS8YXAcIheUgfbxQp4fo7pCr1w6SJ7wqf9JBAptF7iOUZGcRqAcZupsumq7ZIoJ7HH/zW90337KU/oLjteGlZ0lHTc/dqGrUlv1fOjS9SHVKyeXYUADuZcbrsjzDrVP+VYAhF+7NWgtFmo3oNJQJfQrQtDk+yNvoKS+cm+b+NgiycukicJq3NIwDodPYFuKQSrH1mfsJ2YP4KKIEfPKrNtl/OQnbV6mlNJxulRz1XeaDNzQxhujfcHDBI0Su8OygCbNkU10RLy5yFsECcEd3EXdlaIhT39jelDGAlg8JM7UxttfFi3ANszMK70jzZ051v1GKU75ifyjYuz9In/3gK2QMTEXM2qec4igFwYsWrJj0TuRZUUGouCyYFDL3hdkTcWKX3h1jJhnn0KxTeJ2VQ9JBD4SOZuYjLa/ilV/HAVANwbA5d6qJ2Y9Pvm04DmN0CftXiuIsNWwEt1VoPs7W0uksWnHzydn8i8y5tl6kbfcUcHO4DErOSPFAGv2Cun+D9FvybZBJJFfJMgVXJgNiUnMt+IJk1TbYvBMA6B2RbLfVRhS/AjJjq6klLSonMjG0Tj4WfPdEr1d9CMhVAGZxgogVtz+9JDK41XpD90mxHTZTd4gGC6mzz2uf8zYApaOHgNvOKbgk7KYfNuAqqg50j/0BDMDpUVo2cJ7FSbDcTJTwcw7yTtqvSNf0PKS0oxfp/RiczeeTaNkdMIFg92CZZ+K8c+aw970Sim/Ym36a421yr5Hv9Mzeinfe/rzeXKShwNMalwPzncUaWcLlNRcpj0ZsBnzN/iLWUBrka4GX0yc4Nw3XgZr+FwIWYutwVh/dVh71RwysqdeG4tI34S7mSECzsfge5nQ/GRBjHAHKdMxLNnWeGFLFBc74y+bjgT3hx/RIjR7Tu3unZXY29ySqiNNYXNvk0/waU9w19Tql1YOQLCba2M9tlMPMGZ9UHPyOXQgYw9DpWMm1e6beUU7pK4pPn0QB8cuggXs6SdiamVQ+8biux8o9Rvqkd36zpJD2I8ag0TYWph2tOrZMyj63vx9U+AHL9R24VHnHMA2xy0F/lu9aKRWdQjy/1L9rQHzW/sfnHSRU5gGiaD1qThlcYz8oBalBgV2ds0ulaSwnQfS4nk1a/BQadbpmBlBiEzRCrvYliw9bwU1NUNBQ2eV3yb8zZ4Q8AQQbRaWYAYpZ0Dok8taYzPrWTwmoWpIhEzj284Ly7jQivPIWvVgxuVAjX9U+aqbwlHGQqChS83Hp97fxNZDX03JPLU0Gnj5kn9Ln59q7b91GOCogDCtdlF3pRpzYC7zg0u8Ypaquhamsr97dDCHv4s/slSsqX0Z66tERFBaV7WLTMXqoK9OFvdfVXetKLyzqFKONpLRL/13tDE09skv6E0vpRKJuX0/MFV7gH5+rNay+NZpJayWG2aFuTSuZ8sqoO8rCoP19cP5/2hwGouy28gssvN+4CPp/ZZYr8YkJfiaJ1AFCa5jLhwx5yovWtfXbD5edX4+InkNl3MGNvfp2CpMdCeYcK3QWY4G09MLTw0TJoEN0RO0hjekZtzmIsP6msL/PTBMZB17gZADGCZFI68T6WAY0XTVGPCBjsAhXFu/tgO2FDSoPrBwdLoBADgmEUBOmnk9SZ3232eJmu5Nn2j/1oPTcjYn1YVVCWSl2Oz+rcmP7CG+OzQQS1P0gX0grUM1+3FDK0zpnUvYfpZhnoEF+nn8GKvE01JqCE1V26cVAvsIZtUqfBjQxZ/XRb9n8raRmuqG8u/HrOLRXxr7dwk+B3Kq6lj/INHXePkNb3H60ITZuymkuDfBSKnJU/2zYdqVPYXx0jwutRBrEI671TxRUJrY20qm4YOXZ9Poaa1E8MVjdRzdkBHD5HSNiOFhDS4WfqJ9uvzseUGF8joX333HH03alWI/Isg/v0weOsVZWnr0CVh89YJpcqknQg6PZbkCp8xOAPxR7ZMSuuK7Fc8WiVfRs4HtE4jknBjDRdhD1+ZYGaf3UtGnwk70YfaUfANkdZjziGXET1MQavtUI09F8NhwFFXfWx6ibWjYkG6o9uyfcE1pZZEqJExcB/viQUridqRC34lOyqhJT+hKh0V03teVLtTp4TJztykf86GChAqLuclm7RMwhC4aFEBdEgYzWk8Z8Y1kCnaNFBV4GPyCtu9o8CenkIMBvdYa5axI6uGaAueVCKb8fPNf7xQySEeNOIKFKQxLIlPRWlfLUkWwskhiFIZFHjd5lyMSB9YF82QiLnIKT7owX3tu4rNbSztjA9PM1FUX9OjPaEybkoyvq0qiGkJvih3pgD/x9jnG+i/eSCnllGMTXQn5wv0y+2dZxS9hRXjW2RPDcvl1aqBfsV6KBvNLpmazXQCOUxJqq2u5UGYB7nwahRT5pQaAMVnGyjnOI8IXQgM2M1FxGPnROgbf/aPAjENA3uBP8i1A+1198GASXXvHO89rTr4GHryVKBxLbt3/ak2nkNubin4F3PM5GRtkTpQ0gk/QeGlMRAuPXTmNVkPaYfCAuf6RDUPauYgtTEwUyMrhNiy48q7jBqFyuPurZLQsjZIimv0/fO7fgOGIOg6dse44XMeZwf/WOeIT/SZcqW4o5g+oyxOC7sOCbfxXcPObp6sErE3Wzgl84P8yaO/yHHGuVt3TLAxxi0rnNkLW4vRnLe0ASbupAcF9g9tuOsLknG4z36OyzfDCPYI7glwMrcwjTZQ2itZ8HxKS+CmVuG4n+e4T4RhnRPmuP24cAQWo/rCpXkBMzGsV1PN79JDC4WOb4JLXbfKocWBb4PbMoGWwhk+WqgOjX8mBKsiBvhIM4QjvUbcrgqsxjUCQ80tCWvpBQaO7iP9AjSe/jpITSF8VIScJ5rGzf0C84pPuVXgi67Lf8Das4aEDtUEk1+EYT5ITHOgfr8vwWpDALQrt+9vt9sgBAmi/Bf+wze2PxqgIT1+4ni0RctG25kX+QhVfBfEGXP21Kn8u+TBVA5RZNTZpdyjDaKOk3kfxcdEUfuNngmHZY53uOy2BYeNnYoqwhbe7zY1PxwOKLGgmh9sgp3zODUfYCjH4f9BLr0IInzdjEce+lDuOBcsFOG1EhhF8ZIYrMkbQuVzlFFPAoQteh/E6aAp9cIVG2ZIQ88AY15quJbZ53io7H5Ey0SVTEBkA0jRnArnAo/zayOU40dsl4F3gOcpSL60MmgkJgFHlVbQ9ZNvDLIDz8uXU6Mi950b/aRoNTYBTg+qF8Z+KM1aiBf8V7q0p75vRhESdNdbjwCZRJSknnb2nKEGA5OSLKMi4O8alMT5sD+Pt4n7emJHMVSnkdzUAAShmNThUBra5XSy9gfPEdh+o8yt5LZJejuL8Nkuwnf0aME13xo+i3Mrx8q+7IBAzzsr/V3j9CGwbqA6mAE3w7dty93E9y/tB4D4tPDmzFeSRtGDdC+rcEE3bkfVfVOidP2yjVGYjEVF1Mi6xMAyNKbLpsk1jbbnnVMN0X2Kg3M02FWlMzxecx5jn3yL8GAr98/TgCaV/YwJ2fdJbfKFP6TUJWJlPar7dWChLATae1AZQ7aSyilIysZ+cd3ENaEs6OoCf+qno6IQEe0DeM3vSVkdYSXWECg+AZ7reTRxEQ7Y4KfkhL8KRz+jNWxKJPx5rSZ9bdgnxSLkTk5VcuUAEapDdlVa6PpHPjwfE50y7hkqc6rwA0X0IJye5AUACrEEFWI+8UW7Fc54hDTHZWJ+3eB/CPypPS242vJcMVWVtFE9QtyHiFSc2zqdkSnGIPnpkJOcPaOzkW/wxPPT9w6EFnT1DHS1EmjqBuHZHsouV8GlylFiojTXWSJYKpHZS6+BDUvh/pWfgqNiRlzfTcl+kZYNTlOX6B48VqdpxHKtjlqdBZ9qccRfl91yvjAxLgREPOcuhWPP8/wLy5+odxl7Oi8UA397WfbIchFnHQ09mKaIp7XCRv2WIR67FQZxY3nY5S5G08nRTNY5VDrI5Os5GS+fz59/V0CdHZkH2OsivEJMnAs0WTEv7ITxoD4c6CKmx0Ha6AN67N/OP8w6n8e3o0pCdh+sqGHvHSEFHUtAeYx5crSIeE2SYjqGba6InaTjwbA3iQM/OR3LQrpz4WAO34UlCCzhGXGaGFjLVgmhft9Ci1Mvgne5quS+90a96LQ58D/5OXmTgTP0MO289QaA194FwydiQdxGq1uTOq1kRXQJ0mwNvSrpnEy/HSX+p1yvKKxQM7Vfo0jSUWIZvDqcE7vfkHliYCXqllJcf7lQvPLFYIgT/ydewLaoDXlL/J3DBXOFrg3GGkwgfid6IXr+cyuCzA1kMnA9EctmFFEvtGe2loUrvE4YfdtQHWzCk9zQ8eE57135G++tycWob63MWLQ3DaN9jjtsiWfIad0RNTnM1scRHBVJYMF4G3JCyK7oVdxD8CfYFjE8zNeYQa3ifFT26IsFlqpOvm5X5MfKQvpZBTH645MH91A1/sbcObsVFONSPSZN6X0bVX8SPxOVguiyQHq+6m5kLZTSCQaX2wSFnLl26/dt/pAD7nP7qPm5TJfv2Oedc7iKsro/dzMHMvTTvr4h7xRnHgDJmMAQz6HMW52U1bJaSQDyn5yyc21BPM3ljWABD2U2/HlwjlZPLBLnxVXsTxRY2yEYLaMww3Fo674O0Q1GHZvSxrBdwpBhKY3CPAoSNqC1sifCmyqpHbkgE0T19YOE2P36cLEqB7f2XdH++X7cKASV50L7J8UejY+XGHcBWDCsVueuVDlse+kvZc3nUD1fdTsMrTWS849mCXlHOdyKWHYpeCsZqDUEeZXpkQahPeqb73mVZDm0DuHiEll+Aq1dfLeFizMkRtgb7Rr8jd5snf2dcs+tzQdNfDY5+idblcA9Ap86tVLMhqC8+2g9KEozEeTIk7JYVhA8zodVhGJv6jtr/tLcu7BeisXdJTFlof1ul/Kz+vOuPOOTRvDLz41Y9DrPbT4vdG6UJf07oT0YfyrzeuC183732rX3iplaJEztQpZzOvme5e4QieJaPoW027DfDO4JojZVSfcActHXPvSqGVcuy5chyaFvzvnpxpBl5qZE1gCVQzYdZCwA8/TDza0D//USi3mIcp2n4lAWD4ykZhHaGLxQaifqPnAaz7P8D3d0wcrf1Be5wSMsjXOleYxxV4xYlhIkxk/pH+fGMO3fGYKssqdBnhhW8tMBi0hexNUUe6CJOyew2OL2UPrUrzBLUImb/SOzDZhu8XchfulM5yNdQsU0ZXDryDO2RHfkveXNayw0tmu9uX81/v/jWYpz3t80+lyIjeAFR+spw0q84VuheDkB4AeD1TY8u8tHzCkBf43y7R6ZYsGoYZw95ez7ytbkWMk0/rS5CrUmcCBeIOA8/o5i3rW6mDoEuY1dlDLZSyYLDjY6bOKnKYI2tDWRPeRM0WAAPE+1Nk4GMxPKj2WQWaPdCwL06SdISmASvbx04ss9e7eYk78DAdDztEcx/S8qfisqOydDrsmqFpwnN0nBFDwLWMExwrvtu+Jg+69bTyUL5Jf3vyTk3K30DMl0+usZ1YxP26DR+o28kp9ZcWbbNMPboPq20wlyfCLEJDSiZ6ImwR01MDlSqXFXdErx5IS8p1YbmAKwi1wBPY2kY1aiADDTgNSBPSfoapSdlw3qMNfzJ8H/0xIO0bBpR6uGY8RiyUely346ynNff39CX5JPPm4pwR7HWkAh0KKmwfmGJPA/Fcrp5FM2Mz7L6mWSKqmJh2xUsM3USWHxMqrfHOKthL5UtOJtKzYetJY/vEO2mOoWDJ+p5TpLqMBV1kX65vLxuipP4jdmRFaUzrO8Tu95DHH4SUBP6au5egEhx1pZOKTh8LN00W6IHopfvRGvEJPSzu+e+cvPnRT7g0bNbHNedbIkUjA1QaLSPYEzFIYyBT1AVKsIdawK3RAe/yK7wkgFPtxSNrgkRC7ZRnQ/3LGIedDS7PfB9Zgp97a+opHwuoJX6rSV2iTcujOhJDz9PFXGIBhHvGAq4di5vqLD+b0TgqcF0z+xT2nqDNjO87D/UHRcnm+CHucmSj8tLgo9GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":149,"cache_read_input_tokens":48191,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":149},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtQafC59Nv8g5GgQA2","type":"assistant","uuid":"9c591a0f-d54f-44ca-9b6d-96093998b977","timestamp":"2026-02-22T14:35:56.216Z"}
{"parentUuid":"9c591a0f-d54f-44ca-9b6d-96093998b977","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_011A4MhmX2WtekdjtUDY9dCt","type":"message","role":"assistant","content":[{"type":"text","text":"I need to check the interaction between `matchStyle` and `applyStyle` — the user input passed as `themeName` may not match the exact `STYLE_PRESETS` key. Let me update `matchStyle` to return both the key and CSS, fixing the localStorage saving:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":149,"cache_read_input_tokens":48191,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":149},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtQafC59Nv8g5GgQA2","type":"assistant","uuid":"b26ea366-7830-4255-983d-02a1823d6acd","timestamp":"2026-02-22T14:35:57.182Z"}
{"parentUuid":"b26ea366-7830-4255-983d-02a1823d6acd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_011A4MhmX2WtekdjtUDY9dCt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011WYduNN6stxB68g93RWhFG","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1270,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":149,"cache_read_input_tokens":48191,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":149},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtQafC59Nv8g5GgQA2","type":"assistant","uuid":"501191e8-fbc9-4cc1-9715-a264a599e7d6","timestamp":"2026-02-22T14:35:57.908Z"}
{"parentUuid":"501191e8-fbc9-4cc1-9715-a264a599e7d6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_011WYduNN6stxB68g93RWhFG","toolUseID":"toolu_011WYduNN6stxB68g93RWhFG","timestamp":"2026-02-22T14:35:57.984Z","uuid":"0ec95002-7381-4b51-b680-fa59fb9e1a50"}
{"parentUuid":"501191e8-fbc9-4cc1-9715-a264a599e7d6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011WYduNN6stxB68g93RWhFG","type":"tool_result","content":"  1270→        if (input) setTimeout(() => input.focus(), 300);\n  1271→    },\n  1272→\n  1273→    async handleGenerate() {\n  1274→        const input = this.elements.promptInput.value.trim();\n  1275→        if (!input) return;\n  1276→        if (this._isGenerating) return;\n  1277→\n  1278→        const presetCss = this.matchStyle(input);\n  1279→        if (presetCss) {\n  1280→            this.applyStyle(presetCss, input);\n  1281→            this.togglePresets(true);\n  1282→            return;\n  1283→        }\n  1284→\n  1285→        if (!this.getApiKey()) {\n  1286→            this.expandApiKeySection();\n  1287→            return;\n  1288→        }\n  1289→\n  1290→        this._isGenerating = true;\n  1291→        const btn = this.elements.generateBtn;\n  1292→        const originalText = btn.textContent;\n  1293→        btn.textContent = 'Generating...';\n  1294→        btn.disabled = true;\n  1295→\n  1296→        try {\n  1297→            const css = await this.generateTheme(input);\n  1298→            this.applyStyle(css, null, input);\n  1299→            this.togglePresets(true);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ae88bb0f-d485-40eb-9461-545df2c43e33","timestamp":"2026-02-22T14:35:57.984Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);","numLines":30,"startLine":1270,"totalLines":1341}},"sourceToolAssistantUUID":"501191e8-fbc9-4cc1-9715-a264a599e7d6"}
{"parentUuid":"ae88bb0f-d485-40eb-9461-545df2c43e33","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01L9XGpvThKCFddnQS1QFkfw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QY2REXM9b79yBSjeWeyQti","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1305,"limit":25},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1906,"cache_read_input_tokens":48340,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1906},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGv3afefcsGK7FqHECF","type":"assistant","uuid":"4c9ef107-e343-4005-ba6b-46a70fc6aa45","timestamp":"2026-02-22T14:35:59.612Z"}
{"parentUuid":"4c9ef107-e343-4005-ba6b-46a70fc6aa45","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01QY2REXM9b79yBSjeWeyQti","toolUseID":"toolu_01QY2REXM9b79yBSjeWeyQti","timestamp":"2026-02-22T14:35:59.622Z","uuid":"13a43c4d-1bfc-437b-83e8-18ed7dc5982f"}
{"parentUuid":"4c9ef107-e343-4005-ba6b-46a70fc6aa45","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QY2REXM9b79yBSjeWeyQti","type":"tool_result","content":"  1305→            this._isGenerating = false;\n  1306→        }\n  1307→    },\n  1308→\n  1309→    matchStyle(input) {\n  1310→        const normalizedInput = input.toLowerCase();\n  1311→        for (const key in STYLE_PRESETS) {\n  1312→            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n  1313→        }\n  1314→        return null;\n  1315→    },\n  1316→\n  1317→    applyStyle(css, themeName, customPrompt = null) {\n  1318→        this.toggleMenu(false);\n  1319→\n  1320→        if (themeName && STYLE_PRESETS[themeName]) {\n  1321→            localStorage.setItem('acephale-theme', themeName);\n  1322→            localStorage.removeItem('acephale-custom-css');\n  1323→            localStorage.removeItem('acephale-custom-prompt');\n  1324→        } else if (customPrompt) {\n  1325→            localStorage.setItem('acephale-custom-css', css);\n  1326→            localStorage.setItem('acephale-custom-prompt', customPrompt);\n  1327→            localStorage.removeItem('acephale-theme');\n  1328→        }\n  1329→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8e7334d9-14c7-417d-94ee-8f7d088afd9d","timestamp":"2026-02-22T14:35:59.621Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n","numLines":25,"startLine":1305,"totalLines":1341}},"sourceToolAssistantUUID":"4c9ef107-e343-4005-ba6b-46a70fc6aa45"}
{"parentUuid":"8e7334d9-14c7-417d-94ee-8f7d088afd9d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HNbjvYcSfn7iYzepF5kE8V","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I see the issue: `matchStyle` returns the CSS value but not the key name. When `handleGenerate` calls `this.applyStyle(presetCss, input)`, `input` is the user's typed text (e.g., \"minimalist\") which won't exactly match a key in `STYLE_PRESETS` (e.g., \"Minimalist\"). So the localStorage save won't happen for preset matches via the input field.\n\nI'll update `matchStyle` to return the matched key name instead of the CSS, and update `handleGenerate` to look up the CSS from `STYLE_PRESETS` using the key name.","signature":"EqUFCkYICxgCKkBf3QN7dYbuiCtcD9r7RwMe8ua9vBQbsNlFzyN4c8zW/2u+dbZywQuyBwk7VtSL5gyMMzSB3nB5FjUURvrRBRS7EgxRFAp18j1256coCoMaDKFWi9uMlffAJUFTpSIw8Ueb6sT0dZ0o3GY6AJNiuD6XFDe8yAGHH9gHRgYijvVp+Mx5N+jyclYvwXlVYwcAKowERPBrQB0iNXkEZEhYhXyU7FM3pvYWQHJ6uhc2UDR4KYaRhOrSJuPWcVn+H1U+A7m2sTh23cO3M2V5BytuirMlaU0g1PLW1AuZ2ntgCFtrsC0lGtIejOrhOk24UcoFE0K7avneiuP+/heNgoYXLb55Smrsq14tMI4lCB4hrThSqdeze4ZQsfPINMG7rrRJI7EHV/0+Z97gyfLitEmKITMHt+paFJ44zEa/8FUr29CyiHgJjbO/NlJh8oyIpRFuGmDEtGsYLvF1eGOrHzIvj57qVREskIXtP1PyNe2aVTdgJ/A2rNHVfwlqUHCv2n07zV5ShwRGQvvAFUhbMxNXGqZvTiT3/lKLAoiQQ5InFms/vy/iUs9AnFDEsRInoyf55lK+NBedOiRBSlqcQn6RswtJ7vnKDhNpH+o7DdMdYB/ESZ3suMmTYgC67gguRMgAFnQGw7ihwyXw0IM4Wd5JsD658AuWJgZ7jrk+qjSGaS0uyE8YUutD6jQSN/YFQDT/S2YlroYPeMUv0Z++vbaLBLQhR6Ja4ju1Oeejbliz/te5t8FonqIlPtsqw4P/xwjIgonSuHzdpfOrZ07PujhcG1jiVitTaceyE7puxNaPSVo2qrIMXR0clPoAsPIZuctez+ZJeAJG3PY4bY82ELGS/J9dIP8tgqnvgnj6no0yS608b8Ig20KJx/unWMiqMsEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":50246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvArUPxyU4nBqBGsSA","type":"assistant","uuid":"9644f116-12cb-4480-afba-a929da76fd64","timestamp":"2026-02-22T14:36:03.829Z"}
{"parentUuid":"9644f116-12cb-4480-afba-a929da76fd64","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HNbjvYcSfn7iYzepF5kE8V","type":"message","role":"assistant","content":[{"type":"text","text":"I need to fix `matchStyle` to return the key name (not just CSS) so `applyStyle` can correctly save to localStorage. I'll update both `matchStyle` and `handleGenerate`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":50246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvArUPxyU4nBqBGsSA","type":"assistant","uuid":"09ca1203-b9c2-4c7b-b297-80dc568ec6e0","timestamp":"2026-02-22T14:36:05.088Z"}
{"parentUuid":"09ca1203-b9c2-4c7b-b297-80dc568ec6e0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HNbjvYcSfn7iYzepF5kE8V","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014gX1z5AewDG4aa6pQFvCct","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },","new_string":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":50246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvArUPxyU4nBqBGsSA","type":"assistant","uuid":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c","timestamp":"2026-02-22T14:36:06.654Z"}
{"parentUuid":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_014gX1z5AewDG4aa6pQFvCct","toolUseID":"toolu_014gX1z5AewDG4aa6pQFvCct","timestamp":"2026-02-22T14:36:06.658Z","uuid":"102656fe-e6a6-4c23-b3b0-77605de045b7"}
{"parentUuid":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014gX1z5AewDG4aa6pQFvCct","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"d70d8f3a-e296-45b1-bbe0-4dca0971a590","timestamp":"2026-02-22T14:36:06.658Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },","newString":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1309,"oldLines":7,"newStart":1309,"newLines":7,"lines":["     matchStyle(input) {","         const normalizedInput = input.toLowerCase();","         for (const key in STYLE_PRESETS) {","-            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];","+            if (normalizedInput.includes(key.toLowerCase())) return key;","         }","         return null;","     },"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c"}
{"parentUuid":"d70d8f3a-e296-45b1-bbe0-4dca0971a590","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01UwqN8iYrpRRCuhLE2rtUpo","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }","new_string":"        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":503,"cache_read_input_tokens":50789,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":503},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvgs1JCGjvRdQ7hnF6","type":"assistant","uuid":"f042d611-60e8-4cdc-8adb-43928d9171bb","timestamp":"2026-02-22T14:36:09.687Z"}
{"parentUuid":"f042d611-60e8-4cdc-8adb-43928d9171bb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","toolUseID":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","timestamp":"2026-02-22T14:36:09.693Z","uuid":"f4dfba0a-08a0-4ac2-b692-a5aa2d3f15d3"}
{"parentUuid":"f042d611-60e8-4cdc-8adb-43928d9171bb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"c808059c-50ac-4585-989d-974d3032e52a","timestamp":"2026-02-22T14:36:09.692Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }","newString":"        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1275,"oldLines":9,"newStart":1275,"newLines":9,"lines":["         if (!input) return;","         if (this._isGenerating) return;"," ","-        const presetCss = this.matchStyle(input);","-        if (presetCss) {","-            this.applyStyle(presetCss, input);","+        const presetKey = this.matchStyle(input);","+        if (presetKey) {","+            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);","             this.togglePresets(true);","             return;","         }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f042d611-60e8-4cdc-8adb-43928d9171bb"}
{"parentUuid":"c808059c-50ac-4585-989d-974d3032e52a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01XK69VqmgqJSzk3MEYWfkrj","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me verify the final state of the key sections of the file:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":285,"cache_read_input_tokens":51292,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":285},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvudxWekVxga4tk293","type":"assistant","uuid":"0942eec2-0a2d-4d9a-aa00-173a162eb27f","timestamp":"2026-02-22T14:36:11.230Z"}
{"parentUuid":"0942eec2-0a2d-4d9a-aa00-173a162eb27f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01XK69VqmgqJSzk3MEYWfkrj","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0135eSfTujK1i4kHGev27Nr5","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":285,"cache_read_input_tokens":51292,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":285},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvudxWekVxga4tk293","type":"assistant","uuid":"b380e773-024e-4e45-ad0c-435313b2d2cc","timestamp":"2026-02-22T14:36:11.954Z"}
{"parentUuid":"b380e773-024e-4e45-ad0c-435313b2d2cc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_0135eSfTujK1i4kHGev27Nr5","toolUseID":"toolu_0135eSfTujK1i4kHGev27Nr5","timestamp":"2026-02-22T14:36:11.972Z","uuid":"8e37b299-3de1-46ef-8a40-bea56198e32b"}
{"parentUuid":"b380e773-024e-4e45-ad0c-435313b2d2cc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0135eSfTujK1i4kHGev27Nr5","type":"tool_result","content":"     1→/**\n     2→ * Acephale OS | Gardener.js\n     3→ * Hacker News Interface Styling & Data Fetching\n     4→ */\n     5→\n     6→const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n     7→\n     8→const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n     9→Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n    10→\n    11→Define all of these CSS custom properties on :root, then optionally add component overrides:\n    12→\n    13→:root {\n    14→    --bg:                  /* page background */;\n    15→    --card-bg:             /* story card background */;\n    16→    --text:                /* primary text */;\n    17→    --subtext:             /* secondary/meta text */;\n    18→    --accent:              /* links and accent */;\n    19→    --header-bg:           /* header background (rgba allowed) */;\n    20→    --font-main:           /* font stack */;\n    21→    --item-radius:         /* card border-radius */;\n    22→    --item-border:         /* border shorthand or none */;\n    23→    --item-shadow:         /* box-shadow or none */;\n    24→    --more-btn-bg:         /* More button background */;\n    25→    --more-btn-color:      /* More button text color */;\n    26→    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    27→    --mobile-upvote-color: /* upvote text on mobile */;\n    28→}\n    29→\n    30→Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7843eb03-bc50-4c3c-b761-abf8f4a75387","timestamp":"2026-02-22T14:36:11.971Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.","numLines":30,"startLine":1,"totalLines":1341}},"sourceToolAssistantUUID":"b380e773-024e-4e45-ad0c-435313b2d2cc"}
{"parentUuid":"7843eb03-bc50-4c3c-b761-abf8f4a75387","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_0164UttQjZT7CC48tUHdBrNh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VJz8KkQpRaBPkZPHoex4mh","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":980,"limit":60},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":702,"cache_read_input_tokens":51577,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":702},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGw5gCNwGADZVYYdwQT","type":"assistant","uuid":"ab7666d3-cf62-45aa-a11d-b17c3e31c489","timestamp":"2026-02-22T14:36:13.833Z"}
{"parentUuid":"ab7666d3-cf62-45aa-a11d-b17c3e31c489","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01VJz8KkQpRaBPkZPHoex4mh","toolUseID":"toolu_01VJz8KkQpRaBPkZPHoex4mh","timestamp":"2026-02-22T14:36:13.847Z","uuid":"c104aa78-5291-4a92-a97f-82c518c46403"}
{"parentUuid":"ab7666d3-cf62-45aa-a11d-b17c3e31c489","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VJz8KkQpRaBPkZPHoex4mh","type":"tool_result","content":"   980→                if (!isDragging) return;\n   981→                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n   982→                const deltaX = clientX - startX;\n   983→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n   984→\n   985→                if (!isMin && deltaX > 0) {\n   986→                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n   987→                } else if (isMin && deltaX < 0) {\n   988→                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n   989→                }\n   990→            };\n   991→\n   992→            const endDrag = (e) => {\n   993→                if (!isDragging) return;\n   994→                isDragging = false;\n   995→                this.elements.themeControls.style.transition = '';\n   996→                \n   997→                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n   998→                const deltaX = clientX - startX;\n   999→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n  1000→\n  1001→                this.elements.themeControls.style.transform = '';\n  1002→\n  1003→                if (Math.abs(deltaX) < 10) {\n  1004→                    this.elements.themeControls.classList.toggle('is-minimized');\n  1005→                } else {\n  1006→                    if (!isMin && deltaX > threshold) {\n  1007→                        this.elements.themeControls.classList.add('is-minimized');\n  1008→                    } else if (isMin && deltaX < -threshold) {\n  1009→                        this.elements.themeControls.classList.remove('is-minimized');\n  1010→                    }\n  1011→                }\n  1012→            };\n  1013→\n  1014→            const handle = this.elements.panelHandle;\n  1015→            handle.addEventListener('mousedown', startDrag);\n  1016→            handle.addEventListener('touchstart', startDrag, {passive: true});\n  1017→            \n  1018→            document.addEventListener('mousemove', doDrag);\n  1019→            document.addEventListener('touchmove', doDrag, {passive: true});\n  1020→            \n  1021→            document.addEventListener('mouseup', endDrag);\n  1022→            document.addEventListener('touchend', endDrag);\n  1023→        }\n  1024→        \n  1025→        // Handle navigation\n  1026→        this.elements.navLinks.addEventListener('click', (e) => {\n  1027→            if (e.target.tagName === 'A') {\n  1028→                e.preventDefault();\n  1029→                const type = e.target.textContent.trim().toLowerCase();\n  1030→                \n  1031→                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n  1032→                    this.switchFeed(type);\n  1033→                } else if (type === 'submit') {\n  1034→                    this.toggleMenu(false);\n  1035→                    window.open('https://news.ycombinator.com/submit', '_blank');\n  1036→                } else {\n  1037→                    this.toggleMenu(false);\n  1038→                    alert('This feature is currently unavailable in the Generative UI.');\n  1039→                }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5ba0dfac-1aaf-4889-9fdf-f44696ef6a4d","timestamp":"2026-02-22T14:36:13.846Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }","numLines":60,"startLine":980,"totalLines":1341}},"sourceToolAssistantUUID":"ab7666d3-cf62-45aa-a11d-b17c3e31c489"}
{"parentUuid":"5ba0dfac-1aaf-4889-9fdf-f44696ef6a4d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01MsU8tHYA2NG7wxWwgPWFfg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1100,"limit":120},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1281,"cache_read_input_tokens":52279,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1281},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwDcwL6wMQLfukYsrv","type":"assistant","uuid":"87136c38-e273-4095-8cd6-a9b43899a24b","timestamp":"2026-02-22T14:36:16.457Z"}
{"parentUuid":"87136c38-e273-4095-8cd6-a9b43899a24b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","toolUseID":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","timestamp":"2026-02-22T14:36:16.465Z","uuid":"bed967fa-e5ed-4e2e-94a9-e07de13887f1"}
{"parentUuid":"87136c38-e273-4095-8cd6-a9b43899a24b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","type":"tool_result","content":"  1100→\n  1101→    renderStories(stories, append = false) {\n  1102→        if (!append) {\n  1103→            this.elements.listElement.innerHTML = '';\n  1104→        }\n  1105→\n  1106→        stories.forEach((story, index) => {\n  1107→            if (!story) return;\n  1108→            \n  1109→            const rank = this.currentOffset + index + 1;\n  1110→            const domain = story.url ? new URL(story.url).hostname : '';\n  1111→            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n  1112→            const timeAgo = HNData.formatTime(story.time);\n  1113→            \n  1114→            // Escape HTML in user content\n  1115→            const title = this.escapeHtml(story.title || '');\n  1116→            const author = this.escapeHtml(story.by || '');\n  1117→\n  1118→            const listItem = document.createElement('li');\n  1119→            listItem.className = 'hn-story-item';\n  1120→            listItem.innerHTML = `\n  1121→                <div class=\"hn-story-rank\">${rank}</div>\n  1122→                <div class=\"hn-story-content\">\n  1123→                    <div class=\"hn-story-title-row\">\n  1124→                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n  1125→                        ${domainHtml}\n  1126→                    </div>\n  1127→                    <div class=\"hn-story-meta\">\n  1128→                        <span class=\"hn-story-points\">${story.score} pts</span> • \n  1129→                        <span class=\"hn-story-author\">${author}</span> • \n  1130→                        <span class=\"hn-story-time\">${timeAgo}</span>\n  1131→                    </div>\n  1132→                </div>\n  1133→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n  1134→            `;\n  1135→            this.elements.listElement.appendChild(listItem);\n  1136→        });\n  1137→    },\n  1138→\n  1139→    escapeHtml(unsafe) {\n  1140→        return unsafe\n  1141→            .replace(/&/g, \"&amp;\")\n  1142→            .replace(/</g, \"&lt;\")\n  1143→            .replace(/>/g, \"&gt;\")\n  1144→            .replace(/\"/g, \"&quot;\")\n  1145→            .replace(/'/g, \"&#039;\");\n  1146→    },\n  1147→\n  1148→    getApiKey() {\n  1149→        return localStorage.getItem('acephale-gemini-key');\n  1150→    },\n  1151→\n  1152→    saveApiKey(key) {\n  1153→        localStorage.setItem('acephale-gemini-key', key.trim());\n  1154→    },\n  1155→\n  1156→    clearApiKey() {\n  1157→        localStorage.removeItem('acephale-gemini-key');\n  1158→        this.renderApiKeySection();\n  1159→    },\n  1160→\n  1161→    extractCss(text) {\n  1162→        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n  1163→        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n  1164→        return cleaned.trim();\n  1165→    },\n  1166→\n  1167→    async generateTheme(prompt) {\n  1168→        const key = this.getApiKey();\n  1169→        if (!key) throw new Error('NO_API_KEY');\n  1170→\n  1171→        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n  1172→        const body = {\n  1173→            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n  1174→            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n  1175→            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n  1176→        };\n  1177→\n  1178→        const response = await fetch(endpoint, {\n  1179→            method: 'POST',\n  1180→            headers: { 'Content-Type': 'application/json' },\n  1181→            body: JSON.stringify(body)\n  1182→        });\n  1183→\n  1184→        if (!response.ok) {\n  1185→            const status = response.status;\n  1186→            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n  1187→            if (status === 429) throw new Error('RATE_LIMIT');\n  1188→            throw new Error(`API_ERROR:${status}`);\n  1189→        }\n  1190→\n  1191→        const data = await response.json();\n  1192→        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n  1193→        if (!rawText) throw new Error('EMPTY_RESPONSE');\n  1194→        return this.extractCss(rawText);\n  1195→    },\n  1196→\n  1197→    renderApiKeySection() {\n  1198→        const existing = document.getElementById('api-key-section');\n  1199→        if (existing) existing.remove();\n  1200→\n  1201→        const section = document.createElement('div');\n  1202→        section.id = 'api-key-section';\n  1203→        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n  1204→\n  1205→        if (this.getApiKey()) {\n  1206→            section.innerHTML = `\n  1207→                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n  1208→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n  1209→                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n  1210→                </div>`;\n  1211→            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n  1212→        } else {\n  1213→            section.innerHTML = `\n  1214→                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1215→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n  1216→                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n  1217→                </div>\n  1218→                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1219→                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"25e140b3-a120-4270-a1ab-95438b811f85","timestamp":"2026-02-22T14:36:16.464Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">","numLines":120,"startLine":1100,"totalLines":1341}},"sourceToolAssistantUUID":"87136c38-e273-4095-8cd6-a9b43899a24b"}
{"parentUuid":"25e140b3-a120-4270-a1ab-95438b811f85","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01VsmG6jAJgq43C2tT67cp9k","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01X3FcYTwgDZhCruKwUENAgL","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1220,"limit":120},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2247,"cache_read_input_tokens":53560,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2247},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwQp8uhSeNqVHKtrvU","type":"assistant","uuid":"7e07ca0c-b040-46dd-a2b3-ad37479257c3","timestamp":"2026-02-22T14:36:19.363Z"}
{"parentUuid":"7e07ca0c-b040-46dd-a2b3-ad37479257c3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01X3FcYTwgDZhCruKwUENAgL","toolUseID":"toolu_01X3FcYTwgDZhCruKwUENAgL","timestamp":"2026-02-22T14:36:19.373Z","uuid":"2cde12c2-627f-4ab0-af83-b0af78b32445"}
{"parentUuid":"7e07ca0c-b040-46dd-a2b3-ad37479257c3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01X3FcYTwgDZhCruKwUENAgL","type":"tool_result","content":"  1220→                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n  1221→                </div>`;\n  1222→            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n  1223→                const form = section.querySelector('#api-key-form');\n  1224→                const icon = section.querySelector('#api-key-icon');\n  1225→                const isOpen = form.style.display !== 'none';\n  1226→                form.style.display = isOpen ? 'none' : 'flex';\n  1227→                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1228→            });\n  1229→            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n  1230→                const val = section.querySelector('#api-key-input').value.trim();\n  1231→                if (!val) return;\n  1232→                this.saveApiKey(val);\n  1233→                this.renderApiKeySection();\n  1234→            });\n  1235→        }\n  1236→\n  1237→        this.elements.themeControls.appendChild(section);\n  1238→    },\n  1239→\n  1240→    showGenerateError(err) {\n  1241→        let message;\n  1242→        switch (err.message) {\n  1243→            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n  1244→            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n  1245→            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n  1246→            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n  1247→            default:              message = `Generation failed: ${err.message}`;\n  1248→        }\n  1249→        let errEl = document.getElementById('generate-error');\n  1250→        if (!errEl) {\n  1251→            errEl = document.createElement('div');\n  1252→            errEl.id = 'generate-error';\n  1253→            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n  1254→            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n  1255→        }\n  1256→        errEl.textContent = message;\n  1257→        clearTimeout(this._errorTimeout);\n  1258→        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n  1259→    },\n  1260→\n  1261→    expandApiKeySection() {\n  1262→        const form = document.getElementById('api-key-form');\n  1263→        const icon = document.getElementById('api-key-icon');\n  1264→        if (form && form.style.display === 'none') {\n  1265→            form.style.display = 'flex';\n  1266→            if (icon) icon.style.transform = 'rotate(0deg)';\n  1267→        }\n  1268→        this.elements.themeControls.classList.remove('is-minimized');\n  1269→        const input = document.getElementById('api-key-input');\n  1270→        if (input) setTimeout(() => input.focus(), 300);\n  1271→    },\n  1272→\n  1273→    async handleGenerate() {\n  1274→        const input = this.elements.promptInput.value.trim();\n  1275→        if (!input) return;\n  1276→        if (this._isGenerating) return;\n  1277→\n  1278→        const presetKey = this.matchStyle(input);\n  1279→        if (presetKey) {\n  1280→            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n  1281→            this.togglePresets(true);\n  1282→            return;\n  1283→        }\n  1284→\n  1285→        if (!this.getApiKey()) {\n  1286→            this.expandApiKeySection();\n  1287→            return;\n  1288→        }\n  1289→\n  1290→        this._isGenerating = true;\n  1291→        const btn = this.elements.generateBtn;\n  1292→        const originalText = btn.textContent;\n  1293→        btn.textContent = 'Generating...';\n  1294→        btn.disabled = true;\n  1295→\n  1296→        try {\n  1297→            const css = await this.generateTheme(input);\n  1298→            this.applyStyle(css, null, input);\n  1299→            this.togglePresets(true);\n  1300→        } catch (err) {\n  1301→            this.showGenerateError(err);\n  1302→        } finally {\n  1303→            btn.textContent = originalText;\n  1304→            btn.disabled = false;\n  1305→            this._isGenerating = false;\n  1306→        }\n  1307→    },\n  1308→\n  1309→    matchStyle(input) {\n  1310→        const normalizedInput = input.toLowerCase();\n  1311→        for (const key in STYLE_PRESETS) {\n  1312→            if (normalizedInput.includes(key.toLowerCase())) return key;\n  1313→        }\n  1314→        return null;\n  1315→    },\n  1316→\n  1317→    applyStyle(css, themeName, customPrompt = null) {\n  1318→        this.toggleMenu(false);\n  1319→\n  1320→        if (themeName && STYLE_PRESETS[themeName]) {\n  1321→            localStorage.setItem('acephale-theme', themeName);\n  1322→            localStorage.removeItem('acephale-custom-css');\n  1323→            localStorage.removeItem('acephale-custom-prompt');\n  1324→        } else if (customPrompt) {\n  1325→            localStorage.setItem('acephale-custom-css', css);\n  1326→            localStorage.setItem('acephale-custom-prompt', customPrompt);\n  1327→            localStorage.removeItem('acephale-theme');\n  1328→        }\n  1329→\n  1330→        const applyFn = () => {\n  1331→            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n  1332→        };\n  1333→\n  1334→        if (!document.startViewTransition) { applyFn(); return; }\n  1335→        document.startViewTransition(applyFn);\n  1336→    }\n  1337→};\n  1338→\n  1339→// Start the application\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8bd5ad82-b829-4c15-8210-367aa5c346ea","timestamp":"2026-02-22T14:36:19.372Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application","numLines":120,"startLine":1220,"totalLines":1341}},"sourceToolAssistantUUID":"7e07ca0c-b040-46dd-a2b3-ad37479257c3"}
{"parentUuid":"8bd5ad82-b829-4c15-8210-367aa5c346ea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01SLNY7GRB1b1tVEz2AXsm5Q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019KJbkyBSNumB9WFe6hNj1V","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":905,"limit":40},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2004,"cache_read_input_tokens":55807,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2004},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwdHUjfosHkGaLcNcR","type":"assistant","uuid":"1689422e-6858-436e-a42f-81c7cb920faf","timestamp":"2026-02-22T14:36:21.905Z"}
{"parentUuid":"1689422e-6858-436e-a42f-81c7cb920faf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_019KJbkyBSNumB9WFe6hNj1V","toolUseID":"toolu_019KJbkyBSNumB9WFe6hNj1V","timestamp":"2026-02-22T14:36:21.917Z","uuid":"73d918d7-dd8e-4234-984e-57dc268cee22"}
{"parentUuid":"1689422e-6858-436e-a42f-81c7cb920faf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019KJbkyBSNumB9WFe6hNj1V","type":"tool_result","content":"   905→    },\n   906→\n   907→    async init() {\n   908→        this.renderPresetButtons();\n   909→        this.renderApiKeySection();\n   910→        this.bindEvents();\n   911→\n   912→        const savedPreset = localStorage.getItem('acephale-theme');\n   913→        const savedCustom = localStorage.getItem('acephale-custom-css');\n   914→        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n   915→\n   916→        if (savedCustom) {\n   917→            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n   918→            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n   919→        } else {\n   920→            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n   921→            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n   922→        }\n   923→\n   924→        await this.loadInitial();\n   925→    },\n   926→\n   927→    renderPresetButtons() {\n   928→        this.elements.presetButtons.innerHTML = '';\n   929→        Object.keys(STYLE_PRESETS).forEach(themeName => {\n   930→            const btn = document.createElement('button');\n   931→            btn.textContent = themeName;\n   932→            btn.style.cssText = `\n   933→                padding: 6px 12px;\n   934→                background: rgba(0,0,0,0.05);\n   935→                border: 1px solid rgba(0,0,0,0.1);\n   936→                border-radius: 6px;\n   937→                font-size: 12px;\n   938→                font-weight: 500;\n   939→                cursor: pointer;\n   940→                transition: all 0.2s;\n   941→                color: var(--text);\n   942→                flex-shrink: 0;\n   943→            `;\n   944→            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2ba9989d-3ef8-4d5e-9bf5-b077e83e8d37","timestamp":"2026-02-22T14:36:21.916Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };","numLines":40,"startLine":905,"totalLines":1341}},"sourceToolAssistantUUID":"1689422e-6858-436e-a42f-81c7cb920faf"}
{"parentUuid":"2ba9989d-3ef8-4d5e-9bf5-b077e83e8d37","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01KGzHaTLYhBV4ATSxkmzd6J","type":"message","role":"assistant","content":[{"type":"text","text":"Everything looks correct. Let me do a final check to ensure there are no remaining references to the old `showError` method:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":773,"cache_read_input_tokens":57811,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":773},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwosDa5kTuXqzNeg4J","type":"assistant","uuid":"44a37241-922b-4da3-8f10-8484213f4a16","timestamp":"2026-02-22T14:36:23.604Z"}
{"parentUuid":"44a37241-922b-4da3-8f10-8484213f4a16","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01KGzHaTLYhBV4ATSxkmzd6J","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018dmMTWv9Jp42aEvHvNnv4y","name":"Grep","input":{"pattern":"showError","path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":773,"cache_read_input_tokens":57811,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":773},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwosDa5kTuXqzNeg4J","type":"assistant","uuid":"85db4133-7007-46ca-9341-c28157582296","timestamp":"2026-02-22T14:36:24.467Z"}
{"parentUuid":"85db4133-7007-46ca-9341-c28157582296","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_018dmMTWv9Jp42aEvHvNnv4y","toolUseID":"toolu_018dmMTWv9Jp42aEvHvNnv4y","timestamp":"2026-02-22T14:36:24.925Z","uuid":"9ed46cb1-40cc-4863-9e23-53d0accc2e31"}
{"parentUuid":"85db4133-7007-46ca-9341-c28157582296","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018dmMTWv9Jp42aEvHvNnv4y","type":"tool_result","content":"No matches found"}]},"uuid":"5676f08d-1e3f-4f4a-b3a9-12f419fef898","timestamp":"2026-02-22T14:36:24.924Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"","numLines":0},"sourceToolAssistantUUID":"85db4133-7007-46ca-9341-c28157582296"}
{"parentUuid":"5676f08d-1e3f-4f4a-b3a9-12f419fef898","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_0136yDBLAKPbQ9LKffidsmya","type":"message","role":"assistant","content":[{"type":"text","text":"Good, the old `showError` is gone. Let me also verify line count to confirm the file is complete:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":151,"cache_read_input_tokens":58584,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":151},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGx2hPnR3EDNpBvtFYa","type":"assistant","uuid":"7d9ce31c-9c85-4f1d-a2a9-9508542b69b3","timestamp":"2026-02-22T14:36:26.623Z"}
{"parentUuid":"7d9ce31c-9c85-4f1d-a2a9-9508542b69b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_0136yDBLAKPbQ9LKffidsmya","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QStiyi3oaDNDmNgrYAERcq","name":"Bash","input":{"command":"wc -l /Users/turtlekazu/ReactProjects/acephale/gardener.js","description":"Count lines in gardener.js"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":151,"cache_read_input_tokens":58584,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":151},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGx2hPnR3EDNpBvtFYa","type":"assistant","uuid":"3f6afaf4-7d7f-457a-ab99-18b69fc9b560","timestamp":"2026-02-22T14:36:27.310Z"}
{"parentUuid":"3f6afaf4-7d7f-457a-ab99-18b69fc9b560","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QStiyi3oaDNDmNgrYAERcq","type":"tool_result","content":"    1340 /Users/turtlekazu/ReactProjects/acephale/gardener.js","is_error":false}]},"uuid":"0f561833-88af-4f4d-8da5-c0df4892ed4a","timestamp":"2026-02-22T14:36:27.452Z","toolUseResult":{"stdout":"    1340 /Users/turtlekazu/ReactProjects/acephale/gardener.js","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"3f6afaf4-7d7f-457a-ab99-18b69fc9b560"}
{"parentUuid":"0f561833-88af-4f4d-8da5-c0df4892ed4a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_017LTbR2jTScD7xqPJSV6set","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1337,"limit":4},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":161,"cache_read_input_tokens":58735,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":161},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGxDXWQeFJUuGKVWiTW","type":"assistant","uuid":"665100d1-8714-4c06-8d73-2f3e49f38c14","timestamp":"2026-02-22T14:36:29.192Z"}
{"parentUuid":"665100d1-8714-4c06-8d73-2f3e49f38c14","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","toolUseID":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","timestamp":"2026-02-22T14:36:29.208Z","uuid":"69823556-65a5-4e24-987c-be5581f09acc"}
{"parentUuid":"665100d1-8714-4c06-8d73-2f3e49f38c14","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","type":"tool_result","content":"  1337→};\n  1338→\n  1339→// Start the application\n  1340→document.addEventListener('DOMContentLoaded', () => App.init());\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3897bdf9-3957-4552-945b-eed3921750f4","timestamp":"2026-02-22T14:36:29.206Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());","numLines":4,"startLine":1337,"totalLines":1341}},"sourceToolAssistantUUID":"665100d1-8714-4c06-8d73-2f3e49f38c14"}
{"parentUuid":"3897bdf9-3957-4552-945b-eed3921750f4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01355gfDdmXsxW5gHA7n4M6h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Uuk4tzPuFtDUSCChkaaABY","name":"TaskUpdate","input":{"taskId":"1","status":"completed"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":240,"cache_read_input_tokens":58896,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":240},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGxMKKjiy3Y68esS7df","type":"assistant","uuid":"a4c1925f-0ed8-4f61-a14b-3fd8aa059807","timestamp":"2026-02-22T14:36:30.898Z"}
{"parentUuid":"a4c1925f-0ed8-4f61-a14b-3fd8aa059807","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Uuk4tzPuFtDUSCChkaaABY","type":"tool_result","content":"Updated task #1 status"}]},"uuid":"5f75a2d9-1d4b-4234-a9b0-5b156fe20299","timestamp":"2026-02-22T14:36:30.902Z","toolUseResult":{"success":true,"taskId":"1","updatedFields":["status"],"statusChange":{"from":"in_progress","to":"completed"}},"sourceToolAssistantUUID":"a4c1925f-0ed8-4f61-a14b-3fd8aa059807"}
{"parentUuid":"5f75a2d9-1d4b-4234-a9b0-5b156fe20299","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_017eLe2vtnx8Lz1SrAFkp2so","type":"message","role":"assistant","content":[{"type":"text","text":"All changes are complete. Here's a summary of what was implemented in `gardener.js`:\n\n**Step 1** — Added `GEMINI_SYSTEM_PROMPT` constant after `BASE_URL`, instructing Gemini to output raw CSS only with all required custom properties.\n\n**Step 2** — Added 8 new methods to `App`:\n- `getApiKey()` / `saveApiKey()` / `clearApiKey()` — localStorage key management\n- `extractCss()` — strips markdown fences if Gemini wraps its output\n- `generateTheme()` — async Gemini 2.0 Flash API call with structured error handling (400/403 → INVALID_KEY, 429 → RATE_LIMIT)\n- `renderApiKeySection()` — renders either \"Gemini AI: enabled + clear\" or the collapsed \"GEMINI API KEY ▼\" form into `#theme-controls`\n- `showGenerateError()` — inline error display (no more `alert()`), auto-clears after 5s\n- `expandApiKeySection()` — opens the API key form and focuses the input\n\n**Step 3** — Replaced `handleGenerate()` with async version: preset match → apply preset; no key → expand key section; otherwise → call Gemini with loading state guard.\n\n**Step 4** — Updated `applyStyle(css, themeName, customPrompt)` to persist AI-generated CSS to `acephale-custom-css`/`acephale-custom-prompt` and clear them when switching to a preset.\n\n**Step 5** — Updated `init()` to call `renderApiKeySection()` and restore AI-generated themes from localStorage on page load.\n\n**Fix** — `matchStyle()` now returns the matched preset key name (not CSS), so `applyStyle` can correctly save the preset name to localStorage."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":88,"cache_read_input_tokens":59136,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":88},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGxUdcFDfjNTKhrQd8f","type":"assistant","uuid":"8499604b-4977-4fd9-b07c-6c65ab379987","timestamp":"2026-02-22T14:36:43.536Z"}
{"parentUuid":"8499604b-4977-4fd9-b07c-6c65ab379987","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"cc411e8b-9aaa-49c2-be88-6d80236c01fd","toolUseID":"cc411e8b-9aaa-49c2-be88-6d80236c01fd","timestamp":"2026-02-22T14:36:43.608Z","uuid":"7ca5886d-b951-4607-a325-e8cc96e587cd"}
{"parentUuid":"7ca5886d-b951-4607-a325-e8cc96e587cd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":232}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-22T14:36:43.840Z","uuid":"b1d28ddf-1b88-450d-a715-fbca880f8ab0","toolUseID":"cc411e8b-9aaa-49c2-be88-6d80236c01fd"}
{"parentUuid":"b1d28ddf-1b88-450d-a715-fbca880f8ab0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"turn_duration","durationMs":142636,"timestamp":"2026-02-22T14:36:43.842Z","uuid":"e2358f39-3d87-4058-a443-6b48dc3e9419","isMeta":false}
{"type":"file-history-snapshot","messageId":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","snapshot":{"messageId":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v2","version":2,"backupTime":"2026-02-22T14:54:27.338Z"}},"timestamp":"2026-02-22T14:54:27.337Z"},"isSnapshotUpdate":false}
{"parentUuid":"e2358f39-3d87-4058-a443-6b48dc3e9419","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"GEMINI API KEYを入れても、Rate limit hitというエラーが出てしまいました。"},"uuid":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","timestamp":"2026-02-22T14:54:27.213Z","permissionMode":"acceptEdits"}
{"parentUuid":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01ScGDWuDpFh4hrZxbdZhRN5","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is saying that even after entering a Gemini API key, they get a \"Rate limit hit\" error. Let me look at the error handling in `generateTheme()` to understand what might be causing this.\n\nLooking at the code:\n\n```javascript\nif (!response.ok) {\n    const status = response.status;\n    if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n    if (status === 429) throw new Error('RATE_LIMIT');\n    throw new Error(`API_ERROR:${status}`);\n}\n```\n\nHTTP 429 is \"Too Many Requests\" which is the rate limit status code. \n\nBut if they just got the key and are using it for the first time, that shouldn't be the issue. The free tier might have extremely strict limits even for new users, or Gemini could be returning a 429 for quota exceeded or other reasons beyond just rate limiting.\n\nLooking at the Gemini 2.0 Flash free tier limits—15 requests per minute, 1,500 per day, 1 million tokens per minute—a 429 on the first try could mean the API key itself has an issue, or maybe Gemini returns 429 for things like regional restrictions or disabled APIs rather than the status codes we're mapping to INVALID_KEY. I'm wondering if the issue might be something else entirely—maybe the user is hitting a real rate limit right after entering the key, or there's a problem with how the request is structured. Let me reconsider the endpoint and request body to see if there's a mismatch with what the Gemini API actually expects, particularly around the system_instruction field or the model name. I'm wondering if the model name might be incorrect—it could need to be `gemini-2.0-flash-exp` or another variant instead. The user is hitting a 429 rate limit error even on their first request, which is unusual, so it might be a quota issue or the API returning 429 for a different reason like an invalid model name.\n\nThe best approach would be to add better error logging to see what Gemini's actual response body says, then potentially adjust the error handling or try a different model name.\n\nUpdating the error handling... I'm wondering if the `system_instruction` field might be formatted differently in the Gemini API, or if the API key doesn't have access to that feature depending on the version. There's also a possibility the API is returning a 200 status with an error in the response body, which would cause the parsing to fail when trying to extract the text. But the user is seeing a 429, so that points to rate limiting—though I should help them verify what's actually in the API response and consider trying a different model ID if needed.\n\nWriting the error handling fix... I'm handling the error responses from the API call—mapping status codes like 400 and 403 to an invalid key error, 429 to rate limiting, and other statuses to a generic API error. But looking back at the user's issue, they're reporting a rate limit error even after providing a valid API key, which makes me wonder if Gemini is returning 429 for other reasons like quota exhaustion rather than just hitting request limits.\n\nThe real problem could be that the API key is valid but the project doesn't have Gemini enabled, there are regional restrictions, or the quota is already maxed out. Since I can't see the actual response without more debugging, I should log the full error details and improve the 429 message to clarify it might be a quota issue, not just rate limiting. I'm also considering whether the model name `gemini-2.0-flash` might not be available in certain regions, which could be another source of the problem. I'm looking at the different error response formats Google's API returns—400 for invalid keys, 429 for rate limits or quota issues—and the status codes seem to map correctly. Let me verify that CORS isn't causing the issue to be misinterpreted.\n\nThe most likely culprit is that the user has a valid API key but is hitting rate limits on a free-tier account, or the 429 is being triggered for a reason we haven't considered. I should update the error handling to log the actual response body and extract Google's error message directly, then display something more informative to the user.\n\nWriting the updated error handling... Handling the error responses from the API—checking for invalid keys, rate limits, and other failures—then extracting the CSS from the response data. But I'm realizing that even with proper error handling, a genuine 429 rate limit error is still a problem that needs addressing at a deeper level.\n\nLet me think about what else could be causing this. The API key might be valid but the user could be missing billing setup, using the wrong type of key, or lacking access to the specific model. Or maybe the Gemini API is throttling requests at the IP or region level before it even validates the key. Without seeing the actual error response, the best approach is to log the full error body for better diagnostics and then improve the error messaging to help users troubleshoot.\n\nI'm also wondering if the `system_instruction` field could be the culprit—maybe certain model versions don't support it. Though I'm pretty confident Gemini 1.5+ models handle system instructions fine. Another thought: could `gemini-2.0-flash` require a different API version like v1 instead of v1beta?\n\nLooking at the endpoints, both v1 and v1beta should work for this model according to Google's docs. But stepping back, the user's actual problem is a 429 rate limit error, so I should focus on the most practical causes: either they're genuinely hitting quota limits, or there's something about how the request is being made that's triggering the rate limiter. The user might be in Japan where there could be regional availability issues, though the Gemini API should work globally. Most likely the problem is either quota exhaustion on their API key or a newly created key that hasn't been activated yet by Google. I'll improve the error handling by logging the full response body, making the 429 message clearer about potential quota issues, and surfacing the actual error details to the user.\n\nUpdating the API call... I'm realizing that passing custom properties on Error objects isn't reliable across the catch chain, so I need a cleaner approach to handle the rate limit detail message. I'm considering whether the issue might be with the model or endpoint choice, but v1beta should work fine with gemini-2.0-flash. The simplest approach is to log the actual Google API error response to the console and update the rate limit message to direct users there, so we can see what's really happening without making unnecessary changes.\n\nNow I'm looking at the rate limit specifics for the free tier—15 requests per minute and 1.5 million tokens per day—which shouldn't be exceeded on a fresh API key unless there's existing usage on that project or some account restriction. I'm also wondering if the `system_instruction` field or request formatting could be causing Google to return a 429 error, though that seems unlikely.\n\nActually, I think the real issue might be that the API key needs the Generative Language API explicitly enabled in Google Cloud Console, even though Google AI Studio should handle this automatically. Let me reconsider the error handling—maybe I have the 403 vs 429 distinction backwards, especially if a valid key is being rejected by Gemini 2.0 Flash.\n\nLooking at what's actually happening: the user is getting 429 (rate limit), not 403 (invalid key), so the status code is clear. The most likely culprits are either Gemini 2.0 Flash having stricter rate limits on the free tier than expected, a regional quota issue since they're in Japan, or pre-existing quota usage on their account. I should improve the error logging to capture the full response body, update the rate limit message to mention quota exceeded and point them to the AI Studio dashboard, and add a link to check their quota page.\n\nAdding error logging and updating the error messages...\n\nActually, let me reconsider whether there's something else causing the 429 errors. Looking at the request structure with the system instruction and content body, I'm wondering if the issue might be in how we're formatting the API call itself rather than just a quota problem.\n\nThe system instruction field could be the culprit here—I need to verify whether the Gemini API expects camelCase (`systemInstruction`) instead of snake_case (`system_instruction`). If the API doesn't recognize the field, it might either silently ignore it or throw an error, which could explain why we're hitting rate limits unexpectedly.\n\nActually, looking at the REST API documentation more carefully, the field should be `system_instruction` in snake_case since that's how gRPC-transcoded APIs typically handle proto3 fields. But I'm also wondering if this could be a CORS preflight issue—when the browser sends a POST request with JSON content, it first sends an OPTIONS request to check permissions, and if that fails, the actual request might not even reach the API.\n\nBut focusing on what I can actually address: I should add better error logging to see what response we're getting, and improve the 429 error message to be more helpful. \n\nWait, the user's comment \"GEMINI API KEYを入れても\" suggests they successfully entered the key and the UI confirmed it was enabled, then got the rate limit error when actually trying to generate a theme. So the issue isn't with the key validation itself—it's happening during the actual API call after everything seems to be working.\n\nThis points to either a quota restriction on their API key or project, or possibly a regional/model availability issue. The Gemini 2.0 Flash model might have restrictions I'm not aware of. Let me check the model name and then improve the error handling to give the user more actionable feedback about what might be causing the 429.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29,"cache_read_input_tokens":59658,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":29},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJKpyv2ats2vgNQ9CLM","type":"assistant","uuid":"ef32dd5f-1751-4a6e-bc96-8d967a0270d1","timestamp":"2026-02-22T14:56:31.478Z"}
{"parentUuid":"ef32dd5f-1751-4a6e-bc96-8d967a0270d1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01ScGDWuDpFh4hrZxbdZhRN5","type":"message","role":"assistant","content":[{"type":"text","text":"まず現状のエラーハンドリングと `generateTheme` を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29,"cache_read_input_tokens":59658,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":29},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJKpyv2ats2vgNQ9CLM","type":"assistant","uuid":"1926f5f7-78de-4af2-8cd4-4e11928416ff","timestamp":"2026-02-22T14:56:31.878Z"}
{"parentUuid":"1926f5f7-78de-4af2-8cd4-4e11928416ff","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01ScGDWuDpFh4hrZxbdZhRN5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WLVxkJKgzfLVEGzYWccaKo","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1167,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29,"cache_read_input_tokens":59658,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":29},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJKpyv2ats2vgNQ9CLM","type":"assistant","uuid":"87258e71-17fd-48d7-9cb9-542932ed015b","timestamp":"2026-02-22T14:56:33.254Z"}
{"parentUuid":"87258e71-17fd-48d7-9cb9-542932ed015b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01WLVxkJKgzfLVEGzYWccaKo","toolUseID":"toolu_01WLVxkJKgzfLVEGzYWccaKo","timestamp":"2026-02-22T14:56:33.333Z","uuid":"785e11d6-cacb-49c0-a757-1f6cee205e31"}
{"parentUuid":"87258e71-17fd-48d7-9cb9-542932ed015b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WLVxkJKgzfLVEGzYWccaKo","type":"tool_result","content":"  1167→    async generateTheme(prompt) {\n  1168→        const key = this.getApiKey();\n  1169→        if (!key) throw new Error('NO_API_KEY');\n  1170→\n  1171→        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n  1172→        const body = {\n  1173→            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n  1174→            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n  1175→            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n  1176→        };\n  1177→\n  1178→        const response = await fetch(endpoint, {\n  1179→            method: 'POST',\n  1180→            headers: { 'Content-Type': 'application/json' },\n  1181→            body: JSON.stringify(body)\n  1182→        });\n  1183→\n  1184→        if (!response.ok) {\n  1185→            const status = response.status;\n  1186→            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n  1187→            if (status === 429) throw new Error('RATE_LIMIT');\n  1188→            throw new Error(`API_ERROR:${status}`);\n  1189→        }\n  1190→\n  1191→        const data = await response.json();\n  1192→        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n  1193→        if (!rawText) throw new Error('EMPTY_RESPONSE');\n  1194→        return this.extractCss(rawText);\n  1195→    },\n  1196→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"dc514f58-b68b-4b31-a22c-4d1c7dae8841","timestamp":"2026-02-22T14:56:33.332Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n","numLines":30,"startLine":1167,"totalLines":1341}},"sourceToolAssistantUUID":"87258e71-17fd-48d7-9cb9-542932ed015b"}
{"parentUuid":"dc514f58-b68b-4b31-a22c-4d1c7dae8841","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01JP8ZUBiBBL2PZfRmBSkLv2","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The issue is that when the API returns 429, we just throw `RATE_LIMIT` without reading the response body or logging it. This means we don't know the actual reason for the 429.\n\nThe fix:\n1. Read the response body before throwing the error\n2. Log it to console  \n3. Pass the actual Google error message through to the user\n\nAlso, I should think about whether the problem could be with:\n- The API model name\n- The request format\n\nBut without seeing the actual error from Google, I can't be sure. The best immediate fix is to:\n1. Read and log the error body  \n2. Pass the error message to the user via the error detail\n\n\n3. Modify the error handling to capture the response body and attach it to the Error object, then update the error display to show this detail for 429 responses","signature":"EpAICkYICxgCKkAkVFCQ3n7jcJ3A0cIiokLbfZSTLO2BkMJytS2tTdtEL+BPmBNX9odPa8SbF3kFFKMN9zw8BizADhe1KPfR6mlgEgxVG5Wefq+XDUh+jY0aDP+8FwDczcxipZgWdyIwQyMy+VEVEtdgEB8VZuw23qjcWucLzByIplHx5pLrzZYsb4f5yhUINbwl/l6mnVuKKvcGvGMpuz6+0vguMgJnQf+qqWJWEbdXMpwhWsOr4EQ70PqvEIusH7kSsmYIQ/iS6HWG8VGw4L3KOprWIKwrb0tH/g2yOrFEx+7d7e3b81boecFbId2UOAjBMwO3GFSqMBGK+owyacgAUgm4PDi+BI97muYoeuc+6reoC8/810w5MrqVu9Gd/8FJqkOW9eSZQZQxoD+fgvQ2U0iv5FSMJrz9JPu01QjgBNEU4u2QWPvdJ/mEEIFYFOZ28xcl3Xi0cl8uXaOJ0RPGxReie4ncayqKBMpwVvGlihVlG0iKB3NBe45U+c+Hn16cSduV4czK2JAtu9Dz0zgQT1hiFaD2QY0+5aWbEqzzkoT8FzU5d4l8QQsID3gS9W6uF2tKzs6xDkYYJ/H6qsrRv1e2qMLPsICBMeXEqWamoUe8ytJLm8cry+iDIWIEDbF/qeQ4/GIvkUWFh9G+RLcs6ibW+c37XmfAvrk3mxKGQor8sYe/nUSi4SBGxFrlnSItiZAr8hWjnhGxbveeWnmzdAR8Fw8wefcJ4/yEo4Lu82/dRRqEIOCo3QlDqFLRPtRnfemtvjdWuPQg4YczCLEIVwwOglMJdSAj4tB3LUfVrq2XjAQgZ5+ywdvCXdtdihU9jD1CwdSAs52a0oEHORqZ3ONU2c2aNtacf3S0fq4DbBHjkqgQ2KdaCAepdaUHEFGRcPyQ/S5de6zv75AasXOBtwtZ3FShdGvuXDmnOncPvx/sNkDM8CnsxIY873m6Ol4ZB3B/j3OlQ4/eVmowGyaRN4UmICj+oXpjTEVV1aa2qCmaHiE82yeVMH6VIyyl38anCl/hXgkFSoRpuQWvaZfQlsZhtoz8k5WAD88c9mRaq5V8aujmAgyVFxwSJsAKpof+jfIL71aSlS/UUZZg714PHI+zEhQfImtRvhLgman0B7aZl9dEQGSPLX/uL10XHbfUhD4tW3e0lJSTcFqAzoDPVZ7LgHIIuHOYk9ZWwcKgVY46jJG2/58I1JH1J3wn5KcgxBm/4fePSw2hHqEMDWwPwgYTkjVvKspxkR5dXjHhtdNX3kvZCpPaHaX3JuSZXe/hkw4L3sDgncb5VBTbqaYCA7HCU2KxOlYSxESL1JvcJ91QXzWGFVdmMcF8Ac3g0neh81ZT7WCyJoOdQaUX+8fip+TUbslSu5Cnv/BelbqT/oAYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8302,"cache_read_input_tokens":59687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8302},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJV7KvssxiHnb2GwEB3","type":"assistant","uuid":"c6b327aa-c9fb-4d7f-b84b-a81b1ef6ea27","timestamp":"2026-02-22T14:56:40.916Z"}
{"parentUuid":"c6b327aa-c9fb-4d7f-b84b-a81b1ef6ea27","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01JP8ZUBiBBL2PZfRmBSkLv2","type":"message","role":"assistant","content":[{"type":"text","text":"429 が返ってきているのに、Gemini から届く実際のエラー本文を読んでいないため原因が分かりません。エラーボディを読んでコンソールに出力し、メッセージも UI に表示するよう修正します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8302,"cache_read_input_tokens":59687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8302},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJV7KvssxiHnb2GwEB3","type":"assistant","uuid":"704e9502-7d35-4dfe-b63d-9fd4e85390a9","timestamp":"2026-02-22T14:56:41.006Z"}
{"parentUuid":"704e9502-7d35-4dfe-b63d-9fd4e85390a9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01JP8ZUBiBBL2PZfRmBSkLv2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QX7ePTSStYemwqAhYKLijv","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }","new_string":"        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8302,"cache_read_input_tokens":59687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8302},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJV7KvssxiHnb2GwEB3","type":"assistant","uuid":"bd22f03f-4965-4528-ae33-8f0e1fe1a744","timestamp":"2026-02-22T14:56:43.881Z"}
{"parentUuid":"bd22f03f-4965-4528-ae33-8f0e1fe1a744","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01QX7ePTSStYemwqAhYKLijv","toolUseID":"toolu_01QX7ePTSStYemwqAhYKLijv","timestamp":"2026-02-22T14:56:43.886Z","uuid":"534cff18-c1aa-46c0-8ef1-b63160814415"}
{"parentUuid":"bd22f03f-4965-4528-ae33-8f0e1fe1a744","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QX7ePTSStYemwqAhYKLijv","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"b09cc8fa-a671-48c5-9894-1c28cee9e1ea","timestamp":"2026-02-22T14:56:43.885Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }","newString":"        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1183,"oldLines":8,"newStart":1183,"newLines":18,"lines":[" ","         if (!response.ok) {","             const status = response.status;","+            let apiMessage = '';","+            try {","+                const errData = await response.json();","+                apiMessage = errData?.error?.message || '';","+                console.error('Gemini API error:', status, errData);","+            } catch (_) {}","             if (status === 400 || status === 403) throw new Error('INVALID_KEY');","-            if (status === 429) throw new Error('RATE_LIMIT');","+            if (status === 429) {","+                const e = new Error('RATE_LIMIT');","+                e.detail = apiMessage;","+                throw e;","+            }","             throw new Error(`API_ERROR:${status}`);","         }"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"bd22f03f-4965-4528-ae33-8f0e1fe1a744"}
{"parentUuid":"b09cc8fa-a671-48c5-9894-1c28cee9e1ea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01WAzcoR7jxa658SwBeB3Nye","type":"message","role":"assistant","content":[{"type":"text","text":"次に `showGenerateError` の RATE_LIMIT ケースを更新して、Google からの実際のメッセージを表示するようにします。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":712,"cache_read_input_tokens":67989,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":712},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJVtRpQaEyvgnFexGWx","type":"assistant","uuid":"f91aee2a-4abb-4e7d-a2a7-90a18a1f4c43","timestamp":"2026-02-22T14:56:45.880Z"}
{"parentUuid":"f91aee2a-4abb-4e7d-a2a7-90a18a1f4c43","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01WAzcoR7jxa658SwBeB3Nye","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","new_string":"            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":712,"cache_read_input_tokens":67989,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":712},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJVtRpQaEyvgnFexGWx","type":"assistant","uuid":"5946e4fc-d084-447e-acf2-535f89caf4b3","timestamp":"2026-02-22T14:56:47.714Z"}
{"parentUuid":"5946e4fc-d084-447e-acf2-535f89caf4b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","toolUseID":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","timestamp":"2026-02-22T14:56:47.720Z","uuid":"2a3cfb09-be61-4486-8bc3-cec29ff744ce"}
{"parentUuid":"5946e4fc-d084-447e-acf2-535f89caf4b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"0e7f39d6-5254-4839-b940-4151c7595b99","timestamp":"2026-02-22T14:56:47.720Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","newString":"            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1252,"oldLines":7,"newStart":1252,"newLines":7,"lines":["         switch (err.message) {","             case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;","             case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;","-            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","+            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;","             case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;","             default:              message = `Generation failed: ${err.message}`;","         }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5946e4fc-d084-447e-acf2-535f89caf4b3"}
{"parentUuid":"0e7f39d6-5254-4839-b940-4151c7595b99","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01WwA91trKQ5qQXvqEYZLrDE","type":"message","role":"assistant","content":[{"type":"text","text":"これで「Apply」を押したとき、ブラウザの開発者コンソール（F12）に Gemini からの生のエラー JSON が出るようになります。\n\n**次の手順でデバッグしてください：**\n\n1. ブラウザで F12 → Console タブを開く\n2. プロンプトを入力して Apply を押す\n3. コンソールに `Gemini API error: 429 {...}` が出るので、その中の `message` フィールドを確認する\n4. UI にも Google の実際のエラー文言が表示されます\n\n---\n\n**429 の主な原因として考えられるもの：**\n\n| 原因 | `error.message` の例 |\n|------|---------------------|\n| 1日の無料枠上限 | `\"You exceeded your current quota...\"` |\n| プロジェクトに API が未有効化 | `\"Generative Language API has not been used...\"` |\n| API キーの制限設定 | `\"API key not valid...\"` (本来は 400 だが 429 で返す場合も) |\n| 地域制限 | `\"User location is not supported...\"` |\n\nコンソールに表示されたメッセージを教えていただければ、ピンポイントで対処できます。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":279,"cache_read_input_tokens":68701,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":279},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJWB2TL4uPYdK4qoDJN","type":"assistant","uuid":"fec37826-0d01-46d9-86e6-f2cf4b7df8dd","timestamp":"2026-02-22T14:56:56.053Z"}
{"parentUuid":"fec37826-0d01-46d9-86e6-f2cf4b7df8dd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"f58cc474-2237-4bb9-8393-2da4949ca818","toolUseID":"f58cc474-2237-4bb9-8393-2da4949ca818","timestamp":"2026-02-22T14:56:56.085Z","uuid":"7719c605-465b-4089-a761-83e53371e9f1"}
{"parentUuid":"7719c605-465b-4089-a761-83e53371e9f1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":227}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-22T14:56:56.314Z","uuid":"baf353ac-0ab6-431b-8f33-fb08f24f0930","toolUseID":"f58cc474-2237-4bb9-8393-2da4949ca818"}
{"parentUuid":"baf353ac-0ab6-431b-8f33-fb08f24f0930","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"turn_duration","durationMs":148977,"timestamp":"2026-02-22T14:56:56.316Z","uuid":"363b39fa-8ed5-430e-90d2-9de3aaf15fa2","isMeta":false}
{"type":"file-history-snapshot","messageId":"1f668307-2ca4-433a-af2c-260c64ed4201","snapshot":{"messageId":"1f668307-2ca4-433a-af2c-260c64ed4201","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v3","version":3,"backupTime":"2026-02-22T15:09:08.632Z"}},"timestamp":"2026-02-22T15:09:08.632Z"},"isSnapshotUpdate":false}
{"parentUuid":"363b39fa-8ed5-430e-90d2-9de3aaf15fa2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flashに変更したらうまくいきました。現在の実装でコミットして"},"uuid":"1f668307-2ca4-433a-af2c-260c64ed4201","timestamp":"2026-02-22T15:09:08.525Z","permissionMode":"acceptEdits"}
{"parentUuid":"1f668307-2ca4-433a-af2c-260c64ed4201","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01H8dxn9rfb8D2ChMXx96SMx","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user changed the model from `gemini-2.0-flash` to `gemini-2.5-flash` and it worked. They want to commit the current implementation. Let me do a git commit.","signature":"EsgCCkYICxgCKkB8fCoxGI3wcMPbPrBI7UGjnr73ppkD53Yj0kTpjYVIFTKJdf83UcdMNcbpG6T1H5FCY8ccKL9CATtMlUNZnPsGEgzcZE2amij5fT1dh44aDGZWU8DCVkfbFCPqSiIwOKLu31hOu9Z+34R9aoxPMTD1pigeFuBudwatAlg3vYvssSDTKLq1rXNZlCx8WNfAKq8B1/M0e71uyRs5Mt3P08Risst4n37hLUox6NAQrPfzszhjXiCJPeMIdduZZUMcQcCnlHjZ1e3Luff1rK9DmqTyni6jgk4YjugtbUKKTAYX3ye1F5bhWk8V300B7Wz0CMGw4Q+c87CvvmWSOr/UWYOMenMlk5vzTljxC0fZQeCHnHoyVm+g+v6bHsG6QP7MyI35+GcSl34SZxBEWnDbpJk0nUHrQhK78rErrXhpfGB5khgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":51169,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":51169},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKSniYzMWTdcC9ReBDZ","type":"assistant","uuid":"db41c324-c38b-4109-837c-1d28e2c272f7","timestamp":"2026-02-22T15:09:11.954Z"}
{"parentUuid":"db41c324-c38b-4109-837c-1d28e2c272f7","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01H8dxn9rfb8D2ChMXx96SMx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YXMQuni45VxPUXLUFZWmxX","name":"Bash","input":{"command":"git diff && git status","description":"Show diff and status before committing"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":51169,"cache_read_input_tokens":18648,"output_tokens":158,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":51169,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYPKSniYzMWTdcC9ReBDZ","type":"assistant","uuid":"994cc2d8-c130-484d-80fe-c7c579a6eb7c","timestamp":"2026-02-22T15:09:12.825Z"}
{"parentUuid":"994cc2d8-c130-484d-80fe-c7c579a6eb7c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YXMQuni45VxPUXLUFZWmxX","type":"tool_result","content":"diff --git a/gardener.js b/gardener.js\nindex 9423c1b..aec6265 100644\n--- a/gardener.js\n+++ b/gardener.js\n@@ -5,6 +5,31 @@\n \n const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n \n+const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n+Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n+\n+Define all of these CSS custom properties on :root, then optionally add component overrides:\n+\n+:root {\n+    --bg:                  /* page background */;\n+    --card-bg:             /* story card background */;\n+    --text:                /* primary text */;\n+    --subtext:             /* secondary/meta text */;\n+    --accent:              /* links and accent */;\n+    --header-bg:           /* header background (rgba allowed) */;\n+    --font-main:           /* font stack */;\n+    --item-radius:         /* card border-radius */;\n+    --item-border:         /* border shorthand or none */;\n+    --item-shadow:         /* box-shadow or none */;\n+    --more-btn-bg:         /* More button background */;\n+    --more-btn-color:      /* More button text color */;\n+    --mobile-upvote-bg:    /* upvote bg on mobile */;\n+    --mobile-upvote-color: /* upvote text on mobile */;\n+}\n+\n+Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\n+Output nothing except the CSS.`;\n+\n /**\n  * System Core Styles (Layout, Typography Base, Responsive Logic)\n  * Themes should override variables in :root or specific classes if needed.\n@@ -881,16 +906,21 @@ const App = {\n \n     async init() {\n         this.renderPresetButtons();\n+        this.renderApiKeySection();\n         this.bindEvents();\n-        console.log(\"Generative UI - Architecture Refactored.\");\n-        \n-        // Restore saved theme or fallback to Minimalist\n-        const savedTheme = localStorage.getItem('acephale-theme');\n-        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n-        \n-        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n \n-        // Initial load\n+        const savedPreset = localStorage.getItem('acephale-theme');\n+        const savedCustom = localStorage.getItem('acephale-custom-css');\n+        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n+\n+        if (savedCustom) {\n+            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n+            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n+        } else {\n+            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n+            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n+        }\n+\n         await this.loadInitial();\n     },\n \n@@ -1115,52 +1145,204 @@ const App = {\n             .replace(/'/g, \"&#039;\");\n     },\n \n-    handleGenerate() {\n+    getApiKey() {\n+        return localStorage.getItem('acephale-gemini-key');\n+    },\n+\n+    saveApiKey(key) {\n+        localStorage.setItem('acephale-gemini-key', key.trim());\n+    },\n+\n+    clearApiKey() {\n+        localStorage.removeItem('acephale-gemini-key');\n+        this.renderApiKeySection();\n+    },\n+\n+    extractCss(text) {\n+        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n+        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n+        return cleaned.trim();\n+    },\n+\n+    async generateTheme(prompt) {\n+        const key = this.getApiKey();\n+        if (!key) throw new Error('NO_API_KEY');\n+\n+        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n+        const body = {\n+            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n+            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n+            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n+        };\n+\n+        const response = await fetch(endpoint, {\n+            method: 'POST',\n+            headers: { 'Content-Type': 'application/json' },\n+            body: JSON.stringify(body)\n+        });\n+\n+        if (!response.ok) {\n+            const status = response.status;\n+            let apiMessage = '';\n+            try {\n+                const errData = await response.json();\n+                apiMessage = errData?.error?.message || '';\n+                console.error('Gemini API error:', status, errData);\n+            } catch (_) {}\n+            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n+            if (status === 429) {\n+                const e = new Error('RATE_LIMIT');\n+                e.detail = apiMessage;\n+                throw e;\n+            }\n+            throw new Error(`API_ERROR:${status}`);\n+        }\n+\n+        const data = await response.json();\n+        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n+        if (!rawText) throw new Error('EMPTY_RESPONSE');\n+        return this.extractCss(rawText);\n+    },\n+\n+    renderApiKeySection() {\n+        const existing = document.getElementById('api-key-section');\n+        if (existing) existing.remove();\n+\n+        const section = document.createElement('div');\n+        section.id = 'api-key-section';\n+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n+\n+        if (this.getApiKey()) {\n+            section.innerHTML = `\n+                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n+                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n+                </div>`;\n+            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n+        } else {\n+            section.innerHTML = `\n+                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n+                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n+                </div>\n+                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n+                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n+                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n+                </div>`;\n+            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n+                const form = section.querySelector('#api-key-form');\n+                const icon = section.querySelector('#api-key-icon');\n+                const isOpen = form.style.display !== 'none';\n+                form.style.display = isOpen ? 'none' : 'flex';\n+                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n+            });\n+            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n+                const val = section.querySelector('#api-key-input').value.trim();\n+                if (!val) return;\n+                this.saveApiKey(val);\n+                this.renderApiKeySection();\n+            });\n+        }\n+\n+        this.elements.themeControls.appendChild(section);\n+    },\n+\n+    showGenerateError(err) {\n+        let message;\n+        switch (err.message) {\n+            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n+            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n+            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n+            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n+            default:              message = `Generation failed: ${err.message}`;\n+        }\n+        let errEl = document.getElementById('generate-error');\n+        if (!errEl) {\n+            errEl = document.createElement('div');\n+            errEl.id = 'generate-error';\n+            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n+            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n+        }\n+        errEl.textContent = message;\n+        clearTimeout(this._errorTimeout);\n+        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n+    },\n+\n+    expandApiKeySection() {\n+        const form = document.getElementById('api-key-form');\n+        const icon = document.getElementById('api-key-icon');\n+        if (form && form.style.display === 'none') {\n+            form.style.display = 'flex';\n+            if (icon) icon.style.transform = 'rotate(0deg)';\n+        }\n+        this.elements.themeControls.classList.remove('is-minimized');\n+        const input = document.getElementById('api-key-input');\n+        if (input) setTimeout(() => input.focus(), 300);\n+    },\n+\n+    async handleGenerate() {\n         const input = this.elements.promptInput.value.trim();\n         if (!input) return;\n+        if (this._isGenerating) return;\n \n-        const style = this.matchStyle(input);\n-        \n-        if (style) {\n-            this.applyStyle(style, input);\n+        const presetKey = this.matchStyle(input);\n+        if (presetKey) {\n+            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n             this.togglePresets(true);\n-        } else {\n-            this.showError();\n+            return;\n+        }\n+\n+        if (!this.getApiKey()) {\n+            this.expandApiKeySection();\n+            return;\n+        }\n+\n+        this._isGenerating = true;\n+        const btn = this.elements.generateBtn;\n+        const originalText = btn.textContent;\n+        btn.textContent = 'Generating...';\n+        btn.disabled = true;\n+\n+        try {\n+            const css = await this.generateTheme(input);\n+            this.applyStyle(css, null, input);\n+            this.togglePresets(true);\n+        } catch (err) {\n+            this.showGenerateError(err);\n+        } finally {\n+            btn.textContent = originalText;\n+            btn.disabled = false;\n+            this._isGenerating = false;\n         }\n     },\n \n     matchStyle(input) {\n         const normalizedInput = input.toLowerCase();\n         for (const key in STYLE_PRESETS) {\n-            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n+            if (normalizedInput.includes(key.toLowerCase())) return key;\n         }\n         return null;\n     },\n \n-    applyStyle(css, themeName) {\n-        console.log(`Applying theme: ${themeName}`);\n-        this.toggleMenu(false); // Close menu on theme change\n-        \n-        // Save to local storage for persistence\n-        if (STYLE_PRESETS[themeName]) {\n-            localStorage.setItem('acephale-theme', themeName);\n-        }\n+    applyStyle(css, themeName, customPrompt = null) {\n+        this.toggleMenu(false);\n \n-        // Fallback for browsers that don't support View Transition API\n-        if (!document.startViewTransition) {\n-            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-            return;\n+        if (themeName && STYLE_PRESETS[themeName]) {\n+            localStorage.setItem('acephale-theme', themeName);\n+            localStorage.removeItem('acephale-custom-css');\n+            localStorage.removeItem('acephale-custom-prompt');\n+        } else if (customPrompt) {\n+            localStorage.setItem('acephale-custom-css', css);\n+            localStorage.setItem('acephale-custom-prompt', customPrompt);\n+            localStorage.removeItem('acephale-theme');\n         }\n \n-        // Smooth transition using View Transition API\n-        document.startViewTransition(() => {\n+        const applyFn = () => {\n             this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-        });\n-    },\n+        };\n \n-    showError() {\n-        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n-        alert(`Please enter a supported theme:\\n\"${available}\"`);\n+        if (!document.startViewTransition) { applyFn(); return; }\n+        document.startViewTransition(applyFn);\n     }\n };\n \nOn branch main\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")","is_error":false}]},"uuid":"3ad422a7-7a48-4b74-a320-37094aa7eee5","timestamp":"2026-02-22T15:09:12.973Z","toolUseResult":{"stdout":"diff --git a/gardener.js b/gardener.js\nindex 9423c1b..aec6265 100644\n--- a/gardener.js\n+++ b/gardener.js\n@@ -5,6 +5,31 @@\n \n const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n \n+const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n+Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n+\n+Define all of these CSS custom properties on :root, then optionally add component overrides:\n+\n+:root {\n+    --bg:                  /* page background */;\n+    --card-bg:             /* story card background */;\n+    --text:                /* primary text */;\n+    --subtext:             /* secondary/meta text */;\n+    --accent:              /* links and accent */;\n+    --header-bg:           /* header background (rgba allowed) */;\n+    --font-main:           /* font stack */;\n+    --item-radius:         /* card border-radius */;\n+    --item-border:         /* border shorthand or none */;\n+    --item-shadow:         /* box-shadow or none */;\n+    --more-btn-bg:         /* More button background */;\n+    --more-btn-color:      /* More button text color */;\n+    --mobile-upvote-bg:    /* upvote bg on mobile */;\n+    --mobile-upvote-color: /* upvote text on mobile */;\n+}\n+\n+Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\n+Output nothing except the CSS.`;\n+\n /**\n  * System Core Styles (Layout, Typography Base, Responsive Logic)\n  * Themes should override variables in :root or specific classes if needed.\n@@ -881,16 +906,21 @@ const App = {\n \n     async init() {\n         this.renderPresetButtons();\n+        this.renderApiKeySection();\n         this.bindEvents();\n-        console.log(\"Generative UI - Architecture Refactored.\");\n-        \n-        // Restore saved theme or fallback to Minimalist\n-        const savedTheme = localStorage.getItem('acephale-theme');\n-        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n-        \n-        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n \n-        // Initial load\n+        const savedPreset = localStorage.getItem('acephale-theme');\n+        const savedCustom = localStorage.getItem('acephale-custom-css');\n+        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n+\n+        if (savedCustom) {\n+            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n+            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n+        } else {\n+            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n+            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n+        }\n+\n         await this.loadInitial();\n     },\n \n@@ -1115,52 +1145,204 @@ const App = {\n             .replace(/'/g, \"&#039;\");\n     },\n \n-    handleGenerate() {\n+    getApiKey() {\n+        return localStorage.getItem('acephale-gemini-key');\n+    },\n+\n+    saveApiKey(key) {\n+        localStorage.setItem('acephale-gemini-key', key.trim());\n+    },\n+\n+    clearApiKey() {\n+        localStorage.removeItem('acephale-gemini-key');\n+        this.renderApiKeySection();\n+    },\n+\n+    extractCss(text) {\n+        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n+        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n+        return cleaned.trim();\n+    },\n+\n+    async generateTheme(prompt) {\n+        const key = this.getApiKey();\n+        if (!key) throw new Error('NO_API_KEY');\n+\n+        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n+        const body = {\n+            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n+            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n+            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n+        };\n+\n+        const response = await fetch(endpoint, {\n+            method: 'POST',\n+            headers: { 'Content-Type': 'application/json' },\n+            body: JSON.stringify(body)\n+        });\n+\n+        if (!response.ok) {\n+            const status = response.status;\n+            let apiMessage = '';\n+            try {\n+                const errData = await response.json();\n+                apiMessage = errData?.error?.message || '';\n+                console.error('Gemini API error:', status, errData);\n+            } catch (_) {}\n+            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n+            if (status === 429) {\n+                const e = new Error('RATE_LIMIT');\n+                e.detail = apiMessage;\n+                throw e;\n+            }\n+            throw new Error(`API_ERROR:${status}`);\n+        }\n+\n+        const data = await response.json();\n+        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n+        if (!rawText) throw new Error('EMPTY_RESPONSE');\n+        return this.extractCss(rawText);\n+    },\n+\n+    renderApiKeySection() {\n+        const existing = document.getElementById('api-key-section');\n+        if (existing) existing.remove();\n+\n+        const section = document.createElement('div');\n+        section.id = 'api-key-section';\n+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n+\n+        if (this.getApiKey()) {\n+            section.innerHTML = `\n+                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n+                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n+                </div>`;\n+            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n+        } else {\n+            section.innerHTML = `\n+                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n+                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n+                </div>\n+                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n+                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n+                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n+                </div>`;\n+            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n+                const form = section.querySelector('#api-key-form');\n+                const icon = section.querySelector('#api-key-icon');\n+                const isOpen = form.style.display !== 'none';\n+                form.style.display = isOpen ? 'none' : 'flex';\n+                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n+            });\n+            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n+                const val = section.querySelector('#api-key-input').value.trim();\n+                if (!val) return;\n+                this.saveApiKey(val);\n+                this.renderApiKeySection();\n+            });\n+        }\n+\n+        this.elements.themeControls.appendChild(section);\n+    },\n+\n+    showGenerateError(err) {\n+        let message;\n+        switch (err.message) {\n+            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n+            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n+            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n+            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n+            default:              message = `Generation failed: ${err.message}`;\n+        }\n+        let errEl = document.getElementById('generate-error');\n+        if (!errEl) {\n+            errEl = document.createElement('div');\n+            errEl.id = 'generate-error';\n+            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n+            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n+        }\n+        errEl.textContent = message;\n+        clearTimeout(this._errorTimeout);\n+        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n+    },\n+\n+    expandApiKeySection() {\n+        const form = document.getElementById('api-key-form');\n+        const icon = document.getElementById('api-key-icon');\n+        if (form && form.style.display === 'none') {\n+            form.style.display = 'flex';\n+            if (icon) icon.style.transform = 'rotate(0deg)';\n+        }\n+        this.elements.themeControls.classList.remove('is-minimized');\n+        const input = document.getElementById('api-key-input');\n+        if (input) setTimeout(() => input.focus(), 300);\n+    },\n+\n+    async handleGenerate() {\n         const input = this.elements.promptInput.value.trim();\n         if (!input) return;\n+        if (this._isGenerating) return;\n \n-        const style = this.matchStyle(input);\n-        \n-        if (style) {\n-            this.applyStyle(style, input);\n+        const presetKey = this.matchStyle(input);\n+        if (presetKey) {\n+            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n             this.togglePresets(true);\n-        } else {\n-            this.showError();\n+            return;\n+        }\n+\n+        if (!this.getApiKey()) {\n+            this.expandApiKeySection();\n+            return;\n+        }\n+\n+        this._isGenerating = true;\n+        const btn = this.elements.generateBtn;\n+        const originalText = btn.textContent;\n+        btn.textContent = 'Generating...';\n+        btn.disabled = true;\n+\n+        try {\n+            const css = await this.generateTheme(input);\n+            this.applyStyle(css, null, input);\n+            this.togglePresets(true);\n+        } catch (err) {\n+            this.showGenerateError(err);\n+        } finally {\n+            btn.textContent = originalText;\n+            btn.disabled = false;\n+            this._isGenerating = false;\n         }\n     },\n \n     matchStyle(input) {\n         const normalizedInput = input.toLowerCase();\n         for (const key in STYLE_PRESETS) {\n-            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n+            if (normalizedInput.includes(key.toLowerCase())) return key;\n         }\n         return null;\n     },\n \n-    applyStyle(css, themeName) {\n-        console.log(`Applying theme: ${themeName}`);\n-        this.toggleMenu(false); // Close menu on theme change\n-        \n-        // Save to local storage for persistence\n-        if (STYLE_PRESETS[themeName]) {\n-            localStorage.setItem('acephale-theme', themeName);\n-        }\n+    applyStyle(css, themeName, customPrompt = null) {\n+        this.toggleMenu(false);\n \n-        // Fallback for browsers that don't support View Transition API\n-        if (!document.startViewTransition) {\n-            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-            return;\n+        if (themeName && STYLE_PRESETS[themeName]) {\n+            localStorage.setItem('acephale-theme', themeName);\n+            localStorage.removeItem('acephale-custom-css');\n+            localStorage.removeItem('acephale-custom-prompt');\n+        } else if (customPrompt) {\n+            localStorage.setItem('acephale-custom-css', css);\n+            localStorage.setItem('acephale-custom-prompt', customPrompt);\n+            localStorage.removeItem('acephale-theme');\n         }\n \n-        // Smooth transition using View Transition API\n-        document.startViewTransition(() => {\n+        const applyFn = () => {\n             this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-        });\n-    },\n+        };\n \n-    showError() {\n-        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n-        alert(`Please enter a supported theme:\\n\"${available}\"`);\n+        if (!document.startViewTransition) { applyFn(); return; }\n+        document.startViewTransition(applyFn);\n     }\n };\n \nOn branch main\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"994cc2d8-c130-484d-80fe-c7c579a6eb7c"}
{"parentUuid":"3ad422a7-7a48-4b74-a320-37094aa7eee5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LR9mKUfpShNJWRhwHoZx1R","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014k9jFcscZwK1X2hjm6c4RW","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nAdd AI theme generation via Gemini 2.5 Flash API\n\n- Add GEMINI_SYSTEM_PROMPT for structured CSS-only output\n- Add Gemini API key management (save/clear/renderApiKeySection)\n- Add generateTheme() with error handling (INVALID_KEY, RATE_LIMIT, etc.)\n- Add extractCss() to strip markdown fences from API response\n- Replace synchronous handleGenerate() with async version\n- Update applyStyle() to persist AI-generated CSS to localStorage\n- Update init() to restore AI-generated themes on page load\n- Use gemini-2.5-flash model endpoint\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Stage and commit AI theme generation implementation"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4108,"cache_read_input_tokens":69817,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4108},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKT74s7A8ahxbKwKuyz","type":"assistant","uuid":"b61621c6-39a2-4026-9a74-059ad8915589","timestamp":"2026-02-22T15:09:30.976Z"}

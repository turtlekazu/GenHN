{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"entire hooks claude-code session-start"},"parentToolUseID":"c3237459-d2fc-4026-9e75-56e0e9387f93","toolUseID":"c3237459-d2fc-4026-9e75-56e0e9387f93","timestamp":"2026-02-23T06:10:36.007Z","uuid":"a5e979f4-be3e-4434-87fd-00a499af26eb"}
{"parentUuid":"a5e979f4-be3e-4434-87fd-00a499af26eb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","type":"system","subtype":"local_command","content":"<command-name>/model</command-name>\n            <command-message>model</command-message>\n            <command-args></command-args>","level":"info","timestamp":"2026-02-23T06:10:59.811Z","uuid":"c0568ed2-95de-4e88-9a9b-d58180f9368e","isMeta":false}
{"parentUuid":"c0568ed2-95de-4e88-9a9b-d58180f9368e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","type":"system","subtype":"local_command","content":"<local-command-stdout>Kept model as \u001b[1mDefault (recommended)\u001b[22m</local-command-stdout>","level":"info","timestamp":"2026-02-23T06:10:59.811Z","uuid":"a28f0fbf-20ff-4897-85bc-355264e449c9","isMeta":false}
{"type":"file-history-snapshot","messageId":"01b836e3-00bd-4b5d-b688-5fa0c4c74c67","snapshot":{"messageId":"01b836e3-00bd-4b5d-b688-5fa0c4c74c67","trackedFileBackups":{},"timestamp":"2026-02-23T06:19:24.171Z"},"isSnapshotUpdate":false}
{"parentUuid":"a28f0fbf-20ff-4897-85bc-355264e449c9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","type":"user","message":{"role":"user","content":"READMEを、Gemini APIキーで新しいテーマを生成可能であることを追記した内容に更新してください。"},"uuid":"01b836e3-00bd-4b5d-b688-5fa0c4c74c67","timestamp":"2026-02-23T06:19:24.069Z","todos":[],"permissionMode":"default"}
{"parentUuid":"01b836e3-00bd-4b5d-b688-5fa0c4c74c67","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","message":{"model":"claude-sonnet-4-6","id":"msg_01PY9MyzwERKX3wGbvUaQcH6","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to update the README to mention that new themes can be generated using a Gemini API key. Let me first read the current README file and the memory file to understand the project context.","signature":"EvECCkYICxgCKkCenncbtqoNA8sGoVBslKJviY9cc8hPzTfn7AMLurNqgNjZ6+B63G/WdGdcici8tqvHuw2RRFbRjB7xUMPMnLEOEgw1uOixV39Xk4BgnqcaDNSQaBlgT1oFdxcAkyIwQ6VfeX/kbjtus9FZFztXeaMMud4jZ+nj1qU+ud2hv5DAF/jR0gJRcnczzsmNHFvoKtgBHV2AP0iFW+yOkqpRzcawko5EpPrdJNZPTOzoIpP5z5ev2faJ9tNhUnFWA3uZbowe+yQpvPfmcnMvimHLBTqT31bpM7PZOi5NREqXjL4m3YzFLFBOXuiO/6XVEDZX2SKddYUBPAA5fU4YZ87jQAiQV6c0S1mMWKeAhPvM1lgGEWnPVauMhnSgsMa1b3P2joMMCz3P8AmMfYJ+tqdOzrkBC5NQDamTW+L/f307vgrBqbSRMtT7Y5u3VxVN6z5bbug3ZZCGDJNHK5L+pxpkJz9Q5NyG8S5GE/L6GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2069,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2069},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWrjUYCt6iR8HmXPuCZ","type":"assistant","uuid":"ba6deba3-d6ba-407d-a19e-2ea011b89531","timestamp":"2026-02-23T06:19:26.685Z"}
{"parentUuid":"ba6deba3-d6ba-407d-a19e-2ea011b89531","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01PY9MyzwERKX3wGbvUaQcH6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DWhYi5gaTA6LMtjjDKBuGW","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2069,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2069},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWrjUYCt6iR8HmXPuCZ","type":"assistant","uuid":"e6faf186-363f-439a-aa32-d0c8815cbf2b","timestamp":"2026-02-23T06:19:27.079Z"}
{"parentUuid":"e6faf186-363f-439a-aa32-d0c8815cbf2b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01DWhYi5gaTA6LMtjjDKBuGW","toolUseID":"toolu_01DWhYi5gaTA6LMtjjDKBuGW","timestamp":"2026-02-23T06:19:27.094Z","uuid":"f81133fb-d9d4-464a-b7fd-96dd5e1313d7"}
{"parentUuid":"e6faf186-363f-439a-aa32-d0c8815cbf2b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DWhYi5gaTA6LMtjjDKBuGW","type":"tool_result","content":"     1→# GenHN\n     2→\n     3→An experimental project that dynamically reconstructs the Hacker News interface using the \"essences\" of world-renowned product design systems.\n     4→\n     5→[日本語版 (Japanese README)](README-ja.md)\n     6→\n     7→## Features\n     8→\n     9→- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n    10→- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n    11→- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n    12→- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n    13→- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n    14→- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).\n    15→\n    16→## Usage\n    17→\n    18→1. Open `index.html` in your browser.\n    19→2. Click a preset button in the bottom-right panel, or type a theme name in the input field and click **Apply**.\n    20→3. Use the header navigation links to switch between HN feeds (Top / New / Ask / Show / Jobs).\n    21→\n    22→## Available Design Essences\n    23→\n    24→| Theme | Description |\n    25→|-------|-------------|\n    26→| **Minimalist** | Soft white base with glassmorphism header, clean typography, and subtle card shadows. |\n    27→| **Intelligence** | Near-black background with emerald green accents, monospace logo, and a blinking cursor — AI chat interface inspired. |\n    28→| **Search** | Pure white, functional layout, and blue hyperlink-style titles evoking classic search engine aesthetics. |\n    29→| **Universal** | Bold card grid with rounded corners and strong blue accents — friendly and highly legible. |\n    30→| **Glitch** | Black background with electric yellow text, cyan subtext, CRT scanline overlay, and polygon-clipped cards. |\n    31→| **Playful** | Light gray background with a red header, thick black borders, and a card grid reminiscent of game console UI. |\n    32→| **Glow** | Deep navy with a radial blue gradient, glowing neon logo, and translucent cards — next-gen console aesthetic. |\n    33→| **Academic** | Warm cream background, serif typography, and a terracotta accent for a calm, thoughtful reading experience. |\n    34→| **Ghibli** | Soft paper-like cream tones, deep forest green, and Japanese serif fonts — a hand-crafted, watercolor-inspired feel. |\n    35→| **8-Bit** | Pure black, phosphor-green terminal text, cyan accents, monospace font, and pixelated rendering — retro PC / game aesthetic. |\n    36→\n    37→## Architecture\n    38→\n    39→The entire application lives in two files:\n    40→\n    41→- **`index.html`** — Static DOM structure (header, story list, control panel).\n    42→- **`gardener.js`** (~1,200 lines) — All application logic:\n    43→  - `SYSTEM_STYLE` — Base CSS (layout, glassmorphism, responsive design).\n    44→  - `STYLE_PRESETS` — Theme definitions via CSS custom properties.\n    45→  - `HNData` — Hacker News API integration (feed fetching, pagination).\n    46→  - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n    47→\n    48→## Adding a New Theme\n    49→\n    50→Add an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).\n    51→\n    52→## Disclaimer\n    53→\n    54→This project is for design experimentation purposes only and has no direct affiliation with any existing brands. All trademarks and direct brand representations have been excluded.\n    55→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8a780cda-ea63-47ea-98d4-fba65321bdf5","timestamp":"2026-02-23T06:19:27.093Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/README.md","content":"# GenHN\n\nAn experimental project that dynamically reconstructs the Hacker News interface using the \"essences\" of world-renowned product design systems.\n\n[日本語版 (Japanese README)](README-ja.md)\n\n## Features\n\n- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).\n\n## Usage\n\n1. Open `index.html` in your browser.\n2. Click a preset button in the bottom-right panel, or type a theme name in the input field and click **Apply**.\n3. Use the header navigation links to switch between HN feeds (Top / New / Ask / Show / Jobs).\n\n## Available Design Essences\n\n| Theme | Description |\n|-------|-------------|\n| **Minimalist** | Soft white base with glassmorphism header, clean typography, and subtle card shadows. |\n| **Intelligence** | Near-black background with emerald green accents, monospace logo, and a blinking cursor — AI chat interface inspired. |\n| **Search** | Pure white, functional layout, and blue hyperlink-style titles evoking classic search engine aesthetics. |\n| **Universal** | Bold card grid with rounded corners and strong blue accents — friendly and highly legible. |\n| **Glitch** | Black background with electric yellow text, cyan subtext, CRT scanline overlay, and polygon-clipped cards. |\n| **Playful** | Light gray background with a red header, thick black borders, and a card grid reminiscent of game console UI. |\n| **Glow** | Deep navy with a radial blue gradient, glowing neon logo, and translucent cards — next-gen console aesthetic. |\n| **Academic** | Warm cream background, serif typography, and a terracotta accent for a calm, thoughtful reading experience. |\n| **Ghibli** | Soft paper-like cream tones, deep forest green, and Japanese serif fonts — a hand-crafted, watercolor-inspired feel. |\n| **8-Bit** | Pure black, phosphor-green terminal text, cyan accents, monospace font, and pixelated rendering — retro PC / game aesthetic. |\n\n## Architecture\n\nThe entire application lives in two files:\n\n- **`index.html`** — Static DOM structure (header, story list, control panel).\n- **`gardener.js`** (~1,200 lines) — All application logic:\n  - `SYSTEM_STYLE` — Base CSS (layout, glassmorphism, responsive design).\n  - `STYLE_PRESETS` — Theme definitions via CSS custom properties.\n  - `HNData` — Hacker News API integration (feed fetching, pagination).\n  - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n\n## Adding a New Theme\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).\n\n## Disclaimer\n\nThis project is for design experimentation purposes only and has no direct affiliation with any existing brands. All trademarks and direct brand representations have been excluded.\n","numLines":55,"startLine":1,"totalLines":55}},"sourceToolAssistantUUID":"e6faf186-363f-439a-aa32-d0c8815cbf2b"}
{"parentUuid":"8a780cda-ea63-47ea-98d4-fba65321bdf5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01PY9MyzwERKX3wGbvUaQcH6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Jmy2xztkbrBUPsUVqgjH9L","name":"Read","input":{"file_path":"/Users/turtlekazu/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2069,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2069},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWrjUYCt6iR8HmXPuCZ","type":"assistant","uuid":"4aad3b3d-5992-4fc6-9f2d-931c52acb46a","timestamp":"2026-02-23T06:19:27.970Z"}
{"parentUuid":"4aad3b3d-5992-4fc6-9f2d-931c52acb46a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File does not exist. Note: your current working directory is /Users/turtlekazu/ReactProjects/GenHN.","is_error":true,"tool_use_id":"toolu_01Jmy2xztkbrBUPsUVqgjH9L"}]},"uuid":"b62c3122-e0ba-4682-bf4f-cbe02e2a5675","timestamp":"2026-02-23T06:19:27.976Z","toolUseResult":"Error: File does not exist. Note: your current working directory is /Users/turtlekazu/ReactProjects/GenHN.","sourceToolAssistantUUID":"4aad3b3d-5992-4fc6-9f2d-931c52acb46a"}
{"parentUuid":"b62c3122-e0ba-4682-bf4f-cbe02e2a5675","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017U7ugvjjLNKTU3mfhBGFMC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me also check if there's a Japanese README and if there's any Gemini API integration already in the code.","signature":"EpoCCkYICxgCKkAAox5bu6LjDR8k21GFcMhpB446sciAEr/RtmWskpFokE/HLiLCL3h+UGjVM0iY7p/yM23ayk45B8i3fQWg7thkEgyhmMpSSeUOaLcs020aDFTj6kDqxHpeoM1QqyIwH87/k8KtBljJAr9nVHSKxSQEGA/t3nrHki58cPJggEIn7f9rZPUBNOS+ohf21ii/KoEB7vhH0xAohrtxGMZhdsBcpvjttPOFAyZRHH3l21RNC473sj/c4Sefy/Su0vnIVB++bhxiLSClbC/sYMaeWEP/ztGaWaUZf0bnxwi+OeDWJVPlU3QoBSqnTkwBF1nG6kw3r/FcNXTg5v1jCMCk41LNnDekeg0l4jh2jARzgImlQ4nPGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1408,"cache_read_input_tokens":20717,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1408},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWs1h7SbKvn61TH2jqK","type":"assistant","uuid":"41b2b920-f67f-49a4-aa7c-7520607a16c4","timestamp":"2026-02-23T06:19:29.937Z"}
{"parentUuid":"41b2b920-f67f-49a4-aa7c-7520607a16c4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017U7ugvjjLNKTU3mfhBGFMC","type":"message","role":"assistant","content":[{"type":"text","text":"Gemini API連携のコードが既にあるか確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1408,"cache_read_input_tokens":20717,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1408},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWs1h7SbKvn61TH2jqK","type":"assistant","uuid":"3cbef121-898f-4fd2-9e37-7aad3f87217b","timestamp":"2026-02-23T06:19:30.688Z"}
{"parentUuid":"3cbef121-898f-4fd2-9e37-7aad3f87217b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017U7ugvjjLNKTU3mfhBGFMC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WWeUZb5vETeQj8xuFCbjjB","name":"Grep","input":{"pattern":"gemini|Gemini|GEMINI|generateTheme|api.*key|apiKey","path":"/Users/turtlakazu/ReactProjects/GenHN/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1408,"cache_read_input_tokens":20717,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1408},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWs1h7SbKvn61TH2jqK","type":"assistant","uuid":"890837f0-f88f-4962-af34-7abf91a7f77e","timestamp":"2026-02-23T06:19:32.075Z"}
{"parentUuid":"890837f0-f88f-4962-af34-7abf91a7f77e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Path does not exist: /Users/turtlakazu/ReactProjects/GenHN/gardener.js. Note: your current working directory is /Users/turtlekazu/ReactProjects/GenHN.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01WWeUZb5vETeQj8xuFCbjjB"}]},"uuid":"d5261675-9cea-41bd-b362-f97c1a38a139","timestamp":"2026-02-23T06:19:32.078Z","toolUseResult":"Error: Path does not exist: /Users/turtlakazu/ReactProjects/GenHN/gardener.js. Note: your current working directory is /Users/turtlekazu/ReactProjects/GenHN.","sourceToolAssistantUUID":"890837f0-f88f-4962-af34-7abf91a7f77e"}
{"parentUuid":"d5261675-9cea-41bd-b362-f97c1a38a139","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017U7ugvjjLNKTU3mfhBGFMC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RZ15biChjxjYiGL5inH7kn","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README-ja.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1408,"cache_read_input_tokens":20717,"output_tokens":246,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":1408,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQWs1h7SbKvn61TH2jqK","type":"assistant","uuid":"d214e17e-c3d4-4d78-bd13-f8d4d61e7e7d","timestamp":"2026-02-23T06:19:32.635Z"}
{"parentUuid":"d214e17e-c3d4-4d78-bd13-f8d4d61e7e7d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Sibling tool call errored</tool_use_error>","is_error":true,"tool_use_id":"toolu_01RZ15biChjxjYiGL5inH7kn"}]},"uuid":"7a8f71ee-fc4b-47a2-8165-df599f65a2a9","timestamp":"2026-02-23T06:19:32.635Z","toolUseResult":"Sibling tool call errored","sourceToolAssistantUUID":"d214e17e-c3d4-4d78-bd13-f8d4d61e7e7d"}
{"parentUuid":"7a8f71ee-fc4b-47a2-8165-df599f65a2a9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Lb39zHvZoR48CJ1c4i8nRa","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QM7n64Vg6jpeuf3sgs3trF","name":"Grep","input":{"pattern":"gemini|Gemini|GEMINI|generateTheme|apiKey","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":387,"cache_read_input_tokens":22125,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":387},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWsMXDhvJx8RbywKLJ2","type":"assistant","uuid":"d84f31e3-444c-4795-8937-ee6cad259305","timestamp":"2026-02-23T06:19:35.007Z"}
{"parentUuid":"d84f31e3-444c-4795-8937-ee6cad259305","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Lb39zHvZoR48CJ1c4i8nRa","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AcLTSjHkMhRPL8b8UHcfMg","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README-ja.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":387,"cache_read_input_tokens":22125,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":387},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWsMXDhvJx8RbywKLJ2","type":"assistant","uuid":"270cabe8-72b6-4384-9868-239e0c705f98","timestamp":"2026-02-23T06:19:35.299Z"}
{"parentUuid":"270cabe8-72b6-4384-9868-239e0c705f98","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01AcLTSjHkMhRPL8b8UHcfMg","toolUseID":"toolu_01AcLTSjHkMhRPL8b8UHcfMg","timestamp":"2026-02-23T06:19:35.305Z","uuid":"cde0fefd-cb55-458c-bc12-10a3166f6ae4"}
{"parentUuid":"270cabe8-72b6-4384-9868-239e0c705f98","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AcLTSjHkMhRPL8b8UHcfMg","type":"tool_result","content":"     1→# GenHN\n     2→\n     3→Hacker Newsのインターフェースを、世界的に有名なプロダクトやデザインシステムの「本質（エッセンス）」を用いて動的に再構築する実験的プロジェクトです。\n     4→\n     5→[English version (English README)](README.md)\n     6→\n     7→## 特徴\n     8→\n     9→- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n    10→- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n    11→- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n    12→- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n    13→- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n    14→- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。\n    15→\n    16→## 使い方\n    17→\n    18→1. `index.html` をブラウザで開きます。\n    19→2. 右下のパネルにあるプリセットボタンをクリックするか、入力欄にテーマ名を入力して **Apply** をクリックします。\n    20→3. ヘッダーのナビゲーションリンクでHNフィードを切り替えます（Top / New / Ask / Show / Jobs）。\n    21→\n    22→## 利用可能なデザインエッセンス\n    23→\n    24→| テーマ | 説明 |\n    25→|--------|------|\n    26→| **Minimalist** | グラスモーフィズムヘッダー、クリーンなタイポグラフィ、繊細なカードシャドウを備えたソフトな白ベース。 |\n    27→| **Intelligence** | ほぼ黒の背景にエメラルドグリーンのアクセント、モノスペースロゴ、点滅カーソル——AIチャットインターフェース風。 |\n    28→| **Search** | 純白のクリーンなレイアウトと青いリンクスタイルのタイトル。クラシックな検索エンジン美学。 |\n    29→| **Universal** | 角丸の大胆なカードグリッドと強いブルーアクセント。親しみやすく、高い視認性。 |\n    30→| **Glitch** | 黒背景にネオンイエローのテキスト、シアンのサブテキスト、CRTスキャンラインオーバーレイ、多角形クリップのカード。 |\n    31→| **Playful** | ライトグレーの背景に赤ヘッダー、太い黒ボーダー、ゲーム機UIを思わせるカードグリッド。 |\n    32→| **Glow** | ディープネイビーに放射状ブルーグラデーション、光るネオンロゴ、半透明カード——次世代コンソール風。 |\n    33→| **Academic** | 暖かみのあるクリーム背景、セリフ体タイポグラフィ、テラコッタアクセント。落ち着いた読書体験。 |\n    34→| **Ghibli** | 柔らかな和紙風クリームトーン、深い森の緑、日本語明朝体フォント——手描き・水彩画のような温かみ。 |\n    35→| **8-Bit** | 漆黒の背景に燐光グリーンのターミナルテキスト、シアンのアクセント、等幅フォント、ピクセル描画——レトロPC・ゲーム機風。 |\n    36→\n    37→## アーキテクチャ\n    38→\n    39→アプリケーション全体は2つのファイルで構成されています。\n    40→\n    41→- **`index.html`** — 静的なDOM構造（ヘッダー、記事リスト、コントロールパネル）。\n    42→- **`gardener.js`**（約1,200行）— すべてのアプリケーションロジック：\n    43→  - `SYSTEM_STYLE` — ベースCSS（レイアウト、グラスモーフィズム、レスポンシブデザイン）。\n    44→  - `STYLE_PRESETS` — CSSカスタムプロパティによるテーマ定義。\n    45→  - `HNData` — Hacker News API連携（フィード取得、ページネーション）。\n    46→  - `App` — メインコントローラー（テーマ適用、レンダリング、イベント処理、localStorage永続化）。\n    47→\n    48→## 新しいテーマを追加するには\n    49→\n    50→`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。\n    51→\n    52→## 注意事項\n    53→\n    54→このプロジェクトはデザインの実験を目的としており、既存のいかなるブランドとも直接の関係はありません。商標およびブランドの直接的な表現は排除されています。\n    55→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"64e14eaa-3160-402a-abb5-6c52ee441b85","timestamp":"2026-02-23T06:19:35.304Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/README-ja.md","content":"# GenHN\n\nHacker Newsのインターフェースを、世界的に有名なプロダクトやデザインシステムの「本質（エッセンス）」を用いて動的に再構築する実験的プロジェクトです。\n\n[English version (English README)](README.md)\n\n## 特徴\n\n- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。\n\n## 使い方\n\n1. `index.html` をブラウザで開きます。\n2. 右下のパネルにあるプリセットボタンをクリックするか、入力欄にテーマ名を入力して **Apply** をクリックします。\n3. ヘッダーのナビゲーションリンクでHNフィードを切り替えます（Top / New / Ask / Show / Jobs）。\n\n## 利用可能なデザインエッセンス\n\n| テーマ | 説明 |\n|--------|------|\n| **Minimalist** | グラスモーフィズムヘッダー、クリーンなタイポグラフィ、繊細なカードシャドウを備えたソフトな白ベース。 |\n| **Intelligence** | ほぼ黒の背景にエメラルドグリーンのアクセント、モノスペースロゴ、点滅カーソル——AIチャットインターフェース風。 |\n| **Search** | 純白のクリーンなレイアウトと青いリンクスタイルのタイトル。クラシックな検索エンジン美学。 |\n| **Universal** | 角丸の大胆なカードグリッドと強いブルーアクセント。親しみやすく、高い視認性。 |\n| **Glitch** | 黒背景にネオンイエローのテキスト、シアンのサブテキスト、CRTスキャンラインオーバーレイ、多角形クリップのカード。 |\n| **Playful** | ライトグレーの背景に赤ヘッダー、太い黒ボーダー、ゲーム機UIを思わせるカードグリッド。 |\n| **Glow** | ディープネイビーに放射状ブルーグラデーション、光るネオンロゴ、半透明カード——次世代コンソール風。 |\n| **Academic** | 暖かみのあるクリーム背景、セリフ体タイポグラフィ、テラコッタアクセント。落ち着いた読書体験。 |\n| **Ghibli** | 柔らかな和紙風クリームトーン、深い森の緑、日本語明朝体フォント——手描き・水彩画のような温かみ。 |\n| **8-Bit** | 漆黒の背景に燐光グリーンのターミナルテキスト、シアンのアクセント、等幅フォント、ピクセル描画——レトロPC・ゲーム機風。 |\n\n## アーキテクチャ\n\nアプリケーション全体は2つのファイルで構成されています。\n\n- **`index.html`** — 静的なDOM構造（ヘッダー、記事リスト、コントロールパネル）。\n- **`gardener.js`**（約1,200行）— すべてのアプリケーションロジック：\n  - `SYSTEM_STYLE` — ベースCSS（レイアウト、グラスモーフィズム、レスポンシブデザイン）。\n  - `STYLE_PRESETS` — CSSカスタムプロパティによるテーマ定義。\n  - `HNData` — Hacker News API連携（フィード取得、ページネーション）。\n  - `App` — メインコントローラー（テーマ適用、レンダリング、イベント処理、localStorage永続化）。\n\n## 新しいテーマを追加するには\n\n`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。\n\n## 注意事項\n\nこのプロジェクトはデザインの実験を目的としており、既存のいかなるブランドとも直接の関係はありません。商標およびブランドの直接的な表現は排除されています。\n","numLines":55,"startLine":1,"totalLines":55}},"sourceToolAssistantUUID":"270cabe8-72b6-4384-9868-239e0c705f98"}
{"parentUuid":"64e14eaa-3160-402a-abb5-6c52ee441b85","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01QM7n64Vg6jpeuf3sgs3trF","toolUseID":"toolu_01QM7n64Vg6jpeuf3sgs3trF","timestamp":"2026-02-23T06:19:35.326Z","uuid":"d6c9b65d-06fc-4f8f-b6f1-4333fbff6cf8"}
{"parentUuid":"d84f31e3-444c-4795-8937-ee6cad259305","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QM7n64Vg6jpeuf3sgs3trF","type":"tool_result","content":"8:const GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\n1623:        return localStorage.getItem('genhn-gemini-key');\n1627:        localStorage.setItem('genhn-gemini-key', key.trim());\n1631:        localStorage.removeItem('genhn-gemini-key');\n1641:    async generateTheme(prompt) {\n1645:        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n1647:            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n1664:                console.error('Gemini API error:', status, errData);\n1694:                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n1701:                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n1729:            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n1732:            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n1872:            const css = await this.generateTheme(input);"}]},"uuid":"3e0fc12b-1f2b-4e71-8cbc-0a3dd6a86f5d","timestamp":"2026-02-23T06:19:35.325Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"8:const GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\n1623:        return localStorage.getItem('genhn-gemini-key');\n1627:        localStorage.setItem('genhn-gemini-key', key.trim());\n1631:        localStorage.removeItem('genhn-gemini-key');\n1641:    async generateTheme(prompt) {\n1645:        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n1647:            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n1664:                console.error('Gemini API error:', status, errData);\n1694:                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n1701:                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n1729:            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n1732:            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n1872:            const css = await this.generateTheme(input);","numLines":13},"sourceToolAssistantUUID":"d84f31e3-444c-4795-8937-ee6cad259305"}
{"parentUuid":"3e0fc12b-1f2b-4e71-8cbc-0a3dd6a86f5d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019TVK9nWjEmj24NWaD9ZE6N","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a good understanding of the project. I can see that there's already a Gemini API integration in `gardener.js`. The code includes:\n- `GEMINI_SYSTEM_PROMPT` - a system prompt for the Gemini API\n- `generateTheme(prompt)` - an async function that calls the Gemini API to generate themes\n- API key management via localStorage\n- UI for enabling/disabling the Gemini AI feature\n\nI need to update both `README.md` and `README-ja.md` to mention that new themes can be generated using a Gemini API key.\n\nLet me craft the update:\n\n\nI'll add a feature bullet about Gemini AI theme generation and create a new section explaining how to use the API key feature in both the English and Japanese documentation. First, let me examine the gardener.js implementation more closely to ensure I'm documenting the feature accurately.","signature":"Eo0ICkYICxgCKkBOlKinGIOgL8JJ6LFX89cPbvkM1aY53N8VWfr8QCkMuKRQ7zwa+msrpnDoB1Tq8cJaFanJl0mL7e6WH7fjKQW3EgyOQjlob7g5WNvoa0UaDB0CIR2xUmEFMPY/MSIwnN8A4A3rSXu+/KxSV6HH4ujzqngJQ9wCBZotr1C7TbQx9DjoPl9oRe+fdqeE3AmnKvQGsozMvfmyJ+f0BU0mS5SLSnsebgihnWFfBNttF6K3uSTLwxlDOtvM0Lr4dPd5TwCopEDo/IUWu7qz953vj5BN8EYuvHAyR9UpcbdubXEGKL0T18vvwPIKsQz/sshf6JKBjeqCwVyaQyIRuj/gf7+tx28qDE5y1W9HdK4ZoYGw1iLFw0sKrpaxFT79HL37hC9wnZghhtRPNxWmS2YhR26I+4QLHbDGIZksCJuBH2m2z0yzSE49G/smnBm6TNM/hHU3igA0otLZS3UVpI33S7p893nf99VRn3q470/2NI4i7RvwQ8LQM09bBT1wGg4bZf0xQ0s3kbTi4pNr2zrlCk5ZaR9qZsVa9llXKuceae/i2stZfmqg8wRsZbD3QQckWCGdlAJAcGGNiUoLyjAxIMrDGvkWeGUvtGkKFG8Z7r+xnyXFukSh6EUl5gJQ4tlPyz0T4fIWrvpQxVMDUerT3RNCarvFq1SmwuZDXd0RR2haE/2Uurdes0deq12pzMSICjqL4blwWj2uhHuj5Zg+q6iVOZp+TrRL8YjLjindfbYmygWraKwKXoxMEwkMQ6nV/W3we2p5GgRCETegZQxEUMCZr5jkRZlepZk7Dpo6ZLeyN4Utdt0nw+vCeCsLyZESqqO6TlsOE17WmsreYlcnLZ3A7wSfsQzhJKkaV2iQGjsL8tnjtPJM5gZarEtcK4UsSECwZOn79pDHv0c9rVXlkFHjQJtUksq1oTZYPT/4L9YIm3y8/Lpvp6yGSaKymp28QDt7fGiFvLpROiDBwsAPMFf5RE0lSUW6YZi3a473Z+11aS29Odgy81lwG68XvFU/iEsZnDEd+QbtQ3vuAH3hi6TpChQAsZuSMQV0wC603hCbfGq++f1evHTWD+oI7t9XuJWoExdUhjMfYb9rWZ+neM86Cl8YPuq+tB6VzKEWqqhqrhZRoOz6LsspqfZAhF40/FSgDygvx7JIs8rUQ7fIEt4mNT4/p4vDF4n9qZHaarZOzjQhVNwHDrLHgXWo/eTTd65Xszyaqzd2Q/88/nk5jsQTAS/eNcl+4NS2DDsXt5Vqu1mjnrUQ7PnoJxZJ7qRSlkTXTL0OUM7jRZ9aSR325R6E9cQVCfJObkkrBdhk/6od2T5xIuci9XO+NCg7b0l9Ny0yEFuOSb5t9XYmgtHN3to5yn73HOcYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1840,"cache_creation_input_tokens":570,"cache_read_input_tokens":22512,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":570},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWsZ22UvTcRdH2TiHrq","type":"assistant","uuid":"6d736ab4-8d3c-48ab-b0c7-609ae37848b6","timestamp":"2026-02-23T06:19:42.434Z"}
{"parentUuid":"6d736ab4-8d3c-48ab-b0c7-609ae37848b6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019TVK9nWjEmj24NWaD9ZE6N","type":"message","role":"assistant","content":[{"type":"text","text":"Gemini連携の実装詳細を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1840,"cache_creation_input_tokens":570,"cache_read_input_tokens":22512,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":570},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWsZ22UvTcRdH2TiHrq","type":"assistant","uuid":"2b4af414-5db7-4b1e-ad2c-9826f807e454","timestamp":"2026-02-23T06:19:42.477Z"}
{"parentUuid":"2b4af414-5db7-4b1e-ad2c-9826f807e454","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019TVK9nWjEmj24NWaD9ZE6N","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KTGeYiRPGodGsbBA82mShJ","name":"Grep","input":{"pattern":"generateTheme|apiKey|genhn-gemini|expandApiKey","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":3},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1840,"cache_creation_input_tokens":570,"cache_read_input_tokens":22512,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":570},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWsZ22UvTcRdH2TiHrq","type":"assistant","uuid":"f9d39243-1511-4b11-9d3d-a4b9d72b9840","timestamp":"2026-02-23T06:19:43.775Z"}
{"parentUuid":"f9d39243-1511-4b11-9d3d-a4b9d72b9840","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01KTGeYiRPGodGsbBA82mShJ","toolUseID":"toolu_01KTGeYiRPGodGsbBA82mShJ","timestamp":"2026-02-23T06:19:44.067Z","uuid":"77536608-1f35-4b87-9541-34d4ca18c30a"}
{"parentUuid":"f9d39243-1511-4b11-9d3d-a4b9d72b9840","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KTGeYiRPGodGsbBA82mShJ","type":"tool_result","content":"1620-    },\n1621-\n1622-    getApiKey() {\n1623:        return localStorage.getItem('genhn-gemini-key');\n1624-    },\n1625-\n1626-    saveApiKey(key) {\n1627:        localStorage.setItem('genhn-gemini-key', key.trim());\n1628-    },\n1629-\n1630-    clearApiKey() {\n1631:        localStorage.removeItem('genhn-gemini-key');\n1632-        this.renderApiKeySection();\n1633-    },\n1634-\n--\n1638-        return cleaned.trim();\n1639-    },\n1640-\n1641:    async generateTheme(prompt) {\n1642-        const key = this.getApiKey();\n1643-        if (!key) throw new Error('NO_API_KEY');\n1644-\n--\n1726-    showGenerateError(err) {\n1727-        let message;\n1728-        switch (err.message) {\n1729:            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n1730:            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n1731-            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n1732-            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n1733-            default:              message = `Generation failed: ${err.message}`;\n--\n1744-        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n1745-    },\n1746-\n1747:    expandApiKeySection() {\n1748-        const form = document.getElementById('api-key-form');\n1749-        const icon = document.getElementById('api-key-icon');\n1750-        if (form && form.style.display === 'none') {\n--\n1858-        }\n1859-\n1860-        if (!this.getApiKey()) {\n1861:            this.expandApiKeySection();\n1862-            return;\n1863-        }\n1864-\n--\n1869-        btn.disabled = true;\n1870-\n1871-        try {\n1872:            const css = await this.generateTheme(input);\n1873-            this.applyStyle(css, null, input);\n1874-            this.togglePresets(true);\n1875-            this.renderSaveButton(true);"}]},"uuid":"a52dbb78-63bc-4bd1-a27a-f62cbfd237ed","timestamp":"2026-02-23T06:19:44.065Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1620-    },\n1621-\n1622-    getApiKey() {\n1623:        return localStorage.getItem('genhn-gemini-key');\n1624-    },\n1625-\n1626-    saveApiKey(key) {\n1627:        localStorage.setItem('genhn-gemini-key', key.trim());\n1628-    },\n1629-\n1630-    clearApiKey() {\n1631:        localStorage.removeItem('genhn-gemini-key');\n1632-        this.renderApiKeySection();\n1633-    },\n1634-\n--\n1638-        return cleaned.trim();\n1639-    },\n1640-\n1641:    async generateTheme(prompt) {\n1642-        const key = this.getApiKey();\n1643-        if (!key) throw new Error('NO_API_KEY');\n1644-\n--\n1726-    showGenerateError(err) {\n1727-        let message;\n1728-        switch (err.message) {\n1729:            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n1730:            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n1731-            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n1732-            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n1733-            default:              message = `Generation failed: ${err.message}`;\n--\n1744-        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n1745-    },\n1746-\n1747:    expandApiKeySection() {\n1748-        const form = document.getElementById('api-key-form');\n1749-        const icon = document.getElementById('api-key-icon');\n1750-        if (form && form.style.display === 'none') {\n--\n1858-        }\n1859-\n1860-        if (!this.getApiKey()) {\n1861:            this.expandApiKeySection();\n1862-            return;\n1863-        }\n1864-\n--\n1869-        btn.disabled = true;\n1870-\n1871-        try {\n1872:            const css = await this.generateTheme(input);\n1873-            this.applyStyle(css, null, input);\n1874-            this.togglePresets(true);\n1875-            this.renderSaveButton(true);","numLines":56},"sourceToolAssistantUUID":"f9d39243-1511-4b11-9d3d-a4b9d72b9840"}
{"parentUuid":"a52dbb78-63bc-4bd1-a27a-f62cbfd237ed","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01UvK4xWeVKRcA5dUdQ9NdpE","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a clear picture. The Gemini API integration:\n\n1. Stores the API key in localStorage under `genhn-gemini-key`\n2. Uses `gemini-2.5-flash` model via `https://generativelanguage.googleapis.com/v1beta/`\n3. Has a UI section in the control panel to add the API key\n4. Allows generating themes by typing a theme description in the text input field and clicking Apply (when API key is set)\n\nNow let me update both README.md and README-ja.md to reflect this.\n\nFor the English README, I'll:\n\n\n- Add a feature bullet about AI Theme Generation that lets users enter a Gemini API key to generate custom design themes from text prompts\n- Create a new section explaining how to obtain and use the Gemini API key\n\nI'll do the same for the Japanese README with translated content.","signature":"EqEHCkYICxgCKkCjFi99L1u/ROmKq+HE69CBZYBmRMO6gHHx81vkZQasqCHXLnKb1ZCvs52GmrxH3BvtHv7GcONPi3La6Yn380K3EgxqihOtlE6AE+wFJAQaDP/uWQunWPZWWm32RSIwHCn2j5DaSq+li/MEHlT4qzY47NsRUEcUWvvCYGPqwKDtMTnDo0N8MB/4o+oIM9+vKogGfJ+nm/QD70i1GCLUdpeiuk46uDt2OK23FtxM4z21sgeac4cyQJEhrEbYmdvz0CIsPv44Jc+XzkO9wTKZwpN2qYNZffezPoW8ZviH8Ypzji7HtjJpKOp1/jwtHf++xnPEE86v2Q6KQL2g9nLTtM4IT9xJfMcPdwfmCw13CttJCbss7ONrUk55BSDyE6Tun/rO5eDh4H/7s9xHSHmWRc7RyPM8KqWF48BkKo02B/LVJR2aqnZENnz1F+R2CX4tIHeocQZsfzvHVHnPMqNfQigWNdH0DItSZiOhqhiI2YDlVpzv36EUUJsx/Oa2G6YgjS1E6a1JKa+CJ2w6F4hhVb6f+3AxAqSKtLiays7iKyb4jUq2wlgpBZAs3EMjzUQH87S4OtfCBU30+0KA4F6l3V4yW1AeIz1BxPstkbFMqjNyHf0l31K/EfObRqJZ2Hurd8ZA2xGl3LbD5UoqzeuaU0Hi51XOxkQwqU5vJs0Vq7wSC7nLJ0roKF6FBY0lDCqvJ6gLm3DZcET09TXIMKHHq4edKskTBhQFear6+zncgSKyGCq4zvImIaS+7DPRQBmipaaj7j4suqyj6EB525Q9zplhys0e798uRLFwkMlPi9zj1ATMGuKgzGOcRTqOTv14wZPsu4l7zYKDuxKFsYI5CgT/Smh/qVwDn5abufuUL75kcgIl8Sr/WQfnB2LSWnXQRSAo7RXnKWQFB+enQLla6fvidULZEigt3uKlR/jJ9HSP9m+2etbCjlz5bl0/ohRWlxkgZ89IHYceSdUv9u1ZXO/+GfdXpuG+CyOU8dYdtTXtsdX6/g+Hdr3a6PfyyPZSGa3EBKqRCPTbS5/sTZuQrE0yHimr/BENR/iRPzjtNoBJMoX/K3LPPas4Ga6qKKKA7SW693l9zrN2KB6qkcfLLf4bc68rb6/KZH0taV/8vpNPy6co4bLCYvh7dMk9o/RtbtsycAro+1LtqYEC7Kp1k/ixO/Rpcey24oaFW5hntqce+e8m9wbATT741yoqBaP0G7N8qEEtar/hNUsYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2924,"cache_read_input_tokens":23082,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2924},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWtCQKPY68LjT5vXYx7","type":"assistant","uuid":"978a31dd-6808-410c-ac0f-0e9c23fc9bc4","timestamp":"2026-02-23T06:19:50.518Z"}
{"parentUuid":"978a31dd-6808-410c-ac0f-0e9c23fc9bc4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01UvK4xWeVKRcA5dUdQ9NdpE","type":"message","role":"assistant","content":[{"type":"text","text":"実装を把握しました。英語・日本語両方のREADMEを更新します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2924,"cache_read_input_tokens":23082,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2924},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWtCQKPY68LjT5vXYx7","type":"assistant","uuid":"20591e19-a20d-433a-8ee3-6aaaf5097ddc","timestamp":"2026-02-23T06:19:50.528Z"}
{"parentUuid":"20591e19-a20d-433a-8ee3-6aaaf5097ddc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01UvK4xWeVKRcA5dUdQ9NdpE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VBP6UhEwdwMc8TRfgt8vSG","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README.md","old_string":"- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).","new_string":"- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback)."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2924,"cache_read_input_tokens":23082,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2924},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWtCQKPY68LjT5vXYx7","type":"assistant","uuid":"b36160bc-84de-4552-9869-8a66b35508c6","timestamp":"2026-02-23T06:19:56.269Z"}
{"type":"file-history-snapshot","messageId":"b36160bc-84de-4552-9869-8a66b35508c6","snapshot":{"messageId":"01b836e3-00bd-4b5d-b688-5fa0c4c74c67","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v1","version":1,"backupTime":"2026-02-23T06:20:03.202Z"}},"timestamp":"2026-02-23T06:19:24.171Z"},"isSnapshotUpdate":true}
{"parentUuid":"b36160bc-84de-4552-9869-8a66b35508c6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01VBP6UhEwdwMc8TRfgt8vSG","toolUseID":"toolu_01VBP6UhEwdwMc8TRfgt8vSG","timestamp":"2026-02-23T06:20:03.205Z","uuid":"26d51a43-b662-46fe-8a22-3036e7dad1e2"}
{"parentUuid":"b36160bc-84de-4552-9869-8a66b35508c6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VBP6UhEwdwMc8TRfgt8vSG","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/README.md has been updated successfully."}]},"uuid":"c90d104c-bce1-4225-adc2-0616fa8769b0","timestamp":"2026-02-23T06:20:03.204Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/README.md","oldString":"- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).","newString":"- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).","originalFile":"# GenHN\n\nAn experimental project that dynamically reconstructs the Hacker News interface using the \"essences\" of world-renowned product design systems.\n\n[日本語版 (Japanese README)](README-ja.md)\n\n## Features\n\n- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).\n\n## Usage\n\n1. Open `index.html` in your browser.\n2. Click a preset button in the bottom-right panel, or type a theme name in the input field and click **Apply**.\n3. Use the header navigation links to switch between HN feeds (Top / New / Ask / Show / Jobs).\n\n## Available Design Essences\n\n| Theme | Description |\n|-------|-------------|\n| **Minimalist** | Soft white base with glassmorphism header, clean typography, and subtle card shadows. |\n| **Intelligence** | Near-black background with emerald green accents, monospace logo, and a blinking cursor — AI chat interface inspired. |\n| **Search** | Pure white, functional layout, and blue hyperlink-style titles evoking classic search engine aesthetics. |\n| **Universal** | Bold card grid with rounded corners and strong blue accents — friendly and highly legible. |\n| **Glitch** | Black background with electric yellow text, cyan subtext, CRT scanline overlay, and polygon-clipped cards. |\n| **Playful** | Light gray background with a red header, thick black borders, and a card grid reminiscent of game console UI. |\n| **Glow** | Deep navy with a radial blue gradient, glowing neon logo, and translucent cards — next-gen console aesthetic. |\n| **Academic** | Warm cream background, serif typography, and a terracotta accent for a calm, thoughtful reading experience. |\n| **Ghibli** | Soft paper-like cream tones, deep forest green, and Japanese serif fonts — a hand-crafted, watercolor-inspired feel. |\n| **8-Bit** | Pure black, phosphor-green terminal text, cyan accents, monospace font, and pixelated rendering — retro PC / game aesthetic. |\n\n## Architecture\n\nThe entire application lives in two files:\n\n- **`index.html`** — Static DOM structure (header, story list, control panel).\n- **`gardener.js`** (~1,200 lines) — All application logic:\n  - `SYSTEM_STYLE` — Base CSS (layout, glassmorphism, responsive design).\n  - `STYLE_PRESETS` — Theme definitions via CSS custom properties.\n  - `HNData` — Hacker News API integration (feed fetching, pagination).\n  - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n\n## Adding a New Theme\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).\n\n## Disclaimer\n\nThis project is for design experimentation purposes only and has no direct affiliation with any existing brands. All trademarks and direct brand representations have been excluded.\n","structuredPatch":[{"oldStart":8,"oldLines":6,"newStart":8,"newLines":7,"lines":[" "," - **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics."," - **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.","+- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt."," - **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs."," - **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\")."," - **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser."]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b36160bc-84de-4552-9869-8a66b35508c6"}
{"parentUuid":"c90d104c-bce1-4225-adc2-0616fa8769b0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CUWasKiJNRxRT3kzo18uf1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FtGWaejmCqTGEQNwhVPHSX","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README.md","old_string":"## Adding a New Theme\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).","new_string":"## AI Theme Generation\n\nGenHN can generate new themes on-the-fly using the [Gemini API](https://aistudio.google.com/apikey).\n\n1. Obtain a free API key from [Google AI Studio](https://aistudio.google.com/apikey).\n2. Open the control panel (bottom-right) and expand the **Gemini API Key** section.\n3. Paste your key and click **Save** — it is stored only in your browser's localStorage and never sent anywhere other than the Gemini API.\n4. Type any design description in the theme input field (e.g. `\"brutalist newspaper\"`, `\"cozy dark cafe\"`) and click **Apply**.\n\nThe app calls `gemini-2.5-flash` to produce a complete CSS theme from your prompt, which is then applied immediately without a page reload.\n\n## Adding a New Theme Manually\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules)."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":872,"cache_read_input_tokens":26006,"output_tokens":400,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":872,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQWucKmQ2g14UjZasFZY","type":"assistant","uuid":"e0be2672-8644-4b54-a2f6-e87766834973","timestamp":"2026-02-23T06:20:10.832Z"}
{"parentUuid":"e0be2672-8644-4b54-a2f6-e87766834973","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01FtGWaejmCqTGEQNwhVPHSX","toolUseID":"toolu_01FtGWaejmCqTGEQNwhVPHSX","timestamp":"2026-02-23T06:20:10.837Z","uuid":"37781a25-68bc-4d5c-87a2-32d36d118be2"}
{"parentUuid":"e0be2672-8644-4b54-a2f6-e87766834973","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FtGWaejmCqTGEQNwhVPHSX","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/README.md has been updated successfully."}]},"uuid":"8ab6123a-e1c0-4371-a050-c7ed6a3f5219","timestamp":"2026-02-23T06:20:10.836Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/README.md","oldString":"## Adding a New Theme\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).","newString":"## AI Theme Generation\n\nGenHN can generate new themes on-the-fly using the [Gemini API](https://aistudio.google.com/apikey).\n\n1. Obtain a free API key from [Google AI Studio](https://aistudio.google.com/apikey).\n2. Open the control panel (bottom-right) and expand the **Gemini API Key** section.\n3. Paste your key and click **Save** — it is stored only in your browser's localStorage and never sent anywhere other than the Gemini API.\n4. Type any design description in the theme input field (e.g. `\"brutalist newspaper\"`, `\"cozy dark cafe\"`) and click **Apply**.\n\nThe app calls `gemini-2.5-flash` to produce a complete CSS theme from your prompt, which is then applied immediately without a page reload.\n\n## Adding a New Theme Manually\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).","originalFile":"# GenHN\n\nAn experimental project that dynamically reconstructs the Hacker News interface using the \"essences\" of world-renowned product design systems.\n\n[日本語版 (Japanese README)](README-ja.md)\n\n## Features\n\n- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).\n\n## Usage\n\n1. Open `index.html` in your browser.\n2. Click a preset button in the bottom-right panel, or type a theme name in the input field and click **Apply**.\n3. Use the header navigation links to switch between HN feeds (Top / New / Ask / Show / Jobs).\n\n## Available Design Essences\n\n| Theme | Description |\n|-------|-------------|\n| **Minimalist** | Soft white base with glassmorphism header, clean typography, and subtle card shadows. |\n| **Intelligence** | Near-black background with emerald green accents, monospace logo, and a blinking cursor — AI chat interface inspired. |\n| **Search** | Pure white, functional layout, and blue hyperlink-style titles evoking classic search engine aesthetics. |\n| **Universal** | Bold card grid with rounded corners and strong blue accents — friendly and highly legible. |\n| **Glitch** | Black background with electric yellow text, cyan subtext, CRT scanline overlay, and polygon-clipped cards. |\n| **Playful** | Light gray background with a red header, thick black borders, and a card grid reminiscent of game console UI. |\n| **Glow** | Deep navy with a radial blue gradient, glowing neon logo, and translucent cards — next-gen console aesthetic. |\n| **Academic** | Warm cream background, serif typography, and a terracotta accent for a calm, thoughtful reading experience. |\n| **Ghibli** | Soft paper-like cream tones, deep forest green, and Japanese serif fonts — a hand-crafted, watercolor-inspired feel. |\n| **8-Bit** | Pure black, phosphor-green terminal text, cyan accents, monospace font, and pixelated rendering — retro PC / game aesthetic. |\n\n## Architecture\n\nThe entire application lives in two files:\n\n- **`index.html`** — Static DOM structure (header, story list, control panel).\n- **`gardener.js`** (~1,200 lines) — All application logic:\n  - `SYSTEM_STYLE` — Base CSS (layout, glassmorphism, responsive design).\n  - `STYLE_PRESETS` — Theme definitions via CSS custom properties.\n  - `HNData` — Hacker News API integration (feed fetching, pagination).\n  - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n\n## Adding a New Theme\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).\n\n## Disclaimer\n\nThis project is for design experimentation purposes only and has no direct affiliation with any existing brands. All trademarks and direct brand representations have been excluded.\n","structuredPatch":[{"oldStart":46,"oldLines":8,"newStart":46,"newLines":19,"lines":["   - `HNData` — Hacker News API integration (feed fetching, pagination).","   - `App` — Main controller (theming, rendering, event handling, localStorage persistence)."," ","-## Adding a New Theme","+## AI Theme Generation"," ","+GenHN can generate new themes on-the-fly using the [Gemini API](https://aistudio.google.com/apikey).","+","+1. Obtain a free API key from [Google AI Studio](https://aistudio.google.com/apikey).","+2. Open the control panel (bottom-right) and expand the **Gemini API Key** section.","+3. Paste your key and click **Save** — it is stored only in your browser's localStorage and never sent anywhere other than the Gemini API.","+4. Type any design description in the theme input field (e.g. `\"brutalist newspaper\"`, `\"cozy dark cafe\"`) and click **Apply**.","+","+The app calls `gemini-2.5-flash` to produce a complete CSS theme from your prompt, which is then applied immediately without a page reload.","+","+## Adding a New Theme Manually","+"," Add an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules)."," "," ## Disclaimer"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"e0be2672-8644-4b54-a2f6-e87766834973"}
{"parentUuid":"8ab6123a-e1c0-4371-a050-c7ed6a3f5219","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_016fc6JHsScNd51DsRB9N4Mm","type":"message","role":"assistant","content":[{"type":"text","text":"次に日本語READMEを更新します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":457,"cache_read_input_tokens":26878,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":457},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWvArMPGJpteorp86Gw","type":"assistant","uuid":"c07b505c-c143-4528-b123-10c12797774f","timestamp":"2026-02-23T06:20:12.227Z"}
{"type":"file-history-snapshot","messageId":"f475b7a2-23aa-4145-a31a-c1683dc5d96d","snapshot":{"messageId":"01b836e3-00bd-4b5d-b688-5fa0c4c74c67","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v1","version":1,"backupTime":"2026-02-23T06:20:03.202Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v1","version":1,"backupTime":"2026-02-23T06:20:20.977Z"}},"timestamp":"2026-02-23T06:19:24.171Z"},"isSnapshotUpdate":true}
{"parentUuid":"c07b505c-c143-4528-b123-10c12797774f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_016fc6JHsScNd51DsRB9N4Mm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JPtYKjb7xEpzjwa4KxXDoy","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README-ja.md","old_string":"- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。","new_string":"- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n- **AIテーマ生成**: Gemini APIキーを登録すると、自由記述のプロンプトからまったく新しいデザインテーマをその場で生成可能。\n- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":457,"cache_read_input_tokens":26878,"output_tokens":776,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":457,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQWvArMPGJpteorp86Gw","type":"assistant","uuid":"f475b7a2-23aa-4145-a31a-c1683dc5d96d","timestamp":"2026-02-23T06:20:20.974Z"}
{"parentUuid":"f475b7a2-23aa-4145-a31a-c1683dc5d96d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01JPtYKjb7xEpzjwa4KxXDoy","toolUseID":"toolu_01JPtYKjb7xEpzjwa4KxXDoy","timestamp":"2026-02-23T06:20:20.979Z","uuid":"6b1d99f2-e781-421b-abd4-f5f240fdbb28"}
{"parentUuid":"f475b7a2-23aa-4145-a31a-c1683dc5d96d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JPtYKjb7xEpzjwa4KxXDoy","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/README-ja.md has been updated successfully."}]},"uuid":"490bd9a9-a455-4ffa-863d-eed40722421e","timestamp":"2026-02-23T06:20:20.979Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/README-ja.md","oldString":"- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。","newString":"- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n- **AIテーマ生成**: Gemini APIキーを登録すると、自由記述のプロンプトからまったく新しいデザインテーマをその場で生成可能。\n- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。","originalFile":"# GenHN\n\nHacker Newsのインターフェースを、世界的に有名なプロダクトやデザインシステムの「本質（エッセンス）」を用いて動的に再構築する実験的プロジェクトです。\n\n[English version (English README)](README.md)\n\n## 特徴\n\n- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。\n\n## 使い方\n\n1. `index.html` をブラウザで開きます。\n2. 右下のパネルにあるプリセットボタンをクリックするか、入力欄にテーマ名を入力して **Apply** をクリックします。\n3. ヘッダーのナビゲーションリンクでHNフィードを切り替えます（Top / New / Ask / Show / Jobs）。\n\n## 利用可能なデザインエッセンス\n\n| テーマ | 説明 |\n|--------|------|\n| **Minimalist** | グラスモーフィズムヘッダー、クリーンなタイポグラフィ、繊細なカードシャドウを備えたソフトな白ベース。 |\n| **Intelligence** | ほぼ黒の背景にエメラルドグリーンのアクセント、モノスペースロゴ、点滅カーソル——AIチャットインターフェース風。 |\n| **Search** | 純白のクリーンなレイアウトと青いリンクスタイルのタイトル。クラシックな検索エンジン美学。 |\n| **Universal** | 角丸の大胆なカードグリッドと強いブルーアクセント。親しみやすく、高い視認性。 |\n| **Glitch** | 黒背景にネオンイエローのテキスト、シアンのサブテキスト、CRTスキャンラインオーバーレイ、多角形クリップのカード。 |\n| **Playful** | ライトグレーの背景に赤ヘッダー、太い黒ボーダー、ゲーム機UIを思わせるカードグリッド。 |\n| **Glow** | ディープネイビーに放射状ブルーグラデーション、光るネオンロゴ、半透明カード——次世代コンソール風。 |\n| **Academic** | 暖かみのあるクリーム背景、セリフ体タイポグラフィ、テラコッタアクセント。落ち着いた読書体験。 |\n| **Ghibli** | 柔らかな和紙風クリームトーン、深い森の緑、日本語明朝体フォント——手描き・水彩画のような温かみ。 |\n| **8-Bit** | 漆黒の背景に燐光グリーンのターミナルテキスト、シアンのアクセント、等幅フォント、ピクセル描画——レトロPC・ゲーム機風。 |\n\n## アーキテクチャ\n\nアプリケーション全体は2つのファイルで構成されています。\n\n- **`index.html`** — 静的なDOM構造（ヘッダー、記事リスト、コントロールパネル）。\n- **`gardener.js`**（約1,200行）— すべてのアプリケーションロジック：\n  - `SYSTEM_STYLE` — ベースCSS（レイアウト、グラスモーフィズム、レスポンシブデザイン）。\n  - `STYLE_PRESETS` — CSSカスタムプロパティによるテーマ定義。\n  - `HNData` — Hacker News API連携（フィード取得、ページネーション）。\n  - `App` — メインコントローラー（テーマ適用、レンダリング、イベント処理、localStorage永続化）。\n\n## 新しいテーマを追加するには\n\n`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。\n\n## 注意事項\n\nこのプロジェクトはデザインの実験を目的としており、既存のいかなるブランドとも直接の関係はありません。商標およびブランドの直接的な表現は排除されています。\n","structuredPatch":[{"oldStart":8,"oldLines":6,"newStart":8,"newLines":7,"lines":[" "," - **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。"," - **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。","+- **AIテーマ生成**: Gemini APIキーを登録すると、自由記述のプロンプトからまったく新しいデザインテーマをその場で生成可能。"," - **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。"," - **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。"," - **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f475b7a2-23aa-4145-a31a-c1683dc5d96d"}
{"parentUuid":"490bd9a9-a455-4ffa-863d-eed40722421e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01VoK7LzDHQwWEjsN8rTecWp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SYkuL6mrhVERJ25iJQaQ8s","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README-ja.md","old_string":"## 新しいテーマを追加するには\n\n`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。","new_string":"## AIによるテーマ生成\n\n[Gemini API](https://aistudio.google.com/apikey) を使って、プロンプトからリアルタイムに新しいテーマを生成できます。\n\n1. [Google AI Studio](https://aistudio.google.com/apikey) で無料のAPIキーを取得します。\n2. コントロールパネル（右下）を開き、**Gemini API Key** セクションを展開します。\n3. APIキーを貼り付けて **Save** をクリック。キーはブラウザの localStorage にのみ保存され、Gemini API以外には送信されません。\n4. テーマ入力欄に任意のデザインコンセプトを入力（例：`\"brutalist newspaper\"`、`\"cozy dark cafe\"`）し、**Apply** をクリックします。\n\nアプリが `gemini-2.5-flash` を呼び出し、プロンプトからCSSテーマを生成してページリロードなしで即座に適用します。\n\n## 手動で新しいテーマを追加するには\n\n`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":816,"cache_read_input_tokens":27335,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":816},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWvvBpqh6jQHqKrezLk","type":"assistant","uuid":"d31aada6-7bd4-489f-878e-84dba07a3be6","timestamp":"2026-02-23T06:20:29.468Z"}
{"parentUuid":"d31aada6-7bd4-489f-878e-84dba07a3be6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01SYkuL6mrhVERJ25iJQaQ8s","toolUseID":"toolu_01SYkuL6mrhVERJ25iJQaQ8s","timestamp":"2026-02-23T06:20:29.471Z","uuid":"de65e5bc-9860-4f9a-ad4b-3ed782dd76fa"}
{"parentUuid":"d31aada6-7bd4-489f-878e-84dba07a3be6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SYkuL6mrhVERJ25iJQaQ8s","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/README-ja.md has been updated successfully."}]},"uuid":"01b9874b-c6a3-43e1-bd1e-3f213a67b9a7","timestamp":"2026-02-23T06:20:29.470Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/README-ja.md","oldString":"## 新しいテーマを追加するには\n\n`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。","newString":"## AIによるテーマ生成\n\n[Gemini API](https://aistudio.google.com/apikey) を使って、プロンプトからリアルタイムに新しいテーマを生成できます。\n\n1. [Google AI Studio](https://aistudio.google.com/apikey) で無料のAPIキーを取得します。\n2. コントロールパネル（右下）を開き、**Gemini API Key** セクションを展開します。\n3. APIキーを貼り付けて **Save** をクリック。キーはブラウザの localStorage にのみ保存され、Gemini API以外には送信されません。\n4. テーマ入力欄に任意のデザインコンセプトを入力（例：`\"brutalist newspaper\"`、`\"cozy dark cafe\"`）し、**Apply** をクリックします。\n\nアプリが `gemini-2.5-flash` を呼び出し、プロンプトからCSSテーマを生成してページリロードなしで即座に適用します。\n\n## 手動で新しいテーマを追加するには\n\n`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。","originalFile":"# GenHN\n\nHacker Newsのインターフェースを、世界的に有名なプロダクトやデザインシステムの「本質（エッセンス）」を用いて動的に再構築する実験的プロジェクトです。\n\n[English version (English README)](README.md)\n\n## 特徴\n\n- **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n- **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n- **AIテーマ生成**: Gemini APIキーを登録すると、自由記述のプロンプトからまったく新しいデザインテーマをその場で生成可能。\n- **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n- **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n- **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n- **ビュートランジション**: View Transition APIによるスムーズなページ遷移（非対応ブラウザでも graceful fallback）。\n\n## 使い方\n\n1. `index.html` をブラウザで開きます。\n2. 右下のパネルにあるプリセットボタンをクリックするか、入力欄にテーマ名を入力して **Apply** をクリックします。\n3. ヘッダーのナビゲーションリンクでHNフィードを切り替えます（Top / New / Ask / Show / Jobs）。\n\n## 利用可能なデザインエッセンス\n\n| テーマ | 説明 |\n|--------|------|\n| **Minimalist** | グラスモーフィズムヘッダー、クリーンなタイポグラフィ、繊細なカードシャドウを備えたソフトな白ベース。 |\n| **Intelligence** | ほぼ黒の背景にエメラルドグリーンのアクセント、モノスペースロゴ、点滅カーソル——AIチャットインターフェース風。 |\n| **Search** | 純白のクリーンなレイアウトと青いリンクスタイルのタイトル。クラシックな検索エンジン美学。 |\n| **Universal** | 角丸の大胆なカードグリッドと強いブルーアクセント。親しみやすく、高い視認性。 |\n| **Glitch** | 黒背景にネオンイエローのテキスト、シアンのサブテキスト、CRTスキャンラインオーバーレイ、多角形クリップのカード。 |\n| **Playful** | ライトグレーの背景に赤ヘッダー、太い黒ボーダー、ゲーム機UIを思わせるカードグリッド。 |\n| **Glow** | ディープネイビーに放射状ブルーグラデーション、光るネオンロゴ、半透明カード——次世代コンソール風。 |\n| **Academic** | 暖かみのあるクリーム背景、セリフ体タイポグラフィ、テラコッタアクセント。落ち着いた読書体験。 |\n| **Ghibli** | 柔らかな和紙風クリームトーン、深い森の緑、日本語明朝体フォント——手描き・水彩画のような温かみ。 |\n| **8-Bit** | 漆黒の背景に燐光グリーンのターミナルテキスト、シアンのアクセント、等幅フォント、ピクセル描画——レトロPC・ゲーム機風。 |\n\n## アーキテクチャ\n\nアプリケーション全体は2つのファイルで構成されています。\n\n- **`index.html`** — 静的なDOM構造（ヘッダー、記事リスト、コントロールパネル）。\n- **`gardener.js`**（約1,200行）— すべてのアプリケーションロジック：\n  - `SYSTEM_STYLE` — ベースCSS（レイアウト、グラスモーフィズム、レスポンシブデザイン）。\n  - `STYLE_PRESETS` — CSSカスタムプロパティによるテーマ定義。\n  - `HNData` — Hacker News API連携（フィード取得、ページネーション）。\n  - `App` — メインコントローラー（テーマ適用、レンダリング、イベント処理、localStorage永続化）。\n\n## 新しいテーマを追加するには\n\n`gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。\n\n## 注意事項\n\nこのプロジェクトはデザインの実験を目的としており、既存のいかなるブランドとも直接の関係はありません。商標およびブランドの直接的な表現は排除されています。\n","structuredPatch":[{"oldStart":46,"oldLines":8,"newStart":46,"newLines":19,"lines":["   - `HNData` — Hacker News API連携（フィード取得、ページネーション）。","   - `App` — メインコントローラー（テーマ適用、レンダリング、イベント処理、localStorage永続化）。"," ","-## 新しいテーマを追加するには","+## AIによるテーマ生成"," ","+[Gemini API](https://aistudio.google.com/apikey) を使って、プロンプトからリアルタイムに新しいテーマを生成できます。","+","+1. [Google AI Studio](https://aistudio.google.com/apikey) で無料のAPIキーを取得します。","+2. コントロールパネル（右下）を開き、**Gemini API Key** セクションを展開します。","+3. APIキーを貼り付けて **Save** をクリック。キーはブラウザの localStorage にのみ保存され、Gemini API以外には送信されません。","+4. テーマ入力欄に任意のデザインコンセプトを入力（例：`\"brutalist newspaper\"`、`\"cozy dark cafe\"`）し、**Apply** をクリックします。","+","+アプリが `gemini-2.5-flash` を呼び出し、プロンプトからCSSテーマを生成してページリロードなしで即座に適用します。","+","+## 手動で新しいテーマを追加するには","+"," `gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。"," "," ## 注意事項"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"d31aada6-7bd4-489f-878e-84dba07a3be6"}
{"parentUuid":"01b9874b-c6a3-43e1-bd1e-3f213a67b9a7","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01MZG3RzxywB8CDi42t5s4CC","type":"message","role":"assistant","content":[{"type":"text","text":"更新内容を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":660,"cache_read_input_tokens":28151,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":660},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWwYYrfU8fpQ4HQKuX8","type":"assistant","uuid":"2af9dd28-41ad-4da4-a588-33f444a6a1a7","timestamp":"2026-02-23T06:20:30.910Z"}
{"parentUuid":"2af9dd28-41ad-4da4-a588-33f444a6a1a7","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01MZG3RzxywB8CDi42t5s4CC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01N4BJnvJp8XisbsK7CAkmy5","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/README.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":660,"cache_read_input_tokens":28151,"output_tokens":82,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":660,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQWwYYrfU8fpQ4HQKuX8","type":"assistant","uuid":"bc72e13a-15da-4b07-bdd5-5b9b1c2e165d","timestamp":"2026-02-23T06:20:31.309Z"}
{"parentUuid":"bc72e13a-15da-4b07-bdd5-5b9b1c2e165d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01N4BJnvJp8XisbsK7CAkmy5","toolUseID":"toolu_01N4BJnvJp8XisbsK7CAkmy5","timestamp":"2026-02-23T06:20:31.329Z","uuid":"d06b01f5-f952-49c1-abca-93130e4c6b1a"}
{"parentUuid":"bc72e13a-15da-4b07-bdd5-5b9b1c2e165d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01N4BJnvJp8XisbsK7CAkmy5","type":"tool_result","content":"     1→# GenHN\n     2→\n     3→An experimental project that dynamically reconstructs the Hacker News interface using the \"essences\" of world-renowned product design systems.\n     4→\n     5→[日本語版 (Japanese README)](README-ja.md)\n     6→\n     7→## Features\n     8→\n     9→- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n    10→- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n    11→- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt.\n    12→- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n    13→- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n    14→- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n    15→- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).\n    16→\n    17→## Usage\n    18→\n    19→1. Open `index.html` in your browser.\n    20→2. Click a preset button in the bottom-right panel, or type a theme name in the input field and click **Apply**.\n    21→3. Use the header navigation links to switch between HN feeds (Top / New / Ask / Show / Jobs).\n    22→\n    23→## Available Design Essences\n    24→\n    25→| Theme | Description |\n    26→|-------|-------------|\n    27→| **Minimalist** | Soft white base with glassmorphism header, clean typography, and subtle card shadows. |\n    28→| **Intelligence** | Near-black background with emerald green accents, monospace logo, and a blinking cursor — AI chat interface inspired. |\n    29→| **Search** | Pure white, functional layout, and blue hyperlink-style titles evoking classic search engine aesthetics. |\n    30→| **Universal** | Bold card grid with rounded corners and strong blue accents — friendly and highly legible. |\n    31→| **Glitch** | Black background with electric yellow text, cyan subtext, CRT scanline overlay, and polygon-clipped cards. |\n    32→| **Playful** | Light gray background with a red header, thick black borders, and a card grid reminiscent of game console UI. |\n    33→| **Glow** | Deep navy with a radial blue gradient, glowing neon logo, and translucent cards — next-gen console aesthetic. |\n    34→| **Academic** | Warm cream background, serif typography, and a terracotta accent for a calm, thoughtful reading experience. |\n    35→| **Ghibli** | Soft paper-like cream tones, deep forest green, and Japanese serif fonts — a hand-crafted, watercolor-inspired feel. |\n    36→| **8-Bit** | Pure black, phosphor-green terminal text, cyan accents, monospace font, and pixelated rendering — retro PC / game aesthetic. |\n    37→\n    38→## Architecture\n    39→\n    40→The entire application lives in two files:\n    41→\n    42→- **`index.html`** — Static DOM structure (header, story list, control panel).\n    43→- **`gardener.js`** (~1,200 lines) — All application logic:\n    44→  - `SYSTEM_STYLE` — Base CSS (layout, glassmorphism, responsive design).\n    45→  - `STYLE_PRESETS` — Theme definitions via CSS custom properties.\n    46→  - `HNData` — Hacker News API integration (feed fetching, pagination).\n    47→  - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n    48→\n    49→## AI Theme Generation\n    50→\n    51→GenHN can generate new themes on-the-fly using the [Gemini API](https://aistudio.google.com/apikey).\n    52→\n    53→1. Obtain a free API key from [Google AI Studio](https://aistudio.google.com/apikey).\n    54→2. Open the control panel (bottom-right) and expand the **Gemini API Key** section.\n    55→3. Paste your key and click **Save** — it is stored only in your browser's localStorage and never sent anywhere other than the Gemini API.\n    56→4. Type any design description in the theme input field (e.g. `\"brutalist newspaper\"`, `\"cozy dark cafe\"`) and click **Apply**.\n    57→\n    58→The app calls `gemini-2.5-flash` to produce a complete CSS theme from your prompt, which is then applied immediately without a page reload.\n    59→\n    60→## Adding a New Theme Manually\n    61→\n    62→Add an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).\n    63→\n    64→## Disclaimer\n    65→\n    66→This project is for design experimentation purposes only and has no direct affiliation with any existing brands. All trademarks and direct brand representations have been excluded.\n    67→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"68eb4f18-d48e-4724-8e76-ee028895dad0","timestamp":"2026-02-23T06:20:31.328Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/README.md","content":"# GenHN\n\nAn experimental project that dynamically reconstructs the Hacker News interface using the \"essences\" of world-renowned product design systems.\n\n[日本語版 (Japanese README)](README-ja.md)\n\n## Features\n\n- **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n- **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt.\n- **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n- **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n- **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n- **View Transitions**: Smooth page transitions using the View Transition API (with graceful fallback).\n\n## Usage\n\n1. Open `index.html` in your browser.\n2. Click a preset button in the bottom-right panel, or type a theme name in the input field and click **Apply**.\n3. Use the header navigation links to switch between HN feeds (Top / New / Ask / Show / Jobs).\n\n## Available Design Essences\n\n| Theme | Description |\n|-------|-------------|\n| **Minimalist** | Soft white base with glassmorphism header, clean typography, and subtle card shadows. |\n| **Intelligence** | Near-black background with emerald green accents, monospace logo, and a blinking cursor — AI chat interface inspired. |\n| **Search** | Pure white, functional layout, and blue hyperlink-style titles evoking classic search engine aesthetics. |\n| **Universal** | Bold card grid with rounded corners and strong blue accents — friendly and highly legible. |\n| **Glitch** | Black background with electric yellow text, cyan subtext, CRT scanline overlay, and polygon-clipped cards. |\n| **Playful** | Light gray background with a red header, thick black borders, and a card grid reminiscent of game console UI. |\n| **Glow** | Deep navy with a radial blue gradient, glowing neon logo, and translucent cards — next-gen console aesthetic. |\n| **Academic** | Warm cream background, serif typography, and a terracotta accent for a calm, thoughtful reading experience. |\n| **Ghibli** | Soft paper-like cream tones, deep forest green, and Japanese serif fonts — a hand-crafted, watercolor-inspired feel. |\n| **8-Bit** | Pure black, phosphor-green terminal text, cyan accents, monospace font, and pixelated rendering — retro PC / game aesthetic. |\n\n## Architecture\n\nThe entire application lives in two files:\n\n- **`index.html`** — Static DOM structure (header, story list, control panel).\n- **`gardener.js`** (~1,200 lines) — All application logic:\n  - `SYSTEM_STYLE` — Base CSS (layout, glassmorphism, responsive design).\n  - `STYLE_PRESETS` — Theme definitions via CSS custom properties.\n  - `HNData` — Hacker News API integration (feed fetching, pagination).\n  - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n\n## AI Theme Generation\n\nGenHN can generate new themes on-the-fly using the [Gemini API](https://aistudio.google.com/apikey).\n\n1. Obtain a free API key from [Google AI Studio](https://aistudio.google.com/apikey).\n2. Open the control panel (bottom-right) and expand the **Gemini API Key** section.\n3. Paste your key and click **Save** — it is stored only in your browser's localStorage and never sent anywhere other than the Gemini API.\n4. Type any design description in the theme input field (e.g. `\"brutalist newspaper\"`, `\"cozy dark cafe\"`) and click **Apply**.\n\nThe app calls `gemini-2.5-flash` to produce a complete CSS theme from your prompt, which is then applied immediately without a page reload.\n\n## Adding a New Theme Manually\n\nAdd an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).\n\n## Disclaimer\n\nThis project is for design experimentation purposes only and has no direct affiliation with any existing brands. All trademarks and direct brand representations have been excluded.\n","numLines":67,"startLine":1,"totalLines":67}},"sourceToolAssistantUUID":"bc72e13a-15da-4b07-bdd5-5b9b1c2e165d"}
{"parentUuid":"68eb4f18-d48e-4724-8e76-ee028895dad0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017TExjRjmhMvh6o8TUSShwP","type":"message","role":"assistant","content":[{"type":"text","text":"両ファイルを更新しました。変更点は以下のとおりです。\n\n**README.md（英語）**\n- Features に **AI Theme Generation** を追記\n- **AI Theme Generation** セクションを新設（Architecture と手動テーマ追加の間）\n  - Google AI Studio でのキー取得手順\n  - コントロールパネルへのキー登録方法（localStorage保存、Gemini API以外には送信されない旨）\n  - プロンプト入力 → Apply でテーマ生成する手順\n  - 使用モデル（`gemini-2.5-flash`）の明記\n- \"Adding a New Theme\" を \"Adding a New Theme **Manually**\" に改題\n\n**README-ja.md（日本語）**\n- 特徴に **AIテーマ生成** を追記\n- **AIによるテーマ生成** セクションを新設（同内容の日本語版）\n- 「新しいテーマを追加するには」→「**手動で**新しいテーマを追加するには」に改題"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1478,"cache_read_input_tokens":28811,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1478},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWwgS7o1bEvZ1JmRGxi","type":"assistant","uuid":"3525bbaa-aaa2-41d7-ad68-8cba7774e728","timestamp":"2026-02-23T06:20:38.202Z"}
{"parentUuid":"3525bbaa-aaa2-41d7-ad68-8cba7774e728","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"b974265a-7437-47b1-9b0f-aabf5d2f4776","toolUseID":"b974265a-7437-47b1-9b0f-aabf5d2f4776","timestamp":"2026-02-23T06:20:38.244Z","uuid":"78694d1c-3795-4708-a0ab-5b24e0570bdb"}
{"parentUuid":"78694d1c-3795-4708-a0ab-5b24e0570bdb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":140}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:20:38.385Z","uuid":"c903d7e3-e778-46aa-8af2-1a4f89a280ae","toolUseID":"b974265a-7437-47b1-9b0f-aabf5d2f4776"}
{"parentUuid":"c903d7e3-e778-46aa-8af2-1a4f89a280ae","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":67284,"timestamp":"2026-02-23T06:20:38.387Z","uuid":"894732c0-7975-4b6a-9d30-fddd3dc06f1f","isMeta":false}
{"type":"file-history-snapshot","messageId":"f1ed59a7-d37f-43ab-b6ea-a2b325ca0b30","snapshot":{"messageId":"f1ed59a7-d37f-43ab-b6ea-a2b325ca0b30","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"}},"timestamp":"2026-02-23T06:21:02.066Z"},"isSnapshotUpdate":false}
{"parentUuid":"894732c0-7975-4b6a-9d30-fddd3dc06f1f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コミットして"},"uuid":"f1ed59a7-d37f-43ab-b6ea-a2b325ca0b30","timestamp":"2026-02-23T06:21:01.955Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"f1ed59a7-d37f-43ab-b6ea-a2b325ca0b30","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01AuAWRBFdfC2DUEUrfVfXwT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ANFQLxyCp5EPcqZLMtf3is","name":"Bash","input":{"command":"git status && git diff","description":"Show git status and diff"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":7,"cache_read_input_tokens":30581,"output_tokens":95,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":7,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQWywxpVSo6df6xx52Bd","type":"assistant","uuid":"01288581-b0ff-4c9d-8cd5-99e340b4dfee","timestamp":"2026-02-23T06:21:04.078Z"}
{"parentUuid":"01288581-b0ff-4c9d-8cd5-99e340b4dfee","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ANFQLxyCp5EPcqZLMtf3is","type":"tool_result","content":"On branch main\nYour branch is up to date with 'origin/main'.\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   README-ja.md\n\tmodified:   README.md\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\ndiff --git a/README-ja.md b/README-ja.md\nindex 5ecfa2d..36d6880 100644\n--- a/README-ja.md\n+++ b/README-ja.md\n@@ -8,6 +8,7 @@ Hacker Newsのインターフェースを、世界的に有名なプロダクト\n \n - **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n - **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n+- **AIテーマ生成**: Gemini APIキーを登録すると、自由記述のプロンプトからまったく新しいデザインテーマをその場で生成可能。\n - **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n - **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n - **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n@@ -45,7 +46,18 @@ Hacker Newsのインターフェースを、世界的に有名なプロダクト\n   - `HNData` — Hacker News API連携（フィード取得、ページネーション）。\n   - `App` — メインコントローラー（テーマ適用、レンダリング、イベント処理、localStorage永続化）。\n \n-## 新しいテーマを追加するには\n+## AIによるテーマ生成\n+\n+[Gemini API](https://aistudio.google.com/apikey) を使って、プロンプトからリアルタイムに新しいテーマを生成できます。\n+\n+1. [Google AI Studio](https://aistudio.google.com/apikey) で無料のAPIキーを取得します。\n+2. コントロールパネル（右下）を開き、**Gemini API Key** セクションを展開します。\n+3. APIキーを貼り付けて **Save** をクリック。キーはブラウザの localStorage にのみ保存され、Gemini API以外には送信されません。\n+4. テーマ入力欄に任意のデザインコンセプトを入力（例：`\"brutalist newspaper\"`、`\"cozy dark cafe\"`）し、**Apply** をクリックします。\n+\n+アプリが `gemini-2.5-flash` を呼び出し、プロンプトからCSSテーマを生成してページリロードなしで即座に適用します。\n+\n+## 手動で新しいテーマを追加するには\n \n `gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。\n \ndiff --git a/README.md b/README.md\nindex 558a4af..b143cc0 100644\n--- a/README.md\n+++ b/README.md\n@@ -8,6 +8,7 @@ An experimental project that dynamically reconstructs the Hacker News interface\n \n - **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n - **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n+- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt.\n - **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n - **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n - **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n@@ -45,7 +46,18 @@ The entire application lives in two files:\n   - `HNData` — Hacker News API integration (feed fetching, pagination).\n   - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n \n-## Adding a New Theme\n+## AI Theme Generation\n+\n+GenHN can generate new themes on-the-fly using the [Gemini API](https://aistudio.google.com/apikey).\n+\n+1. Obtain a free API key from [Google AI Studio](https://aistudio.google.com/apikey).\n+2. Open the control panel (bottom-right) and expand the **Gemini API Key** section.\n+3. Paste your key and click **Save** — it is stored only in your browser's localStorage and never sent anywhere other than the Gemini API.\n+4. Type any design description in the theme input field (e.g. `\"brutalist newspaper\"`, `\"cozy dark cafe\"`) and click **Apply**.\n+\n+The app calls `gemini-2.5-flash` to produce a complete CSS theme from your prompt, which is then applied immediately without a page reload.\n+\n+## Adding a New Theme Manually\n \n Add an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).","is_error":false}]},"uuid":"f32608e2-815f-457d-ab8f-b34e930bf162","timestamp":"2026-02-23T06:21:04.489Z","toolUseResult":{"stdout":"On branch main\nYour branch is up to date with 'origin/main'.\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   README-ja.md\n\tmodified:   README.md\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\ndiff --git a/README-ja.md b/README-ja.md\nindex 5ecfa2d..36d6880 100644\n--- a/README-ja.md\n+++ b/README-ja.md\n@@ -8,6 +8,7 @@ Hacker Newsのインターフェースを、世界的に有名なプロダクト\n \n - **10種類のデザインプリセット**: アイコニックなブランド美学にインスパイアされたデザインシステムをワンクリックで切り替え。\n - **プリセットパネル**: 各テーマへのワンクリックボタンに加え、テーマ名を自由入力して適用できる入力欄も搭載。\n+- **AIテーマ生成**: Gemini APIキーを登録すると、自由記述のプロンプトからまったく新しいデザインテーマをその場で生成可能。\n - **フィードナビゲーション**: Top / New / Ask / Show / Jobs など、Hacker Newsの各フィードを切り替え可能。\n - **HNリアルタイムデータ**: Hacker News Firebase APIから実際の記事を取得（1ページ30件、\"More\"ボタンで追加読み込み）。\n - **ビルド不要**: 純粋なバニラJS + CSS。`index.html`をブラウザで直接開くだけで動作。\n@@ -45,7 +46,18 @@ Hacker Newsのインターフェースを、世界的に有名なプロダクト\n   - `HNData` — Hacker News API連携（フィード取得、ページネーション）。\n   - `App` — メインコントローラー（テーマ適用、レンダリング、イベント処理、localStorage永続化）。\n \n-## 新しいテーマを追加するには\n+## AIによるテーマ生成\n+\n+[Gemini API](https://aistudio.google.com/apikey) を使って、プロンプトからリアルタイムに新しいテーマを生成できます。\n+\n+1. [Google AI Studio](https://aistudio.google.com/apikey) で無料のAPIキーを取得します。\n+2. コントロールパネル（右下）を開き、**Gemini API Key** セクションを展開します。\n+3. APIキーを貼り付けて **Save** をクリック。キーはブラウザの localStorage にのみ保存され、Gemini API以外には送信されません。\n+4. テーマ入力欄に任意のデザインコンセプトを入力（例：`\"brutalist newspaper\"`、`\"cozy dark cafe\"`）し、**Apply** をクリックします。\n+\n+アプリが `gemini-2.5-flash` を呼び出し、プロンプトからCSSテーマを生成してページリロードなしで即座に適用します。\n+\n+## 手動で新しいテーマを追加するには\n \n `gardener.js` 内の `STYLE_PRESETS` に、既存のパターンに倣って新しいエントリを追加します。各テーマはCSSカスタムプロパティをオーバーライドし、必要に応じてコンポーネント固有のスタイルを追加できます。\n \ndiff --git a/README.md b/README.md\nindex 558a4af..b143cc0 100644\n--- a/README.md\n+++ b/README.md\n@@ -8,6 +8,7 @@ An experimental project that dynamically reconstructs the Hacker News interface\n \n - **10 Design Presets**: Instantly switch between design systems inspired by iconic brand aesthetics.\n - **Preset Panel**: One-click buttons for each built-in theme, plus a free-text input for applying any theme by name.\n+- **AI Theme Generation**: Enter a Gemini API key to generate entirely new design themes from any free-text prompt.\n - **Feed Navigation**: Switch between Hacker News feeds — Top, New, Ask, Show, and Jobs.\n - **Live HN Data**: Fetches real stories from the Hacker News Firebase API (30 stories per page, with infinite scroll via \"More\").\n - **No Build Step**: Pure vanilla JS + CSS. Open `index.html` directly in a browser.\n@@ -45,7 +46,18 @@ The entire application lives in two files:\n   - `HNData` — Hacker News API integration (feed fetching, pagination).\n   - `App` — Main controller (theming, rendering, event handling, localStorage persistence).\n \n-## Adding a New Theme\n+## AI Theme Generation\n+\n+GenHN can generate new themes on-the-fly using the [Gemini API](https://aistudio.google.com/apikey).\n+\n+1. Obtain a free API key from [Google AI Studio](https://aistudio.google.com/apikey).\n+2. Open the control panel (bottom-right) and expand the **Gemini API Key** section.\n+3. Paste your key and click **Save** — it is stored only in your browser's localStorage and never sent anywhere other than the Gemini API.\n+4. Type any design description in the theme input field (e.g. `\"brutalist newspaper\"`, `\"cozy dark cafe\"`) and click **Apply**.\n+\n+The app calls `gemini-2.5-flash` to produce a complete CSS theme from your prompt, which is then applied immediately without a page reload.\n+\n+## Adding a New Theme Manually\n \n Add an entry to `STYLE_PRESETS` in `gardener.js` following the existing pattern. Each theme overrides CSS custom properties (and optionally adds component-specific rules).","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"01288581-b0ff-4c9d-8cd5-99e340b4dfee"}
{"parentUuid":"f32608e2-815f-457d-ab8f-b34e930bf162","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_012oetJxSmMKRVspvJ4JdyEZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SfGkMon9RjXnGu65FYqQG5","name":"Bash","input":{"command":"git add README.md README-ja.md && git commit -m \"$(cat <<'EOF'\ndocs: document Gemini API key feature for AI theme generation\n\nAdd AI Theme Generation section to README (EN/JA) explaining how to\nobtain a key from Google AI Studio, register it in the control panel,\nand generate new themes from free-text prompts via gemini-2.5-flash.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Stage and commit README updates"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1716,"cache_read_input_tokens":30588,"output_tokens":193,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":1716,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQWz8CyJZBHCG6CDgAW2","type":"assistant","uuid":"80c7366b-ac5c-4dac-8144-5774947b382c","timestamp":"2026-02-23T06:21:08.686Z"}
{"parentUuid":"80c7366b-ac5c-4dac-8144-5774947b382c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SfGkMon9RjXnGu65FYqQG5","type":"tool_result","content":"[main 7325a9a] docs: document Gemini API key feature for AI theme generation\n 2 files changed, 26 insertions(+), 2 deletions(-)","is_error":false}]},"uuid":"406f155e-c9a0-4c9b-bc27-b00c330b4d17","timestamp":"2026-02-23T06:21:09.003Z","toolUseResult":{"stdout":"[main 7325a9a] docs: document Gemini API key feature for AI theme generation\n 2 files changed, 26 insertions(+), 2 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"80c7366b-ac5c-4dac-8144-5774947b382c"}
{"parentUuid":"406f155e-c9a0-4c9b-bc27-b00c330b4d17","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_011mJQvnFVGCLRE9XaqZWY5J","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました。\n\n```\n7325a9a docs: document Gemini API key feature for AI theme generation\n```\n\n`README.md` と `README-ja.md` の変更2ファイル、26行追加・2行変更です。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":247,"cache_read_input_tokens":32304,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":247},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQWzTZJiYLd18EBgpZJ4","type":"assistant","uuid":"620fd038-3ac1-402a-adf8-5e7159ce76c3","timestamp":"2026-02-23T06:21:11.164Z"}
{"parentUuid":"620fd038-3ac1-402a-adf8-5e7159ce76c3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"64646c5d-6d82-480c-b622-f2fc32cfdd27","toolUseID":"64646c5d-6d82-480c-b622-f2fc32cfdd27","timestamp":"2026-02-23T06:21:11.191Z","uuid":"27a8fd4d-d406-4636-92eb-74a014ed85e6"}
{"parentUuid":"27a8fd4d-d406-4636-92eb-74a014ed85e6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":257}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:21:11.449Z","uuid":"8c9a690b-4c36-475d-8efc-20ac2d9b7e5e","toolUseID":"64646c5d-6d82-480c-b622-f2fc32cfdd27"}
{"type":"file-history-snapshot","messageId":"b485e046-092a-4581-83d0-69c29866170b","snapshot":{"messageId":"b485e046-092a-4581-83d0-69c29866170b","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"}},"timestamp":"2026-02-23T06:22:28.593Z"},"isSnapshotUpdate":false}
{"parentUuid":"8c9a690b-4c36-475d-8efc-20ac2d9b7e5e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"GitHubリポジトリのDescriptionの部分の内容を、英語で考えてみてください。"},"uuid":"b485e046-092a-4581-83d0-69c29866170b","timestamp":"2026-02-23T06:22:28.493Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"b485e046-092a-4581-83d0-69c29866170b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01SBtXtvHsARMzTXx3xqepnL","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to suggest a GitHub repository description (the short description field shown on the repo page) in English. Let me think about what would be a good, concise description for GenHN based on what I know about the project.\n\nGenHN is:\n- A vanilla JS web app\n- Reconstructs the Hacker News interface\n- Uses different design \"essences\" inspired by iconic brands\n- Has Gemini AI-powered theme generation\n- No build step required\n\nGitHub descriptions should be short (under 350 characters, ideally 1-2 sentences).\n\nLet me think of a few options:\n\n1. \"Reconstruct Hacker News in any design language — 10 built-in presets or AI-generated themes via Gemini.\"\n\n\n2. \"A design playground that reimagines Hacker News through iconic brand aesthetics, with AI theme generation powered by Gemini.\"\n3. \"Vanilla JS HN reader with 10 brand-inspired design presets and Gemini-powered AI theme generation.\"\n4. \"Reimagine Hacker News in any visual style — from iconic brand aesthetics to AI-generated themes via Gemini API.\"\n\nI think option 1 is the punchiest and clearest, hitting the key features without being too wordy.","signature":"EusJCkYICxgCKkCEUPnXAKiGeUE0b5mfS9SmpYwm45X0EsvIHzWNji2f8kAgd4OBSXdObXVF1nmYl7qQxYsl7jAxhbwZReeXzmGcEgxYlLkSF0Gm8w+FXW0aDOcprSjcCbbw5DPSiSIw3sIaPYNQuuxk9z/3cm8QW1pwgmCMd6ccOJTJADbKRkmTPFbY147KyOsseAsX3yr5KtIITfnaQjHQIRbh7jt6ItHM1hWvEJ8hHe7RJetV3/joXmjrPFSMan1k3oO7Mer3itLfP1inTKqorjGHYIiT9TVMJS3cShe5Po31BB9+M5jL1yZzm5eoOSpvclFLOVJZF5du7UgawQmzWvmzCLYYNlYBKX8fDPeyxP+Q4sHeYuhtbp38UMrJag4Kh7wJBwFEPqOB4eILCrzNPBCOUhB/vzs+ffwufm8UJz8pb8BfOdCy55tKZUoXxXBYVH6cZrFz8av0jT7XNuOiFrltnADqmbq5Z0GWJ5qLUztHHzBK2zQW0FznAM5Uw0iMfbvbfPbvzTk0+QBh5NMJqTEbNY7JO/Su5PmE2gGQvkA6UgcC7YAizt4CNIpkl8fEd8G/W4qUhd1f4WOci40bdyB4qH0+mRK/h5u1F5ok9YEi2NpefYtb8SX4lnMsUlNx01Yi1MlgzGpVFPZ1UTwDP0R6MadpArw4t1/J2cS1RNhDIW9h1jMxQzyyPMIFCqtKgGnCDuF4uRMXDAW28cgFj1bTxcZeis2kVkaHpX4WdNoKBgv/X1GhBmvWu3Ud0ueU9EwsHUSpfG21Ysm6n4/qKWg+njjsln4ArjExJzIL3U9uRnDwNBRIgrX1X+3Aa8a1kUWrmPnBHvXwrPj1sNEsw733PG8xTxNNHaW1q0n05ftyZM7zpj7X9WYAbEfuov3Wf9vcaL9xQeB+zXMdmhQxBvSfBi94ShN4buRj77Gi4ezpVpd/ABM74HG0a/p66EKKviTdBp94JbRwnf2LVM/V9YrD0f8OhDSyREGmTOFAGeiYY+MwAsPFd8GFUpBF133CJ1sKhHfRP20zVRUC4vOY5RuTCYFxH+kOm4RR5kK8cjDuoZLs2F4er9cW4IlT8rLyMGTN3nXHfoStrReyluiymT5CcqgtR+nd+nL4zK2W/zSGO3Lobsmf0ASKZcFVmEyppuGzs1l0HiRzbZ+f3Tc7DjBPfpE+XjmbsxzxLtTvFesNfdQ8wOjQhRzA30cTxMwHPIude5uFjWhnnXPfiZKR6VKipoZW4PgRq+vcT2d/2n92zn+ruBJdo6JS5EEIFfqPGx3uxuqYKPi5ZoejUnQFUJ0YUB3S2mQdOv907leWOWWd0ElS2qwhJsFDCJbTth+1f5TTPWZvxocWFlKSDewdy1iOeENVc+LgzryxoLyW8DUKo7JQwquqFVCbLF9c9jNWT6LxT28+nwHYN54bHd6RojyFtI4rSr2DYFGLw2YORHMhRyKaP8g8djIIFXnRB84JU1N5/pfd1Qc6n1kgvUZS46W5Da1uudw4H1I0drUe6VD2rMAXcVaCdZonqT6NaFJG+THI/Qcln01PrX8BuX78JXSRS22hPAgFx5UCogCtZoahVfhLg7HlHT5NMv8KFqB/7UNSUM4oTYf5r4/D5rzCKbXlskFQvBDlJV1/KvLHRsDpR+LjFpcWFaWZaKUwLy4vZd345Oe0MQ6X7+UYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":142,"cache_read_input_tokens":32615,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":142},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQX6Kuqqs2WEm8igQ1qH","type":"assistant","uuid":"87575298-d66c-42e9-b947-74306540cb94","timestamp":"2026-02-23T06:22:36.342Z"}
{"parentUuid":"87575298-d66c-42e9-b947-74306540cb94","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01SBtXtvHsARMzTXx3xqepnL","type":"message","role":"assistant","content":[{"type":"text","text":"いくつか案を出します。\n\n---\n\n**候補 A — コンセプト重視**\n> Reimagine Hacker News through iconic design aesthetics — 10 built-in presets or AI-generated themes via Gemini API.\n\n**候補 B — 機能列挙寄り**\n> Vanilla JS HN reader with brand-inspired design presets and on-the-fly AI theme generation powered by Gemini.\n\n**候補 C — シンプル・一文**\n> A design playground that reconstructs Hacker News in any visual language, with AI theme generation via Gemini API.\n\n---\n\n個人的には **候補 A** が一番バランスよいと思います。\"Reimagine\" でコンセプトを端的に伝えつつ、プリセット数とGemini連携の両方を収めています。\n\nどれかベースに調整しますか？"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":142,"cache_read_input_tokens":32615,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":142},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQX6Kuqqs2WEm8igQ1qH","type":"assistant","uuid":"441f1083-c063-43fc-81c4-debf792ce198","timestamp":"2026-02-23T06:22:38.995Z"}
{"parentUuid":"441f1083-c063-43fc-81c4-debf792ce198","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"4111ad09-d6b3-4163-bad2-5600a825242e","toolUseID":"4111ad09-d6b3-4163-bad2-5600a825242e","timestamp":"2026-02-23T06:22:39.026Z","uuid":"9df9b07f-b1a2-4075-b70d-cb37ae960360"}
{"parentUuid":"9df9b07f-b1a2-4075-b70d-cb37ae960360","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":132}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:22:39.159Z","uuid":"717cc095-b28a-4b10-bc05-8d688eda984f","toolUseID":"4111ad09-d6b3-4163-bad2-5600a825242e"}
{"type":"file-history-snapshot","messageId":"42a6c263-b895-4e2a-9a89-bea6dd2f420b","snapshot":{"messageId":"42a6c263-b895-4e2a-9a89-bea6dd2f420b","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"}},"timestamp":"2026-02-23T06:24:18.061Z"},"isSnapshotUpdate":false}
{"parentUuid":"717cc095-b28a-4b10-bc05-8d688eda984f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"Generative UIの実験的プロジェクト、ということをメインで書きたいです。"},"uuid":"42a6c263-b895-4e2a-9a89-bea6dd2f420b","timestamp":"2026-02-23T06:24:17.933Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"42a6c263-b895-4e2a-9a89-bea6dd2f420b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01AMe9GkhqpxG2QRy85u9BDx","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants the GitHub description to focus on \"Generative UI\" as an experimental project. Let me think of options that lead with that concept.","signature":"ErsCCkYICxgCKkA/mNOqIHkXbSGhiisRU8sRYS7IvY8lvomtB3hEuPZknTBBC2xAE8sYGeYfZutKJnMVGlD+UHXL1Sc6peP+Sj7PEgzK+yWxYPqF6fQGzrAaDJ8lr3XIenZuapUiCSIwySO5gYjQCSAt39pWF1pkx55k8NiP9PP302bfXlQLFeYu3dPZ5++9by6HZbiz8vRvKqIBNXsGQTyY2IzOwG0z7lrW1ahEQ/qEl/COy4KhwKpMfRhECiF9a9w1VFIcWAb0MOaxEJ4M2v1rjPkvPlsYbFQgEQW+zU7/sUMsrdHa/t4ldHND51ioCn1/uSNuJomfOuMecUJYEaSSgLzZHGeInL1JnNSF2NoKGjj4TwC6zm+lKW30SwYiPDndCRVCO1y+dIhij1eXE3pCWpAKBm5V2p4WXdARGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":30,"cache_read_input_tokens":33283,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":30},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXEPvfRhcRoRDcfVE2J","type":"assistant","uuid":"e3e8a0d3-42ec-4612-bb6b-d2c28e5539f5","timestamp":"2026-02-23T06:24:19.525Z"}
{"parentUuid":"e3e8a0d3-42ec-4612-bb6b-d2c28e5539f5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01AMe9GkhqpxG2QRy85u9BDx","type":"message","role":"assistant","content":[{"type":"text","text":"では \"Generative UI\" をメインに据えた案をいくつか。\n\n---\n\n**候補 A**\n> An experimental Generative UI project — describe any visual style and watch Hacker News reshape itself in real time.\n\n**候補 B**\n> Generative UI experiment: prompt Gemini to reconstruct Hacker News in any design language, on the fly.\n\n**候補 C**\n> Exploring Generative UI through Hacker News — type a design concept, get a living interface.\n\n---\n\n\"Generative UI\" という言葉を前面に出しつつ、HNをキャンバスとして使っているプロジェクトの性格が伝わる **候補 A** か **候補 C** が自然かなと思います。どれかベースに調整しますか？"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":30,"cache_read_input_tokens":33283,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":30},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXEPvfRhcRoRDcfVE2J","type":"assistant","uuid":"91e26378-2d44-4963-8569-9b80ea039bdd","timestamp":"2026-02-23T06:24:23.370Z"}
{"parentUuid":"91e26378-2d44-4963-8569-9b80ea039bdd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"654b38d7-b1c8-4199-a995-a487dc5b042d","toolUseID":"654b38d7-b1c8-4199-a995-a487dc5b042d","timestamp":"2026-02-23T06:24:23.394Z","uuid":"b41d221d-7e4a-4c9b-a55a-490c567c80ee"}
{"parentUuid":"b41d221d-7e4a-4c9b-a55a-490c567c80ee","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":163}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:24:23.557Z","uuid":"aa5f18f6-2fdf-4514-87e3-e50f240eab0c","toolUseID":"654b38d7-b1c8-4199-a995-a487dc5b042d"}
{"type":"file-history-snapshot","messageId":"1924bf99-1bcb-4c17-9f5f-bdc3364e5b8c","snapshot":{"messageId":"1924bf99-1bcb-4c17-9f5f-bdc3364e5b8c","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"}},"timestamp":"2026-02-23T06:32:01.958Z"},"isSnapshotUpdate":false}
{"parentUuid":"aa5f18f6-2fdf-4514-87e3-e50f240eab0c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"外部の生成AIで、作成したカスタムスタイルをコピペ可能なようなインターフェースを、コントロールパネルに用意してみてください。"},"uuid":"1924bf99-1bcb-4c17-9f5f-bdc3364e5b8c","timestamp":"2026-02-23T06:32:01.845Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"1924bf99-1bcb-4c17-9f5f-bdc3364e5b8c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01HgQuXewtsQwMtG2AUZcRew","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to add an interface in the control panel that allows copying/pasting custom styles generated by external AI (not the built-in Gemini integration). So they want a UI element where users can paste CSS generated by external AI tools (like ChatGPT, Claude, etc.) and apply it.\n\nLet me first read the gardener.js to understand the current control panel structure and how styles are applied.","signature":"ErcECkYICxgCKkA8YTxK5whTKgJ+8kGgDJz2i3FypiLH1dG75RjZUswanV6uaxsTtvjq71mEaMpGnvSCb7Jga1sDAnpuNeuDl1cwEgxj+MCPn95sDLncAd0aDMDYMJZrIH7aACa7jiIwALblmv/u4tFfksFyFRE2FZux6Tgz7hp4nps+5kM/iJFnDzN0WX+U5/ELHClAlbRiKp4DucgFN9q1Vgm8ex+1+VcQ38/qNm2y8NrNkpRrFh5R+ww8H88AGd+FURxJNoFUepyFaiv1ndoJAp2zISa2POAXgP0tQUdhTRbudHmnmatUb6+mhAQ6Yzio0rRhTZyOIr/x1LkKIkFlF+QuHAJy4OKVmQQqXLP48Gma1uteQosEkdKz2aFhBNVVjxZpqoPS9LEXwOXCYEA/NozY8TF2lI+iUscDQ5IBZD0DNlJ9UttMUPWoR83BW9Cbm1YThtkrU/zvwvlKp+jkJ/SgvEAPGtl3b6dRwh5ae8091AnYkNIk67DllkTTwS4EPSGZLkj9/sP0h2W7pj7N5IEnXvIEBfmBYSgiV35HvncBIVQcZ2tKuLgHpRHFv+RpyoB46n9iAxJc6ab5E2VgPyanPiJYUZYU0HwLX/+hs9Hwo04kJA3g5NzkZXK6N6WJTYHXfLh6wto/otDiYIKJq3/87zmNgfoInN/XoJgzky3+ZLGUtt4esfU2qWG9uT2NceiP+3m0vS9NE6SrJzNsnlnlSjqrpGKRUbcCeR0LHO+wLOFLYrEjGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":55,"cache_read_input_tokens":33568,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":55},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXpbSAQjtxfh9EvvzBm","type":"assistant","uuid":"8b7fe721-ff43-4177-b5a2-a93914fa3cc3","timestamp":"2026-02-23T06:32:05.414Z"}
{"parentUuid":"8b7fe721-ff43-4177-b5a2-a93914fa3cc3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01HgQuXewtsQwMtG2AUZcRew","type":"message","role":"assistant","content":[{"type":"text","text":"まずコントロールパネルの現在の構造を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":55,"cache_read_input_tokens":33568,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":55},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXpbSAQjtxfh9EvvzBm","type":"assistant","uuid":"d3b19962-5e1d-480e-9a3e-fadea2d848cb","timestamp":"2026-02-23T06:32:06.096Z"}
{"parentUuid":"d3b19962-5e1d-480e-9a3e-fadea2d848cb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01HgQuXewtsQwMtG2AUZcRew","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BjDKjvTcCd4NaLL1aAmqWk","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1680,"limit":120},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":55,"cache_read_input_tokens":33568,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":55},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXpbSAQjtxfh9EvvzBm","type":"assistant","uuid":"afaf5995-7ecb-40f3-b105-5ebf3ed350f2","timestamp":"2026-02-23T06:32:07.268Z"}
{"parentUuid":"afaf5995-7ecb-40f3-b105-5ebf3ed350f2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01BjDKjvTcCd4NaLL1aAmqWk","toolUseID":"toolu_01BjDKjvTcCd4NaLL1aAmqWk","timestamp":"2026-02-23T06:32:07.298Z","uuid":"2b4ebc16-9163-4c4d-b9d9-84a6957c2c79"}
{"parentUuid":"afaf5995-7ecb-40f3-b105-5ebf3ed350f2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BjDKjvTcCd4NaLL1aAmqWk","type":"tool_result","content":"  1680→        return css;\n  1681→    },\n  1682→\n  1683→    renderApiKeySection() {\n  1684→        const existing = document.getElementById('api-key-section');\n  1685→        if (existing) existing.remove();\n  1686→\n  1687→        const section = document.createElement('div');\n  1688→        section.id = 'api-key-section';\n  1689→        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n  1690→\n  1691→        if (this.getApiKey()) {\n  1692→            section.innerHTML = `\n  1693→                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n  1694→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n  1695→                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n  1696→                </div>`;\n  1697→            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n  1698→        } else {\n  1699→            section.innerHTML = `\n  1700→                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1701→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n  1702→                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n  1703→                </div>\n  1704→                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1705→                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n  1706→                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n  1707→                </div>`;\n  1708→            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n  1709→                const form = section.querySelector('#api-key-form');\n  1710→                const icon = section.querySelector('#api-key-icon');\n  1711→                const isOpen = form.style.display !== 'none';\n  1712→                form.style.display = isOpen ? 'none' : 'flex';\n  1713→                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1714→            });\n  1715→            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n  1716→                const val = section.querySelector('#api-key-input').value.trim();\n  1717→                if (!val) return;\n  1718→                this.saveApiKey(val);\n  1719→                this.renderApiKeySection();\n  1720→            });\n  1721→        }\n  1722→\n  1723→        this.elements.themeControls.appendChild(section);\n  1724→    },\n  1725→\n  1726→    showGenerateError(err) {\n  1727→        let message;\n  1728→        switch (err.message) {\n  1729→            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n  1730→            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n  1731→            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n  1732→            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n  1733→            default:              message = `Generation failed: ${err.message}`;\n  1734→        }\n  1735→        let errEl = document.getElementById('generate-error');\n  1736→        if (!errEl) {\n  1737→            errEl = document.createElement('div');\n  1738→            errEl.id = 'generate-error';\n  1739→            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n  1740→            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n  1741→        }\n  1742→        errEl.textContent = message;\n  1743→        clearTimeout(this._errorTimeout);\n  1744→        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n  1745→    },\n  1746→\n  1747→    expandApiKeySection() {\n  1748→        const form = document.getElementById('api-key-form');\n  1749→        const icon = document.getElementById('api-key-icon');\n  1750→        if (form && form.style.display === 'none') {\n  1751→            form.style.display = 'flex';\n  1752→            if (icon) icon.style.transform = 'rotate(0deg)';\n  1753→        }\n  1754→        this.elements.themeControls.classList.remove('is-minimized');\n  1755→        const input = document.getElementById('api-key-input');\n  1756→        if (input) setTimeout(() => input.focus(), 300);\n  1757→    },\n  1758→\n  1759→    summarizePrompt(prompt) {\n  1760→        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n  1761→        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n  1762→        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n  1763→        return word.charAt(0).toUpperCase() + word.slice(1);\n  1764→    },\n  1765→\n  1766→    getSavedThemes() {\n  1767→        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n  1768→        catch (_) { return []; }\n  1769→    },\n  1770→\n  1771→    saveCurrentTheme() {\n  1772→        const css = localStorage.getItem('genhn-custom-css');\n  1773→        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n  1774→        if (!css) return;\n  1775→\n  1776→        const baseName = this.summarizePrompt(prompt);\n  1777→        const saved = this.getSavedThemes();\n  1778→        if (saved.some(t => t.css === css)) return;\n  1779→\n  1780→        let name = baseName;\n  1781→        const existingNames = new Set(saved.map(t => t.name));\n  1782→        let i = 2;\n  1783→        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n  1784→\n  1785→        saved.push({ id: Date.now().toString(), name, css, prompt });\n  1786→        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n  1787→        this.renderSavedThemeButtons();\n  1788→        this.renderSaveButton(false);\n  1789→    },\n  1790→\n  1791→    deleteSavedTheme(id) {\n  1792→        const saved = this.getSavedThemes().filter(t => t.id !== id);\n  1793→        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n  1794→        this.renderSavedThemeButtons();\n  1795→    },\n  1796→\n  1797→    renderSavedThemeButtons() {\n  1798→        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n  1799→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c3a30505-34b5-48ab-87bb-c53a1df5359b","timestamp":"2026-02-23T06:32:07.297Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n","numLines":120,"startLine":1680,"totalLines":1918}},"sourceToolAssistantUUID":"afaf5995-7ecb-40f3-b105-5ebf3ed350f2"}
{"parentUuid":"c3a30505-34b5-48ab-87bb-c53a1df5359b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01HgQuXewtsQwMtG2AUZcRew","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AuMem3J6jXW3zQcoeVtdyN","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1800,"limit":120},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":55,"cache_read_input_tokens":33568,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":55},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXpbSAQjtxfh9EvvzBm","type":"assistant","uuid":"7933e2b9-d920-4eff-83a9-a83d6d5765fe","timestamp":"2026-02-23T06:32:07.948Z"}
{"parentUuid":"7933e2b9-d920-4eff-83a9-a83d6d5765fe","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01AuMem3J6jXW3zQcoeVtdyN","toolUseID":"toolu_01AuMem3J6jXW3zQcoeVtdyN","timestamp":"2026-02-23T06:32:07.981Z","uuid":"c8b626a1-aa4e-410f-a538-a1f09c402831"}
{"parentUuid":"7933e2b9-d920-4eff-83a9-a83d6d5765fe","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AuMem3J6jXW3zQcoeVtdyN","type":"tool_result","content":"  1800→        this.getSavedThemes().forEach(theme => {\n  1801→            const wrapper = document.createElement('div');\n  1802→            wrapper.className = 'saved-theme-btn-wrapper';\n  1803→            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n  1804→\n  1805→            const btn = document.createElement('button');\n  1806→            btn.textContent = theme.name;\n  1807→            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n  1808→            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n  1809→            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n  1810→            btn.addEventListener('click', () => {\n  1811→                this.elements.promptInput.value = theme.prompt;\n  1812→                this.applyStyle(theme.css, null, theme.prompt);\n  1813→                this.renderSaveButton(false);\n  1814→                this.togglePresets(true);\n  1815→            });\n  1816→\n  1817→            const delBtn = document.createElement('button');\n  1818→            delBtn.textContent = '×';\n  1819→            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n  1820→            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n  1821→            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n  1822→            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n  1823→\n  1824→            wrapper.appendChild(btn);\n  1825→            wrapper.appendChild(delBtn);\n  1826→            this.elements.presetButtons.appendChild(wrapper);\n  1827→        });\n  1828→    },\n  1829→\n  1830→    renderSaveButton(show) {\n  1831→        const existing = document.getElementById('save-theme-row');\n  1832→        if (existing) existing.remove();\n  1833→        if (!show) return;\n  1834→\n  1835→        const row = document.createElement('div');\n  1836→        row.id = 'save-theme-row';\n  1837→        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n  1838→\n  1839→        const btn = document.createElement('button');\n  1840→        btn.textContent = 'Save as Preset';\n  1841→        btn.style.cssText = 'font-size:11px;';\n  1842→        btn.addEventListener('click', () => this.saveCurrentTheme());\n  1843→\n  1844→        row.appendChild(btn);\n  1845→        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n  1846→    },\n  1847→\n  1848→    async handleGenerate() {\n  1849→        const input = this.elements.promptInput.value.trim();\n  1850→        if (!input) return;\n  1851→        if (this._isGenerating) return;\n  1852→\n  1853→        const presetKey = this.matchStyle(input);\n  1854→        if (presetKey) {\n  1855→            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n  1856→            this.togglePresets(true);\n  1857→            return;\n  1858→        }\n  1859→\n  1860→        if (!this.getApiKey()) {\n  1861→            this.expandApiKeySection();\n  1862→            return;\n  1863→        }\n  1864→\n  1865→        this._isGenerating = true;\n  1866→        const btn = this.elements.generateBtn;\n  1867→        const originalText = btn.textContent;\n  1868→        btn.textContent = 'Generating...';\n  1869→        btn.disabled = true;\n  1870→\n  1871→        try {\n  1872→            const css = await this.generateTheme(input);\n  1873→            this.applyStyle(css, null, input);\n  1874→            this.togglePresets(true);\n  1875→            this.renderSaveButton(true);\n  1876→        } catch (err) {\n  1877→            this.showGenerateError(err);\n  1878→        } finally {\n  1879→            btn.textContent = originalText;\n  1880→            btn.disabled = false;\n  1881→            this._isGenerating = false;\n  1882→        }\n  1883→    },\n  1884→\n  1885→    matchStyle(input) {\n  1886→        const normalizedInput = input.toLowerCase();\n  1887→        for (const key in STYLE_PRESETS) {\n  1888→            if (normalizedInput.includes(key.toLowerCase())) return key;\n  1889→        }\n  1890→        return null;\n  1891→    },\n  1892→\n  1893→    applyStyle(css, themeName, customPrompt = null) {\n  1894→        this.toggleMenu(false);\n  1895→\n  1896→        if (themeName && STYLE_PRESETS[themeName]) {\n  1897→            localStorage.setItem('genhn-theme', themeName);\n  1898→            localStorage.removeItem('genhn-custom-css');\n  1899→            localStorage.removeItem('genhn-custom-prompt');\n  1900→            this.renderSaveButton(false);\n  1901→        } else if (customPrompt) {\n  1902→            localStorage.setItem('genhn-custom-css', css);\n  1903→            localStorage.setItem('genhn-custom-prompt', customPrompt);\n  1904→            localStorage.removeItem('genhn-theme');\n  1905→        }\n  1906→\n  1907→        const applyFn = () => {\n  1908→            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n  1909→        };\n  1910→\n  1911→        if (!document.startViewTransition) { applyFn(); return; }\n  1912→        document.startViewTransition(applyFn);\n  1913→    }\n  1914→};\n  1915→\n  1916→// Start the application\n  1917→document.addEventListener('DOMContentLoaded', () => App.init());\n  1918→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f75cb13f-4a51-44cb-bd31-dadcb6695616","timestamp":"2026-02-23T06:32:07.979Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","numLines":119,"startLine":1800,"totalLines":1918}},"sourceToolAssistantUUID":"7933e2b9-d920-4eff-83a9-a83d6d5765fe"}
{"parentUuid":"f75cb13f-4a51-44cb-bd31-dadcb6695616","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01WKsjMWFLUwqYVMTt5jcjZc","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me see the control panel rendering to understand where things are placed and how they're structured.","signature":"EpQCCkYICxgCKkC0Kc1r/4BobL4G7QH+mrQ+5Hg7u1b883Xf/EUQGx9IQoRFPeFaJ/eLBIIAh9EKo6DW1cAwic+mEbal421WXLoYEgzYBgCWBbui4m3Fw+YaDFgbsv/98VDxlMraniIwPmNp3/fZbJumM+1E/rpxcknUUsEE/nqFzQRUIEc5XsQEwkVX6DFrhPDTYVkG+K7GKnxgFMmhhwrKpRaZLgC+Uzy9EtMIQvcprgAIycI3ZrIfFOiteU8BS6tsIuYuGIUGDwERepwVjaMr6yLYdq+uOaEfoSyq+J5tFwUpG+xNHFBZ3/AzV3gRWJGF+hXkNPCOnXfXGoyW23FOrbKVaMgmiOp0klz60BiYQAEv7te9GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4831,"cache_read_input_tokens":33623,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4831},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXq361ghjEWK9hRkb6M","type":"assistant","uuid":"1995d03f-d144-4a18-a168-b84f3077b54d","timestamp":"2026-02-23T06:32:09.680Z"}
{"parentUuid":"1995d03f-d144-4a18-a168-b84f3077b54d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01WKsjMWFLUwqYVMTt5jcjZc","type":"message","role":"assistant","content":[{"type":"text","text":"コントロールパネルの初期化部分も確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4831,"cache_read_input_tokens":33623,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4831},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXq361ghjEWK9hRkb6M","type":"assistant","uuid":"02726054-5cca-4e86-a263-55b8df8af903","timestamp":"2026-02-23T06:32:10.396Z"}
{"parentUuid":"02726054-5cca-4e86-a263-55b8df8af903","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01WKsjMWFLUwqYVMTt5jcjZc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Y45E8Ww3Zp9BqVJubWpQky","name":"Grep","input":{"pattern":"renderApiKeySection|themeControls|renderSaveButton|renderControlPanel|initControls|renderSaved","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":2},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4831,"cache_read_input_tokens":33623,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4831},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXq361ghjEWK9hRkb6M","type":"assistant","uuid":"82d72131-a55c-45ea-a448-26d9c3235ac5","timestamp":"2026-02-23T06:32:12.495Z"}
{"parentUuid":"82d72131-a55c-45ea-a448-26d9c3235ac5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01Y45E8Ww3Zp9BqVJubWpQky","toolUseID":"toolu_01Y45E8Ww3Zp9BqVJubWpQky","timestamp":"2026-02-23T06:32:12.883Z","uuid":"f0026cb7-1f08-42f3-8809-d9d65f8e2cc5"}
{"parentUuid":"82d72131-a55c-45ea-a448-26d9c3235ac5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Y45E8Ww3Zp9BqVJubWpQky","type":"tool_result","content":"1372-        navLinks: document.querySelector('.hn-nav-links'),\n1373-        header: document.querySelector('.hn-header'),\n1374:        themeControls: document.getElementById('theme-controls'),\n1375-        panelHandle: document.getElementById('panel-handle')\n1376-    },\n--\n1378-    async init() {\n1379-        this.renderPresetButtons();\n1380:        this.renderSavedThemeButtons();\n1381:        this.renderApiKeySection();\n1382-        this.bindEvents();\n1383-\n--\n1390-            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n1391-            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n1392:            this.renderSaveButton(!alreadySaved);\n1393-        } else {\n1394-            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n--\n1448-                isDragging = true;\n1449-                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n1450:                this.elements.themeControls.style.transition = 'none';\n1451-            };\n1452-\n--\n1455-                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n1456-                const deltaX = clientX - startX;\n1457:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1458-\n1459-                if (!isMin && deltaX > 0) {\n1460:                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n1461-                } else if (isMin && deltaX < 0) {\n1462:                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n1463-                }\n1464-            };\n--\n1467-                if (!isDragging) return;\n1468-                isDragging = false;\n1469:                this.elements.themeControls.style.transition = '';\n1470-                \n1471-                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n1472-                const deltaX = clientX - startX;\n1473:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1474-\n1475:                this.elements.themeControls.style.transform = '';\n1476-\n1477-                if (Math.abs(deltaX) < 10) {\n1478:                    this.elements.themeControls.classList.toggle('is-minimized');\n1479-                } else {\n1480-                    if (!isMin && deltaX > threshold) {\n1481:                        this.elements.themeControls.classList.add('is-minimized');\n1482-                    } else if (isMin && deltaX < -threshold) {\n1483:                        this.elements.themeControls.classList.remove('is-minimized');\n1484-                    }\n1485-                }\n--\n1630-    clearApiKey() {\n1631-        localStorage.removeItem('genhn-gemini-key');\n1632:        this.renderApiKeySection();\n1633-    },\n1634-\n--\n1681-    },\n1682-\n1683:    renderApiKeySection() {\n1684-        const existing = document.getElementById('api-key-section');\n1685-        if (existing) existing.remove();\n--\n1717-                if (!val) return;\n1718-                this.saveApiKey(val);\n1719:                this.renderApiKeySection();\n1720-            });\n1721-        }\n1722-\n1723:        this.elements.themeControls.appendChild(section);\n1724-    },\n1725-\n--\n1752-            if (icon) icon.style.transform = 'rotate(0deg)';\n1753-        }\n1754:        this.elements.themeControls.classList.remove('is-minimized');\n1755-        const input = document.getElementById('api-key-input');\n1756-        if (input) setTimeout(() => input.focus(), 300);\n--\n1785-        saved.push({ id: Date.now().toString(), name, css, prompt });\n1786-        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n1787:        this.renderSavedThemeButtons();\n1788:        this.renderSaveButton(false);\n1789-    },\n1790-\n--\n1792-        const saved = this.getSavedThemes().filter(t => t.id !== id);\n1793-        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n1794:        this.renderSavedThemeButtons();\n1795-    },\n1796-\n1797:    renderSavedThemeButtons() {\n1798-        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n1799-\n--\n1811-                this.elements.promptInput.value = theme.prompt;\n1812-                this.applyStyle(theme.css, null, theme.prompt);\n1813:                this.renderSaveButton(false);\n1814-                this.togglePresets(true);\n1815-            });\n--\n1828-    },\n1829-\n1830:    renderSaveButton(show) {\n1831-        const existing = document.getElementById('save-theme-row');\n1832-        if (existing) existing.remove();\n--\n1873-            this.applyStyle(css, null, input);\n1874-            this.togglePresets(true);\n1875:            this.renderSaveButton(true);\n1876-        } catch (err) {\n1877-            this.showGenerateError(err);\n--\n1898-            localStorage.removeItem('genhn-custom-css');\n1899-            localStorage.removeItem('genhn-custom-prompt');\n1900:            this.renderSaveButton(false);\n1901-        } else if (customPrompt) {\n1902-            localStorage.setItem('genhn-custom-css', css);"}]},"uuid":"206e6cf2-9f22-430d-8be6-70a2743d7266","timestamp":"2026-02-23T06:32:12.882Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1372-        navLinks: document.querySelector('.hn-nav-links'),\n1373-        header: document.querySelector('.hn-header'),\n1374:        themeControls: document.getElementById('theme-controls'),\n1375-        panelHandle: document.getElementById('panel-handle')\n1376-    },\n--\n1378-    async init() {\n1379-        this.renderPresetButtons();\n1380:        this.renderSavedThemeButtons();\n1381:        this.renderApiKeySection();\n1382-        this.bindEvents();\n1383-\n--\n1390-            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n1391-            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n1392:            this.renderSaveButton(!alreadySaved);\n1393-        } else {\n1394-            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n--\n1448-                isDragging = true;\n1449-                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n1450:                this.elements.themeControls.style.transition = 'none';\n1451-            };\n1452-\n--\n1455-                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n1456-                const deltaX = clientX - startX;\n1457:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1458-\n1459-                if (!isMin && deltaX > 0) {\n1460:                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n1461-                } else if (isMin && deltaX < 0) {\n1462:                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n1463-                }\n1464-            };\n--\n1467-                if (!isDragging) return;\n1468-                isDragging = false;\n1469:                this.elements.themeControls.style.transition = '';\n1470-                \n1471-                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n1472-                const deltaX = clientX - startX;\n1473:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1474-\n1475:                this.elements.themeControls.style.transform = '';\n1476-\n1477-                if (Math.abs(deltaX) < 10) {\n1478:                    this.elements.themeControls.classList.toggle('is-minimized');\n1479-                } else {\n1480-                    if (!isMin && deltaX > threshold) {\n1481:                        this.elements.themeControls.classList.add('is-minimized');\n1482-                    } else if (isMin && deltaX < -threshold) {\n1483:                        this.elements.themeControls.classList.remove('is-minimized');\n1484-                    }\n1485-                }\n--\n1630-    clearApiKey() {\n1631-        localStorage.removeItem('genhn-gemini-key');\n1632:        this.renderApiKeySection();\n1633-    },\n1634-\n--\n1681-    },\n1682-\n1683:    renderApiKeySection() {\n1684-        const existing = document.getElementById('api-key-section');\n1685-        if (existing) existing.remove();\n--\n1717-                if (!val) return;\n1718-                this.saveApiKey(val);\n1719:                this.renderApiKeySection();\n1720-            });\n1721-        }\n1722-\n1723:        this.elements.themeControls.appendChild(section);\n1724-    },\n1725-\n--\n1752-            if (icon) icon.style.transform = 'rotate(0deg)';\n1753-        }\n1754:        this.elements.themeControls.classList.remove('is-minimized');\n1755-        const input = document.getElementById('api-key-input');\n1756-        if (input) setTimeout(() => input.focus(), 300);\n--\n1785-        saved.push({ id: Date.now().toString(), name, css, prompt });\n1786-        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n1787:        this.renderSavedThemeButtons();\n1788:        this.renderSaveButton(false);\n1789-    },\n1790-\n--\n1792-        const saved = this.getSavedThemes().filter(t => t.id !== id);\n1793-        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n1794:        this.renderSavedThemeButtons();\n1795-    },\n1796-\n1797:    renderSavedThemeButtons() {\n1798-        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n1799-\n--\n1811-                this.elements.promptInput.value = theme.prompt;\n1812-                this.applyStyle(theme.css, null, theme.prompt);\n1813:                this.renderSaveButton(false);\n1814-                this.togglePresets(true);\n1815-            });\n--\n1828-    },\n1829-\n1830:    renderSaveButton(show) {\n1831-        const existing = document.getElementById('save-theme-row');\n1832-        if (existing) existing.remove();\n--\n1873-            this.applyStyle(css, null, input);\n1874-            this.togglePresets(true);\n1875:            this.renderSaveButton(true);\n1876-        } catch (err) {\n1877-            this.showGenerateError(err);\n--\n1898-            localStorage.removeItem('genhn-custom-css');\n1899-            localStorage.removeItem('genhn-custom-prompt');\n1900:            this.renderSaveButton(false);\n1901-        } else if (customPrompt) {\n1902-            localStorage.setItem('genhn-custom-css', css);","numLines":123},"sourceToolAssistantUUID":"82d72131-a55c-45ea-a448-26d9c3235ac5"}
{"parentUuid":"206e6cf2-9f22-430d-8be6-70a2743d7266","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01XVzzvDEWLMkMT6SquNAqzB","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I understand the structure well. Let me think about what needs to be implemented.\n\nThe user wants an interface for pasting custom CSS generated by external AI (like Claude, ChatGPT, etc.) into the control panel. This should:\n\n1. Have a \"Paste CSS\" or similar section in the control panel\n2. Allow user to paste CSS code\n3. Apply it directly without needing a Gemini API key\n4. Ideally integrate with the existing save/preset system\n\nThe control panel currently has:\n1. Preset buttons (built-in themes)\n2. Saved theme buttons\n3. Theme input + Apply button (for Gemini generation)\n\n\n4. Save as Preset button (shown after generation)\n5. API Key section (Gemini)\n\nI should add a \"Paste CSS\" section below the Gemini API section with a textarea for pasting CSS, an Apply button that triggers `applyStyle()` and shows the Save as Preset button. Looking at the init function to understand the panel ordering and where to insert this new section.\n\nThe init() calls render functions in this order: `renderPresetButtons()`, `renderSavedThemeButtons()`, `renderApiKeySection()`, then `bindEvents()`. So the control panel flows from preset buttons at the top, through saved themes, theme input controls, and the API key section at the bottom. I need to figure out where exactly to insert the Paste CSS section in the HTML structure.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1826,"cache_read_input_tokens":38454,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1826},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXqPveG4VNpHzntocxF","type":"assistant","uuid":"ae28f69b-64ec-4aae-8704-d101e462f142","timestamp":"2026-02-23T06:32:23.037Z"}
{"parentUuid":"ae28f69b-64ec-4aae-8704-d101e462f142","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01XVzzvDEWLMkMT6SquNAqzB","type":"message","role":"assistant","content":[{"type":"text","text":"`index.html` のコントロールパネル構造も確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1826,"cache_read_input_tokens":38454,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1826},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXqPveG4VNpHzntocxF","type":"assistant","uuid":"ec414c5c-8474-477e-b492-8b56199b3ac7","timestamp":"2026-02-23T06:32:23.045Z"}
{"parentUuid":"ec414c5c-8474-477e-b492-8b56199b3ac7","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01XVzzvDEWLMkMT6SquNAqzB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016wFf9fBKjruUunkBxjdFEQ","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/index.html"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1826,"cache_read_input_tokens":38454,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1826},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXqPveG4VNpHzntocxF","type":"assistant","uuid":"0bede5fe-ec88-4d9d-ab9d-d6fe98436673","timestamp":"2026-02-23T06:32:23.464Z"}
{"parentUuid":"0bede5fe-ec88-4d9d-ab9d-d6fe98436673","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_016wFf9fBKjruUunkBxjdFEQ","toolUseID":"toolu_016wFf9fBKjruUunkBxjdFEQ","timestamp":"2026-02-23T06:32:23.496Z","uuid":"7c36d5eb-5343-40da-87b2-09ff12286d90"}
{"parentUuid":"0bede5fe-ec88-4d9d-ab9d-d6fe98436673","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016wFf9fBKjruUunkBxjdFEQ","type":"tool_result","content":"     1→<!DOCTYPE html>\n     2→<html lang=\"en\">\n     3→<head>\n     4→    <meta charset=\"UTF-8\">\n     5→    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n     6→    <title>GenHN</title>\n     7→    <style id=\"generated-style\"></style>\n     8→    </head>\n     9→<body>\n    10→    <div id=\"theme-controls\">\n    11→        <div id=\"panel-handle\"></div>\n    12→        <div id=\"presets-toggle\" style=\"width: 100%; cursor: pointer; font-size: 11px; margin-bottom: 8px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; user-select: none;\">\n    13→             <span style=\"text-transform: uppercase; letter-spacing: 1px; font-weight: 600;\">Presets</span>\n    14→             <span id=\"presets-icon\" style=\"font-size: 10px;\">▼</span>\n    15→        </div>\n    16→        <div id=\"preset-buttons\" style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; transition: all 0.3s ease; overflow: hidden;\">\n    17→            <!-- Buttons will be generated by gardener.js -->\n    18→        </div>\n    19→        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">\n    20→            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">\n    21→            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>\n    22→        </div>\n    23→    </div>\n    24→\n    25→    <header class=\"hn-header\">\n    26→        <nav class=\"hn-nav\">\n    27→            <button class=\"hn-menu-toggle\" aria-label=\"Toggle Menu\">\n    28→                <span></span>\n    29→                <span></span>\n    30→                <span></span>\n    31→            </button>\n    32→            <a href=\"#\" class=\"hn-logo\" aria-label=\"Hacker News Home\">Y</a>\n    33→            <span class=\"hn-site-title\">Hacker News</span>\n    34→            <ul class=\"hn-nav-links\">\n    35→                <li><a href=\"#\">new</a></li>\n    36→                <li><a href=\"#\">past</a></li>\n    37→                <li><a href=\"#\">comments</a></li>\n    38→                <li><a href=\"#\">ask</a></li>\n    39→                <li><a href=\"#\">show</a></li>\n    40→                <li><a href=\"#\">jobs</a></li>\n    41→                <li><a href=\"#\">submit</a></li>\n    42→            </ul>\n    43→            <div class=\"hn-auth\">\n    44→                <a href=\"https://news.ycombinator.com/login\" target=\"_blank\">login</a>\n    45→            </div>\n    46→        </nav>\n    47→    </header>\n    48→\n    49→    <main class=\"hn-main\">\n    50→        <ol class=\"hn-story-list\">\n    51→            \n    52→            <li class=\"hn-story-item\">\n    53→                <div class=\"hn-story-rank\">1.</div>\n    54→                <div class=\"hn-story-content\">\n    55→                    <div class=\"hn-story-title-row\">\n    56→                        <a href=\"#\" class=\"hn-story-title\">Show HN: A brand new Hacker News experience with Generative UI</a>\n    57→                        <span class=\"hn-story-domain\">(github.com)</span>\n    58→                    </div>\n    59→                    <div class=\"hn-story-meta\">\n    60→                        <span class=\"hn-story-points\">150 points</span> by\n    61→                        <span class=\"hn-story-author\">generative_hacker</span>\n    62→                        <span class=\"hn-story-time\">2 hours ago</span>\n    63→                    </div>\n    64→                </div>\n    65→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n    66→            </li>\n    67→\n    68→            <li class=\"hn-story-item\">\n    69→                <div class=\"hn-story-rank\">2.</div>\n    70→                <div class=\"hn-story-content\">\n    71→                    <div class=\"hn-story-title-row\">\n    72→                        <a href=\"#\" class=\"hn-story-title\">New AI model released as open source</a>\n    73→                        <span class=\"hn-story-domain\">(example.com)</span>\n    74→                    </div>\n    75→                    <div class=\"hn-story-meta\">\n    76→                        <span class=\"hn-story-points\">300 points</span> by\n    77→                        <span class=\"hn-story-author\">ai_fan</span>\n    78→                        <span class=\"hn-story-time\">4 hours ago</span>\n    79→                    </div>\n    80→                </div>\n    81→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n    82→            </li>\n    83→\n    84→            <li class=\"hn-story-item\">\n    85→                <div class=\"hn-story-rank\">3.</div>\n    86→                <div class=\"hn-story-content\">\n    87→                    <div class=\"hn-story-title-row\">\n    88→                        <a href=\"#\" class=\"hn-story-title\">Read the latest design system guidelines</a>\n    89→                        <span class=\"hn-story-domain\">(design.com)</span>\n    90→                    </div>\n    91→                    <div class=\"hn-story-meta\">\n    92→                        <span class=\"hn-story-points\">215 points</span> by\n    93→                        <span class=\"hn-story-author\">design_geek</span>\n    94→                        <span class=\"hn-story-time\">5 hours ago</span>\n    95→                    </div>\n    96→                </div>\n    97→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n    98→            </li>\n    99→\n   100→        </ol>\n   101→        \n   102→        <button class=\"hn-load-more\">More</button>\n   103→    </main>\n   104→\n   105→    <footer class=\"hn-footer\">\n   106→        <ul class=\"hn-footer-links\">\n   107→            <li><a href=\"#\">Guidelines</a></li>\n   108→            <li><a href=\"#\">FAQ</a></li>\n   109→            <li><a href=\"#\">Lists</a></li>\n   110→            <li><a href=\"#\">API</a></li>\n   111→            <li><a href=\"#\">Security</a></li>\n   112→            <li><a href=\"#\">Legal</a></li>\n   113→            <li><a href=\"#\">Apply to YC</a></li>\n   114→            <li><a href=\"#\">Contact</a></li>\n   115→        </ul>\n   116→    </footer>\n   117→    <script src=\"gardener.js\"></script>\n   118→</body>\n   119→</html>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"acbf03ce-f09f-406c-91a5-60dc8fd198a2","timestamp":"2026-02-23T06:32:23.495Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/index.html","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>GenHN</title>\n    <style id=\"generated-style\"></style>\n    </head>\n<body>\n    <div id=\"theme-controls\">\n        <div id=\"panel-handle\"></div>\n        <div id=\"presets-toggle\" style=\"width: 100%; cursor: pointer; font-size: 11px; margin-bottom: 8px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; user-select: none;\">\n             <span style=\"text-transform: uppercase; letter-spacing: 1px; font-weight: 600;\">Presets</span>\n             <span id=\"presets-icon\" style=\"font-size: 10px;\">▼</span>\n        </div>\n        <div id=\"preset-buttons\" style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; transition: all 0.3s ease; overflow: hidden;\">\n            <!-- Buttons will be generated by gardener.js -->\n        </div>\n        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">\n            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">\n            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>\n        </div>\n    </div>\n\n    <header class=\"hn-header\">\n        <nav class=\"hn-nav\">\n            <button class=\"hn-menu-toggle\" aria-label=\"Toggle Menu\">\n                <span></span>\n                <span></span>\n                <span></span>\n            </button>\n            <a href=\"#\" class=\"hn-logo\" aria-label=\"Hacker News Home\">Y</a>\n            <span class=\"hn-site-title\">Hacker News</span>\n            <ul class=\"hn-nav-links\">\n                <li><a href=\"#\">new</a></li>\n                <li><a href=\"#\">past</a></li>\n                <li><a href=\"#\">comments</a></li>\n                <li><a href=\"#\">ask</a></li>\n                <li><a href=\"#\">show</a></li>\n                <li><a href=\"#\">jobs</a></li>\n                <li><a href=\"#\">submit</a></li>\n            </ul>\n            <div class=\"hn-auth\">\n                <a href=\"https://news.ycombinator.com/login\" target=\"_blank\">login</a>\n            </div>\n        </nav>\n    </header>\n\n    <main class=\"hn-main\">\n        <ol class=\"hn-story-list\">\n            \n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">1.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">Show HN: A brand new Hacker News experience with Generative UI</a>\n                        <span class=\"hn-story-domain\">(github.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">150 points</span> by\n                        <span class=\"hn-story-author\">generative_hacker</span>\n                        <span class=\"hn-story-time\">2 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">2.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">New AI model released as open source</a>\n                        <span class=\"hn-story-domain\">(example.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">300 points</span> by\n                        <span class=\"hn-story-author\">ai_fan</span>\n                        <span class=\"hn-story-time\">4 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">3.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">Read the latest design system guidelines</a>\n                        <span class=\"hn-story-domain\">(design.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">215 points</span> by\n                        <span class=\"hn-story-author\">design_geek</span>\n                        <span class=\"hn-story-time\">5 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n        </ol>\n        \n        <button class=\"hn-load-more\">More</button>\n    </main>\n\n    <footer class=\"hn-footer\">\n        <ul class=\"hn-footer-links\">\n            <li><a href=\"#\">Guidelines</a></li>\n            <li><a href=\"#\">FAQ</a></li>\n            <li><a href=\"#\">Lists</a></li>\n            <li><a href=\"#\">API</a></li>\n            <li><a href=\"#\">Security</a></li>\n            <li><a href=\"#\">Legal</a></li>\n            <li><a href=\"#\">Apply to YC</a></li>\n            <li><a href=\"#\">Contact</a></li>\n        </ul>\n    </footer>\n    <script src=\"gardener.js\"></script>\n</body>\n</html>","numLines":119,"startLine":1,"totalLines":119}},"sourceToolAssistantUUID":"0bede5fe-ec88-4d9d-ab9d-d6fe98436673"}
{"parentUuid":"acbf03ce-f09f-406c-91a5-60dc8fd198a2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01RfqR2CqfzDbTUUvx2XjAqf","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a complete picture of the codebase. Let me design the \"Paste CSS\" feature.\n\nThe control panel layout (from top to bottom):\n1. Presets toggle + preset buttons (in HTML)\n2. Prompt input + Apply button (in HTML)\n3. Save as Preset row (dynamically added after generate)\n4. API Key section (dynamically appended at end of themeControls)\n\nWhat I need to add:\n- A collapsible \"Paste CSS\" section, similar in style to the API Key section\n- It should have:\n  - A toggle header (like \"External AI CSS\" or \"Paste CSS\")\n  - A collapsed state showing just the label\n  - When expanded: a textarea for pasting CSS, an Apply button, and an optional name input for saving as a preset\n  - When applied, it calls `applyStyle(css, null, 'Custom CSS')` and shows the Save as Preset button\n\nI'll add this section between or after the API Key section by creating a new `renderPasteCssSection()` method that gets called after `renderApiKeySection()` in the initialization.\n\nNow I'm designing the UI to match the existing collapsed section style with a \"Paste CSS\" label, and when expanded it'll show a textarea with a placeholder mentioning external AI sources, the Apply button, and an optional name input for the theme. I'll position this right after the API key section since they're both related to external integrations.\n\nWriting the implementation... Building the form layout... I'm setting up the event listener for the Apply button to grab the CSS input and optional name, then call `applyStyle()` with the custom name and trigger the preset UI updates. Now I need to integrate this with the \"Save as Preset\" flow by checking how `applyStyle()` handles the custom prompt parameter and stores it in localStorage. I'm checking whether I need a divider between the API key and CSS sections, but looking at the existing design, sections just rely on spacing rather than explicit dividers—the parent container's gap already handles the visual separation.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2672,"cache_read_input_tokens":40280,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2672},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXrBNrrJaNZaje1VBcM","type":"assistant","uuid":"1ec1dbb3-27bb-43b3-991b-17c3e849af80","timestamp":"2026-02-23T06:32:51.864Z"}
{"parentUuid":"1ec1dbb3-27bb-43b3-991b-17c3e849af80","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01RfqR2CqfzDbTUUvx2XjAqf","type":"message","role":"assistant","content":[{"type":"text","text":"パネルのCSSスタイルも確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2672,"cache_read_input_tokens":40280,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2672},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXrBNrrJaNZaje1VBcM","type":"assistant","uuid":"5dc20831-2787-403f-a60f-8d55e84da002","timestamp":"2026-02-23T06:32:51.877Z"}
{"parentUuid":"5dc20831-2787-403f-a60f-8d55e84da002","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01RfqR2CqfzDbTUUvx2XjAqf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CtHD6PW9aH6vjhNFj9KgAE","name":"Grep","input":{"pattern":"theme-controls|panel-handle|PANEL_STYLE","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":3,"head_limit":80},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2672,"cache_read_input_tokens":40280,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2672},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXrBNrrJaNZaje1VBcM","type":"assistant","uuid":"911009db-90df-4c47-b5ff-d68011a76636","timestamp":"2026-02-23T06:32:53.560Z"}
{"parentUuid":"911009db-90df-4c47-b5ff-d68011a76636","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01CtHD6PW9aH6vjhNFj9KgAE","toolUseID":"toolu_01CtHD6PW9aH6vjhNFj9KgAE","timestamp":"2026-02-23T06:32:53.930Z","uuid":"f61f8336-8962-4a9b-8d5a-fa68e7a76257"}
{"parentUuid":"911009db-90df-4c47-b5ff-d68011a76636","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CtHD6PW9aH6vjhNFj9KgAE","type":"tool_result","content":"366-    }\n367-\n368-    /* --- Control Panel (Glassmorphism) --- */\n369:    #theme-controls { \n370-        view-transition-name: theme-ui;\n371-        position: fixed; \n372-        bottom: 20px; \n--\n390-        -webkit-backdrop-filter: saturate(180%) blur(30px);\n391-        transition: all 0.3s;\n392-    }\n393:    #theme-controls input {\n394-        background: var(--bg);\n395-        color: var(--text);\n396-        border: 1px solid var(--subtext);\n--\n400-        flex: 1;\n401-        opacity: 0.8;\n402-    }\n403:    #theme-controls button {\n404-        background: rgba(0,0,0,0.05);\n405-        color: var(--text);\n406-        border: 1px solid rgba(0,0,0,0.1);\n--\n410-        font-weight: 500;\n411-        transition: 0.2s;\n412-    }\n413:    #theme-controls #generate-btn {\n414-        background: var(--accent) !important;\n415-        color: #fff;\n416-        border: none;\n--\n429-    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n430-\n431-    /* --- Desktop Panel Toggle (Drag Handle) --- */\n432:    #panel-handle { display: none; }\n433-    @media (min-width: 769px) {\n434:        #panel-handle {\n435-            display: block; position: absolute; top: 0; left: 0;\n436-            width: 20px; height: 100%;\n437-            background: transparent;\n--\n439-            z-index: 20;\n440-        }\n441-        /* Visual cue */\n442:        #panel-handle::before {\n443-            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n444-            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n445-            transition: 0.2s;\n446-        }\n447:        #panel-handle:hover::before { opacity: 0.4; }\n448-        \n449:        #theme-controls { \n450-            padding-left: 20px; \n451-            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n452-        }\n453:        #theme-controls.is-minimized {\n454-            transform: translateX(calc(100% - 20px));\n455-        }\n456:        #theme-controls.is-minimized > *:not(#panel-handle) {\n457-            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n458-        }\n459-    }\n--\n530-        }\n531-\n532-        /* Mobile Control Panel */\n533:        #theme-controls {\n534-            bottom: 20px; right: 20px; width: auto;\n535-            max-width: calc(100vw - 40px);\n536-            padding: 15px;\n--\n553- * Contains just the control panel styles + the minimal :root variables\n554- * they depend on, so the panel renders correctly with no other CSS loaded.\n555- */\n556:const PANEL_STYLE = `\n557-    :root {\n558-        --bg: #ffffff; --text: #333333; --subtext: #888888;\n559-        --accent: #007aff; --card-bg: #ffffff;\n--\n\n[Showing results with pagination = limit: 80, offset: 0]"}]},"uuid":"cbf9421f-f078-47c3-b0f4-6b8c355d9f1c","timestamp":"2026-02-23T06:32:53.928Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"366-    }\n367-\n368-    /* --- Control Panel (Glassmorphism) --- */\n369:    #theme-controls { \n370-        view-transition-name: theme-ui;\n371-        position: fixed; \n372-        bottom: 20px; \n--\n390-        -webkit-backdrop-filter: saturate(180%) blur(30px);\n391-        transition: all 0.3s;\n392-    }\n393:    #theme-controls input {\n394-        background: var(--bg);\n395-        color: var(--text);\n396-        border: 1px solid var(--subtext);\n--\n400-        flex: 1;\n401-        opacity: 0.8;\n402-    }\n403:    #theme-controls button {\n404-        background: rgba(0,0,0,0.05);\n405-        color: var(--text);\n406-        border: 1px solid rgba(0,0,0,0.1);\n--\n410-        font-weight: 500;\n411-        transition: 0.2s;\n412-    }\n413:    #theme-controls #generate-btn {\n414-        background: var(--accent) !important;\n415-        color: #fff;\n416-        border: none;\n--\n429-    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n430-\n431-    /* --- Desktop Panel Toggle (Drag Handle) --- */\n432:    #panel-handle { display: none; }\n433-    @media (min-width: 769px) {\n434:        #panel-handle {\n435-            display: block; position: absolute; top: 0; left: 0;\n436-            width: 20px; height: 100%;\n437-            background: transparent;\n--\n439-            z-index: 20;\n440-        }\n441-        /* Visual cue */\n442:        #panel-handle::before {\n443-            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n444-            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n445-            transition: 0.2s;\n446-        }\n447:        #panel-handle:hover::before { opacity: 0.4; }\n448-        \n449:        #theme-controls { \n450-            padding-left: 20px; \n451-            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n452-        }\n453:        #theme-controls.is-minimized {\n454-            transform: translateX(calc(100% - 20px));\n455-        }\n456:        #theme-controls.is-minimized > *:not(#panel-handle) {\n457-            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n458-        }\n459-    }\n--\n530-        }\n531-\n532-        /* Mobile Control Panel */\n533:        #theme-controls {\n534-            bottom: 20px; right: 20px; width: auto;\n535-            max-width: calc(100vw - 40px);\n536-            padding: 15px;\n--\n553- * Contains just the control panel styles + the minimal :root variables\n554- * they depend on, so the panel renders correctly with no other CSS loaded.\n555- */\n556:const PANEL_STYLE = `\n557-    :root {\n558-        --bg: #ffffff; --text: #333333; --subtext: #888888;\n559-        --accent: #007aff; --card-bg: #ffffff;\n--","numLines":80,"appliedLimit":80},"sourceToolAssistantUUID":"911009db-90df-4c47-b5ff-d68011a76636"}
{"parentUuid":"cbf9421f-f078-47c3-b0f4-6b8c355d9f1c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Cgxv7cKxtpfGFyXsVZASYL","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a full picture. Let me implement the \"Paste CSS\" section. I'll:\n\n1. Add a `renderPasteCssSection()` method to the `App` object in `gardener.js`\n2. Call it from `init()` after `renderApiKeySection()`\n\nThe section will:\n- Be collapsible (like the API key section)\n- Have a textarea for pasting CSS\n- Have an optional theme name input\n- Have an Apply button\n- When applied, use `applyStyle()` and show the \"Save as Preset\" button\n\nLet me look at where exactly `init()` is to add the call there.","signature":"EpoFCkYICxgCKkBLwggZZGW6FgZfx3tsK/4NEJXNnfWRXjP3A79gPkwSnnTxD4Zfw4no8MQiL3cALjsrASh3PyJhhPazAHv3UQLpEgynKThT1oHk2HSyhooaDJn9J23Y0cKm0O1EVSIweGpZYkXH6ovF89iJ0sf2v590BBF6sd8GZZICgw0+aQY2dpH8fkyGS4LsVZ/q6AJcKoEEHXh2vInpAbbuktIrhGHqv9c+g1I8cqmfvB/Ii3GP4eGFCoPGgOUMzpG3TLmwJod4VHKNmLhwwPhJdZa2yah6teuFthlAk+L+v1a6abqbcnuRTGExHeK3Mntbo5/IZ7mVDVo6+LlM8zc/yL7AEQIDrFdmTjXkgAfoAu5ZxJ6hV44hT/jCy358I3yALcEkVjtip7j3FUkfOiiUdjTbt1wfokOM60Q3OZpu+NB9vqsWAdSbauompDuNuUTb5rm7DeE6wf6lra8Q64L1W/ToopsZw7wgo5opTvzERT5OjxS7/R5cS/6sR2w9ow7JlW97G4AWCVvSikVSU77+vq9ervz0yMMiAWiNPN+QtwxOX9v8LXw5BrJjiZD4njBgEmwc8cgG8NxOtw59prnA91n9mB5vwzD3caA4DEGOcaqQLnZUtBOZ4EtrtnAAGXduM9YSV9WUoRml3X6lrLjKCDiPbG2oy0Kb2MpKlIe1H7pDb6JOmkazxWFRLq0No/812j134GDL4MPla27WpoVHjHMrpNOhiSXIbv1msSiDlQI3ll9M8MCrySiYLgYFjLgL8qqzAwoY9YhNRmb28RW94rdvfJq5VHnYt+PAm7l4YRtu6hcx2f5KrFO60nfZH31sK07xJh7Rfwbdbb50jTMJfi5FfzyaDvZ8P2F3ECWLaahLGohyloWbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2804,"cache_read_input_tokens":42952,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2804},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXtRUEoXGMMBJArZYDP","type":"assistant","uuid":"7c254867-c44f-4025-932f-a90d0921a821","timestamp":"2026-02-23T06:32:58.845Z"}
{"parentUuid":"7c254867-c44f-4025-932f-a90d0921a821","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Cgxv7cKxtpfGFyXsVZASYL","type":"message","role":"assistant","content":[{"type":"text","text":"全体像が把握できました。実装します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2804,"cache_read_input_tokens":42952,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2804},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXtRUEoXGMMBJArZYDP","type":"assistant","uuid":"8d82e1f9-7585-438c-8379-cfa9fab71080","timestamp":"2026-02-23T06:32:59.549Z"}
{"parentUuid":"8d82e1f9-7585-438c-8379-cfa9fab71080","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Cgxv7cKxtpfGFyXsVZASYL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0171VXhRzDxU7PmkfSHpwo1J","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1378,"limit":10},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2804,"cache_read_input_tokens":42952,"output_tokens":285,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2804,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQXtRUEoXGMMBJArZYDP","type":"assistant","uuid":"5c9b5b52-c695-4aa6-80ea-8490d47e4b81","timestamp":"2026-02-23T06:33:00.778Z"}
{"parentUuid":"5c9b5b52-c695-4aa6-80ea-8490d47e4b81","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_0171VXhRzDxU7PmkfSHpwo1J","toolUseID":"toolu_0171VXhRzDxU7PmkfSHpwo1J","timestamp":"2026-02-23T06:33:00.801Z","uuid":"e5a44990-1452-4741-8da7-7cbed2dc3f12"}
{"parentUuid":"5c9b5b52-c695-4aa6-80ea-8490d47e4b81","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0171VXhRzDxU7PmkfSHpwo1J","type":"tool_result","content":"  1378→    async init() {\n  1379→        this.renderPresetButtons();\n  1380→        this.renderSavedThemeButtons();\n  1381→        this.renderApiKeySection();\n  1382→        this.bindEvents();\n  1383→\n  1384→        const savedPreset = localStorage.getItem('genhn-theme');\n  1385→        const savedCustom = localStorage.getItem('genhn-custom-css');\n  1386→        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n  1387→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a300a5da-6492-4dd6-aa75-4c0f03f77367","timestamp":"2026-02-23T06:33:00.800Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n","numLines":10,"startLine":1378,"totalLines":1918}},"sourceToolAssistantUUID":"5c9b5b52-c695-4aa6-80ea-8490d47e4b81"}
{"type":"file-history-snapshot","messageId":"64db32c5-5f7e-4521-813c-d57d8185b10f","snapshot":{"messageId":"1924bf99-1bcb-4c17-9f5f-bdc3364e5b8c","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v1","version":1,"backupTime":"2026-02-23T06:33:03.092Z"}},"timestamp":"2026-02-23T06:32:01.958Z"},"isSnapshotUpdate":true}
{"parentUuid":"a300a5da-6492-4dd6-aa75-4c0f03f77367","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01N5DjFZw6KELFNVJfUVdqZi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019rnB14b3YMD9sQoeUXtSC4","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();","new_string":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":513,"cache_read_input_tokens":45756,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":513},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXtvpay3f6xQapR5T49","type":"assistant","uuid":"64db32c5-5f7e-4521-813c-d57d8185b10f","timestamp":"2026-02-23T06:33:03.089Z"}
{"parentUuid":"64db32c5-5f7e-4521-813c-d57d8185b10f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_019rnB14b3YMD9sQoeUXtSC4","toolUseID":"toolu_019rnB14b3YMD9sQoeUXtSC4","timestamp":"2026-02-23T06:33:03.098Z","uuid":"53ad18ff-cf87-4a3c-b584-4ef37f9c64d1"}
{"parentUuid":"64db32c5-5f7e-4521-813c-d57d8185b10f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019rnB14b3YMD9sQoeUXtSC4","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"9ee1a327-5c22-43e9-b508-fd2584806084","timestamp":"2026-02-23T06:33:03.097Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();","newString":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1379,"oldLines":6,"newStart":1379,"newLines":7,"lines":["         this.renderPresetButtons();","         this.renderSavedThemeButtons();","         this.renderApiKeySection();","+        this.renderPasteCssSection();","         this.bindEvents();"," ","         const savedPreset = localStorage.getItem('genhn-theme');"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"64db32c5-5f7e-4521-813c-d57d8185b10f"}
{"parentUuid":"9ee1a327-5c22-43e9-b508-fd2584806084","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01TLmS6Ea7faKKTgGgAVw8SP","type":"message","role":"assistant","content":[{"type":"text","text":"次に `renderPasteCssSection()` メソッドを `renderApiKeySection()` の直後に追加します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":250,"cache_read_input_tokens":46269,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":250},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXu6ke2s1HKx1f62BB2","type":"assistant","uuid":"c4435e27-b03f-416e-8527-f1dbf88e74ce","timestamp":"2026-02-23T06:33:04.625Z"}
{"parentUuid":"c4435e27-b03f-416e-8527-f1dbf88e74ce","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01TLmS6Ea7faKKTgGgAVw8SP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WAYchB7LG94hvg6uvKRCQb","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {","new_string":"        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":250,"cache_read_input_tokens":46269,"output_tokens":917,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":250,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQXu6ke2s1HKx1f62BB2","type":"assistant","uuid":"3736cbce-20da-447b-b56b-688ad295bf42","timestamp":"2026-02-23T06:33:15.023Z"}
{"parentUuid":"3736cbce-20da-447b-b56b-688ad295bf42","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01WAYchB7LG94hvg6uvKRCQb","toolUseID":"toolu_01WAYchB7LG94hvg6uvKRCQb","timestamp":"2026-02-23T06:33:15.030Z","uuid":"e83417a9-00c1-4635-9923-f4cd0ff3d057"}
{"parentUuid":"3736cbce-20da-447b-b56b-688ad295bf42","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WAYchB7LG94hvg6uvKRCQb","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"75fc6fdc-b866-4517-a718-d6b415b37ed1","timestamp":"2026-02-23T06:33:15.029Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {","newString":"        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1724,"oldLines":6,"newStart":1724,"newLines":47,"lines":["         this.elements.themeControls.appendChild(section);","     },"," ","+    renderPasteCssSection() {","+        const existing = document.getElementById('paste-css-section');","+        if (existing) existing.remove();","+","+        const section = document.createElement('div');","+        section.id = 'paste-css-section';","+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';","+","+        section.innerHTML = `","+            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","+                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>","+                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","+            </div>","+            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">","+                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>","+                <div style=\"display:flex; gap:6px; align-items:center;\">","+                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">","+                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>","+                </div>","+            </div>`;","+","+        section.querySelector('#paste-css-toggle').addEventListener('click', () => {","+            const form = section.querySelector('#paste-css-form');","+            const icon = section.querySelector('#paste-css-icon');","+            const isOpen = form.style.display !== 'none';","+            form.style.display = isOpen ? 'none' : 'flex';","+            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';","+        });","+","+        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {","+            const css = section.querySelector('#paste-css-input').value.trim();","+            if (!css) return;","+            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';","+            this.applyStyle(css, null, name);","+            this.togglePresets(true);","+            this.renderSaveButton(true);","+        });","+","+        this.elements.themeControls.appendChild(section);","+    },","+","     showGenerateError(err) {","         let message;","         switch (err.message) {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"3736cbce-20da-447b-b56b-688ad295bf42"}
{"parentUuid":"75fc6fdc-b866-4517-a718-d6b415b37ed1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01LjpeV45xZ9eUtc5HkKUJaP","type":"message","role":"assistant","content":[{"type":"text","text":"動作確認のため、追加した部分を読み直します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":956,"cache_read_input_tokens":46519,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":956},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXuyaZWue4h4SbZVFXA","type":"assistant","uuid":"5cdebcfb-d90e-465f-97f1-4dca23887c41","timestamp":"2026-02-23T06:33:17.059Z"}
{"parentUuid":"5cdebcfb-d90e-465f-97f1-4dca23887c41","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01LjpeV45xZ9eUtc5HkKUJaP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GqzzQHVoBSHxJfGEP6U7eN","name":"Grep","input":{"pattern":"renderPasteCssSection","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":1},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":956,"cache_read_input_tokens":46519,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":956},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXuyaZWue4h4SbZVFXA","type":"assistant","uuid":"9a906e7a-7fae-4929-8912-226ca06ca08c","timestamp":"2026-02-23T06:33:17.970Z"}
{"parentUuid":"9a906e7a-7fae-4929-8912-226ca06ca08c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01GqzzQHVoBSHxJfGEP6U7eN","toolUseID":"toolu_01GqzzQHVoBSHxJfGEP6U7eN","timestamp":"2026-02-23T06:33:18.242Z","uuid":"075d88d4-0b8d-4720-b1e1-a6188b90198b"}
{"parentUuid":"9a906e7a-7fae-4929-8912-226ca06ca08c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GqzzQHVoBSHxJfGEP6U7eN","type":"tool_result","content":"1381-        this.renderApiKeySection();\n1382:        this.renderPasteCssSection();\n1383-        this.bindEvents();\n--\n1726-\n1727:    renderPasteCssSection() {\n1728-        const existing = document.getElementById('paste-css-section');"}]},"uuid":"49261215-3b71-4428-867c-3d88a5184efc","timestamp":"2026-02-23T06:33:18.241Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1381-        this.renderApiKeySection();\n1382:        this.renderPasteCssSection();\n1383-        this.bindEvents();\n--\n1726-\n1727:    renderPasteCssSection() {\n1728-        const existing = document.getElementById('paste-css-section');","numLines":7},"sourceToolAssistantUUID":"9a906e7a-7fae-4929-8912-226ca06ca08c"}
{"parentUuid":"49261215-3b71-4428-867c-3d88a5184efc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_0191HDfyY1vDn7F1MtzHp3Ym","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VFnT3rkeSDFvr1JDEW1pbD","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1727,"limit":45},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":234,"cache_read_input_tokens":47475,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":234},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXvDP2b3iPKS4rJqPJP","type":"assistant","uuid":"07582ef4-179d-40ec-89b8-b5df4be43863","timestamp":"2026-02-23T06:33:20.359Z"}
{"parentUuid":"07582ef4-179d-40ec-89b8-b5df4be43863","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01VFnT3rkeSDFvr1JDEW1pbD","toolUseID":"toolu_01VFnT3rkeSDFvr1JDEW1pbD","timestamp":"2026-02-23T06:33:20.404Z","uuid":"2651688d-5d41-4ba4-ae5a-85ab0491e08c"}
{"parentUuid":"07582ef4-179d-40ec-89b8-b5df4be43863","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VFnT3rkeSDFvr1JDEW1pbD","type":"tool_result","content":"  1727→    renderPasteCssSection() {\n  1728→        const existing = document.getElementById('paste-css-section');\n  1729→        if (existing) existing.remove();\n  1730→\n  1731→        const section = document.createElement('div');\n  1732→        section.id = 'paste-css-section';\n  1733→        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n  1734→\n  1735→        section.innerHTML = `\n  1736→            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1737→                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n  1738→                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n  1739→            </div>\n  1740→            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1741→                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n  1742→                <div style=\"display:flex; gap:6px; align-items:center;\">\n  1743→                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n  1744→                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n  1745→                </div>\n  1746→            </div>`;\n  1747→\n  1748→        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n  1749→            const form = section.querySelector('#paste-css-form');\n  1750→            const icon = section.querySelector('#paste-css-icon');\n  1751→            const isOpen = form.style.display !== 'none';\n  1752→            form.style.display = isOpen ? 'none' : 'flex';\n  1753→            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1754→        });\n  1755→\n  1756→        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n  1757→            const css = section.querySelector('#paste-css-input').value.trim();\n  1758→            if (!css) return;\n  1759→            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n  1760→            this.applyStyle(css, null, name);\n  1761→            this.togglePresets(true);\n  1762→            this.renderSaveButton(true);\n  1763→        });\n  1764→\n  1765→        this.elements.themeControls.appendChild(section);\n  1766→    },\n  1767→\n  1768→    showGenerateError(err) {\n  1769→        let message;\n  1770→        switch (err.message) {\n  1771→            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8eb37014-f9e4-4814-83d0-9aaa031930ae","timestamp":"2026-02-23T06:33:20.402Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;","numLines":45,"startLine":1727,"totalLines":1960}},"sourceToolAssistantUUID":"07582ef4-179d-40ec-89b8-b5df4be43863"}
{"parentUuid":"8eb37014-f9e4-4814-83d0-9aaa031930ae","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01EVKPnbzgSsSqSZVpDJZNNL","type":"message","role":"assistant","content":[{"type":"text","text":"問題ありません。変更内容をまとめます。\n\n---\n\n追加した機能：\n\n**コントロールパネル下部に \"PASTE CSS\" セクション**\n\n- Gemini API Key セクションと同じ折りたたみスタイル。初期状態は閉じた状態（▼ が90度回転）\n- クリックで展開すると：\n  - **textarea**（高さ100px、可変リサイズ）：`/* Paste CSS generated by ChatGPT, Claude, etc. */` をプレースホルダーとして表示\n  - **テーマ名入力欄**（任意）：省略時は `Custom CSS` として扱われる\n  - **Apply ボタン**：`applyStyle()` を呼び出し、View Transition 付きで即座に適用\n- 適用後は既存の **Save as Preset** ボタンが表示され、保存して再利用可能\n\n外部AIで生成したCSSをペーストして試す→気に入ったら名前をつけて保存、という流れで使えます。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1147,"cache_read_input_tokens":47709,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1147},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQXvQ8gZ8DvcNnLWjhi2","type":"assistant","uuid":"9f784442-8290-48df-8a47-7373258f05ea","timestamp":"2026-02-23T06:33:28.503Z"}
{"parentUuid":"9f784442-8290-48df-8a47-7373258f05ea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"deb7ce01-1ebf-477c-ac22-c1a6a812c1c9","toolUseID":"deb7ce01-1ebf-477c-ac22-c1a6a812c1c9","timestamp":"2026-02-23T06:33:28.628Z","uuid":"f903c683-c24c-4023-b14b-593940ddcacb"}
{"parentUuid":"f903c683-c24c-4023-b14b-593940ddcacb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":231}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:33:28.860Z","uuid":"e742943e-f1f0-4621-94bf-a28b23482a51","toolUseID":"deb7ce01-1ebf-477c-ac22-c1a6a812c1c9"}
{"parentUuid":"e742943e-f1f0-4621-94bf-a28b23482a51","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":86903,"timestamp":"2026-02-23T06:33:28.862Z","uuid":"4c8770c2-8612-473b-9881-fd2a8a8184a7","isMeta":false}
{"type":"file-history-snapshot","messageId":"c3b6ced8-c8ef-42fe-95fa-824c555222a9","snapshot":{"messageId":"c3b6ced8-c8ef-42fe-95fa-824c555222a9","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v2","version":2,"backupTime":"2026-02-23T06:35:21.615Z"}},"timestamp":"2026-02-23T06:35:21.614Z"},"isSnapshotUpdate":false}
{"parentUuid":"4c8770c2-8612-473b-9881-fd2a8a8184a7","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"プレースホルダーに、必要な構造のCSSの事例を入れてもっとフォーマットをわかりやすくしてください。"},"uuid":"c3b6ced8-c8ef-42fe-95fa-824c555222a9","timestamp":"2026-02-23T06:35:21.471Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"c3b6ced8-c8ef-42fe-95fa-824c555222a9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01D9r83d6nA7riqzsinZ5UFT","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to improve the placeholder text in the CSS textarea to show an example of the CSS structure that's expected. Let me first look at what a theme CSS looks like in STYLE_PRESETS to understand the format.","signature":"EoADCkYICxgCKkCZ35XXs8/XvWv61nCr/ZR3KcNt1e6veRkZYhWxPHgcKSfWpoflkSWkqW+WwckEsXB4Bz716nZ1eRDLRJssxajsEgx9qD9PtB3tLQ6yrOoaDGfpA7uUKHSBtMDWKiIwtUcXCjvrVnz/HAVPcg6VmgvgB/gJfBVcBfzx1LlaRgxi9fsWPVQsPHH4JzdvADjZKucBaTO4LTfRAcdm5Kr5Fef+1J8dB+NScJ5qBnVdBSOSYl0NOpZ7k32LooS4yP+xGlxN0FCzmbabsjDms6CP3dG04Wu9l2hTuAtzQkaUcVaDfysEIVK4XEAqXOoC+OaHp+aT2KyN47f0aTdK+JURRdDBBFwHXA5dwlYPvbPuKpkpVkG/Wc62yOrV/ph0khuyr+r/j6YLVbe1V7uZ9NyIccuTZz9ey1Ao4diz2Y895kY9kGewg68wAWoCXfSiLNc9yGQeBCSju9XugR2rJ2Uw5z+m/9EvKzdmRR9AIAxRtWhXUapV0Pjv3nm6GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":46,"cache_read_input_tokens":49153,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":46},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY5Jveboxm4sQFUaHuM","type":"assistant","uuid":"1eb3f46a-49ac-475d-9397-5abf6b12ef4c","timestamp":"2026-02-23T06:35:24.101Z"}
{"parentUuid":"1eb3f46a-49ac-475d-9397-5abf6b12ef4c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01D9r83d6nA7riqzsinZ5UFT","type":"message","role":"assistant","content":[{"type":"text","text":"既存テーマのCSS構造を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":46,"cache_read_input_tokens":49153,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":46},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY5Jveboxm4sQFUaHuM","type":"assistant","uuid":"5c8ef408-890c-4d4f-8a81-4d2d431d929f","timestamp":"2026-02-23T06:35:24.610Z"}
{"parentUuid":"5c8ef408-890c-4d4f-8a81-4d2d431d929f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01D9r83d6nA7riqzsinZ5UFT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Hv48TDeTAdrBestbtacQGJ","name":"Grep","input":{"pattern":"STYLE_PRESETS","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":2,"head_limit":10},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":46,"cache_read_input_tokens":49153,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":46},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY5Jveboxm4sQFUaHuM","type":"assistant","uuid":"17cad928-2f35-4624-ac9b-db36784dbe45","timestamp":"2026-02-23T06:35:26.535Z"}
{"parentUuid":"17cad928-2f35-4624-ac9b-db36784dbe45","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01Hv48TDeTAdrBestbtacQGJ","toolUseID":"toolu_01Hv48TDeTAdrBestbtacQGJ","timestamp":"2026-02-23T06:35:26.851Z","uuid":"8360522a-87e0-409c-8324-252ada53606e"}
{"parentUuid":"17cad928-2f35-4624-ac9b-db36784dbe45","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Hv48TDeTAdrBestbtacQGJ","type":"tool_result","content":"630- * Define variables and minimal specific overrides.\n631- */\n632:const STYLE_PRESETS = {\n633-    \"None\": \"\",\n634-\n--\n1393-            this.renderSaveButton(!alreadySaved);\n1394-        } else {\n1395:            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n1396:            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n[Showing results with pagination = limit: 10, offset: 0]"}]},"uuid":"8c306ae0-7e1d-4ac4-9d0f-7e4b5fa8af59","timestamp":"2026-02-23T06:35:26.849Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"630- * Define variables and minimal specific overrides.\n631- */\n632:const STYLE_PRESETS = {\n633-    \"None\": \"\",\n634-\n--\n1393-            this.renderSaveButton(!alreadySaved);\n1394-        } else {\n1395:            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n1396:            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);","numLines":10,"appliedLimit":10},"sourceToolAssistantUUID":"17cad928-2f35-4624-ac9b-db36784dbe45"}
{"parentUuid":"8c306ae0-7e1d-4ac4-9d0f-7e4b5fa8af59","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01XrUkZFb7rrZw3fRMPSsJ5v","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01T51kDS5xw5Gij4DdPfMVHg","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":632,"limit":100},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":504,"cache_read_input_tokens":49199,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":504},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY5hJYeGnHMHwtmEa6u","type":"assistant","uuid":"45978d86-40a3-4865-a480-2a35fe7574d2","timestamp":"2026-02-23T06:35:29.791Z"}
{"parentUuid":"45978d86-40a3-4865-a480-2a35fe7574d2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01T51kDS5xw5Gij4DdPfMVHg","toolUseID":"toolu_01T51kDS5xw5Gij4DdPfMVHg","timestamp":"2026-02-23T06:35:29.831Z","uuid":"7ceeb701-d0db-45e9-8016-60dcb35d0fbb"}
{"parentUuid":"45978d86-40a3-4865-a480-2a35fe7574d2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01T51kDS5xw5Gij4DdPfMVHg","type":"tool_result","content":"   632→const STYLE_PRESETS = {\n   633→    \"None\": \"\",\n   634→\n   635→    \"Minimalist\": `\n   636→        :root {\n   637→            --bg: #f5f5f7;\n   638→            --card-bg: #ffffff;\n   639→            --text: #1d1d1f;\n   640→            --subtext: #86868b;\n   641→            --accent: #0066cc;\n   642→            --header-bg: rgba(251, 251, 253, 0.8);\n   643→            \n   644→            /* Mobile */\n   645→            --mobile-upvote-bg: #e8e8ed;\n   646→            --mobile-upvote-radius: 50%;\n   647→\n   648→            /* More Button */\n   649→            --more-btn-bg: var(--accent);\n   650→            --more-btn-color: #fff;\n   651→        }\n   652→        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n   653→        .hn-header { \n   654→            background: rgba(255, 255, 255, 0.7); \n   655→            border: 0.5px solid rgba(0,0,0,0.05);\n   656→            backdrop-filter: saturate(180%) blur(20px);\n   657→            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n   658→            margin: 12px 20px;\n   659→            border-radius: 100px;\n   660→            height: 50px;\n   661→            top: 12px;\n   662→        }\n   663→        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n   664→        .hn-logo { \n   665→            text-transform: uppercase; \n   666→            letter-spacing: 0.2em; \n   667→            font-size: 14px; \n   668→            font-weight: 300;\n   669→            color: #000;\n   670→        }\n   671→        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n   672→        #theme-controls #generate-btn { background: var(--accent) !important; }\n   673→    `,\n   674→\n   675→    \"Glitch\": `\n   676→        :root {\n   677→            --bg: #050a0e;\n   678→            --card-bg: rgba(5, 10, 14, 0.9);\n   679→            --text: #fcee0a; /* Yellow */\n   680→            --subtext: #00f0ff; /* Blue */\n   681→            --accent: #ff003c; /* Pink */\n   682→            --header-bg: var(--text);\n   683→            --font-main: sans-serif;\n   684→            \n   685→            /* Mobile */\n   686→            --mobile-upvote-bg: var(--accent);\n   687→            --mobile-upvote-color: #fff;\n   688→            --mobile-upvote-radius: 0;\n   689→\n   690→            /* More Button */\n   691→            --more-btn-bg: var(--text);\n   692→            --more-btn-color: #000;\n   693→        }\n   694→        \n   695→        body { text-transform: uppercase; }\n   696→        body::before {\n   697→            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n   698→            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n   699→            pointer-events: none; z-index: 1000;\n   700→        }\n   701→        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n   702→        .hn-header.is-open-active { clip-path: none; }\n   703→        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n   704→        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n   705→        .hn-story-item { \n   706→            border: 2px solid var(--subtext);\n   707→            background: rgba(255, 0, 60, 0.05);\n   708→            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n   709→        }\n   710→        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n   711→        .hn-upvote { \n   712→            background: var(--accent); color: #fff; border: none; border-radius: 0; \n   713→            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n   714→            padding: 0 10px; width: auto;\n   715→        }\n   716→        /* Override Common Apply Button for visibility */\n   717→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   718→    `,\n   719→\n   720→    \"Playful\": `\n   721→        :root {\n   722→            --red: #e60012;\n   723→            --blue: #00a0e9;\n   724→            --bg: #eee;\n   725→            --card-bg: #fff;\n   726→            --text: #333;\n   727→            --subtext: #8c8c8c;\n   728→            --accent: var(--blue);\n   729→            --header-bg: var(--red);\n   730→            \n   731→            /* Mobile */\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4a47cc1f-8e00-4991-b1f5-2b0a9b3421ec","timestamp":"2026-02-23T06:35:29.829Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"const STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */","numLines":100,"startLine":632,"totalLines":1960}},"sourceToolAssistantUUID":"45978d86-40a3-4865-a480-2a35fe7574d2"}
{"parentUuid":"4a47cc1f-8e00-4991-b1f5-2b0a9b3421ec","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_0199PWmkrPkkL9ZRVRAbkneq","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I understand the CSS structure well. The themes use:\n1. `:root { }` with CSS custom properties:\n   - `--bg`, `--card-bg`, `--text`, `--subtext`, `--accent`, `--header-bg`, `--font-main`\n   - `--mobile-upvote-bg`, `--mobile-upvote-color`, `--mobile-upvote-radius`\n   - `--more-btn-bg`, `--more-btn-color`\n2. Optional component-level overrides for classes like `.hn-header`, `.hn-logo`, `.hn-story-item`, etc.\n\n\nI need to create a placeholder example that demonstrates the key variables and a few component overrides in plain text format, since textarea placeholders don't support formatting—they'll just show as plain text when empty.\n\nWriting the CSS placeholder...","signature":"EsAPCkYICxgCKkBdXS0kvM2adYoQyVqRlqMZWRw3G9rXfxUSsmCF3xcp0Tain1OW5Xi9QlTgqFTmalZKlBcz9wGJc+p1AFSKkKOqEgwxbibfbFpAkkPEcSgaDCsGnJwDPLLU+oV+GSIwpTOQBGN7e0lLLsJZozzMoTBdDS/N6CL2yFAdeTrDYyryrBSjthII+rArLsqNnK2qKqcOWVCjqZOnP9J4S84sM6vpYiVgn4CI0ecHbgi0qzdDiy5Esl7aq4kFypv0glJmgbxiJ/+q5XGGQvjikd8dJ+g2+RPWKoHZ5BgXBfhmhqkRvY74EQ/Ex7hTRswfIJQkJLNfmPLjZlkKQEt3I0U0Ftar7KHnGWNivE/kgb6BXe98PnBb1t8ipC/j6BwBriTr0J5j8s271W/D/BNpQesxCeWx83wPE8vhAbeduU5jhfoKZJNcHBS8DTKAGQorTlVzwFe7Vunk/IMT0mVwoOnNbdvK8nQzSMEM7VYX1hlzPEVoExn5hVzS0moBg1GS9+gbxct/LxQe8wg/Ge9su93uBIA5yU5tOBzfMnrVLgvoQhV7LNgzHCR4UmUiis78OxrteQ3vA0dvBzzQkBGbYONhZvHjeqmkqDx5vkYYGgtDd+APKIAQ28Iynfm2OHGXQnGkbpRv/3czfTZMxb714XYKJbbBUqhaTs4Qb+ZIEs7SDyXvGiVzQmdS7SBfWgxkIt9HGxezBg+1sjUWAxsNEQQIChRUvgqqEutwsyZ1Z7g/8P9TNnuhd7mMspRv25h5QqUrd8f3AbTe/dOV+Zbu4dQ1ILBbd67umMr8Ru6dLqNxWk6fT9ekgnmfWdXsOEESXKws2ovcTiWKhgFiuQf8l1okFR5dky2PEgKLj+8fxPGBpcYXGHbTIfTBV3NZiIT+RlSeOHaX672oNnt3E0FY1DEFSNlkR1H2+ni0CXmsCb1IOyszsaQDGUrQFjsiOG3Q+UBfE/7zFo3BRyIO7QbpcPDrfCkDk2F6yxCClIyrV/KYV+nJAxG3ZrdWqTiiA9UysPFff8byq0zv9s125AWQ0lpOHNwtbVHh6GNqHUQLnpgWeh7HtPWCmH9/S9ay7GIhXoDKeghOVpaCqyVrWkRN+WN3L6CCV+aPNkdrAUJjarPhCLR2V4mBTHuV+aGmwBEdYrt1zlRr5ejTHCnwgBhkauJu0ewgY6aTJd5XaTscPL6bPaeS1N3ZZq/M79PU4c7KmQ1a22BM2kbtFvNeU4KtdyKt5S+tdLFqACzanC5fEwI/CQFNkExSswN7EZndI5sfkOcvRGaMWLz9AovYwD5/z92mNoO61AFuBYeb14OoIDlMwIPx+1Yb5i6avzK75wG8OSz9tNYxlwNtcYb798UndM/DDURuxdzk5Ww6MlvFNi/TLMEHjyu5wYnxvWc7hl06/b8uj+JzqZVEH/OrZfeJYa1GIe1xW+r428BDtv2OFcDg05SNQmkeStju5HE0BIE0q+HNOOSPvVoQa4pxfvRtnWDURNbyHjwdw46tYLhYw+vVo8m6vv7WY1yzpoCk0zlJoY4xJvseD5wRoULUMxUq7pfwTYL2lEUPioz7vlqCuFSTqu1q5R38zyo8op7iQCgDOqB9IQHmVv4n4yvc6kR9TIgJDeO4H3a9ogTvZIUmAoGQhlbMnasCSqesWpBC2tZa+z9SqjUxEv/Jep8kGgk/0LeD/xPJhW29jR8mxohhFiRvDzbIsW1PLa7qjEf91l0TdMVr/DqW+XrjH3d87TfMWuliZY3oNxsVVChO83YjnsNaAp6ZiFvYPYHqAS3Et2mM4X7CWShzotjOcFMmPQ5EBdpvkPrWo7pIFornonG9JrWf1SblBOt8v2DuMwbvyfcCfMWT0buD8uxXmslbfgOoTwIuHffFX0Lsm0tuQeBlnDQksmc7cawj2dXXRzlJIoLVfuRoa+xwc7sciGGPc96pEoZtQK3qs+Fviwkszrcd2WUyDCmFBhy3LJNZoUpUJRY+wUcPdDTHhyml/pKMlmFN9Z56Y3G66BUv7vESDMhcJ9RAYgzB0NR1rE3rsST8a40a4BF5OTLQ5DCC3uKJEMOhL2hvqbF92DmdyXI7bDxs2v+e+tYt2Yc8+h8Z2j+N05nTMFeiagc0Kfrx7OtzJ+4fDftdcUZkwuowbq3TW/+pYhPZlZSciiVYi+nm/x3FtZcGkGswYxDj8eZyckSxw3MUgWHXM8Ar1ZJMApE2CM5VTWT70Gp2/ItyX62TsoI8w8pGjwf4b6MOLy/4sVKeYWnr4tjrbGKs9hQNCzTFsbi6XKhsH7of5CqAfFR7Cngd0hwuVSwi34tn8mvVZdoWVj+QvI0siVBeWT382vSZ/6mg13eBi4UZuEOpo9962sdefU9VECL6HS+3PfFSH8dVsDk19lBPZqxRy0l6A39TI83YeHKtIsrNafCBPKyOUw+niSRopEVmBgVmK7G/H1+ZwJCepCXSjFi8AnuQW8So3bBK2vOzkFp1Tkst9x8w2VccUZB8YGkThuc1ocCjXUanKz+hWWY2MWu9h9Bv1nKSgcjaClAHOjrvUn1xKb+3fp6EwCfs6rpPtdSkg4/Sg++4MlyiyQ0TTNrCkT1ngUnEVDRWX0WCy0VT0XyrQ1mFqf3sKtEWpyNtshFY78Q8OJw2chgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1848,"cache_read_input_tokens":49703,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1848},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY5uy3onjZppDxgTNV9","type":"assistant","uuid":"43f00fb1-2dee-4d4e-afe0-58ae75c7ef8b","timestamp":"2026-02-23T06:35:41.443Z"}
{"parentUuid":"43f00fb1-2dee-4d4e-afe0-58ae75c7ef8b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_0199PWmkrPkkL9ZRVRAbkneq","type":"message","role":"assistant","content":[{"type":"text","text":"使われているCSS変数をすべて把握します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1848,"cache_read_input_tokens":49703,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1848},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY5uy3onjZppDxgTNV9","type":"assistant","uuid":"3846d579-8127-460c-9416-8439459074d2","timestamp":"2026-02-23T06:35:41.853Z"}
{"parentUuid":"3846d579-8127-460c-9416-8439459074d2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_0199PWmkrPkkL9ZRVRAbkneq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013DSzproqKdQvkS45p4eag8","name":"Grep","input":{"pattern":"var\\(--","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","head_limit":60},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1848,"cache_read_input_tokens":49703,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1848},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY5uy3onjZppDxgTNV9","type":"assistant","uuid":"2940dfce-f44b-4930-9e8a-6fe1f00dcd6d","timestamp":"2026-02-23T06:35:43.359Z"}
{"parentUuid":"2940dfce-f44b-4930-9e8a-6fe1f00dcd6d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_013DSzproqKdQvkS45p4eag8","toolUseID":"toolu_013DSzproqKdQvkS45p4eag8","timestamp":"2026-02-23T06:35:43.672Z","uuid":"31d5a54e-98bb-413a-be79-c04d065b1a86"}
{"parentUuid":"2940dfce-f44b-4930-9e8a-6fe1f00dcd6d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013DSzproqKdQvkS45p4eag8","type":"tool_result","content":"74:           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n94:  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n111:Glow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\n115:Press hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n118:Float rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\n124:Masthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\n126:Stripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\n127:Ambient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n197:        --more-btn-bg: var(--text);\n198:        --more-btn-color: var(--bg);\n216:        background: var(--bg);\n217:        color: var(--text);\n218:        font-family: var(--font-main);\n232:        background: var(--header-bg);\n233:        border-bottom: var(--header-border);\n236:        height: var(--header-height);\n255:        color: var(--accent);\n259:    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n260:    .hn-nav-links a:hover { color: var(--text); }\n261:    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n275:        gap: var(--story-gap);\n281:        background: var(--item-bg, var(--card-bg));\n282:        border: var(--item-border);\n283:        border-radius: var(--item-radius);\n284:        padding: var(--item-padding);\n285:        box-shadow: var(--item-shadow);\n289:        gap: var(--item-gap);\n290:        transition: var(--item-transition);\n296:        color: var(--subtext);\n304:        font-size: var(--title-size);\n306:        color: var(--text);\n310:    .hn-story-title:hover { color: var(--accent); }\n311:    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n312:    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n318:        border: 1px solid var(--subtext);\n319:        color: var(--subtext);\n320:        width: var(--upvote-size);\n321:        height: var(--upvote-size);\n332:        border-color: var(--accent);\n333:        color: var(--accent);\n342:        background: var(--more-btn-bg);\n343:        color: var(--more-btn-color);\n345:        border-radius: var(--load-more-radius);\n354:        border-top: 1px solid var(--header-border);\n357:        color: var(--subtext);\n358:        background: var(--bg);\n384:        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n385:        color: var(--text);\n387:        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n394:        background: var(--bg);\n395:        color: var(--text);\n396:        border: 1px solid var(--subtext);\n405:        color: var(--text);\n414:        background: var(--accent) !important;\n470:            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n498:            background: var(--mobile-rank-bg, transparent);\n499:            border: var(--mobile-rank-border, none);\n500:            padding: var(--mobile-rank-padding, 0);\n501:            border-radius: var(--mobile-rank-radius, 0);\n502:            opacity: var(--mobile-rank-opacity, 0.5);\n\n[Showing results with pagination = limit: 60, offset: 0]"}]},"uuid":"45a1d5e4-70a9-4b25-aef4-6fb9772f1aff","timestamp":"2026-02-23T06:35:43.671Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"74:           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n94:  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n111:Glow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\n115:Press hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n118:Float rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\n124:Masthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\n126:Stripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\n127:Ambient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n197:        --more-btn-bg: var(--text);\n198:        --more-btn-color: var(--bg);\n216:        background: var(--bg);\n217:        color: var(--text);\n218:        font-family: var(--font-main);\n232:        background: var(--header-bg);\n233:        border-bottom: var(--header-border);\n236:        height: var(--header-height);\n255:        color: var(--accent);\n259:    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n260:    .hn-nav-links a:hover { color: var(--text); }\n261:    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n275:        gap: var(--story-gap);\n281:        background: var(--item-bg, var(--card-bg));\n282:        border: var(--item-border);\n283:        border-radius: var(--item-radius);\n284:        padding: var(--item-padding);\n285:        box-shadow: var(--item-shadow);\n289:        gap: var(--item-gap);\n290:        transition: var(--item-transition);\n296:        color: var(--subtext);\n304:        font-size: var(--title-size);\n306:        color: var(--text);\n310:    .hn-story-title:hover { color: var(--accent); }\n311:    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n312:    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n318:        border: 1px solid var(--subtext);\n319:        color: var(--subtext);\n320:        width: var(--upvote-size);\n321:        height: var(--upvote-size);\n332:        border-color: var(--accent);\n333:        color: var(--accent);\n342:        background: var(--more-btn-bg);\n343:        color: var(--more-btn-color);\n345:        border-radius: var(--load-more-radius);\n354:        border-top: 1px solid var(--header-border);\n357:        color: var(--subtext);\n358:        background: var(--bg);\n384:        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n385:        color: var(--text);\n387:        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n394:        background: var(--bg);\n395:        color: var(--text);\n396:        border: 1px solid var(--subtext);\n405:        color: var(--text);\n414:        background: var(--accent) !important;\n470:            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n498:            background: var(--mobile-rank-bg, transparent);\n499:            border: var(--mobile-rank-border, none);\n500:            padding: var(--mobile-rank-padding, 0);\n501:            border-radius: var(--mobile-rank-radius, 0);\n502:            opacity: var(--mobile-rank-opacity, 0.5);","numLines":60,"appliedLimit":60},"sourceToolAssistantUUID":"2940dfce-f44b-4930-9e8a-6fe1f00dcd6d"}
{"parentUuid":"45a1d5e4-70a9-4b25-aef4-6fb9772f1aff","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_0111nezAvZcaEMipoBXdpnjQ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a great picture of the CSS variables used. The most important ones are:\n- `--bg` - page background\n- `--card-bg` - story card background\n- `--text` - main text color\n- `--subtext` - secondary text (meta, nav links)\n- `--accent` - links, buttons, highlights\n- `--header-bg` - nav header background\n- `--font-main` - main font family\n\nOptional:\n- `--more-btn-bg`, `--more-btn-color` - \"More\" button\n- `--mobile-upvote-bg`, `--mobile-upvote-color`, `--mobile-upvote-radius` - mobile upvote button\n\n\n- `--item-border`, `--item-radius`, `--item-shadow` - card styling\n- `--header-border`, `--header-height` - header customization\n- `--title-size`, `--story-gap` - spacing and typography\n\nFor the placeholder, I want to show the minimal required structure clearly. I'll create a textarea placeholder that displays the essential CSS variables in `:root {}` along with a couple of optional component override examples as comments to guide users.\n\nWriting the placeholder code...","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2006,"cache_read_input_tokens":51551,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2006},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY6wA1xUvGEoC2kb56U","type":"assistant","uuid":"0c479866-44d3-41cf-aaf8-78c68fb2b4a3","timestamp":"2026-02-23T06:35:53.668Z"}
{"parentUuid":"0c479866-44d3-41cf-aaf8-78c68fb2b4a3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_0111nezAvZcaEMipoBXdpnjQ","type":"message","role":"assistant","content":[{"type":"text","text":"必要な変数の全体像が把握できました。プレースホルダーを更新します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2006,"cache_read_input_tokens":51551,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2006},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY6wA1xUvGEoC2kb56U","type":"assistant","uuid":"1e0fbbcb-56ed-42af-b35f-6f65b3d891d9","timestamp":"2026-02-23T06:35:54.038Z"}
{"parentUuid":"1e0fbbcb-56ed-42af-b35f-6f65b3d891d9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_0111nezAvZcaEMipoBXdpnjQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01S5Dx1awNxs8nsfyj42cvRu","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>","new_string":"                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2006,"cache_read_input_tokens":51551,"output_tokens":955,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2006,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQY6wA1xUvGEoC2kb56U","type":"assistant","uuid":"439029b0-e1f6-42cb-b33f-e6a206e80608","timestamp":"2026-02-23T06:35:58.374Z"}
{"parentUuid":"439029b0-e1f6-42cb-b33f-e6a206e80608","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01S5Dx1awNxs8nsfyj42cvRu","toolUseID":"toolu_01S5Dx1awNxs8nsfyj42cvRu","timestamp":"2026-02-23T06:35:58.382Z","uuid":"27ee6c02-59c1-4420-af01-0aec33d60858"}
{"parentUuid":"439029b0-e1f6-42cb-b33f-e6a206e80608","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01S5Dx1awNxs8nsfyj42cvRu","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"25546b87-94a1-4af8-bc7b-44aaf3655f05","timestamp":"2026-02-23T06:35:58.381Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>","newString":"                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1738,"oldLines":7,"newStart":1738,"newLines":19,"lines":["                 <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","             </div>","             <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">","-                <textarea id=\"paste-css-input\" placeholder=\"/* Paste CSS generated by ChatGPT, Claude, etc. */\" style=\"font-size:11px; min-width:0; width:100%; height:100px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>","+                <textarea id=\"paste-css-input\" placeholder=\":root {","+  --bg: #f5f5f7;        /* page background   */","+  --card-bg: #ffffff;   /* story card        */","+  --text: #1d1d1f;      /* main text         */","+  --subtext: #86868b;   /* metadata / nav    */","+  --accent: #0066cc;    /* links & buttons   */","+  --header-bg: rgba(255,255,255,0.8);","+  --font-main: sans-serif;","+}","+","+/* optional: component overrides */","+.hn-story-item { border-radius: 16px; }","+.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>","                 <div style=\"display:flex; gap:6px; align-items:center;\">","                     <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">","                     <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"439029b0-e1f6-42cb-b33f-e6a206e80608"}
{"parentUuid":"25546b87-94a1-4af8-bc7b-44aaf3655f05","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CFaWgaaDQdHLcjW923ZuZq","type":"message","role":"assistant","content":[{"type":"text","text":"反映を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":999,"cache_read_input_tokens":53557,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":999},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY823yg9a3BtCaJ1BvP","type":"assistant","uuid":"bacea4d3-195e-4160-86fc-8cbdef69bde4","timestamp":"2026-02-23T06:35:59.976Z"}
{"parentUuid":"bacea4d3-195e-4160-86fc-8cbdef69bde4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CFaWgaaDQdHLcjW923ZuZq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01H78d9CJ4k7exvokS5NbqUq","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1740,"limit":15},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":999,"cache_read_input_tokens":53557,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":999},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY823yg9a3BtCaJ1BvP","type":"assistant","uuid":"7c48fe5f-4b02-47f5-8840-44f237c08af3","timestamp":"2026-02-23T06:36:00.750Z"}
{"parentUuid":"7c48fe5f-4b02-47f5-8840-44f237c08af3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01H78d9CJ4k7exvokS5NbqUq","toolUseID":"toolu_01H78d9CJ4k7exvokS5NbqUq","timestamp":"2026-02-23T06:36:00.785Z","uuid":"2d34031a-ea48-4c5f-82c6-0591d70f63ad"}
{"parentUuid":"7c48fe5f-4b02-47f5-8840-44f237c08af3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01H78d9CJ4k7exvokS5NbqUq","type":"tool_result","content":"  1740→            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1741→                <textarea id=\"paste-css-input\" placeholder=\":root {\n  1742→  --bg: #f5f5f7;        /* page background   */\n  1743→  --card-bg: #ffffff;   /* story card        */\n  1744→  --text: #1d1d1f;      /* main text         */\n  1745→  --subtext: #86868b;   /* metadata / nav    */\n  1746→  --accent: #0066cc;    /* links & buttons   */\n  1747→  --header-bg: rgba(255,255,255,0.8);\n  1748→  --font-main: sans-serif;\n  1749→}\n  1750→\n  1751→/* optional: component overrides */\n  1752→.hn-story-item { border-radius: 16px; }\n  1753→.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n  1754→                <div style=\"display:flex; gap:6px; align-items:center;\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c8c8bf25-e469-430a-941f-dbacbb9f5cd3","timestamp":"2026-02-23T06:36:00.784Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">","numLines":15,"startLine":1740,"totalLines":1972}},"sourceToolAssistantUUID":"7c48fe5f-4b02-47f5-8840-44f237c08af3"}
{"parentUuid":"c8c8bf25-e469-430a-941f-dbacbb9f5cd3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_016gWmhxj26iyq14SaJtSjqD","type":"message","role":"assistant","content":[{"type":"text","text":"問題ありません。変更内容：\n\n**テキストエリアのプレースホルダー**を実際のCSSスニペットに差し替えました。\n\n```css\n:root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\n```\n\n- `:root {}` に設定すべき変数を網羅し、各行に用途コメントを添えました\n- 下部にコンポーネントオーバーライドの例も示しています\n- テキストエリアの高さも100px → 160px に広げてプレースホルダー全体が見えるようにしました"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":546,"cache_read_input_tokens":54556,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":546},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQY8CNajfATkaBudJLVJ","type":"assistant","uuid":"9098094d-17e5-4f4d-b108-5dabf945737b","timestamp":"2026-02-23T06:36:06.231Z"}
{"parentUuid":"9098094d-17e5-4f4d-b108-5dabf945737b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"1fb023d8-3b41-4f67-8d13-2dda20038324","toolUseID":"1fb023d8-3b41-4f67-8d13-2dda20038324","timestamp":"2026-02-23T06:36:06.259Z","uuid":"c3cfe1ee-7f00-433d-b8b0-f36387c9212c"}
{"parentUuid":"c3cfe1ee-7f00-433d-b8b0-f36387c9212c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":212}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:36:06.471Z","uuid":"354e115a-0467-4888-8095-95e8eefcc444","toolUseID":"1fb023d8-3b41-4f67-8d13-2dda20038324"}
{"parentUuid":"354e115a-0467-4888-8095-95e8eefcc444","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":44857,"timestamp":"2026-02-23T06:36:06.473Z","uuid":"6b41c3ac-fa08-40cc-b189-37208a244472","isMeta":false}
{"type":"file-history-snapshot","messageId":"f32b36fc-e03f-4436-a96c-9b9baa5d2d82","snapshot":{"messageId":"f32b36fc-e03f-4436-a96c-9b9baa5d2d82","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v3","version":3,"backupTime":"2026-02-23T06:36:55.856Z"}},"timestamp":"2026-02-23T06:36:55.856Z"},"isSnapshotUpdate":false}
{"parentUuid":"6b41c3ac-fa08-40cc-b189-37208a244472","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"また、テーマ生成のためのプロンプトのテンプレートをコピーできるセクションも追加してください。"},"uuid":"f32b36fc-e03f-4436-a96c-9b9baa5d2d82","timestamp":"2026-02-23T06:36:55.721Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"f32b36fc-e03f-4436-a96c-9b9baa5d2d82","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01MuokF6kicJZW1y3Kg7K2L6","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to add a section where they can copy a prompt template for generating themes using external AI. This prompt template would be something users can copy and paste into ChatGPT, Claude, etc. to generate CSS for GenHN themes.\n\nLet me think about what this prompt template should look like. It should:\n1. Explain the GenHN app structure\n2. Show the CSS variables available\n3. Ask the AI to generate a theme\n\nI should look at the GEMINI_SYSTEM_PROMPT that's already in the code - that's the prompt used for Gemini generation, and I can adapt it for the copy-paste template.","signature":"EusFCkYICxgCKkBu2/u4uQyKuDnP29uTVoF867OFjRYaSvDXRMPCskRvNA0W76JiPKibrBFKtI6HbPTi94Z3IMH2c9IrmU5D2/5zEgymO0/pIpaLIfzuAFgaDNBhFrSj/jFVnwaBeSIwlVMOd1ZdE6ujkZc4xe/zv/tWPA5b2BDOoTs7U8xPVadnKbjI7zTj17KZPvYYRHpCKtIEOdkDgcsR3VSDwuu4hIn7AXElwjKnP/Zp/tpr0dydqW0pWrAKfCtgqFc+iu2+EPzd5hpRe42Kqjt8fL0/by+77a7aejCBr3wfRvLXnEc3DveGRUbpkKErJiU0M7BSLkl2WxeySR8NOrnbRmGL5Fm68Z8578K5D9/moFhmVCV/RDs+O5EU7MeVLpezZpWL9HwW71HkaJupcE+HoVSXlQR7nzqwV049uUa58wBibtu9WcQcJXyu6E98SUzc1sSwsjW3QY7t0sRz61ShpgtQcvZQDfqoNUyvwARWQmkH7ZwZhPSkIYoBHm0LaFqUVQQlj2QUy21GJ4rTpTwxayl4GaLDJ6FX/bqw1Rl/tBbCnqZDSIPy4jeC4OLRRv/b41/Z3I5CklVL8MrkZG5l0YnvYnNRQN1oZThJ8zmFpreLIijUnEBcB1z0o+nzt06+xHHFXrkcM8NZPQ3Q5jagU7YVRnhRe1RYHEpdercVi7Z2E/gEPWXGRB3GGGgXJ2Yj0/HRkIefRxuwuqQlrXGBRgCux8nY6QDIuDP+ptBt+jqs9oWCmq0BPfD6wnHquS2Dar1Ee17rTSbv3o+0aR6EivCoJvufy6zgxvPrVpTqKKfhAZHRc/pZcuaQFaFQ2ql0+4J8noWvNFHa4IVp0XZnAjTntiDbZ8pn7kwrqSP1z2Z9rvvCBHSg0hF+xtaETkuQTLz55+T+dnqXQ1bM22gx197n+u5s27EsqloEXSNZi4biA9yjlbb8cKBhHqQ/9A6f1iHQJjFtoEFmL3Kp6hbiK+nRmOd/oA0dGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":40,"cache_read_input_tokens":55417,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":40},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYCFsY7KXcKbfBXjqNx","type":"assistant","uuid":"7d85be0f-ad1b-4c72-95e6-afa77c6fc0d4","timestamp":"2026-02-23T06:37:00.186Z"}
{"parentUuid":"7d85be0f-ad1b-4c72-95e6-afa77c6fc0d4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01MuokF6kicJZW1y3Kg7K2L6","type":"message","role":"assistant","content":[{"type":"text","text":"Gemini用のシステムプロンプトを参考にします。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":40,"cache_read_input_tokens":55417,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":40},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYCFsY7KXcKbfBXjqNx","type":"assistant","uuid":"236c97bc-f9ca-4d7a-bc18-2d80fb10268f","timestamp":"2026-02-23T06:37:00.743Z"}
{"parentUuid":"236c97bc-f9ca-4d7a-bc18-2d80fb10268f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01MuokF6kicJZW1y3Kg7K2L6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Sd8zxHgYvH5cKewETGdQq2","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1,"limit":130},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":40,"cache_read_input_tokens":55417,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":40},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYCFsY7KXcKbfBXjqNx","type":"assistant","uuid":"48f755a0-72be-4d78-9d59-b76f8bf7ffb4","timestamp":"2026-02-23T06:37:01.298Z"}
{"parentUuid":"48f755a0-72be-4d78-9d59-b76f8bf7ffb4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Sd8zxHgYvH5cKewETGdQq2","toolUseID":"toolu_01Sd8zxHgYvH5cKewETGdQq2","timestamp":"2026-02-23T06:37:01.311Z","uuid":"47fa02e5-bb47-4591-904a-3593afae921a"}
{"parentUuid":"48f755a0-72be-4d78-9d59-b76f8bf7ffb4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Sd8zxHgYvH5cKewETGdQq2","type":"tool_result","content":"     1→/**\n     2→ * Acephale OS | Gardener.js\n     3→ * Hacker News Interface Styling & Data Fetching\n     4→ */\n     5→\n     6→const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n     7→\n     8→const GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\n     9→Output ONLY raw CSS. No explanations, markdown, code fences, or comments.\n    10→Begin with /* world: NAME */ on the first line.\n    11→\n    12→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n    13→WORLD-BUILDING MANDATE\n    14→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n    15→You are not changing colors. You are creating a complete universe.\n    16→Every world must have ALL FOUR of these dimensions:\n    17→\n    18→  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n    19→  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n    20→  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n    21→  ④ IDENTITY    — header + logo that could only belong to this world\n    22→\n    23→Producing only color + font changes = FAILURE. The layout must shift. Something must animate.\n    24→\n    25→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n    26→CONTRAST LAW (mandatory)\n    27→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n    28→DARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\n    29→LIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\n    30→WRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\n    31→RIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\n    32→Buttons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n    33→\n    34→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n    35→WORLDS — pick one, apply its complete interaction model\n    36→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n    37→TERMINAL\n    38→  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n    39→  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n    40→  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n    41→  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n    42→\n    43→BRUTALIST\n    44→  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n    45→           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n    46→  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n    47→  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n    48→  Identity: Impact/condensed font · max 3 colors · masthead-style header\n    49→\n    50→EDITORIAL\n    51→  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n    52→           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n    53→  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n    54→  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n    55→  Identity: Georgia/serif · subdued accent · newspaper masthead header\n    56→\n    57→PLAYFUL\n    58→  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n    59→           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n    60→  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n    61→  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n    62→  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n    63→\n    64→NEON / CYBERPUNK\n    65→  Layout:  list · subtle glow border on cards · 4-8px radius\n    66→  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n    67→           @keyframes: continuous ambient pulse on .hn-logo or header\n    68→  Atm:     body radial-gradient from corner · header glows · scanline optional\n    69→  Identity: logo multi-layer text-shadow glow · very dark bg\n    70→\n    71→MAGAZINE / BROADSHEET\n    72→  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n    73→           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n    74→           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n    75→  Hover:   first child: title grows (font-size transition) · others: bg darkens\n    76→  Atm:     high contrast · editorial typography · no card shadows\n    77→  Identity: condensed or serif font · header = thick top border only\n    78→\n    79→RETRO GUI\n    80→  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n    81→  Hover:   border reverses (inset simulation) + bg darkens slightly\n    82→  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n    83→  Identity: dialog-box feel · .hn-logo in title-bar style\n    84→\n    85→VAPORWAVE\n    86→  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n    87→  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n    88→  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n    89→           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n    90→           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n    91→  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n    92→\n    93→NATURE / ORGANIC\n    94→  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n    95→           generous gap · no card bg (transparent) · ruled separator\n    96→  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n    97→  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n    98→  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n    99→\n   100→ISOMETRIC / 3D\n   101→  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n   102→  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n   103→           transition:transform 0.3s ease, box-shadow 0.3s\n   104→  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n   105→  Identity: geometric sans-serif · structured header\n   106→\n   107→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n   108→CSS ARSENAL (mix freely — every theme should use several)\n   109→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n   110→Scanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\n   111→Glow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\n   112→Logo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\n   113→Logo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\n   114→Spring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\n   115→Press hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n   116→3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\n   117→Grid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\n   118→Float rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\n   119→Clip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\n   120→Diagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\n   121→Bevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n   122→Hue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\n   123→Title slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\n   124→Masthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\n   125→Pill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\n   126→Stripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\n   127→Ambient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n   128→\n   129→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n   130→TEMPLATE (fill every value; all blocks are required)\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2fe6f052-7832-40fd-9046-d362a480af76","timestamp":"2026-02-23T06:37:01.310Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)","numLines":130,"startLine":1,"totalLines":1972}},"sourceToolAssistantUUID":"48f755a0-72be-4d78-9d59-b76f8bf7ffb4"}
{"parentUuid":"2fe6f052-7832-40fd-9046-d362a480af76","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Tu3SekT97YbvhgA24wvhJN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ue6cs1BPoY4TzKedT8vvQB","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":130,"limit":60},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4212,"cache_read_input_tokens":55457,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4212},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYCfGTmDhKoZvi6hjk4","type":"assistant","uuid":"f291e1a6-ec2d-405c-94b0-c6f14b6669ad","timestamp":"2026-02-23T06:37:04.486Z"}
{"parentUuid":"f291e1a6-ec2d-405c-94b0-c6f14b6669ad","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Ue6cs1BPoY4TzKedT8vvQB","toolUseID":"toolu_01Ue6cs1BPoY4TzKedT8vvQB","timestamp":"2026-02-23T06:37:04.530Z","uuid":"1701252a-21ea-4297-a0e4-9600989a856b"}
{"parentUuid":"f291e1a6-ec2d-405c-94b0-c6f14b6669ad","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ue6cs1BPoY4TzKedT8vvQB","type":"tool_result","content":"   130→TEMPLATE (fill every value; all blocks are required)\n   131→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n   132→:root {\n   133→    --bg:\n   134→    --card-bg:\n   135→    --text:\n   136→    --subtext:\n   137→    --accent:\n   138→    --header-bg:\n   139→    --header-border:\n   140→    --header-height:   /* 50-80px */\n   141→    --font-main:\n   142→    --item-radius:\n   143→    --item-border:\n   144→    --item-shadow:\n   145→    --story-gap:       /* 0-40px */\n   146→    --title-size:      /* 15-32px */\n   147→    --upvote-size:     /* 24-52px */\n   148→    --load-more-radius: /* 0px=square · 100px=pill */\n   149→    --item-transition: /* full transition value — use cubic-bezier for spring */\n   150→    --more-btn-bg:\n   151→    --more-btn-color:\n   152→    --mobile-upvote-bg:\n   153→    --mobile-upvote-color:\n   154→}\n   155→.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n   156→.hn-logo { /* ≥3 properties — make it unmistakable */ }\n   157→.hn-story-item { }\n   158→.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n   159→.hn-story-rank { }\n   160→.hn-upvote { }\n   161→/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n   162→/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n   163→`;\n   164→\n   165→/**\n   166→ * System Core Styles (Layout, Typography Base, Responsive Logic)\n   167→ * Themes should override variables in :root or specific classes if needed.\n   168→ */\n   169→const SYSTEM_STYLE = `\n   170→    :root {\n   171→        /* Default Variables (Fallback) */\n   172→        --bg: #ffffff;\n   173→        --text: #333333;\n   174→        --subtext: #888888;\n   175→        --accent: #007aff;\n   176→        --card-bg: #ffffff;\n   177→        --header-bg: rgba(255,255,255,0.9);\n   178→        --header-border: 1px solid rgba(0,0,0,0.1);\n   179→        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n   180→        \n   181→        /* Component Specific Defaults */\n   182→        --item-padding: 24px;\n   183→        --item-radius: 12px;\n   184→        --item-border: 1px solid rgba(0,0,0,0.05);\n   185→        --item-shadow: none;\n   186→        --item-gap: 20px;\n   187→        \n   188→        /* Mobile Defaults */\n   189→        --mobile-upvote-bg: rgba(0,0,0,0.05);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a8234447-70c8-4662-970c-5eb0a0922296","timestamp":"2026-02-23T06:37:04.529Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"TEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);","numLines":60,"startLine":130,"totalLines":1972}},"sourceToolAssistantUUID":"f291e1a6-ec2d-405c-94b0-c6f14b6669ad"}
{"parentUuid":"a8234447-70c8-4662-970c-5eb0a0922296","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01SVkgYE7r9MseCgcqgXDz3P","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a complete picture of the Gemini system prompt. I can create a prompt template for external AI tools that's based on this but adapted for copy-paste use (with the user's theme idea embedded as a placeholder).\n\nThe prompt template should:\n1. Explain what the app is\n2. Explain the CSS structure\n3. Include the constraints from GEMINI_SYSTEM_PROMPT (WORLD-BUILDING MANDATE, CONTRAST LAW, etc.)\n4. Have a placeholder like `[YOUR THEME IDEA HERE]` or `[DESCRIBE YOUR THEME]`\n\nBut wait - I should think about what the user really wants. They want a template prompt that they can copy and paste into an external AI (ChatGPT, Claude, etc.) to have it generate CSS for GenHN. \n\n\nI need to extract the essential parts from the system prompt—the role definition, output format requirements, available CSS variables, and component classes—and package them into a self-contained template with a theme placeholder that guides external AIs to produce valid CSS. For the UI, I'm thinking a collapsible section similar to the \"Paste CSS\" area with a textarea containing the pre-filled template text.\n\nThe textarea should display the actual template content as read-only text so users can easily copy it. I'll store the template as a constant in the JavaScript and bind it to the textarea's value. The template itself needs to establish the role clearly, specify output constraints, and outline the four dimensions that every theme must include.\n\nDesigning the prompt template... change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\n② CONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\nNow I'm setting up the CSS variables for spacing, typography, and interactive elements—header dimensions, card styling, transitions with spring easing, gaps between items, button sizes, and mobile-specific upvote styling.\n\nI'm also mapping out the key classes that will be targeted: the sticky header, logo, story list container, individual cards, rank numbers, titles, metadata, upvote buttons, and using body::before for atmospheric overlays.\n\nNow I need to think about where users will paste the CSS and how to structure the UI implementation—deciding on the layout approach for the story list, defining hover interactions that go beyond simple color changes, and creating an atmospheric effect that gives the theme its own identity.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1144,"cache_read_input_tokens":59669,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1144},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYCuhsb17pzpfohawNb","type":"assistant","uuid":"15a0a734-f901-4b32-a79a-b3a83de845eb","timestamp":"2026-02-23T06:37:33.399Z"}
{"parentUuid":"15a0a734-f901-4b32-a79a-b3a83de845eb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01SVkgYE7r9MseCgcqgXDz3P","type":"message","role":"assistant","content":[{"type":"text","text":"プロンプトの構造を完全に把握しました。実装します。\n\nまずプロンプトテンプレートの定数を `GEMINI_SYSTEM_PROMPT` の直後に追加します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1144,"cache_read_input_tokens":59669,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1144},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYCuhsb17pzpfohawNb","type":"assistant","uuid":"def0be53-09ff-4a75-8c37-16604b7111de","timestamp":"2026-02-23T06:37:34.391Z"}
{"parentUuid":"def0be53-09ff-4a75-8c37-16604b7111de","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01SVkgYE7r9MseCgcqgXDz3P","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YJoMG5JHemLKtAyAwm1BrW","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":163,"limit":5},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1144,"cache_read_input_tokens":59669,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1144},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYCuhsb17pzpfohawNb","type":"assistant","uuid":"2c4ba292-1bf6-40c7-b54a-fd4fd4a512e3","timestamp":"2026-02-23T06:37:35.600Z"}
{"parentUuid":"2c4ba292-1bf6-40c7-b54a-fd4fd4a512e3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01YJoMG5JHemLKtAyAwm1BrW","toolUseID":"toolu_01YJoMG5JHemLKtAyAwm1BrW","timestamp":"2026-02-23T06:37:35.649Z","uuid":"0b394a80-074c-4441-a815-ba46593156d8"}
{"parentUuid":"2c4ba292-1bf6-40c7-b54a-fd4fd4a512e3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YJoMG5JHemLKtAyAwm1BrW","type":"tool_result","content":"   163→`;\n   164→\n   165→/**\n   166→ * System Core Styles (Layout, Typography Base, Responsive Logic)\n   167→ * Themes should override variables in :root or specific classes if needed.\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"55bab267-7e33-4c2d-955a-bad76162cb39","timestamp":"2026-02-23T06:37:35.647Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.","numLines":5,"startLine":163,"totalLines":1972}},"sourceToolAssistantUUID":"2c4ba292-1bf6-40c7-b54a-fd4fd4a512e3"}
{"parentUuid":"55bab267-7e33-4c2d-955a-bad76162cb39","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01QbP1nySpjbBFF67R7iXa2V","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011P7kYhFZXrLxnDBnSXXNTh","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.","new_string":"`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1570,"cache_read_input_tokens":60813,"output_tokens":907,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":1570,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQYFBrXM2aN2fbwSDMj1","type":"assistant","uuid":"ca368880-cf6d-4fd7-ae1a-1b9e00b98cf0","timestamp":"2026-02-23T06:37:48.164Z"}
{"parentUuid":"ca368880-cf6d-4fd7-ae1a-1b9e00b98cf0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_011P7kYhFZXrLxnDBnSXXNTh","toolUseID":"toolu_011P7kYhFZXrLxnDBnSXXNTh","timestamp":"2026-02-23T06:37:48.172Z","uuid":"0fd43af3-4e33-4047-b240-1fe0354e8885"}
{"parentUuid":"ca368880-cf6d-4fd7-ae1a-1b9e00b98cf0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011P7kYhFZXrLxnDBnSXXNTh","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"4027e9b2-18e4-480f-8a71-69773a7053ea","timestamp":"2026-02-23T06:37:48.171Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.","newString":"`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":162,"oldLines":6,"newStart":162,"newLines":57,"lines":[" /* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */"," `;"," ","+const EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.","+Output ONLY raw CSS. No explanations, markdown, code fences, or comments.","+","+Theme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]","+","+━━━ RULES ━━━","+Every theme must have ALL FOUR dimensions:","+  LAYOUT      — change the story list structure (grid? columns? dense? airy?)","+  INTERACTION — hover effects using transform, animation, or filter (not just color)","+  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background","+  IDENTITY    — a header + logo that could only belong to this world","+","+CONTRAST LAW (mandatory):","+  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter","+  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker","+","+━━━ CSS VARIABLES (:root) ━━━","+--bg              page background","+--card-bg         story card background","+--text            main text color","+--subtext         metadata / secondary text","+--accent          links & interactive elements","+--header-bg       nav header background","+--header-border   header bottom border (e.g. \"1px solid #ccc\")","+--header-height   nav height in px (50–80px)","+--font-main       main typeface","+--item-radius     card corner radius","+--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")","+--item-shadow     card box-shadow","+--item-transition full transition value (use cubic-bezier for spring physics)","+--story-gap       gap between cards (0–40px)","+--title-size      story title font-size (15–32px)","+--upvote-size     upvote button size (24–52px)","+--load-more-radius \"More\" button border-radius (0=square, 100px=pill)","+--more-btn-bg     \"More\" button background","+--more-btn-color  \"More\" button text color","+--mobile-upvote-bg     mobile upvote background","+--mobile-upvote-color  mobile upvote text color","+","+━━━ KEY CLASSES ━━━","+.hn-header            sticky top nav bar","+.hn-logo              the \"Y\" site logo","+.hn-story-list        <ol> containing all cards","+.hn-story-item        individual story card","+.hn-story-item:hover  card hover state","+.hn-story-rank        rank number (1. 2. 3.)","+.hn-story-title       headline link","+.hn-story-meta        points / author / time row","+.hn-upvote            upvote triangle button","+body::before          use for overlays / atmospheric effects`;","+"," /**","  * System Core Styles (Layout, Typography Base, Responsive Logic)","  * Themes should override variables in :root or specific classes if needed."]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ca368880-cf6d-4fd7-ae1a-1b9e00b98cf0"}
{"parentUuid":"4027e9b2-18e4-480f-8a71-69773a7053ea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_015y8SMeoVJ9J6jKKzXGdXc2","type":"message","role":"assistant","content":[{"type":"text","text":"次に `renderPromptTemplateSection()` メソッドを `renderPasteCssSection()` の直後に追加します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":965,"cache_read_input_tokens":62383,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":965},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYG7Uspx6W6rWC3eyfi","type":"assistant","uuid":"426be966-7c45-4653-aaaf-a9eca1b51332","timestamp":"2026-02-23T06:37:50.952Z"}
{"parentUuid":"426be966-7c45-4653-aaaf-a9eca1b51332","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_015y8SMeoVJ9J6jKKzXGdXc2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016hQmAwpre6Mk1Nx1GxNM42","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1810,"limit":10},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":965,"cache_read_input_tokens":62383,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":965},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYG7Uspx6W6rWC3eyfi","type":"assistant","uuid":"ae8d04b4-7d56-4582-8a8c-389b8f694c95","timestamp":"2026-02-23T06:37:51.595Z"}
{"parentUuid":"ae8d04b4-7d56-4582-8a8c-389b8f694c95","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_016hQmAwpre6Mk1Nx1GxNM42","toolUseID":"toolu_016hQmAwpre6Mk1Nx1GxNM42","timestamp":"2026-02-23T06:37:51.648Z","uuid":"6e581799-33cb-4698-9c58-8e1d61a294b1"}
{"parentUuid":"ae8d04b4-7d56-4582-8a8c-389b8f694c95","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016hQmAwpre6Mk1Nx1GxNM42","type":"tool_result","content":"  1810→\n  1811→        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n  1812→            const form = section.querySelector('#paste-css-form');\n  1813→            const icon = section.querySelector('#paste-css-icon');\n  1814→            const isOpen = form.style.display !== 'none';\n  1815→            form.style.display = isOpen ? 'none' : 'flex';\n  1816→            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1817→        });\n  1818→\n  1819→        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d12e5bef-abb9-47ff-86b1-9e991e6ce215","timestamp":"2026-02-23T06:37:51.646Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {","numLines":10,"startLine":1810,"totalLines":2023}},"sourceToolAssistantUUID":"ae8d04b4-7d56-4582-8a8c-389b8f694c95"}
{"parentUuid":"d12e5bef-abb9-47ff-86b1-9e991e6ce215","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_011g9nRfAopUM3LpbLYCUSZR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KSo3khmTUNgRXyHz7JW5LQ","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1819,"limit":15},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":412,"cache_read_input_tokens":63348,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":412},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYGNNpP87ZGuMX2W65P","type":"assistant","uuid":"0d05e0e3-7756-43e8-85a7-d26277674d0b","timestamp":"2026-02-23T06:37:54.318Z"}
{"parentUuid":"0d05e0e3-7756-43e8-85a7-d26277674d0b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01KSo3khmTUNgRXyHz7JW5LQ","toolUseID":"toolu_01KSo3khmTUNgRXyHz7JW5LQ","timestamp":"2026-02-23T06:37:54.365Z","uuid":"9f6e94cc-cb1c-4461-bc1d-0fb7fd91a11e"}
{"parentUuid":"0d05e0e3-7756-43e8-85a7-d26277674d0b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KSo3khmTUNgRXyHz7JW5LQ","type":"tool_result","content":"  1819→        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n  1820→            const css = section.querySelector('#paste-css-input').value.trim();\n  1821→            if (!css) return;\n  1822→            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n  1823→            this.applyStyle(css, null, name);\n  1824→            this.togglePresets(true);\n  1825→            this.renderSaveButton(true);\n  1826→        });\n  1827→\n  1828→        this.elements.themeControls.appendChild(section);\n  1829→    },\n  1830→\n  1831→    showGenerateError(err) {\n  1832→        let message;\n  1833→        switch (err.message) {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"15396880-5782-4aef-94f2-a12d0f6f04a8","timestamp":"2026-02-23T06:37:54.364Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {","numLines":15,"startLine":1819,"totalLines":2023}},"sourceToolAssistantUUID":"0d05e0e3-7756-43e8-85a7-d26277674d0b"}
{"parentUuid":"15396880-5782-4aef-94f2-a12d0f6f04a8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CAf6n5DhUoR6FMdNoC2YKf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Wj1YWqX3vXjB4k49dALsDa","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {","new_string":"        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":414,"cache_read_input_tokens":63760,"output_tokens":913,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":414,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQYGaETAD5ZxzbNwVftf","type":"assistant","uuid":"cc3faacf-842f-4c6a-a253-40a2e3ed1461","timestamp":"2026-02-23T06:38:06.039Z"}
{"parentUuid":"cc3faacf-842f-4c6a-a253-40a2e3ed1461","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Wj1YWqX3vXjB4k49dALsDa","toolUseID":"toolu_01Wj1YWqX3vXjB4k49dALsDa","timestamp":"2026-02-23T06:38:06.046Z","uuid":"c8b62a16-8108-4105-a147-adc0288a6d56"}
{"parentUuid":"cc3faacf-842f-4c6a-a253-40a2e3ed1461","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Wj1YWqX3vXjB4k49dALsDa","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"e11cf104-3911-4c8c-8115-b8d7218bc53d","timestamp":"2026-02-23T06:38:06.045Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {","newString":"        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1828,"oldLines":6,"newStart":1828,"newLines":48,"lines":["         this.elements.themeControls.appendChild(section);","     },"," ","+    renderPromptTemplateSection() {","+        const existing = document.getElementById('prompt-template-section');","+        if (existing) existing.remove();","+","+        const section = document.createElement('div');","+        section.id = 'prompt-template-section';","+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';","+","+        section.innerHTML = `","+            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","+                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>","+                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","+            </div>","+            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">","+                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>","+                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>","+                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>","+            </div>`;","+","+        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {","+            const form = section.querySelector('#prompt-template-form');","+            const icon = section.querySelector('#prompt-template-icon');","+            const isOpen = form.style.display !== 'none';","+            form.style.display = isOpen ? 'none' : 'flex';","+            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';","+        });","+","+        const textarea = section.querySelector('#prompt-template-text');","+        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;","+","+        const copyBtn = section.querySelector('#prompt-template-copy-btn');","+        copyBtn.addEventListener('click', () => {","+            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {","+                const original = copyBtn.textContent;","+                copyBtn.textContent = 'Copied!';","+                setTimeout(() => { copyBtn.textContent = original; }, 2000);","+            });","+        });","+","+        this.elements.themeControls.appendChild(section);","+    },","+","     showGenerateError(err) {","         let message;","         switch (err.message) {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"cc3faacf-842f-4c6a-a253-40a2e3ed1461"}
{"parentUuid":"e11cf104-3911-4c8c-8115-b8d7218bc53d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Whb1iLyThYFjKUdYuu6Gk9","type":"message","role":"assistant","content":[{"type":"text","text":"最後に `init()` から呼び出します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":952,"cache_read_input_tokens":64174,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":952},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYHRuBAaJa27whU7Jnz","type":"assistant","uuid":"7a0ee4a2-6516-47c6-bd7b-cb09745b502f","timestamp":"2026-02-23T06:38:07.848Z"}
{"parentUuid":"7a0ee4a2-6516-47c6-bd7b-cb09745b502f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Whb1iLyThYFjKUdYuu6Gk9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YTRwDbUhkz5jMKBz5sQBy2","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();","new_string":"        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":952,"cache_read_input_tokens":64174,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":952},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYHRuBAaJa27whU7Jnz","type":"assistant","uuid":"fbd73ca0-515f-4d98-85e1-825ce7bd4f03","timestamp":"2026-02-23T06:38:09.477Z"}
{"parentUuid":"fbd73ca0-515f-4d98-85e1-825ce7bd4f03","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01YTRwDbUhkz5jMKBz5sQBy2","toolUseID":"toolu_01YTRwDbUhkz5jMKBz5sQBy2","timestamp":"2026-02-23T06:38:09.484Z","uuid":"61f7faf2-6efd-44b7-a27e-2df118711d6d"}
{"parentUuid":"fbd73ca0-515f-4d98-85e1-825ce7bd4f03","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YTRwDbUhkz5jMKBz5sQBy2","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"b158a802-1ffc-4d46-af20-0729cbcd80a4","timestamp":"2026-02-23T06:38:09.483Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();","newString":"        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1431,"oldLines":6,"newStart":1431,"newLines":7,"lines":["         this.renderSavedThemeButtons();","         this.renderApiKeySection();","         this.renderPasteCssSection();","+        this.renderPromptTemplateSection();","         this.bindEvents();"," ","         const savedPreset = localStorage.getItem('genhn-theme');"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"fbd73ca0-515f-4d98-85e1-825ce7bd4f03"}
{"parentUuid":"b158a802-1ffc-4d46-af20-0729cbcd80a4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_018DtbAA3x4USvUJN67Y32ea","type":"message","role":"assistant","content":[{"type":"text","text":"実装を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":356,"cache_read_input_tokens":65126,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":356},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYHgpN5Mm389UhvDLL4","type":"assistant","uuid":"22595bde-9ffc-4347-9fa2-57687608c65e","timestamp":"2026-02-23T06:38:10.951Z"}
{"parentUuid":"22595bde-9ffc-4347-9fa2-57687608c65e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_018DtbAA3x4USvUJN67Y32ea","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0149niQf3w3ADiEkiK3Scmr4","name":"Grep","input":{"pattern":"renderPromptTemplateSection","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":1},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":356,"cache_read_input_tokens":65126,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":356},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYHgpN5Mm389UhvDLL4","type":"assistant","uuid":"615de340-37a7-47a5-a0e5-7f6e55977826","timestamp":"2026-02-23T06:38:12.050Z"}
{"parentUuid":"615de340-37a7-47a5-a0e5-7f6e55977826","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_0149niQf3w3ADiEkiK3Scmr4","toolUseID":"toolu_0149niQf3w3ADiEkiK3Scmr4","timestamp":"2026-02-23T06:38:12.389Z","uuid":"fe29714b-93f2-4ab4-88e8-c4e1ca222ef3"}
{"parentUuid":"615de340-37a7-47a5-a0e5-7f6e55977826","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0149niQf3w3ADiEkiK3Scmr4","type":"tool_result","content":"1433-        this.renderPasteCssSection();\n1434:        this.renderPromptTemplateSection();\n1435-        this.bindEvents();\n--\n1831-\n1832:    renderPromptTemplateSection() {\n1833-        const existing = document.getElementById('prompt-template-section');"}]},"uuid":"17b5bcc9-50cc-43b4-8bd6-512d32ff5966","timestamp":"2026-02-23T06:38:12.388Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1433-        this.renderPasteCssSection();\n1434:        this.renderPromptTemplateSection();\n1435-        this.bindEvents();\n--\n1831-\n1832:    renderPromptTemplateSection() {\n1833-        const existing = document.getElementById('prompt-template-section');","numLines":7},"sourceToolAssistantUUID":"615de340-37a7-47a5-a0e5-7f6e55977826"}
{"parentUuid":"17b5bcc9-50cc-43b4-8bd6-512d32ff5966","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01FnUcHjhchx85inYC9pS12p","type":"message","role":"assistant","content":[{"type":"text","text":"問題ありません。実装内容を整理します。\n\n---\n\n追加した内容：\n\n**`EXTERNAL_AI_PROMPT_TEMPLATE` 定数**（`gardener.js` 冒頭）  \nChatGPT・Claude・Gemini等に貼り付けるためのプロンプトテンプレート。以下を含みます：\n- テーマ記述の差し込み欄 `[DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\"]`\n- LAYOUT / INTERACTION / ATMOSPHERE / IDENTITY の4次元ルール\n- コントラスト法則（ダーク/ライト背景での文字色の指針）\n- 全CSS変数の一覧と用途説明\n- 操作対象のクラス名一覧\n\n**コントロールパネルの \"AI Prompt Template\" セクション**  \n- 他の折りたたみセクションと同じスタイル\n- 展開すると：\n  - 使い方の説明文（「Paste CSS セクションに貼り付けてください」）\n  - テンプレートが表示されたリードオンリーのテキストエリア\n  - **Copy Prompt** ボタン → クリップボードにコピー、2秒間 \"Copied!\" 表示"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":225,"cache_read_input_tokens":65482,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":225},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYHtwNTLoqWh2AUWyiE","type":"assistant","uuid":"528c1406-c59c-45e4-b594-d93e1982282e","timestamp":"2026-02-23T06:38:21.597Z"}
{"parentUuid":"528c1406-c59c-45e4-b594-d93e1982282e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"ae4d05f8-b437-4d5b-968d-28db9313c8a9","toolUseID":"ae4d05f8-b437-4d5b-968d-28db9313c8a9","timestamp":"2026-02-23T06:38:21.627Z","uuid":"63908a31-91b8-48e6-9f3e-93ff8e366b1a"}
{"parentUuid":"63908a31-91b8-48e6-9f3e-93ff8e366b1a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":230}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:38:21.857Z","uuid":"17543f24-0be3-43e6-8ee9-5e9a3d401e76","toolUseID":"ae4d05f8-b437-4d5b-968d-28db9313c8a9"}
{"parentUuid":"17543f24-0be3-43e6-8ee9-5e9a3d401e76","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":86002,"timestamp":"2026-02-23T06:38:21.859Z","uuid":"fa8b96a9-4169-46b1-93fe-c4f90ddbdead","isMeta":false}
{"type":"file-history-snapshot","messageId":"6454bede-e6ff-4448-883a-c43b7e4d95ac","snapshot":{"messageId":"6454bede-e6ff-4448-883a-c43b7e4d95ac","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v4","version":4,"backupTime":"2026-02-23T06:39:36.603Z"}},"timestamp":"2026-02-23T06:39:36.603Z"},"isSnapshotUpdate":false}
{"parentUuid":"fa8b96a9-4169-46b1-93fe-c4f90ddbdead","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コミットして"},"uuid":"6454bede-e6ff-4448-883a-c43b7e4d95ac","timestamp":"2026-02-23T06:39:36.422Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"6454bede-e6ff-4448-883a-c43b7e4d95ac","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_016jxDbzWqcVh2qjAesyEgrs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VLJvhfohPmEuytsg9eocdY","name":"Bash","input":{"command":"git status && git diff --stat","description":"Show git status and diff stat"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":7,"cache_read_input_tokens":66056,"output_tokens":80,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":7,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQYQ7EiKhaNt3i6LRfVh","type":"assistant","uuid":"0f78d12e-5a35-40b4-a9c5-b939c3ba2b5b","timestamp":"2026-02-23T06:39:38.713Z"}
{"parentUuid":"0f78d12e-5a35-40b4-a9c5-b939c3ba2b5b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VLJvhfohPmEuytsg9eocdY","type":"tool_result","content":"On branch main\nYour branch is up to date with 'origin/main'.\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n gardener.js | 148 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n 1 file changed, 148 insertions(+)","is_error":false}]},"uuid":"efd0b725-24d3-4f18-8466-a741646f16a3","timestamp":"2026-02-23T06:39:38.862Z","toolUseResult":{"stdout":"On branch main\nYour branch is up to date with 'origin/main'.\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n gardener.js | 148 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n 1 file changed, 148 insertions(+)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"0f78d12e-5a35-40b4-a9c5-b939c3ba2b5b"}
{"parentUuid":"efd0b725-24d3-4f18-8466-a741646f16a3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01BQMeV6qH3tTUC5jYz5urFr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LDNYpBHCf7e8Cb9W8buiiz","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nfeat: add Paste CSS and AI Prompt Template sections to control panel\n\n- Add Paste CSS section: collapsible textarea for applying CSS generated\n  by external AI tools, with optional theme name input and Save as Preset\n  support. Placeholder shows the expected :root variable structure.\n- Add AI Prompt Template section: collapsible readonly textarea containing\n  EXTERNAL_AI_PROMPT_TEMPLATE (rules, CSS variables, key classes), with a\n  Copy Prompt button that writes to clipboard and briefly shows \"Copied!\".\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Stage and commit gardener.js changes"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":231,"cache_read_input_tokens":66063,"output_tokens":243,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":231,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQYQGdmKoG2MPs6iP8FK","type":"assistant","uuid":"2deeec6c-4d49-48e7-b118-a42956fdacd9","timestamp":"2026-02-23T06:39:44.375Z"}
{"parentUuid":"2deeec6c-4d49-48e7-b118-a42956fdacd9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LDNYpBHCf7e8Cb9W8buiiz","type":"tool_result","content":"[main 3bd5647] feat: add Paste CSS and AI Prompt Template sections to control panel\n 1 file changed, 148 insertions(+)","is_error":false}]},"uuid":"ca0cf7d3-cd37-417b-89e8-6ac29b56aaf3","timestamp":"2026-02-23T06:39:45.207Z","toolUseResult":{"stdout":"[main 3bd5647] feat: add Paste CSS and AI Prompt Template sections to control panel\n 1 file changed, 148 insertions(+)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"2deeec6c-4d49-48e7-b118-a42956fdacd9"}
{"parentUuid":"ca0cf7d3-cd37-417b-89e8-6ac29b56aaf3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01FVtUpaFo3VPkSEpbWWz5Rx","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました。\n\n```\n3bd5647 feat: add Paste CSS and AI Prompt Template sections to control panel\n```\n\n`gardener.js` 1ファイル、148行追加です。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":291,"cache_read_input_tokens":66294,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":291},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYQjoPpcWqdYfcQiSeL","type":"assistant","uuid":"c88d3546-4a21-4d59-9efe-6e3c1b2f0824","timestamp":"2026-02-23T06:39:47.843Z"}
{"parentUuid":"c88d3546-4a21-4d59-9efe-6e3c1b2f0824","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"e8cc0e10-07b6-477a-9ebb-7b11cb913cda","toolUseID":"e8cc0e10-07b6-477a-9ebb-7b11cb913cda","timestamp":"2026-02-23T06:39:47.925Z","uuid":"2384d7e9-5feb-4fb1-8de8-07a632412861"}
{"parentUuid":"2384d7e9-5feb-4fb1-8de8-07a632412861","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":993}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:39:48.918Z","uuid":"dc727a20-bf77-412f-82df-3e267e08d553","toolUseID":"e8cc0e10-07b6-477a-9ebb-7b11cb913cda"}
{"type":"file-history-snapshot","messageId":"86ea311a-3e8b-4871-93b7-3113c509b467","snapshot":{"messageId":"86ea311a-3e8b-4871-93b7-3113c509b467","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v4","version":4,"backupTime":"2026-02-23T06:39:36.603Z"}},"timestamp":"2026-02-23T06:41:12.950Z"},"isSnapshotUpdate":false}
{"parentUuid":"dc727a20-bf77-412f-82df-3e267e08d553","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"Presetsを選択するたびにアコーディオンが閉じる仕様を削除して"},"uuid":"86ea311a-3e8b-4871-93b7-3113c509b467","timestamp":"2026-02-23T06:41:12.808Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"86ea311a-3e8b-4871-93b7-3113c509b467","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01PtTBk7AozxzWhKsU72biZr","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to remove the behavior where the Presets accordion closes every time a preset is selected. Let me find where `togglePresets` is called.","signature":"Er8CCkYICxgCKkB9a5SA9FY5LUrU3F4NLKIjwW2+B+Naz/W/jd//jCioDNAauhjfYh1LQIEsM3Qtg5U3Wf+rtQM2jiGeVff1BqUUEgxOWBX1MAn+iTtBQAAaDItaXvnN//X/r5aRsyIwduk1i53TD3Q9CCIluObmP/08nX/KZYtEUzNBviIwMtSXCVmrwoawJA2SxQN7nuaWKqYBFmem8ZJHDj511oUenULg/ya9xQc9fHeOHQEMH8wxkf+TXkUjegNjgvdvnZo3+Iee+dKn9pEg/7wzxb8zdMoegUaG+bzzIZ4OBKtOjox2jN3wxx7qUl7GFLc2UTIQMhNe9sSWLiM0Kf66XgTVXw1QYiDKvm9DCGSYhW75Z0ZIPakLjuuhQFIYR2qR957EIcLF7RGuivcf8IPd1RC/MUQzGuOayl70JRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":31,"cache_read_input_tokens":66637,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":31},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYXD5tQHe6bC4h94WXi","type":"assistant","uuid":"8afbb433-1b49-474f-b903-3cf025a3c04d","timestamp":"2026-02-23T06:41:14.929Z"}
{"parentUuid":"8afbb433-1b49-474f-b903-3cf025a3c04d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01PtTBk7AozxzWhKsU72biZr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DgmdjJHv5nyBHmDmJmAQeb","name":"Grep","input":{"pattern":"togglePresets","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":2},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":31,"cache_read_input_tokens":66637,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":31},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYXD5tQHe6bC4h94WXi","type":"assistant","uuid":"d11429fb-e282-4c38-8370-38be4c0985ca","timestamp":"2026-02-23T06:41:16.343Z"}
{"parentUuid":"d11429fb-e282-4c38-8370-38be4c0985ca","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01DgmdjJHv5nyBHmDmJmAQeb","toolUseID":"toolu_01DgmdjJHv5nyBHmDmJmAQeb","timestamp":"2026-02-23T06:41:16.706Z","uuid":"ccd47eab-6702-4135-8ba5-f3c64ccb82cd"}
{"parentUuid":"d11429fb-e282-4c38-8370-38be4c0985ca","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DgmdjJHv5nyBHmDmJmAQeb","type":"tool_result","content":"1474-                this.elements.promptInput.value = themeName;\n1475-                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n1476:                this.togglePresets(true);\n1477-            };\n1478-            this.elements.presetButtons.appendChild(btn);\n--\n1489-        \n1490-        if (this.elements.presetsToggle) {\n1491:            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n1492-        }\n1493-\n--\n1569-    },\n1570-\n1571:    togglePresets(collapse) {\n1572-        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n1573-        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n--\n1823-            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n1824-            this.applyStyle(css, null, name);\n1825:            this.togglePresets(true);\n1826-            this.renderSaveButton(true);\n1827-        });\n--\n1960-                this.applyStyle(theme.css, null, theme.prompt);\n1961-                this.renderSaveButton(false);\n1962:                this.togglePresets(true);\n1963-            });\n1964-\n--\n2002-        if (presetKey) {\n2003-            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n2004:            this.togglePresets(true);\n2005-            return;\n2006-        }\n--\n2020-            const css = await this.generateTheme(input);\n2021-            this.applyStyle(css, null, input);\n2022:            this.togglePresets(true);\n2023-            this.renderSaveButton(true);\n2024-        } catch (err) {"}]},"uuid":"5f9f622f-0f62-4a01-bd7a-4e78fe5f0353","timestamp":"2026-02-23T06:41:16.705Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1474-                this.elements.promptInput.value = themeName;\n1475-                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n1476:                this.togglePresets(true);\n1477-            };\n1478-            this.elements.presetButtons.appendChild(btn);\n--\n1489-        \n1490-        if (this.elements.presetsToggle) {\n1491:            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n1492-        }\n1493-\n--\n1569-    },\n1570-\n1571:    togglePresets(collapse) {\n1572-        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n1573-        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n--\n1823-            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n1824-            this.applyStyle(css, null, name);\n1825:            this.togglePresets(true);\n1826-            this.renderSaveButton(true);\n1827-        });\n--\n1960-                this.applyStyle(theme.css, null, theme.prompt);\n1961-                this.renderSaveButton(false);\n1962:                this.togglePresets(true);\n1963-            });\n1964-\n--\n2002-        if (presetKey) {\n2003-            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n2004:            this.togglePresets(true);\n2005-            return;\n2006-        }\n--\n2020-            const css = await this.generateTheme(input);\n2021-            this.applyStyle(css, null, input);\n2022:            this.togglePresets(true);\n2023-            this.renderSaveButton(true);\n2024-        } catch (err) {","numLines":41},"sourceToolAssistantUUID":"d11429fb-e282-4c38-8370-38be4c0985ca"}
{"parentUuid":"5f9f622f-0f62-4a01-bd7a-4e78fe5f0353","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Request interrupted by user]"}]},"uuid":"cec158f4-4f19-4297-a664-971ff1b3bb35","timestamp":"2026-02-23T06:41:21.284Z"}
{"type":"file-history-snapshot","messageId":"6e93ce70-6bd4-4064-a1fc-8ab089f601b9","snapshot":{"messageId":"6e93ce70-6bd4-4064-a1fc-8ab089f601b9","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v4","version":4,"backupTime":"2026-02-23T06:39:36.603Z"}},"timestamp":"2026-02-23T06:41:30.350Z"},"isSnapshotUpdate":false}
{"parentUuid":"cec158f4-4f19-4297-a664-971ff1b3bb35","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"Presetsを選択するたびに、コントロールパネルのアコーディオンが閉じる仕様を削除して"},"uuid":"6e93ce70-6bd4-4064-a1fc-8ab089f601b9","timestamp":"2026-02-23T06:41:30.211Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"6e93ce70-6bd4-4064-a1fc-8ab089f601b9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ABvv2ENk8uLLwXuEF8VwrP","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to remove the behavior where selecting a preset closes the Presets accordion. The `togglePresets(true)` call on line 1476 is the one triggered when clicking a preset button. I should remove just that call, but keep the other `togglePresets(true)` calls elsewhere (like after generating a theme via text input or Paste CSS).\n\nWait, let me re-read the user's request: \"Presetsを選択するたびにアコーディオンが閉じる仕様を削除して\" - remove the spec that closes the accordion every time a preset is selected.\n\nThe call at line 1476 is inside `renderPresetButtons()` where preset buttons are created. \n\nThat's the one to remove. The other calls at lines 1825, 1962, 2004, and 2022 are in different contexts—after pasting CSS, clicking saved themes, matching via text input, and generating via Gemini—so those should stay. The user specifically said \"Presetsを選択するたびに\" which refers to the preset buttons themselves, so I'll only remove the call at line 1476.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":46,"cache_read_input_tokens":67356,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":46},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYYVYNMwoAacAmcnGNL","type":"assistant","uuid":"80631623-7993-4490-8a9b-bbb672481a3c","timestamp":"2026-02-23T06:41:39.844Z"}
{"parentUuid":"80631623-7993-4490-8a9b-bbb672481a3c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ABvv2ENk8uLLwXuEF8VwrP","type":"message","role":"assistant","content":[{"type":"text","text":"プリセットボタンのクリック時だけ `togglePresets(true)` を削除します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":46,"cache_read_input_tokens":67356,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":46},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYYVYNMwoAacAmcnGNL","type":"assistant","uuid":"63e2c947-3f8c-4f20-a57e-52ecac0030fa","timestamp":"2026-02-23T06:41:39.972Z"}
{"parentUuid":"63e2c947-3f8c-4f20-a57e-52ecac0030fa","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ABvv2ENk8uLLwXuEF8VwrP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UU6fkg2CKKkkpWtzUAw2pg","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1471,"limit":8},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":46,"cache_read_input_tokens":67356,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":46},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYYVYNMwoAacAmcnGNL","type":"assistant","uuid":"d987afcf-2fc6-46f9-94e0-7de1e0a7c9cf","timestamp":"2026-02-23T06:41:40.713Z"}
{"parentUuid":"d987afcf-2fc6-46f9-94e0-7de1e0a7c9cf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01UU6fkg2CKKkkpWtzUAw2pg","toolUseID":"toolu_01UU6fkg2CKKkkpWtzUAw2pg","timestamp":"2026-02-23T06:41:40.778Z","uuid":"1bbb5476-8b39-4913-9773-672f02542abf"}
{"parentUuid":"d987afcf-2fc6-46f9-94e0-7de1e0a7c9cf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UU6fkg2CKKkkpWtzUAw2pg","type":"tool_result","content":"  1471→            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n  1472→            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n  1473→            btn.onclick = () => {\n  1474→                this.elements.promptInput.value = themeName;\n  1475→                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n  1476→                this.togglePresets(true);\n  1477→            };\n  1478→            this.elements.presetButtons.appendChild(btn);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e07bcfd0-4973-47be-91ce-0527edcc0b80","timestamp":"2026-02-23T06:41:40.777Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);","numLines":8,"startLine":1471,"totalLines":2066}},"sourceToolAssistantUUID":"d987afcf-2fc6-46f9-94e0-7de1e0a7c9cf"}
{"parentUuid":"e07bcfd0-4973-47be-91ce-0527edcc0b80","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01MoK7S1Wir4TEVdCavs8dK9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01S4hRbmXr8gen7WFSJ9ME2C","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };","new_string":"            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":817,"cache_read_input_tokens":67402,"output_tokens":211,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":817,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQYZG6Ggv6xGVXCDYgkr","type":"assistant","uuid":"f342ecaf-45e7-463e-b44a-e9d2d6c14d74","timestamp":"2026-02-23T06:41:43.428Z"}
{"parentUuid":"f342ecaf-45e7-463e-b44a-e9d2d6c14d74","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01S4hRbmXr8gen7WFSJ9ME2C","toolUseID":"toolu_01S4hRbmXr8gen7WFSJ9ME2C","timestamp":"2026-02-23T06:41:43.438Z","uuid":"0faf334c-f7dd-4130-8156-1734b3d3e5be"}
{"parentUuid":"f342ecaf-45e7-463e-b44a-e9d2d6c14d74","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01S4hRbmXr8gen7WFSJ9ME2C","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"d3aea26d-26c6-4ee8-8190-29c2f23e04c9","timestamp":"2026-02-23T06:41:43.437Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };","newString":"            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1473,"oldLines":7,"newStart":1473,"newLines":6,"lines":["             btn.onclick = () => {","                 this.elements.promptInput.value = themeName;","                 this.applyStyle(STYLE_PRESETS[themeName], themeName);","-                this.togglePresets(true);","             };","             this.elements.presetButtons.appendChild(btn);","         });"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f342ecaf-45e7-463e-b44a-e9d2d6c14d74"}
{"parentUuid":"d3aea26d-26c6-4ee8-8190-29c2f23e04c9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01WFRgk7cpSXXT8kfVEvdNnZ","type":"message","role":"assistant","content":[{"type":"text","text":"完了です。プリセットボタンをクリックしてもアコーディオンが閉じなくなりました。他の箇所（テキスト入力からのApply、Paste CSS、保存済みテーマ）の `togglePresets(true)` はそのまま残しています。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":380,"cache_read_input_tokens":68219,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":380},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYZTFjSZr2BbBW5NM5n","type":"assistant","uuid":"76289c70-177f-4a8c-9d3b-043fa90eb4d5","timestamp":"2026-02-23T06:41:46.192Z"}
{"parentUuid":"76289c70-177f-4a8c-9d3b-043fa90eb4d5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"dff3aded-ae95-4c17-81bf-dd2f566efe4a","toolUseID":"dff3aded-ae95-4c17-81bf-dd2f566efe4a","timestamp":"2026-02-23T06:41:46.265Z","uuid":"414c17d9-8167-4edc-98e1-ff81b6849d6c"}
{"parentUuid":"414c17d9-8167-4edc-98e1-ff81b6849d6c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":179}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:41:46.445Z","uuid":"816d3608-2382-4651-9281-2b3ef07beab6","toolUseID":"dff3aded-ae95-4c17-81bf-dd2f566efe4a"}
{"type":"file-history-snapshot","messageId":"731659a9-9ba1-4aa6-8912-740279f65ac1","snapshot":{"messageId":"731659a9-9ba1-4aa6-8912-740279f65ac1","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v5","version":5,"backupTime":"2026-02-23T06:44:29.087Z"}},"timestamp":"2026-02-23T06:44:29.086Z"},"isSnapshotUpdate":false}
{"parentUuid":"816d3608-2382-4651-9281-2b3ef07beab6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コントロールパネルをスワイプで折りたたんだ時に、Presetの文字が表示されたままなのを修正して"},"uuid":"731659a9-9ba1-4aa6-8912-740279f65ac1","timestamp":"2026-02-23T06:44:28.963Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"731659a9-9ba1-4aa6-8912-740279f65ac1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01832G6Zgzxe16pPSSRtTWNu","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to fix the issue where the \"Presets\" text remains visible when the control panel is collapsed/swiped away. Let me look at the CSS for the minimized state.","signature":"EtICCkYICxgCKkD+WVULT7Iq/V6VHkyOCZOkrdL1id+jRSra4tboFS3en/+dsM18WmjsDt5dfaE4f0DCudG3KEy0qqCL7c9tC/t0Egyt1orWbVAec5HyEjgaDIUTbpesMKAUvt1a5CIwGWzCHUaNNs35r3sohEWbJ+0O8mxKaFzMJiC2ofIc67niFfZPg13ODypYLPPbaFZJKrkBuN/sgaN0r+DCJNJK/zWAxt12em0a25+hNMTpi2bT3sfIvvFYuIlYqzkNRRD77GNRexh7sFfLDUw6a59o2sSPYijrstfT7lINkFJ+Xdvg0ZKhOOwVs674edDJJNh9CnZqnesVG2TSnXPg1jpyujEWAV7Oh7xiMxoHXDEYo9TMNs9FTN9KA22Z+A1jIdLYIySig+od+z2DnrC34oyV6dgVbtuD8qGSoqj8SymiZ+aqTUDOaK6Ur8twCAoYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":44,"cache_read_input_tokens":68682,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":44},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYmfXkhs8s3aLHJbZ3D","type":"assistant","uuid":"ecc46126-a5a8-4abb-a09e-b30dcecbe28a","timestamp":"2026-02-23T06:44:31.496Z"}
{"parentUuid":"ecc46126-a5a8-4abb-a09e-b30dcecbe28a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01832G6Zgzxe16pPSSRtTWNu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013HQXgzhjp1xxMCuTq5uPDt","name":"Grep","input":{"pattern":"is-minimized","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":2},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":44,"cache_read_input_tokens":68682,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":44},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYmfXkhs8s3aLHJbZ3D","type":"assistant","uuid":"35ba2ed2-0b59-4b33-87db-87bb24153e78","timestamp":"2026-02-23T06:44:32.600Z"}
{"parentUuid":"35ba2ed2-0b59-4b33-87db-87bb24153e78","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_013HQXgzhjp1xxMCuTq5uPDt","toolUseID":"toolu_013HQXgzhjp1xxMCuTq5uPDt","timestamp":"2026-02-23T06:44:32.934Z","uuid":"c4f4d5b4-2ffd-415e-902a-70ef3c6f525e"}
{"parentUuid":"35ba2ed2-0b59-4b33-87db-87bb24153e78","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013HQXgzhjp1xxMCuTq5uPDt","type":"tool_result","content":"502-            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n503-        }\n504:        #theme-controls.is-minimized {\n505-            transform: translateX(calc(100% - 20px));\n506-        }\n507:        #theme-controls.is-minimized > *:not(#panel-handle) {\n508-            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n509-        }\n--\n663-        #panel-handle:hover::before { opacity: 0.4; }\n664-        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n665:        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n666:        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n667-    }\n668-    @media (max-width: 768px) {\n--\n1507-                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n1508-                const deltaX = clientX - startX;\n1509:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1510-\n1511-                if (!isMin && deltaX > 0) {\n--\n1523-                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n1524-                const deltaX = clientX - startX;\n1525:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1526-\n1527-                this.elements.themeControls.style.transform = '';\n1528-\n1529-                if (Math.abs(deltaX) < 10) {\n1530:                    this.elements.themeControls.classList.toggle('is-minimized');\n1531-                } else {\n1532-                    if (!isMin && deltaX > threshold) {\n1533:                        this.elements.themeControls.classList.add('is-minimized');\n1534-                    } else if (isMin && deltaX < -threshold) {\n1535:                        this.elements.themeControls.classList.remove('is-minimized');\n1536-                    }\n1537-                }\n--\n1899-            if (icon) icon.style.transform = 'rotate(0deg)';\n1900-        }\n1901:        this.elements.themeControls.classList.remove('is-minimized');\n1902-        const input = document.getElementById('api-key-input');\n1903-        if (input) setTimeout(() => input.focus(), 300);"}]},"uuid":"9e37024b-8fa2-4d1e-a20c-6e458a0f86c6","timestamp":"2026-02-23T06:44:32.933Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"502-            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n503-        }\n504:        #theme-controls.is-minimized {\n505-            transform: translateX(calc(100% - 20px));\n506-        }\n507:        #theme-controls.is-minimized > *:not(#panel-handle) {\n508-            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n509-        }\n--\n663-        #panel-handle:hover::before { opacity: 0.4; }\n664-        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n665:        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n666:        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n667-    }\n668-    @media (max-width: 768px) {\n--\n1507-                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n1508-                const deltaX = clientX - startX;\n1509:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1510-\n1511-                if (!isMin && deltaX > 0) {\n--\n1523-                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n1524-                const deltaX = clientX - startX;\n1525:                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n1526-\n1527-                this.elements.themeControls.style.transform = '';\n1528-\n1529-                if (Math.abs(deltaX) < 10) {\n1530:                    this.elements.themeControls.classList.toggle('is-minimized');\n1531-                } else {\n1532-                    if (!isMin && deltaX > threshold) {\n1533:                        this.elements.themeControls.classList.add('is-minimized');\n1534-                    } else if (isMin && deltaX < -threshold) {\n1535:                        this.elements.themeControls.classList.remove('is-minimized');\n1536-                    }\n1537-                }\n--\n1899-            if (icon) icon.style.transform = 'rotate(0deg)';\n1900-        }\n1901:        this.elements.themeControls.classList.remove('is-minimized');\n1902-        const input = document.getElementById('api-key-input');\n1903-        if (input) setTimeout(() => input.focus(), 300);","numLines":43},"sourceToolAssistantUUID":"35ba2ed2-0b59-4b33-87db-87bb24153e78"}
{"parentUuid":"9e37024b-8fa2-4d1e-a20c-6e458a0f86c6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KAf8dBqXfCwdMZKfs7gTKw","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The issue is that when the control panel is minimized (swiped to the right), the CSS `#theme-controls.is-minimized > *:not(#panel-handle)` hides direct children of `#theme-controls` by setting opacity to 0. However, \"Presets\" text is inside `#presets-toggle` which is a direct child of `#theme-controls`, so it should be hidden.\n\nWait, let me look at the HTML structure again. In `index.html`:\n```html\n<div id=\"theme-controls\">\n    <div id=\"panel-handle\"></div>\n    <div id=\"presets-toggle\" ...>\n         <span ...>Presets</span>\n         ...\n    </div>\n    <div id=\"preset-buttons\" ...>\n    </div>\n    <div style=\"display: flex; gap: 10px; ...\">\n        <input type=\"text\" id=\"prompt-input\" ...>\n        <button id=\"generate-btn\" ...>Apply</button>\n    </div>\n</div>\n```\n\nSo `#presets-toggle` is a direct child of `#theme-controls` and should be hidden by the CSS selector when minimized.\n\nI'm noticing there are two places where the minimization styles are defined—one in `SYSTEM_STYLE` and another in `PANEL_STYLE`. Let me trace through whether the issue is that the bare browser defaults version is missing the panel minimization rules, or if there's a specificity conflict preventing the opacity from being applied.\n\nStill writing styles... Still examining the CSS selectors...\n\nActually, I think the issue might be with `overflow: hidden` not being applied to the panel itself, so when the transform pushes it off-screen, the text at the edge is still visible. The panel is positioned fixed at the bottom-right and only partially translated, leaving a 20px strip exposed where the \"Presets\" text can leak through. 20px visible (for the handle)\n\nSo the issue is: when the panel is translated to the right, some text in the panel might be visible because the panel's left edge (where the handle is, 20px) is the visible part, and the text in `#presets-toggle` might appear near the left of the panel.\n\nWait, looking at the CSS more carefully:\n- `#theme-controls` has `padding-left: 20px` in desktop\n- `#panel-handle` is `position: absolute; top: 0; left: 0; width: 20px; height: 100%`\n- `#presets-toggle` is a direct child of `#theme-controls`\n\nWhen minimized, `opacity: 0` should be applied to `#presets-toggle` (direct child). But the user says the Presets text remains visible.\n\nI think the issue might be with the timing of the animations — the opacity transition is 0.2s while the transform is 0.4s, so during the animation the text could briefly appear. But \"remains visible\" suggests it's staying visible permanently, not just during the transition.\n\nLooking at the CSS selector more carefully, the transition property is defined on the minimized state itself, which affects how it animates when transitioning back to expanded. I'm checking the HTML structure to see if all the dynamically added sections are direct children of the theme-controls container, which they should be for the CSS selector to work properly. I see the issue now—during the swipe gesture, the inline transform is applied directly to the theme controls element while the `is-minimized` class hasn't been added yet, so the child elements remain at full opacity as the user drags. Once the swipe threshold is met, the class gets toggled and the transform is cleared, which should trigger the opacity transition on those children.\n\nBut the user's complaint about the collapsed state suggests the problem might be something else entirely—perhaps an inline style attribute on the presets toggle element that's overriding the CSS opacity rules.\n\nLooking at the HTML, I can see the `#presets-toggle` has `opacity: 0.6` set directly as an inline style, which has higher specificity than any CSS selector. That's preventing the minimized state from hiding it properly. I could fix this by moving that opacity value into the stylesheet instead, or switching to a different hiding method like `visibility: hidden` or `clip-path`.\n\nBut wait, I'm noticing the same pattern elsewhere—the `#api-key-toggle` in `renderApiKeySection()` also has inline `opacity: 0.6`, which means this is a systemic issue with how these elements are being styled.\n\nThe real problem is that all these section toggles have inline opacity set, which overrides any CSS rules trying to hide them when the panel minimizes. The cleanest solution would be to either use `visibility: hidden` instead of opacity changes, or apply `overflow: hidden` to the parent container combined with a transform to actually remove them from view.\n\nWhen the panel translates right by `calc(100% - 20px)`, the handle stays visible in that leftmost 20px strip, but `overflow: hidden` would clip everything else that extends beyond those 20 pixels, effectively hiding all the content inside. children within the panel's left 20px would technically be visible. But `#presets-toggle` is a direct child with `padding-left: 20px` applied to its parent, so it starts 20px from the left edge—right at the boundary of the visible 20px area when minimized, potentially showing a sliver of text. The cleanest solution is to make child elements truly invisible when minimized, and since inline styles override CSS, I can apply those to hide the content.\n\nI'm weighing a few approaches: using `!important` on the opacity rule to override inline styles, adding `overflow: hidden` to clip content (though that won't fully work here), moving the inline opacity to CSS instead, or toggling opacity via JavaScript. The `!important` approach seems most legitimate—it's a state override that specifically needs to override inline styles. Let me check if there are multiple places in the CSS where this needs to be applied.\n\nLooking at the grep results, I found the rule in two locations: once in the base SYSTEM_STYLE around line 507-509, and again in the desktop media query block around line 665-666. I need to fix both for consistency across mobile and desktop. The user mentioned a swipe gesture for collapsing, which is typically mobile, but the JavaScript drag logic seems to be desktop-only based on the `panel-handle` element. Let me verify which interaction applies where.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":934,"cache_read_input_tokens":68726,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":934},"output_tokens":11,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYmwukKdPZNUY7ygGwZ","type":"assistant","uuid":"09ddba4f-6ab2-4743-84ce-f6be3c6b0f44","timestamp":"2026-02-23T06:45:43.456Z"}
{"parentUuid":"09ddba4f-6ab2-4743-84ce-f6be3c6b0f44","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KAf8dBqXfCwdMZKfs7gTKw","type":"message","role":"assistant","content":[{"type":"text","text":"原因を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":934,"cache_read_input_tokens":68726,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":934},"output_tokens":11,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYmwukKdPZNUY7ygGwZ","type":"assistant","uuid":"b1916dc4-d92c-472a-bc9d-6c9463334a9d","timestamp":"2026-02-23T06:45:43.516Z"}
{"parentUuid":"b1916dc4-d92c-472a-bc9d-6c9463334a9d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KAf8dBqXfCwdMZKfs7gTKw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0166o1GHVbZfZBiswJ5hyXyh","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/index.html","offset":12,"limit":4},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":934,"cache_read_input_tokens":68726,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":934},"output_tokens":11,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYmwukKdPZNUY7ygGwZ","type":"assistant","uuid":"c1edcf7c-9aff-416c-b159-d8e5de5885c8","timestamp":"2026-02-23T06:45:44.582Z"}
{"parentUuid":"c1edcf7c-9aff-416c-b159-d8e5de5885c8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_0166o1GHVbZfZBiswJ5hyXyh","toolUseID":"toolu_0166o1GHVbZfZBiswJ5hyXyh","timestamp":"2026-02-23T06:45:44.655Z","uuid":"920165c7-bd37-44bf-b53a-ebf91a2aa036"}
{"parentUuid":"c1edcf7c-9aff-416c-b159-d8e5de5885c8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0166o1GHVbZfZBiswJ5hyXyh","type":"tool_result","content":"    12→        <div id=\"presets-toggle\" style=\"width: 100%; cursor: pointer; font-size: 11px; margin-bottom: 8px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; user-select: none;\">\n    13→             <span style=\"text-transform: uppercase; letter-spacing: 1px; font-weight: 600;\">Presets</span>\n    14→             <span id=\"presets-icon\" style=\"font-size: 10px;\">▼</span>\n    15→        </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"176cfb6b-5ea6-4ed6-9aef-a8f907d2b115","timestamp":"2026-02-23T06:45:44.653Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/index.html","content":"        <div id=\"presets-toggle\" style=\"width: 100%; cursor: pointer; font-size: 11px; margin-bottom: 8px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; user-select: none;\">\n             <span style=\"text-transform: uppercase; letter-spacing: 1px; font-weight: 600;\">Presets</span>\n             <span id=\"presets-icon\" style=\"font-size: 10px;\">▼</span>\n        </div>","numLines":4,"startLine":12,"totalLines":119}},"sourceToolAssistantUUID":"c1edcf7c-9aff-416c-b159-d8e5de5885c8"}
{"parentUuid":"176cfb6b-5ea6-4ed6-9aef-a8f907d2b115","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KAf8dBqXfCwdMZKfs7gTKw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BKFoCJknqCoWu367c5yFBm","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":504,"limit":6},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":934,"cache_read_input_tokens":68726,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":934},"output_tokens":11,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYmwukKdPZNUY7ygGwZ","type":"assistant","uuid":"7cb8bc34-4981-4bfa-a977-6c4adec224ad","timestamp":"2026-02-23T06:45:45.141Z"}
{"parentUuid":"7cb8bc34-4981-4bfa-a977-6c4adec224ad","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01BKFoCJknqCoWu367c5yFBm","toolUseID":"toolu_01BKFoCJknqCoWu367c5yFBm","timestamp":"2026-02-23T06:45:45.196Z","uuid":"158bc3bf-3d7a-453b-b8f8-7861b57e4006"}
{"parentUuid":"7cb8bc34-4981-4bfa-a977-6c4adec224ad","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BKFoCJknqCoWu367c5yFBm","type":"tool_result","content":"   504→        #theme-controls.is-minimized {\n   505→            transform: translateX(calc(100% - 20px));\n   506→        }\n   507→        #theme-controls.is-minimized > *:not(#panel-handle) {\n   508→            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n   509→        }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ca5c4796-116f-44b0-844b-190a0330495d","timestamp":"2026-02-23T06:45:45.195Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }","numLines":6,"startLine":504,"totalLines":2065}},"sourceToolAssistantUUID":"7cb8bc34-4981-4bfa-a977-6c4adec224ad"}
{"parentUuid":"ca5c4796-116f-44b0-844b-190a0330495d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017spGxoyc1r4pGpsJutBgJa","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Found the bug. `#presets-toggle` has an inline style `opacity: 0.6`, which overrides the CSS `opacity: 0`. The fix is to add `!important` to the CSS rule.\n\nThere are two places where this CSS is defined:\n1. Line 507-509 (SYSTEM_STYLE)\n2. Line 665-666 (in the desktop media query, which is a duplicate)\n\nI need to add `!important` to both.","signature":"EvoDCkYICxgCKkAWxemeXlxxE8NLwfcNCB9pKhCETMZE7DA3yCU19MJR//P1UQ2XZqoej3w4TuiN1jXqL5RFlTfJ4vQ3nhy7XZ/dEgxt5xqkaQOK08UulfcaDPwL1bvCgfPuFWuyCCIwjbHwTtYqzyfCdTW8/RA8nR6pwNWvhJxqU/wVhkCxU8m5LmJ+hhEYtKuifdDiW7HyKuEC5ls+vKM4EZ9Ll7Ln8FbQ9dWXk5f42Jji7vvTl+A9ugum8TXM2O9CbfLxFSyyTWII/d9/Gj8851JaAcORJaeVx3kpJfPXeyAyqfuSRBYDaWm1cMZXMCOh5jRRLFk0F6ubv7ux/bWvOfD8lBZBAAIFe100w0+zG/raiQoXleFWox54yErUpqFMjl4ZrjEdRrIQnDTadWKNbfypN7xL5Ppeiyv2yktdWA4PgQxJp0aqsXFe32dhKSzIJm+2tum+xERLiJKhjDS5HsLTc/5JOZmg9a75T5vxyEOVnD2/CgBvAuSRX+qLd8XHSMAwFp4/ts8DOYKfjitVeepbDYixovlpSOFerH352DYH+oQdiVsSC+2RqxYR/Jhl35B5+ZXmRjQumZfzmClY7jbd/qv7ErM6s99TkuWahb7ahgfX6a0IfV6KQuXIfdcfsIbzyThT1Dtx+lvF1zWQ37SnsAyqeRHMfh8YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4872,"cache_read_input_tokens":69660,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4872},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYsGteHvsTim7gPEQgh","type":"assistant","uuid":"95ed59fd-823e-4c94-9ce3-e91171ae6d15","timestamp":"2026-02-23T06:45:48.266Z"}
{"parentUuid":"95ed59fd-823e-4c94-9ce3-e91171ae6d15","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017spGxoyc1r4pGpsJutBgJa","type":"message","role":"assistant","content":[{"type":"text","text":"原因判明。`#presets-toggle` に `opacity: 0.6` がインラインスタイルで書かれており、CSSの `opacity: 0` を上書きしてしまっています。同じ問題は動的に追加される他のセクションヘッダー（API Key、Paste CSS、Prompt Template）にも存在します。`!important` で上書きします。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4872,"cache_read_input_tokens":69660,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4872},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYsGteHvsTim7gPEQgh","type":"assistant","uuid":"bd35fcee-4363-4f69-a4d8-93b8c8567b49","timestamp":"2026-02-23T06:45:50.328Z"}
{"parentUuid":"bd35fcee-4363-4f69-a4d8-93b8c8567b49","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017spGxoyc1r4pGpsJutBgJa","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QsEKhaJUhVNYk78qEssnHk","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":663,"limit":5},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4872,"cache_read_input_tokens":69660,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4872},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYsGteHvsTim7gPEQgh","type":"assistant","uuid":"c4c25d9d-23c2-4be3-9121-f685ac4d5cb1","timestamp":"2026-02-23T06:45:50.902Z"}
{"parentUuid":"c4c25d9d-23c2-4be3-9121-f685ac4d5cb1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01QsEKhaJUhVNYk78qEssnHk","toolUseID":"toolu_01QsEKhaJUhVNYk78qEssnHk","timestamp":"2026-02-23T06:45:50.951Z","uuid":"0d563226-6fa0-48de-ab03-45983e3c8492"}
{"parentUuid":"c4c25d9d-23c2-4be3-9121-f685ac4d5cb1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QsEKhaJUhVNYk78qEssnHk","type":"tool_result","content":"   663→        #panel-handle:hover::before { opacity: 0.4; }\n   664→        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n   665→        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n   666→        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n   667→    }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a4800c23-d621-47dc-8231-f9068304d06b","timestamp":"2026-02-23T06:45:50.950Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }","numLines":5,"startLine":663,"totalLines":2065}},"sourceToolAssistantUUID":"c4c25d9d-23c2-4be3-9121-f685ac4d5cb1"}
{"parentUuid":"a4800c23-d621-47dc-8231-f9068304d06b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01WyqDaa9MEw8cV3iL3wWm1N","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JVUVuFCbDt2u4DdjmQGfAY","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }","new_string":"        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":576,"cache_read_input_tokens":74532,"output_tokens":223,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":576,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQYsheRA9Eyd4ka16V55","type":"assistant","uuid":"948e6228-455a-4a78-b100-478f58b01b4a","timestamp":"2026-02-23T06:45:54.618Z"}
{"parentUuid":"948e6228-455a-4a78-b100-478f58b01b4a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01JVUVuFCbDt2u4DdjmQGfAY","toolUseID":"toolu_01JVUVuFCbDt2u4DdjmQGfAY","timestamp":"2026-02-23T06:45:54.629Z","uuid":"395640e3-24be-4181-bd12-1590f129063f"}
{"parentUuid":"948e6228-455a-4a78-b100-478f58b01b4a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JVUVuFCbDt2u4DdjmQGfAY","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"c0197f1b-4caf-4e31-837d-b72f32305a8f","timestamp":"2026-02-23T06:45:54.628Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }","newString":"        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":505,"oldLines":7,"newStart":505,"newLines":7,"lines":["             transform: translateX(calc(100% - 20px));","         }","         #theme-controls.is-minimized > *:not(#panel-handle) {","-            opacity: 0; pointer-events: none; transition: opacity 0.2s;","+            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;","         }","     }"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"948e6228-455a-4a78-b100-478f58b01b4a"}
{"parentUuid":"c0197f1b-4caf-4e31-837d-b72f32305a8f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_014a3ibBnwZTbLbSPFs4DYpc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UpRUBYedkEu3rVZGD6jDBS","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }","new_string":"        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":262,"cache_read_input_tokens":75108,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":262},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYsyDHwB2ZuQQkZjyc1","type":"assistant","uuid":"efb75877-ffcc-4bb8-b380-eb4df0b80999","timestamp":"2026-02-23T06:45:57.176Z"}
{"parentUuid":"efb75877-ffcc-4bb8-b380-eb4df0b80999","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01UpRUBYedkEu3rVZGD6jDBS","toolUseID":"toolu_01UpRUBYedkEu3rVZGD6jDBS","timestamp":"2026-02-23T06:45:57.181Z","uuid":"2aff902f-b8fe-4da0-84eb-f72e17c73b58"}
{"parentUuid":"efb75877-ffcc-4bb8-b380-eb4df0b80999","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UpRUBYedkEu3rVZGD6jDBS","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"49a93fc9-3bed-4b9a-aba1-a49298ccebd9","timestamp":"2026-02-23T06:45:57.180Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }","newString":"        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":663,"oldLines":7,"newStart":663,"newLines":7,"lines":["         #panel-handle:hover::before { opacity: 0.4; }","         #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }","         #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }","-        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0; pointer-events: none; transition: opacity 0.2s; }","+        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }","     }","     @media (max-width: 768px) {","         #theme-controls {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"efb75877-ffcc-4bb8-b380-eb4df0b80999"}
{"parentUuid":"49a93fc9-3bed-4b9a-aba1-a49298ccebd9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Nd1XcQ62GTnh712Pb1WBuH","type":"message","role":"assistant","content":[{"type":"text","text":"修正完了です。\n\n**原因**: `#presets-toggle`（および動的に追加される各セクションのトグルヘッダー）にインラインスタイルで `opacity: 0.6` が指定されており、CSSの `opacity: 0` より優先度が高いため非表示にならなかった。\n\n**修正**: 2箇所（SYSTEM_STYLEの通常セクションとデスクトップ用メディアクエリ）の `opacity: 0` に `!important` を追加し、インラインスタイルを上書きするようにしました。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":254,"cache_read_input_tokens":75370,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":254},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQYtAGojCtTSmJ7Gecji","type":"assistant","uuid":"2d7ef353-208f-47e8-a68b-327dd1522ace","timestamp":"2026-02-23T06:46:01.162Z"}
{"parentUuid":"2d7ef353-208f-47e8-a68b-327dd1522ace","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"17bb4d77-b48b-4d9f-96ba-8a8fa5010330","toolUseID":"17bb4d77-b48b-4d9f-96ba-8a8fa5010330","timestamp":"2026-02-23T06:46:01.224Z","uuid":"877328e0-b00d-4955-9448-f207f4c30670"}
{"parentUuid":"877328e0-b00d-4955-9448-f207f4c30670","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":164}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:46:01.388Z","uuid":"0e84fe00-64f0-4b66-a0a4-035d7e0d4424","toolUseID":"17bb4d77-b48b-4d9f-96ba-8a8fa5010330"}
{"parentUuid":"0e84fe00-64f0-4b66-a0a4-035d7e0d4424","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":92302,"timestamp":"2026-02-23T06:46:01.390Z","uuid":"9917a11e-3dcb-48c8-aac1-f6d2b61c6957","isMeta":false}
{"type":"file-history-snapshot","messageId":"e743ee99-78c9-491f-889b-ef0ee07f2d52","snapshot":{"messageId":"e743ee99-78c9-491f-889b-ef0ee07f2d52","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v6","version":6,"backupTime":"2026-02-23T06:47:30.011Z"}},"timestamp":"2026-02-23T06:47:30.010Z"},"isSnapshotUpdate":false}
{"parentUuid":"9917a11e-3dcb-48c8-aac1-f6d2b61c6957","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"Paste CSSからApplyしたテーマを、カスタムプリセットとして保存できるようにする機能を実装してみてください。"},"uuid":"e743ee99-78c9-491f-889b-ef0ee07f2d52","timestamp":"2026-02-23T06:47:29.873Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"e743ee99-78c9-491f-889b-ef0ee07f2d52","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01TTUi6CanedRoGWYmfdJEFr","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to implement a feature to save themes applied via \"Paste CSS\" as custom presets. Let me look at the existing \"Save as Preset\" functionality to understand how it works, then extend it for the Paste CSS flow.\n\nActually, looking at the code already, when a CSS is applied via `applyStyle(css, null, name)`, it:\n1. Saves to `localStorage` as `genhn-custom-css` and `genhn-custom-prompt`\n2. Shows the \"Save as Preset\" button via `renderSaveButton(true)`\n\nAnd `saveCurrentTheme()` saves it to `genhn-saved-themes` in localStorage, rendering it as a button in the preset area.\n\n\nWait, I'm realizing the \"Save as Preset\" button already appears when you apply CSS via Paste CSS, so the core functionality exists—but maybe the user wants the saved presets to be more discoverable or organized in a dedicated section rather than just appearing as buttons. but the button gets inserted after the generate button, which is outside the Paste CSS section entirely. The user probably wants a more integrated save option right there in the same area where they're pasting and applying CSS, rather than having to hunt for a button that appears elsewhere on the page.\n\nI'm thinking the cleanest approach would be to show a \"Save as Preset\" button directly within the Paste CSS section itself, appearing after they click Apply. That way the save functionality is right where they're working, making the workflow feel more cohesive.\n\nLooking at the user's request more carefully, they want to save themes applied from Paste CSS as custom presets. The current save mechanism might already handle this, but the real improvement would be separating custom presets visually from the built-in ones so users can easily distinguish what they've created themselves.\n\nI'll create a dedicated \"Save as Preset\" flow that lives within the Paste CSS section itself—when someone applies CSS, they get a save button right there with the option to name their preset, and saved presets will appear in their own distinct area with a visual indicator to set them apart from the defaults.\n\nExamining the current implementation...\n\nBuilding the save flow into the Paste CSS section...","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":154,"cache_read_input_tokens":75788,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":154},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ118pygKwYeZb9bdcG","type":"assistant","uuid":"b7e2ba91-c79f-4770-8e46-eb59bd7fca5b","timestamp":"2026-02-23T06:48:03.538Z"}
{"parentUuid":"b7e2ba91-c79f-4770-8e46-eb59bd7fca5b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01TTUi6CanedRoGWYmfdJEFr","type":"message","role":"assistant","content":[{"type":"text","text":"現在の保存周りのコードを詳しく確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":154,"cache_read_input_tokens":75788,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":154},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ118pygKwYeZb9bdcG","type":"assistant","uuid":"10ae9996-97b7-4655-bc40-b55dfd211d63","timestamp":"2026-02-23T06:48:03.656Z"}
{"parentUuid":"10ae9996-97b7-4655-bc40-b55dfd211d63","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01TTUi6CanedRoGWYmfdJEFr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UzhzCaYvSVHePdDaTjfuna","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1915,"limit":80},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":154,"cache_read_input_tokens":75788,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":154},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ118pygKwYeZb9bdcG","type":"assistant","uuid":"0fa13e0e-6591-4d40-b5f9-b1c1351d7e33","timestamp":"2026-02-23T06:48:04.562Z"}
{"parentUuid":"0fa13e0e-6591-4d40-b5f9-b1c1351d7e33","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01UzhzCaYvSVHePdDaTjfuna","toolUseID":"toolu_01UzhzCaYvSVHePdDaTjfuna","timestamp":"2026-02-23T06:48:04.620Z","uuid":"60040f02-11b3-44d3-bbe5-a85a5b31a203"}
{"parentUuid":"0fa13e0e-6591-4d40-b5f9-b1c1351d7e33","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UzhzCaYvSVHePdDaTjfuna","type":"tool_result","content":"  1915→        catch (_) { return []; }\n  1916→    },\n  1917→\n  1918→    saveCurrentTheme() {\n  1919→        const css = localStorage.getItem('genhn-custom-css');\n  1920→        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n  1921→        if (!css) return;\n  1922→\n  1923→        const baseName = this.summarizePrompt(prompt);\n  1924→        const saved = this.getSavedThemes();\n  1925→        if (saved.some(t => t.css === css)) return;\n  1926→\n  1927→        let name = baseName;\n  1928→        const existingNames = new Set(saved.map(t => t.name));\n  1929→        let i = 2;\n  1930→        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n  1931→\n  1932→        saved.push({ id: Date.now().toString(), name, css, prompt });\n  1933→        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n  1934→        this.renderSavedThemeButtons();\n  1935→        this.renderSaveButton(false);\n  1936→    },\n  1937→\n  1938→    deleteSavedTheme(id) {\n  1939→        const saved = this.getSavedThemes().filter(t => t.id !== id);\n  1940→        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n  1941→        this.renderSavedThemeButtons();\n  1942→    },\n  1943→\n  1944→    renderSavedThemeButtons() {\n  1945→        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n  1946→\n  1947→        this.getSavedThemes().forEach(theme => {\n  1948→            const wrapper = document.createElement('div');\n  1949→            wrapper.className = 'saved-theme-btn-wrapper';\n  1950→            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n  1951→\n  1952→            const btn = document.createElement('button');\n  1953→            btn.textContent = theme.name;\n  1954→            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n  1955→            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n  1956→            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n  1957→            btn.addEventListener('click', () => {\n  1958→                this.elements.promptInput.value = theme.prompt;\n  1959→                this.applyStyle(theme.css, null, theme.prompt);\n  1960→                this.renderSaveButton(false);\n  1961→                this.togglePresets(true);\n  1962→            });\n  1963→\n  1964→            const delBtn = document.createElement('button');\n  1965→            delBtn.textContent = '×';\n  1966→            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n  1967→            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n  1968→            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n  1969→            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n  1970→\n  1971→            wrapper.appendChild(btn);\n  1972→            wrapper.appendChild(delBtn);\n  1973→            this.elements.presetButtons.appendChild(wrapper);\n  1974→        });\n  1975→    },\n  1976→\n  1977→    renderSaveButton(show) {\n  1978→        const existing = document.getElementById('save-theme-row');\n  1979→        if (existing) existing.remove();\n  1980→        if (!show) return;\n  1981→\n  1982→        const row = document.createElement('div');\n  1983→        row.id = 'save-theme-row';\n  1984→        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n  1985→\n  1986→        const btn = document.createElement('button');\n  1987→        btn.textContent = 'Save as Preset';\n  1988→        btn.style.cssText = 'font-size:11px;';\n  1989→        btn.addEventListener('click', () => this.saveCurrentTheme());\n  1990→\n  1991→        row.appendChild(btn);\n  1992→        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n  1993→    },\n  1994→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3d68a33f-52a3-482b-b861-6f40b192c41b","timestamp":"2026-02-23T06:48:04.619Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n","numLines":80,"startLine":1915,"totalLines":2065}},"sourceToolAssistantUUID":"0fa13e0e-6591-4d40-b5f9-b1c1351d7e33"}
{"parentUuid":"3d68a33f-52a3-482b-b861-6f40b192c41b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01TTUi6CanedRoGWYmfdJEFr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HWd5BqwKGXfwYNYyQPVG7u","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1995,"limit":60},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":154,"cache_read_input_tokens":75788,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":154},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ118pygKwYeZb9bdcG","type":"assistant","uuid":"8eac7f2c-3bb8-4a1f-b193-1bc739a8bfac","timestamp":"2026-02-23T06:48:05.008Z"}
{"parentUuid":"8eac7f2c-3bb8-4a1f-b193-1bc739a8bfac","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01HWd5BqwKGXfwYNYyQPVG7u","toolUseID":"toolu_01HWd5BqwKGXfwYNYyQPVG7u","timestamp":"2026-02-23T06:48:05.015Z","uuid":"6ff46965-19b7-40c4-bb15-7db45181663b"}
{"parentUuid":"8eac7f2c-3bb8-4a1f-b193-1bc739a8bfac","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HWd5BqwKGXfwYNYyQPVG7u","type":"tool_result","content":"  1995→    async handleGenerate() {\n  1996→        const input = this.elements.promptInput.value.trim();\n  1997→        if (!input) return;\n  1998→        if (this._isGenerating) return;\n  1999→\n  2000→        const presetKey = this.matchStyle(input);\n  2001→        if (presetKey) {\n  2002→            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n  2003→            this.togglePresets(true);\n  2004→            return;\n  2005→        }\n  2006→\n  2007→        if (!this.getApiKey()) {\n  2008→            this.expandApiKeySection();\n  2009→            return;\n  2010→        }\n  2011→\n  2012→        this._isGenerating = true;\n  2013→        const btn = this.elements.generateBtn;\n  2014→        const originalText = btn.textContent;\n  2015→        btn.textContent = 'Generating...';\n  2016→        btn.disabled = true;\n  2017→\n  2018→        try {\n  2019→            const css = await this.generateTheme(input);\n  2020→            this.applyStyle(css, null, input);\n  2021→            this.togglePresets(true);\n  2022→            this.renderSaveButton(true);\n  2023→        } catch (err) {\n  2024→            this.showGenerateError(err);\n  2025→        } finally {\n  2026→            btn.textContent = originalText;\n  2027→            btn.disabled = false;\n  2028→            this._isGenerating = false;\n  2029→        }\n  2030→    },\n  2031→\n  2032→    matchStyle(input) {\n  2033→        const normalizedInput = input.toLowerCase();\n  2034→        for (const key in STYLE_PRESETS) {\n  2035→            if (normalizedInput.includes(key.toLowerCase())) return key;\n  2036→        }\n  2037→        return null;\n  2038→    },\n  2039→\n  2040→    applyStyle(css, themeName, customPrompt = null) {\n  2041→        this.toggleMenu(false);\n  2042→\n  2043→        if (themeName && STYLE_PRESETS[themeName]) {\n  2044→            localStorage.setItem('genhn-theme', themeName);\n  2045→            localStorage.removeItem('genhn-custom-css');\n  2046→            localStorage.removeItem('genhn-custom-prompt');\n  2047→            this.renderSaveButton(false);\n  2048→        } else if (customPrompt) {\n  2049→            localStorage.setItem('genhn-custom-css', css);\n  2050→            localStorage.setItem('genhn-custom-prompt', customPrompt);\n  2051→            localStorage.removeItem('genhn-theme');\n  2052→        }\n  2053→\n  2054→        const applyFn = () => {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e814fb19-0753-4af7-8617-e2714da744a0","timestamp":"2026-02-23T06:48:05.015Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {","numLines":60,"startLine":1995,"totalLines":2065}},"sourceToolAssistantUUID":"8eac7f2c-3bb8-4a1f-b193-1bc739a8bfac"}
{"parentUuid":"e814fb19-0753-4af7-8617-e2714da744a0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01GKU9tLTNQsT57nDdf95vcU","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I understand the full picture. Currently:\n\n1. `applyStyle(css, null, name)` saves CSS to localStorage\n2. `renderSaveButton(true)` shows \"Save as Preset\" button after the prompt input row\n\nThe existing \"Save as Preset\" button already works when Paste CSS is applied. But the UX is poor because:\n- The save button appears after the prompt input row (not near the Paste CSS section)\n- The name input in Paste CSS doesn't directly map to the saved preset name (because `saveCurrentTheme()` uses `summarizePrompt(localStorage.getItem('genhn-custom-prompt'))` to derive the name)\n\n\n- I need to add a dedicated \"Save as Preset\" button within the Paste CSS section that appears after Apply is clicked, and create a new method that saves the CSS with the exact name from the name input field rather than deriving it from the prompt.\n\nNow I'm implementing the save functionality by adding a hidden save row to the form that becomes visible after applying CSS, then creating a method that handles duplicate names and persists the theme to storage before re-rendering the saved theme buttons. Writing the saveThemeAs method... Writing the paste CSS handlers... Writing the paste CSS form...","signature":"EpwtCkYICxgCKkCsHxU7QewTZDelApbWZ52AisWOK9fJbqlJc0LYNgoRbgBDiRctCOVQpxRuXIAyb7Jnki08zbCSVrTchmyDm1fyEgxJTFe7WRar07IXCOQaDMgMpgPlGDUOzv0dCyIwl5WURZlN5NRxkBiaE+QCehcBzfDUHg16UsRYiQ5BAg+TmFd3/Z86rnmYs32Dq/ZIKoMshjNttTJXXz2TxOa7DGEbiTg+8G9InP1/5HvO2LdnZSXuzZiQQII4R01JY462e9snnfvdOV5MQ2XkqVh9POgrfz43ZAuFVxQnoUv9lvcVpw+fj31hVZbCkf8/7hTAEBnmzTnaSmXTcXJP/a3EY/8eujKCC5QBQem4yU7j9adWK5IA7xZE2PKhiHmTsFntQHzEdFXDPHLSyWEzyj0959fEsQ7BOc9tCuUqZbH/gONsC+pBPewOe4O8kdY1Hop5zJZTF+Vwri9CSwQxqgZLj4P2qug9X2WAztzg3pV4BEf0c3t6qL8+TjsbWQfsM3Pqc7RFN4HTZiEKEnE7B07KZvHKx/Rw3GXZ9qcpI1qZ8vlDgC6+vH7AwHVJFjv0RMFNxv83+4tDsRJeob0cQ0/73PELD5mwca3oztpkgeRctj5XbqLNduy9iEbI0Cj6MW8SSO9vY+9mf2Kp2GYjRAEzQem1i68e1K/77ZIoV87xsl2MPhYFOoCMC0scHZ0TE6YvotioBcE9U3vjhsCKrgKHshvi42j/gJfvuf8SZz9eFY5ZvjL7209mz/pote+hnhUlNBe6fwV2BezL25ytXJVrbxmQR61J/HBvlEi6Hpq6832ZhPQOrKncTetllyXDhZvoDsigMsJV0AndorxVQjLoSs2zP1RoXI/dNH4CPd3/bR4QH9DcuZxnzTcgZCjIs+/BacDVsIpu3rER07Z1JGKqe8gH7b1PcOZ652vh4pemBxN2Vdd8TellFBQXWi84DkMx2gUOtOBZOeoXSHQMu8nWgjb33OmmDTTWXAlrsuN+3iFtjfURO+nYnhovpzzsY+sx/5/3eWqiVa/XH11Bqi1s5mPSw2fbJcBjgVMrnrN382uJMaCz7cOofLeqnH4gei8eEE70ZCRz+w/wD8z2nFma1X+mQpmjORKKsp0lIrDxrdhcDfGbNSnidxaHlIKbMRaqkXaE1DAcIgzkEK+qNjjl4tcm4flZhwPjlbtVvHeGTFxSRqOhGku/tkU2Dv5hcMg8kCS67W/aobyd1Eize9jg/b0kP0nhxqYTBLQX3rJJGCDFcUUNExUC3bYJJuBf+nJpKRCq9M6VdANpUJevrTtUws26JZyT4iFy85uqO4ZHoU7aSrhyotrI1R+SzFj1u+wNK9WFPu4SPy4W9upbTJlfVEYRqvBMrjw+1h8da5rTCJHp4hQh3wr9yPrJCPcPZ36POhcospFRSG6fGMwl2icyNt9rp89/6SiXA8iGxu1M8DWq11DDzmg/s4nruOIn8eJsXOYrmJXVQwPtXSTAx2KbPLdPwaLUjTllmHC4w3W2Ck528/5E6nZv7RR6gHfMpBqN50ihFW76e9NmSZwaxyd8HDgAeQj4QWenBlIqLHtJnCzPI3x36Ccq4NgguSDe8KC/1UGw5J6GEZjdplDnbg2lrE+1YABcvdcpPy73PEYzUCgbjqEMhO5bOM5nL0NO1fc7T3jeblKQNiPSh3us2Z+bzOqTGwLGeZniXzzw81jV4hf1ktyK0DZvtyKb+/G+iXvS2JjI7h+8kid0xlWfUyNjD6WL6MNN7uq1JrSiVzAIM1qdGlyT32j2TA1KYGeNteBOiMh4YkwmWoiHKQ0Tcw6tM03X8Pay3MXs0xBx3+ZO6WUOZHbgyEtcDEhm9lFlFANV6rmW2SM464UprNjmlKDIMcjhLm6Qor+LdCNNnmGMlCW+pHjGMtCM67t75FnSSCy5M+N67Td+Yndwt8UDwIhZSWekolbC9WLxVn3qxaf/+xJ4Bt7TXqhHEclAerjyh4vHmXSsGQamUorCTDbp0R8NTEQ2QNO3vYAzsbaILaLlpgjUCuZrmMBqmqX10qoznJdDe0p8sXBMbfpElMTGSiLed2SD+sy+4V1aJ/DyR7n2axbxF5GYsALS12R+uOcnjy5+jTHG36dI2ar70WQbl8b18PHbLqTHky2XCOvrrFRTYpQHn7QRbvALu669G1lQQzCYW4937sjwxf6Om/iDq5O2j1H6gkkezi9NP76nuboUN5/BPp6rVgMxw/9Vs3bBvhMk3GN8xJmMEnB6JYSVEDLZx76BlAhoTdNp3DMkFff8jKqhO71QSFdvbFP7/NCKw5THvjQsdxYi8R9dVFzkasvmoSMwpaMrCi4jbvI7R3cGAUZo16vejvySAb5W7qD8JaVZzmvau4nbz52hdIBJC7AhvGP5B1iGuh1d7yupgx7TjXuczqmFx78xu4nP8CwyhIGc6Geu0YWqA+MY3BM5FQlXxWPYXIGnxZfnNt/icNnhELBY0/Nch7/bUeYxanV3DrjrF1EW9hR2qtlfQ7wl2kkXSf4qOZhqp4U0OsY0luNAvGa/5pJKzMmu3bfzvDT6Px6wy4QC9zp+5epApZFlNHoIt/hobqN0kCSQwqvrIsdiujbVXZrxEBqulByzwY/uQN4C0D/DUAnscyxcYJ1wbCfgxSltZd0pSmr/qWfoGP2Zj0egqcgWcg9Hx/3EWDhjZoSVTZNdhSdgcYWq0OMahQZienga2U2pCRNIzolpL3tR3VkPeLZatL2sUmYjAU6gnORns8vVAuWF/z/K4Y5giSHR1vGxe2VLQk3c40zdLRN+DQVHw3OkvzcbsPd3dCUd5/sogU4cBT/R2YX1geW6OdGXaLhwAn05U95oV7jnEuEUby/MiygfAHpEDi1bllxBOmlV0tAvGIBnaMyv5wlHgWDz8PhnRmlPDgw7lZwcU90CkVIVGwCK8LrlEdh9LeHpUZzTWcCYF/MrzMsyfgyeLwiP420CIIpkfxxF4ZiO+dkd2J8c1LztKc8hsbo4LeJ1dhQehUHSFljR5K/91wDsZLvOHRp03nFQZttXcBCRQz7JnzgvoFLHXgkjKlYgL1/VVNxQAbfyn0cWzyQgTHQLKPmawpgOBeyA1UX6Nn+CSTM9JBCWSFvfGUU51hPohl9E20MNIDg06nSzhXt/X/6dRnO2h3ckTPXkFzv/U+G0fmMKwCF2vbwoG3yAeSO00uiR0lk9rPKImUgnapLEZgh9gvS9c5MPFp/QR5YaXKDLsyG6l+4ecSxbILNoscl/Oovj1qP5igNrI+Ifamh32db2McI6aQqyXGpZIrHwCsGcrcpnnJckyZvS/H64Jr4nLU3ZScZ8wwdI3hAfvK7xy/8jlVqY+UlFeG9yP2eYrgtBUW8IEGGSm3+c6LB34fXiBGPzkiv6X0TyLK7OOYMb57nJmGhmYWakXkUNZwsEUd3Ts0btZPLV7u9x/eqG0zI7FG7khvGPGXJWY36fS14o1pLBxdUT0xzv0dyfNXhOrpqQpE8HVTJCVR2pXqnVfb380qyUtSHDKRCTkaGzygAtWsvb/Q14U8yVEvsh+RPhlsN5rwcrNaT8GxylOXRjZMZkV277H+BmTiLRWQOaDWA2mhSm2HVyfxh+Hw4IQmRU202C2hD5C4iPLBeshl8J7jQa7DnaynTj8GLPSNgVBm7Zz9cieiu9z5L3fKykCsff6STmltbcQ14hkp/1t6laPHsL91ThaIUBVv1K17yfrEC21cnHr6UwI/zFYyInqZE0efxQ/qvzHa3xGsicvdVaItyNpS5nIpobH7nGfGY4o3IUmIL7ajjvUp7BnsBR51KgDFExj1Apbyb9GDYgLpvCyJu9U/B2z5esY2GI58CkvlF9Gia7WKKkAMDAjtupoxZH1h5nOtJhbB8NQtIOTRj3Z9UWXhTrSby7/MXMLGRNokrGYzFZVLG2MQ2BBEMZG5fqJodhBlRVbXdW4fI6nxK8MdRd49lcaCEEr/CBB8tIG3dZSlvHB49NVIxyuogGQBwdgdUowyhESy/Cu4R8sPySpBcXXWQv4xhaHE+Sci6wgBRxv2Dl+UDMQXi+PhwHJdKiIlfkTUuyeUALd8yfvYZxMiQykrbhS4FTiQoXtk0m4D/vBFV0X69wkjfo5pP1L08uqQdzOiWBQr5BsbCBVu34y0iJOkpGAwk+7Cbm3otUlw15QGOZaoq6rplVEfwDGXh1Ol4ZwwyJpmicWEN0APkPftGOc8Yx9B8mg3HTu4tnhkHSg/wau7nVfV2eu0TEYRUI4Yg7o8tU6HxByoCzKkaq4zJBMlMxw8GpUe80b0QI1ZH3vvktn3HNzl1Ac+vbLlsMB6MVRqkgbRdRkohu8usCiiO87Qiimp+S3utC64/PxcqroQsWuVwFWxVrvhcu0RyjWlIU3XxRVVs3DrNemQAfJZgBf28R8+8KeJCYVVwjah779ig45c8EHNcx4WRf4PSg/AChxd0NCQnM3l3Rzh5mWJ4/vQh2jnYNNo7oFsgo+sHmzzZYsaEte3PonkymZVnhqj9rNFaltqWn6LNa20wpeaQl+8NubxJJMd0b0/Z8cNnmnSrF3FTI2RwZ/dnHaM7NiX2/7Wn5A60WmFkfK7cps/sUiBjDYkhjzrAUM9UAUtEJXPDA70C2puZyYgiprXQfvGRuxChqHbNshDLV9u8E/Nl7LaOWtCOKnlhrxz3p/xj53qlurxb9f0ubhmSe2XEhkpq0+NKefjkAfSpJIywfFRLmWCsgUEwmwWmDMmQw3biFDMREbloPUiNTZdPcjTbHtD+iTNP9R3lRNTYC2sqAIcL0ITFwNoD02vTcvzCL/cHHPuQbxM7sJzpV4Izlheu7+dEnmPVGwXntq8ypoz0xbVW8XiqdK8zOr8JpVRFVQrILuVgQNDFJ38fSnFDCRBqOYPUUnZdSSwLAaDWlTABXa/HbGhZRVOoXjDq9wpJl9pPITaz/6WYNxbYqpB5tZtBREckIiTjeAaE6VWwK/vOgRb+Lj9ha/yHnishwJCHp98dJX7xlE/OIn02PIdEK1nI12bV3Njl2VVU2+UQ9evStRZUpoUmqMx+7cqXGBQHcq3lX1rOx5tHCAX5HVOmGPJyZRzjHAC7fQ8JpgqD6dJYGLKJFI5GArZ2ZiZRsOzOOWizb6hS0rHsMezpRgkNAuGzgm73B5rFWVP/KWYdLWX47xlJI76FtfU/9ucwWAaRVvoxV2YV2ob4e1gocvImwCt6g55HqBt6txQjIFJBU3bDRueLrApuHq1mRxu4jbRUT5N4UiHgvqM8MVuMGlsmid3S3x3jvDmJJeWnZvW3ENaI3Mcnxe3IAkkAn0xSP2pccIE58EhZDcI0nwpiTBgsqstwlTjR+IVC36e5PUTGIO+0bKosiMjdOxdQfe04dXPzsncPQlt9leDcu6jO83aPjaH5cdbKCO2wulUWaK5VMNCD1NXNgt7kXqz6AL88vcohOeoch+sYyQPMxkQtTwTK9qZ8iVgrJE1XsIK6z33D1HcyCxOrQgnvet8aLlIeGxqE1JcJaIdiHY1alLlBIWEc0A8Zff4ebGjg7Ru0Raxe1IsUGzuktsmBjES4mfqTBSzV4e4YOA9qlPXqpQWbvCsm5XgwRAfaDNtF1X0YoSmbEuH5uqwSGgJzTKYSWaBkDDrCCZyNvJk/zmEaFNZfhXdwpRJZYLJrSs8+22E3A/r4ygQbW5/URYBR/j/TxzcQLFLthis+Af5aoBJ9wCE+fFEJi3cck+kkDeE+IwwfAjrGX0o46u3sbLr7S5nnRj+JnaNSUMDV4Jy5rZG6Vk4pvCjv7+TFT9K1VUFbczdS1AQ9wR8GRm2cMNzPB9Q8J4HXS5QmtQ1zLh/QOD+/lVChI5+phUpl+6r8bxgCyNA26C4MLViJClK9vbdP/ObYac9faBmGYcF/3rZWI/XFPlf5pFB7dJ3c/xm7+UGJQDqX51jWDgmrI5zqk4ajnyUBuRYikVam6z7QZjkjssc5ckGSHO6RPFvxacSaCJI5W3DYave05o+sJVY0BZuVMDzH2zYyXVviOBQf3w2tHZ09pfZDjaib9ivy/xZFL27uJLl4aGqKO7C9NKM176uabhHdhqNznz5Hqsz5xL23vhbK2VAPyb2X2TIkxe795IWD/cDzHOzNX2ZN3hooz+NhiGNWFrYNDBd+RiYAEPnfUr6lp5C6W85wqWqMTDjcLBJWlwanEq3/pi/nNK5ZQ9MR1QWhNsj70Aqk7YZQfSDA/N3G6sW3OPbEMW655m64zUNU6nK/O8xsJGWL0LtkemqYaQRLEKO1aopd0oXShyj7S1GmAAQR2YlkOkCREAlD84zVH2iRtDc7p/Bz0zBECV3+B7DvJfKpjmgxvhCic8ywutMPE2wiQUVwfFMWoMA9347hcDsriMkQB+YwWr/m5gO47P3JerxHj9puUPvbWmR685HmvhyZU0v6BfdqZR9IFvpoN8gH6Yci/3HcC0qWLryikHENmK8zcnMaCIPYZGPyPqmxkngeQRolW7NQTvwHfM6mHFNjmNdtLZTZb3iPvkSf7kQP6OMgi3Gkiz7WilS/HYf+HzKeIqxOTKiXpL1l4El3EDUY96S49tbhHsh7l3HyQvV6Rwq6jrziA/i8+3bHuibPSOtZKKTEdeT9Ue2CJ6xHeaj/sT2dM5ns2AF1wkXW/0u9CqQO1rskn3Phc+2lvxXLCvojsmSZh4lFiWJmmwXjdNuSHncepLkwR/i/1zkovNtLXJREZKyVPiRjgq34+mhbaX2UdQXiPUkqoUfGOyWBKNHZDfeZckYfSu8h9GS+7QjaU5LWocSHQF1PLeXt/BIyDXzxTd+aaYkkjRqmseCd0kZ9UlzKRgJw6PQq9KoERK7eRKYMY6AKW7iMJWOWiAM3ZHbX1QJD2XRhEdvO21t3ODeYxujTziSjkg611o5Pbd63CvmbHx85wjL+zWq8bYy0DbYfvNmTvFxv8KJu+hGK1geizAWdVPQHu2WWV4Gt9Hi8kC27dDGCoB6uCt5Hk4C0M82xYYm34HvCg6Xu32iu2yyJ0qaYP58KsDfsA/jER5WmReo+Pr+a613CdnU7KzblMXRDIa9Mx5iSbxgLK3YDr1btcceaG4nq4fIZ4W5mGDsD8vBsrwKSqnGVud6KdDMhqhOsEPhwTh22MA9gsRgoLKW27GgoQzkQA6kOYTgixO3uenZjPpl947pNSqys94zlvWSTgpPta3OYoHuJckVT5/4ZC1t4q7gF30EHBp7nqrUyAvjYKLjXu+eTOOqfwPuNFp2Az+DfPBtFBoGA4e5kcfbmRrxin5C0Ifc6cxGya/jNZ4O609lSAUdk2S0eQXm5aM9uS8nSzxojZMRzykAHkbQwIfWPlzA6Ro1G0sIpbIc7VO0gGnTNnHnTmrHtMG8k+oiSPgB0CcmtaQuKORn/zMGYlGKpG5xICyF4iBS1tDZcNNYnLiXPj3xAG/qv4Mvhx2+a2m1EQFO8lXZhX80iHxJgmyTEHC5YrX6cgK4ojlg9Ze1Y1si2fSRr+yzv+Uv98JIVZLjmfxRI6or9rv/9/DvhSJNks+ecW4kTFHMSHk19w87TPSEeSlcr9krTHE95V4PSEaPsGspgaIJ9Xa/5uyjrpMBrOO2J/4p05gX+zi7Ld4MJDj5tQv/JZcWQ3ctvwBkBsUQVDuGy045gOjA8r+3U6Uk2TqkXhRi2LZsbkxoZh7Mfna4JWVrdBTJf0eHg3Afs/dxX5YBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4371,"cache_read_input_tokens":75942,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4371},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ3apS7b5YYTPWRrNpi","type":"assistant","uuid":"2c3745de-dd6d-4b54-ad5c-421839d7b0c5","timestamp":"2026-02-23T06:48:33.282Z"}
{"parentUuid":"2c3745de-dd6d-4b54-ad5c-421839d7b0c5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01GKU9tLTNQsT57nDdf95vcU","type":"message","role":"assistant","content":[{"type":"text","text":"現状を理解しました。Paste CSSセクション内に「Save as Preset」ボタンを組み込み、入力された名前をそのまま使う `saveThemeAs()` メソッドを追加します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4371,"cache_read_input_tokens":75942,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4371},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ3apS7b5YYTPWRrNpi","type":"assistant","uuid":"fac7b825-07ea-469c-9c08-2f545f230b4b","timestamp":"2026-02-23T06:48:33.909Z"}
{"parentUuid":"fac7b825-07ea-469c-9c08-2f545f230b4b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01GKU9tLTNQsT57nDdf95vcU","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Q8rngBM4DvgUN4uw3TYtkc","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1796,"limit":40},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4371,"cache_read_input_tokens":75942,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4371},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ3apS7b5YYTPWRrNpi","type":"assistant","uuid":"08ad1480-0739-494f-99f5-ebe000b1d42d","timestamp":"2026-02-23T06:48:35.163Z"}
{"parentUuid":"08ad1480-0739-494f-99f5-ebe000b1d42d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Q8rngBM4DvgUN4uw3TYtkc","toolUseID":"toolu_01Q8rngBM4DvgUN4uw3TYtkc","timestamp":"2026-02-23T06:48:35.229Z","uuid":"9d37db11-c9ba-4228-8e9c-b4dab16f7973"}
{"parentUuid":"08ad1480-0739-494f-99f5-ebe000b1d42d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Q8rngBM4DvgUN4uw3TYtkc","type":"tool_result","content":"  1796→  --subtext: #86868b;   /* metadata / nav    */\n  1797→  --accent: #0066cc;    /* links & buttons   */\n  1798→  --header-bg: rgba(255,255,255,0.8);\n  1799→  --font-main: sans-serif;\n  1800→}\n  1801→\n  1802→/* optional: component overrides */\n  1803→.hn-story-item { border-radius: 16px; }\n  1804→.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n  1805→                <div style=\"display:flex; gap:6px; align-items:center;\">\n  1806→                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n  1807→                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n  1808→                </div>\n  1809→            </div>`;\n  1810→\n  1811→        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n  1812→            const form = section.querySelector('#paste-css-form');\n  1813→            const icon = section.querySelector('#paste-css-icon');\n  1814→            const isOpen = form.style.display !== 'none';\n  1815→            form.style.display = isOpen ? 'none' : 'flex';\n  1816→            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1817→        });\n  1818→\n  1819→        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n  1820→            const css = section.querySelector('#paste-css-input').value.trim();\n  1821→            if (!css) return;\n  1822→            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n  1823→            this.applyStyle(css, null, name);\n  1824→            this.togglePresets(true);\n  1825→            this.renderSaveButton(true);\n  1826→        });\n  1827→\n  1828→        this.elements.themeControls.appendChild(section);\n  1829→    },\n  1830→\n  1831→    renderPromptTemplateSection() {\n  1832→        const existing = document.getElementById('prompt-template-section');\n  1833→        if (existing) existing.remove();\n  1834→\n  1835→        const section = document.createElement('div');\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4c8b4007-52ac-4b85-b897-6d76ca3aa1d4","timestamp":"2026-02-23T06:48:35.228Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');","numLines":40,"startLine":1796,"totalLines":2065}},"sourceToolAssistantUUID":"08ad1480-0739-494f-99f5-ebe000b1d42d"}
{"parentUuid":"4c8b4007-52ac-4b85-b897-6d76ca3aa1d4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01JVvKKexojvbGVvJD8dHKxF","type":"message","role":"assistant","content":[{"type":"text","text":"まずセクション内のHTMLに Save as Preset 行を追加し、Apply ハンドラを更新します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2645,"cache_read_input_tokens":80313,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2645},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ5oq58EJXv6bdZwjiF","type":"assistant","uuid":"da9ae877-a55f-4395-8e83-c7251c7b0b2c","timestamp":"2026-02-23T06:48:37.343Z"}
{"parentUuid":"da9ae877-a55f-4395-8e83-c7251c7b0b2c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01JVvKKexojvbGVvJD8dHKxF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01P3ashG6ZYofeZbwmG5ykni","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });","new_string":"                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2645,"cache_read_input_tokens":80313,"output_tokens":1082,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2645,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQZ5oq58EJXv6bdZwjiF","type":"assistant","uuid":"16a747a4-0c19-42e9-af32-6c3f0b97b292","timestamp":"2026-02-23T06:48:45.677Z"}
{"parentUuid":"16a747a4-0c19-42e9-af32-6c3f0b97b292","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01P3ashG6ZYofeZbwmG5ykni","toolUseID":"toolu_01P3ashG6ZYofeZbwmG5ykni","timestamp":"2026-02-23T06:48:45.684Z","uuid":"dee5317e-07c7-45f7-a877-e05e3526a15f"}
{"parentUuid":"16a747a4-0c19-42e9-af32-6c3f0b97b292","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01P3ashG6ZYofeZbwmG5ykni","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"e36cbbef-bda5-4b28-984f-6e624aee27cd","timestamp":"2026-02-23T06:48:45.683Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });","newString":"                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = section.querySelector('#paste-css-input').value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1806,"oldLines":6,"newStart":1806,"newLines":9,"lines":["                     <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">","                     <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>","                 </div>","+                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">","+                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>","+                </div>","             </div>`;"," ","         section.querySelector('#paste-css-toggle').addEventListener('click', () => {"]},{"oldStart":1816,"oldLines":15,"newStart":1819,"newLines":32,"lines":["             icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';","         });"," ","+        const textarea = section.querySelector('#paste-css-input');","+        const saveRow = section.querySelector('#paste-css-save-row');","+        const saveBtn = section.querySelector('#paste-css-save-btn');","+","+        textarea.addEventListener('input', () => {","+            saveRow.style.display = 'none';","+            saveBtn.textContent = 'Save as Preset';","+        });","+","         section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {","-            const css = section.querySelector('#paste-css-input').value.trim();","+            const css = textarea.value.trim();","             if (!css) return;","             const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';","             this.applyStyle(css, null, name);","-            this.togglePresets(true);","-            this.renderSaveButton(true);","+            saveRow.style.display = 'flex';","+            saveBtn.textContent = 'Save as Preset';","         });"," ","+        saveBtn.addEventListener('click', () => {","+            const css = textarea.value.trim();","+            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';","+            const saved = this.saveThemeAs(css, name);","+            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';","+            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);","+        });","+","         this.elements.themeControls.appendChild(section);","     },"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"16a747a4-0c19-42e9-af32-6c3f0b97b292"}
{"parentUuid":"e36cbbef-bda5-4b28-984f-6e624aee27cd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019ryoxyLfactszAN6u7rDBL","type":"message","role":"assistant","content":[{"type":"text","text":"次に `saveThemeAs()` メソッドを `saveCurrentTheme()` の直後に追加します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1140,"cache_read_input_tokens":82958,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1140},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ6aVRBLXRqbv3Wj9tv","type":"assistant","uuid":"ed2821a8-5464-4dcf-8849-234a85fc56cd","timestamp":"2026-02-23T06:48:49.057Z"}
{"parentUuid":"ed2821a8-5464-4dcf-8849-234a85fc56cd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019ryoxyLfactszAN6u7rDBL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HddhZ7AxEyg7zKGnwFX1Bf","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"    deleteSavedTheme(id) {","new_string":"    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1140,"cache_read_input_tokens":82958,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1140},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ6aVRBLXRqbv3Wj9tv","type":"assistant","uuid":"ec35f21e-38e4-4738-94f3-95140e595790","timestamp":"2026-02-23T06:48:52.892Z"}
{"parentUuid":"ec35f21e-38e4-4738-94f3-95140e595790","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01HddhZ7AxEyg7zKGnwFX1Bf","toolUseID":"toolu_01HddhZ7AxEyg7zKGnwFX1Bf","timestamp":"2026-02-23T06:48:52.898Z","uuid":"4c469b61-a35c-42d0-97e3-cc760996715c"}
{"parentUuid":"ec35f21e-38e4-4738-94f3-95140e595790","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HddhZ7AxEyg7zKGnwFX1Bf","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"a1632742-1ca4-4431-88e9-5fd5ea18f608","timestamp":"2026-02-23T06:48:52.897Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"    deleteSavedTheme(id) {","newString":"    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1955,"oldLines":6,"newStart":1955,"newLines":21,"lines":["         this.renderSaveButton(false);","     },"," ","+    saveThemeAs(css, name) {","+        const saved = this.getSavedThemes();","+        if (saved.some(t => t.css === css)) return false;","+","+        let finalName = name;","+        const existingNames = new Set(saved.map(t => t.name));","+        let i = 2;","+        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }","+","+        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });","+        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));","+        this.renderSavedThemeButtons();","+        return true;","+    },","+","     deleteSavedTheme(id) {","         const saved = this.getSavedThemes().filter(t => t.id !== id);","         localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ec35f21e-38e4-4738-94f3-95140e595790"}
{"parentUuid":"a1632742-1ca4-4431-88e9-5fd5ea18f608","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01X9vYfFoYhEUE9BNgc2QnHu","type":"message","role":"assistant","content":[{"type":"text","text":"動作を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":391,"cache_read_input_tokens":84098,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":391},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ77cRnpQFUy7aGVGBi","type":"assistant","uuid":"684a5344-a0ab-4879-8cf5-3fc13df2d611","timestamp":"2026-02-23T06:48:54.522Z"}
{"parentUuid":"684a5344-a0ab-4879-8cf5-3fc13df2d611","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01X9vYfFoYhEUE9BNgc2QnHu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01275gEe1BLutMg2gELXoFiR","name":"Grep","input":{"pattern":"saveThemeAs|paste-css-save","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":2},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":391,"cache_read_input_tokens":84098,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":391},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ77cRnpQFUy7aGVGBi","type":"assistant","uuid":"1f60ce78-52f0-49c2-9a06-94b1f5b97df6","timestamp":"2026-02-23T06:48:55.758Z"}
{"parentUuid":"1f60ce78-52f0-49c2-9a06-94b1f5b97df6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01275gEe1BLutMg2gELXoFiR","toolUseID":"toolu_01275gEe1BLutMg2gELXoFiR","timestamp":"2026-02-23T06:48:56.081Z","uuid":"ddd1f2a1-c1c9-488d-9d91-e58d7b1800ec"}
{"parentUuid":"1f60ce78-52f0-49c2-9a06-94b1f5b97df6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01275gEe1BLutMg2gELXoFiR","type":"tool_result","content":"1807-                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n1808-                </div>\n1809:                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n1810:                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n1811-                </div>\n1812-            </div>`;\n--\n1821-\n1822-        const textarea = section.querySelector('#paste-css-input');\n1823:        const saveRow = section.querySelector('#paste-css-save-row');\n1824:        const saveBtn = section.querySelector('#paste-css-save-btn');\n1825-\n1826-        textarea.addEventListener('input', () => {\n--\n1841-            const css = textarea.value.trim();\n1842-            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n1843:            const saved = this.saveThemeAs(css, name);\n1844-            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n1845-            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n--\n1956-    },\n1957-\n1958:    saveThemeAs(css, name) {\n1959-        const saved = this.getSavedThemes();\n1960-        if (saved.some(t => t.css === css)) return false;"}]},"uuid":"31ee647f-6b0a-4573-b057-fcf5998570f1","timestamp":"2026-02-23T06:48:56.080Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1807-                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n1808-                </div>\n1809:                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n1810:                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n1811-                </div>\n1812-            </div>`;\n--\n1821-\n1822-        const textarea = section.querySelector('#paste-css-input');\n1823:        const saveRow = section.querySelector('#paste-css-save-row');\n1824:        const saveBtn = section.querySelector('#paste-css-save-btn');\n1825-\n1826-        textarea.addEventListener('input', () => {\n--\n1841-            const css = textarea.value.trim();\n1842-            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n1843:            const saved = this.saveThemeAs(css, name);\n1844-            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n1845-            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n--\n1956-    },\n1957-\n1958:    saveThemeAs(css, name) {\n1959-        const saved = this.getSavedThemes();\n1960-        if (saved.some(t => t.css === css)) return false;","numLines":25},"sourceToolAssistantUUID":"1f60ce78-52f0-49c2-9a06-94b1f5b97df6"}
{"parentUuid":"31ee647f-6b0a-4573-b057-fcf5998570f1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Wm29gmJpoWyhXB16vVTdYs","type":"message","role":"assistant","content":[{"type":"text","text":"実装完了です。変更内容をまとめます。\n\n**追加した `saveThemeAs(css, name)` メソッド**\n- テキストエリアの CSS と名前入力の値をそのままプリセット名として保存（`summarizePrompt` による名前の変換なし）\n- 同一 CSS がすでに保存済みなら `false` を返す\n- 重複名は自動でナンバリング（`My Theme` → `My Theme 2`）\n\n**Paste CSS セクションの UX 変更**\n- Apply を押すと **Save as Preset** ボタンがセクション内に表示される\n- Save as Preset を押すと：\n  - 保存成功 → \"Saved!\" と 2 秒表示してから元のラベルに戻る\n  - 既に保存済み → \"Already saved\" と表示\n- テキストエリアを編集すると Save as Preset ボタンは非表示に戻る（適用前の状態に対して保存させない）\n\n保存されたプリセットはこれまで通り、Presets エリアに太枠ボタンで並びます。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":655,"cache_read_input_tokens":84489,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":655},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQZ7LyMCZaB4jJ45sryY","type":"assistant","uuid":"d236a51a-8c8f-4da4-b133-bf49158c5672","timestamp":"2026-02-23T06:49:04.255Z"}
{"parentUuid":"d236a51a-8c8f-4da4-b133-bf49158c5672","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"436b617f-cfc7-4719-8ddf-5e0790528a06","toolUseID":"436b617f-cfc7-4719-8ddf-5e0790528a06","timestamp":"2026-02-23T06:49:04.290Z","uuid":"d9f79766-7dc3-4bad-a36e-f49d09a2f02a"}
{"parentUuid":"d9f79766-7dc3-4bad-a36e-f49d09a2f02a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":225}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T06:49:04.515Z","uuid":"86955796-835f-40ae-a0dd-02b15c27b2a5","toolUseID":"436b617f-cfc7-4719-8ddf-5e0790528a06"}
{"parentUuid":"86955796-835f-40ae-a0dd-02b15c27b2a5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":94506,"timestamp":"2026-02-23T06:49:04.517Z","uuid":"9544fe0f-e7c4-4b63-8426-e7cff60c13d2","isMeta":false}
{"type":"file-history-snapshot","messageId":"50d93b7a-2e30-47a6-a281-2558e04cd659","snapshot":{"messageId":"50d93b7a-2e30-47a6-a281-2558e04cd659","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v7","version":7,"backupTime":"2026-02-23T07:13:54.200Z"}},"timestamp":"2026-02-23T07:13:54.199Z"},"isSnapshotUpdate":false}
{"parentUuid":"9544fe0f-e7c4-4b63-8426-e7cff60c13d2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コミットして"},"uuid":"50d93b7a-2e30-47a6-a281-2558e04cd659","timestamp":"2026-02-23T07:13:54.050Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"50d93b7a-2e30-47a6-a281-2558e04cd659","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01LD2SDpYmBabpy3gXQbMu5k","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012GqtjH63xYaAgV14uiP2wn","name":"Bash","input":{"command":"git status && git diff --stat","description":"Show git status and diff stat"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":7,"cache_read_input_tokens":85461,"output_tokens":80,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":7,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQb1nYJej7847sCrLdfQ","type":"assistant","uuid":"78c31144-c990-4178-92c7-ac383adc10f3","timestamp":"2026-02-23T07:13:57.529Z"}
{"parentUuid":"78c31144-c990-4178-92c7-ac383adc10f3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012GqtjH63xYaAgV14uiP2wn","type":"tool_result","content":"On branch main\nYour branch is ahead of 'origin/main' by 3 commits.\n  (use \"git push\" to publish your local commits)\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n gardener.js | 41 ++++++++++++++++++++++++++++++++++++++---\n 1 file changed, 38 insertions(+), 3 deletions(-)","is_error":false}]},"uuid":"0c85b252-f575-4a9b-af75-16a6b679e63b","timestamp":"2026-02-23T07:13:57.713Z","toolUseResult":{"stdout":"On branch main\nYour branch is ahead of 'origin/main' by 3 commits.\n  (use \"git push\" to publish your local commits)\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n gardener.js | 41 ++++++++++++++++++++++++++++++++++++++---\n 1 file changed, 38 insertions(+), 3 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"78c31144-c990-4178-92c7-ac383adc10f3"}
{"parentUuid":"0c85b252-f575-4a9b-af75-16a6b679e63b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01FeByc2wWXPQttCeaxDdLgG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XpWGz9S6CPcJJwDmzkB9Ew","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nfeat: add Save as Preset to Paste CSS section and fix minimized panel opacity\n\n- Add Save as Preset button within Paste CSS section: appears after Apply\n  is clicked, shows \"Saved!\" / \"Already saved\" feedback, and hides again\n  when the textarea is edited.\n- Add saveThemeAs(css, name) method that saves with the exact name provided\n  (no summarizePrompt transform), with duplicate-name numbering.\n- Remove preset accordion auto-close on built-in preset button click.\n- Fix control panel minimized state: add !important to opacity:0 rule so\n  inline opacity styles on section headers no longer leak through when the\n  panel is swiped closed.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Stage and commit all pending changes"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":249,"cache_read_input_tokens":85468,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":249},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQb23J4xxZkyAbLFqgh9","type":"assistant","uuid":"a0dbe4b3-6ecc-4623-a765-d8d481758df5","timestamp":"2026-02-23T07:14:10.350Z"}
{"parentUuid":"a0dbe4b3-6ecc-4623-a765-d8d481758df5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XpWGz9S6CPcJJwDmzkB9Ew","type":"tool_result","content":"[main b333221] feat: add Save as Preset to Paste CSS section and fix minimized panel opacity\n 1 file changed, 38 insertions(+), 3 deletions(-)","is_error":false}]},"uuid":"54df5ac6-cb95-4131-b7e3-7cf757dc6445","timestamp":"2026-02-23T07:14:11.428Z","toolUseResult":{"stdout":"[main b333221] feat: add Save as Preset to Paste CSS section and fix minimized panel opacity\n 1 file changed, 38 insertions(+), 3 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"a0dbe4b3-6ecc-4623-a765-d8d481758df5"}
{"parentUuid":"54df5ac6-cb95-4131-b7e3-7cf757dc6445","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_011j6aR9EUy7yuYLFeMJoucd","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました。\n\n```\nb333221 feat: add Save as Preset to Paste CSS section and fix minimized panel opacity\n```\n\n今回のセッションで溜まっていた変更（Paste CSS の Save as Preset 実装、アコーディオン自動閉じ削除、パネル最小化時の opacity バグ修正）をまとめて1コミットにしました。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":338,"cache_read_input_tokens":85717,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":338},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQb33rpq5hnTFnyYHLKJ","type":"assistant","uuid":"ed00f60d-0bbd-4469-9144-404c693c2f56","timestamp":"2026-02-23T07:14:14.978Z"}
{"parentUuid":"ed00f60d-0bbd-4469-9144-404c693c2f56","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"3b040639-7e6c-4b29-9548-fabf16a03f7c","toolUseID":"3b040639-7e6c-4b29-9548-fabf16a03f7c","timestamp":"2026-02-23T07:14:15.070Z","uuid":"237ca674-4450-4f45-9356-6825511bc1bb"}
{"parentUuid":"237ca674-4450-4f45-9356-6825511bc1bb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":1448}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T07:14:16.520Z","uuid":"21e2ffac-53b5-40f3-9df5-5ccdef51499c","toolUseID":"3b040639-7e6c-4b29-9548-fabf16a03f7c"}
{"type":"file-history-snapshot","messageId":"77fbcbb5-f0fb-4f10-9f78-078312db970f","snapshot":{"messageId":"77fbcbb5-f0fb-4f10-9f78-078312db970f","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v7","version":7,"backupTime":"2026-02-23T07:13:54.200Z"}},"timestamp":"2026-02-23T07:17:46.398Z"},"isSnapshotUpdate":false}
{"parentUuid":"21e2ffac-53b5-40f3-9df5-5ccdef51499c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コントロールパネル内のUIの改良として、従来のプロンプト入力のテキストフィールドを、Gemini AIのセクションに移動させて、統合したいです。"},"uuid":"77fbcbb5-f0fb-4f10-9f78-078312db970f","timestamp":"2026-02-23T07:17:46.276Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"77fbcbb5-f0fb-4f10-9f78-078312db970f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KdwheY8mhvRw3M3XSqALdV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to move the existing prompt input text field (currently at the bottom of the control panel as a standalone row) into the Gemini AI section, integrating them together.\n\nLet me understand the current layout:\n1. Presets toggle + preset buttons (in HTML)\n2. Prompt input + Apply button (in HTML - `#prompt-input` + `#generate-btn`)\n3. Gemini API Key section (dynamically added)\n4. Paste CSS section (dynamically added)\n5. AI Prompt Template section (dynamically added)\n\nThe user wants to move #2 (prompt input + apply button) into the Gemini AI section (#3).\n\n\nSo the new layout would be:\n1. Presets toggle + preset buttons\n2. Gemini API Key section (with prompt input + apply button integrated)\n3. Paste CSS section\n4. AI Prompt Template section\n\nNow I need to examine the current HTML structure and the renderApiKeySection function to figure out how to integrate the prompt input into the Gemini section.\n\nLooking at the existing markup, the prompt input and generate button are currently in their own flex container within the theme-controls div. The elements object already references these, and renderSaveButton inserts content after the generate button's parent. My plan is to pull that prompt input and button out of the main HTML and move them into renderApiKeySection so they appear as part of the Gemini AI section when expanded, with the API key input showing below them.\n\nFor the UX, I'm weighing whether to keep the section header as just \"Gemini AI\" and show the prompt input as the main content when the section opens, with API key management nested below it. This way the entire Gemini workflow lives in one collapsible section rather than having the prompt input floating separately at the top.\n\nThe challenge is that `promptInput` and `generateBtn` are referenced throughout the codebase, so I need to make sure they still point to the correct elements in their new location. The `renderSaveButton` function also inserts content after the generate button's parent, which will need to work properly once I restructure the DOM. I'm checking how the element references are initialized and what needs to be updated to make this work.\n\nExamining the event bindings...","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":58,"cache_read_input_tokens":86161,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":58},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbJuBsymKiSyXvDy1Mx","type":"assistant","uuid":"a1b413cd-e9a2-44a9-9e69-a8d64844cf00","timestamp":"2026-02-23T07:18:05.611Z"}
{"parentUuid":"a1b413cd-e9a2-44a9-9e69-a8d64844cf00","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KdwheY8mhvRw3M3XSqALdV","type":"message","role":"assistant","content":[{"type":"text","text":"現在のイベントバインディングと要素参照を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":58,"cache_read_input_tokens":86161,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":58},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbJuBsymKiSyXvDy1Mx","type":"assistant","uuid":"ba01ea3c-40db-4cf3-8d80-4b4d50984a74","timestamp":"2026-02-23T07:18:05.619Z"}
{"parentUuid":"ba01ea3c-40db-4cf3-8d80-4b4d50984a74","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KdwheY8mhvRw3M3XSqALdV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Uu991FPkQhe7QheMvdb8W8","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1400,"limit":80},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":58,"cache_read_input_tokens":86161,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":58},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbJuBsymKiSyXvDy1Mx","type":"assistant","uuid":"fc398eb1-1402-4a2b-97a6-4290931a59c1","timestamp":"2026-02-23T07:18:06.069Z"}
{"parentUuid":"fc398eb1-1402-4a2b-97a6-4290931a59c1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Uu991FPkQhe7QheMvdb8W8","toolUseID":"toolu_01Uu991FPkQhe7QheMvdb8W8","timestamp":"2026-02-23T07:18:06.156Z","uuid":"2d11a20d-90ed-41a0-b8c4-8858604fb7ec"}
{"parentUuid":"fc398eb1-1402-4a2b-97a6-4290931a59c1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Uu991FPkQhe7QheMvdb8W8","type":"tool_result","content":"  1400→        interval = Math.floor(seconds / 60);\n  1401→        if (interval > 1) return interval + \" minutes ago\";\n  1402→        return Math.floor(seconds) + \" seconds ago\";\n  1403→    }\n  1404→};\n  1405→\n  1406→/**\n  1407→ * Application Controller\n  1408→ */\n  1409→const App = {\n  1410→    currentOffset: 0,\n  1411→    isLoading: false,\n  1412→\n  1413→    elements: {\n  1414→        styleTag: document.getElementById('generated-style'),\n  1415→        promptInput: document.getElementById('prompt-input'),\n  1416→        generateBtn: document.getElementById('generate-btn'),\n  1417→        presetButtons: document.getElementById('preset-buttons'),\n  1418→        presetsToggle: document.getElementById('presets-toggle'),\n  1419→        presetsIcon: document.getElementById('presets-icon'),\n  1420→        listElement: document.querySelector('.hn-story-list'),\n  1421→        loadMoreBtn: document.querySelector('.hn-load-more'),\n  1422→        menuToggle: document.querySelector('.hn-menu-toggle'),\n  1423→        navLinks: document.querySelector('.hn-nav-links'),\n  1424→        header: document.querySelector('.hn-header'),\n  1425→        themeControls: document.getElementById('theme-controls'),\n  1426→        panelHandle: document.getElementById('panel-handle')\n  1427→    },\n  1428→\n  1429→    async init() {\n  1430→        this.renderPresetButtons();\n  1431→        this.renderSavedThemeButtons();\n  1432→        this.renderApiKeySection();\n  1433→        this.renderPasteCssSection();\n  1434→        this.renderPromptTemplateSection();\n  1435→        this.bindEvents();\n  1436→\n  1437→        const savedPreset = localStorage.getItem('genhn-theme');\n  1438→        const savedCustom = localStorage.getItem('genhn-custom-css');\n  1439→        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n  1440→\n  1441→        if (savedCustom) {\n  1442→            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n  1443→            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n  1444→            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n  1445→            this.renderSaveButton(!alreadySaved);\n  1446→        } else {\n  1447→            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n  1448→            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n  1449→        }\n  1450→\n  1451→        await this.loadInitial();\n  1452→    },\n  1453→\n  1454→    renderPresetButtons() {\n  1455→        this.elements.presetButtons.innerHTML = '';\n  1456→        Object.keys(STYLE_PRESETS).forEach(themeName => {\n  1457→            const btn = document.createElement('button');\n  1458→            btn.textContent = themeName;\n  1459→            btn.style.cssText = `\n  1460→                padding: 6px 12px;\n  1461→                background: rgba(0,0,0,0.05);\n  1462→                border: 1px solid rgba(0,0,0,0.1);\n  1463→                border-radius: 6px;\n  1464→                font-size: 12px;\n  1465→                font-weight: 500;\n  1466→                cursor: pointer;\n  1467→                transition: all 0.2s;\n  1468→                color: var(--text);\n  1469→                flex-shrink: 0;\n  1470→            `;\n  1471→            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n  1472→            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n  1473→            btn.onclick = () => {\n  1474→                this.elements.promptInput.value = themeName;\n  1475→                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n  1476→            };\n  1477→            this.elements.presetButtons.appendChild(btn);\n  1478→        });\n  1479→    },\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a0876085-d532-4cdf-be5c-87d738e5ff31","timestamp":"2026-02-23T07:18:06.154Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },","numLines":80,"startLine":1400,"totalLines":2100}},"sourceToolAssistantUUID":"fc398eb1-1402-4a2b-97a6-4290931a59c1"}
{"parentUuid":"a0876085-d532-4cdf-be5c-87d738e5ff31","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KdwheY8mhvRw3M3XSqALdV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01F2ZweucopiqDJzP6gqQQTw","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1370,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":58,"cache_read_input_tokens":86161,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":58},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbJuBsymKiSyXvDy1Mx","type":"assistant","uuid":"51779961-15fe-48d7-85b5-afd19d38e2d5","timestamp":"2026-02-23T07:18:06.715Z"}
{"parentUuid":"51779961-15fe-48d7-85b5-afd19d38e2d5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01F2ZweucopiqDJzP6gqQQTw","toolUseID":"toolu_01F2ZweucopiqDJzP6gqQQTw","timestamp":"2026-02-23T07:18:06.731Z","uuid":"97b39618-f621-4f82-87dc-8fafff8fdd60"}
{"parentUuid":"51779961-15fe-48d7-85b5-afd19d38e2d5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01F2ZweucopiqDJzP6gqQQTw","type":"tool_result","content":"  1370→            this.allStoryIds = await response.json();\n  1371→            return this.allStoryIds;\n  1372→        } catch (error) {\n  1373→            console.error(\"Failed to fetch ID list:\", error);\n  1374→            return [];\n  1375→        }\n  1376→    },\n  1377→\n  1378→    async fetchStoriesBatch(offset, limit = 30) {\n  1379→        const ids = await this.fetchAllIds();\n  1380→        const batchIds = ids.slice(offset, offset + limit);\n  1381→\n  1382→        const storyPromises = batchIds.map(async (id) => {\n  1383→            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n  1384→            return await storyRes.json();\n  1385→        });\n  1386→\n  1387→        return await Promise.all(storyPromises);\n  1388→    },\n  1389→\n  1390→    formatTime(timestamp) {\n  1391→        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n  1392→        let interval = Math.floor(seconds / 31536000);\n  1393→        if (interval > 1) return interval + \" years ago\";\n  1394→        interval = Math.floor(seconds / 2592000);\n  1395→        if (interval > 1) return interval + \" months ago\";\n  1396→        interval = Math.floor(seconds / 86400);\n  1397→        if (interval > 1) return interval + \" days ago\";\n  1398→        interval = Math.floor(seconds / 3600);\n  1399→        if (interval > 1) return interval + \" hours ago\";\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"85927b46-4f67-4c06-a345-e3cbe2d4d051","timestamp":"2026-02-23T07:18:06.730Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";","numLines":30,"startLine":1370,"totalLines":2100}},"sourceToolAssistantUUID":"51779961-15fe-48d7-85b5-afd19d38e2d5"}
{"parentUuid":"85927b46-4f67-4c06-a345-e3cbe2d4d051","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_014cimtDN1omw5tnVnwZzMyZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ss2Emai79DPaL7pvcP33L8","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1479,"limit":60},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3090,"cache_read_input_tokens":86219,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3090},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbLQ8hRNpwpEVwkTa3p","type":"assistant","uuid":"82b59d58-290c-4fe3-9064-73e034ea2516","timestamp":"2026-02-23T07:18:08.896Z"}
{"parentUuid":"82b59d58-290c-4fe3-9064-73e034ea2516","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Ss2Emai79DPaL7pvcP33L8","toolUseID":"toolu_01Ss2Emai79DPaL7pvcP33L8","timestamp":"2026-02-23T07:18:08.966Z","uuid":"02ab246f-0a47-4f1f-b4ee-e59dd4041815"}
{"parentUuid":"82b59d58-290c-4fe3-9064-73e034ea2516","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ss2Emai79DPaL7pvcP33L8","type":"tool_result","content":"  1479→    },\n  1480→\n  1481→    bindEvents() {\n  1482→        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n  1483→        this.elements.promptInput.addEventListener('keypress', (e) => {\n  1484→            if (e.key === 'Enter') this.handleGenerate();\n  1485→        });\n  1486→        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n  1487→        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n  1488→        \n  1489→        if (this.elements.presetsToggle) {\n  1490→            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n  1491→        }\n  1492→\n  1493→        if (this.elements.panelHandle) {\n  1494→            let isDragging = false;\n  1495→            let startX = 0;\n  1496→            const threshold = 50;\n  1497→\n  1498→            const startDrag = (e) => {\n  1499→                if (window.innerWidth < 769) return;\n  1500→                isDragging = true;\n  1501→                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n  1502→                this.elements.themeControls.style.transition = 'none';\n  1503→            };\n  1504→\n  1505→            const doDrag = (e) => {\n  1506→                if (!isDragging) return;\n  1507→                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n  1508→                const deltaX = clientX - startX;\n  1509→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n  1510→\n  1511→                if (!isMin && deltaX > 0) {\n  1512→                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n  1513→                } else if (isMin && deltaX < 0) {\n  1514→                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n  1515→                }\n  1516→            };\n  1517→\n  1518→            const endDrag = (e) => {\n  1519→                if (!isDragging) return;\n  1520→                isDragging = false;\n  1521→                this.elements.themeControls.style.transition = '';\n  1522→                \n  1523→                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n  1524→                const deltaX = clientX - startX;\n  1525→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n  1526→\n  1527→                this.elements.themeControls.style.transform = '';\n  1528→\n  1529→                if (Math.abs(deltaX) < 10) {\n  1530→                    this.elements.themeControls.classList.toggle('is-minimized');\n  1531→                } else {\n  1532→                    if (!isMin && deltaX > threshold) {\n  1533→                        this.elements.themeControls.classList.add('is-minimized');\n  1534→                    } else if (isMin && deltaX < -threshold) {\n  1535→                        this.elements.themeControls.classList.remove('is-minimized');\n  1536→                    }\n  1537→                }\n  1538→            };\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"af99aec0-9948-4743-8d7f-21a26a806c03","timestamp":"2026-02-23T07:18:08.966Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };","numLines":60,"startLine":1479,"totalLines":2100}},"sourceToolAssistantUUID":"82b59d58-290c-4fe3-9064-73e034ea2516"}
{"parentUuid":"af99aec0-9948-4743-8d7f-21a26a806c03","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01NMtVVCQSto5yHxhiUPXs9i","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a clear picture. Let me plan the changes needed:\n\n**Current structure:**\n```html\n<div id=\"theme-controls\">\n  <div id=\"panel-handle\"></div>\n  <div id=\"presets-toggle\">Presets ▼</div>\n  <div id=\"preset-buttons\">...</div>\n  <div style=\"display:flex; gap:10px;\">  <!-- prompt row -->\n    <input id=\"prompt-input\" placeholder=\"Enter theme...\">\n    <button id=\"generate-btn\">Apply</button>\n  </div>\n  <!-- dynamically added: -->\n  <!-- #api-key-section (Gemini API Key) -->\n  <!-- #paste-css-section -->\n  <!-- #prompt-template-section -->\n</div>\n```\n\n**Target structure:**\n```html\n<div id=\"theme-controls\">\n  <div id=\"panel-handle\"></div>\n  <div id=\"presets-toggle\">Presets ▼</div>\n  <div id=\"preset-buttons\">...</div>\n  <!-- prompt row REMOVED from here -->\n  <!-- dynamically added: -->\n  <!-- #gemini-section (Gemini AI) — contains prompt input + apply + api key -->\n  <!-- #paste-css-section -->\n  <!-- #prompt-template-section -->\n</div>\n```\n\nThe key change is consolidating the prompt input, apply button, and API key into a single Gemini section that gets dynamically inserted, removing the hardcoded prompt row from the static markup.\n\nI need to refactor the HTML to remove the prompt input row, then update the elements object to reference the dynamically created prompt and generate button elements after the Gemini section renders, and rename the API key rendering function to handle the new consolidated structure. I'm deciding whether to keep `renderApiKeySection` as a separate method or fully merge it into the new `renderGeminiSection()`. The cleanest approach is to create one unified method that handles the entire section—including the toggle header, prompt input row, and the API key subsection—while updating the element references so event binding works correctly afterward. Building the gemini section structure...\n\nI need to decide whether to keep this section expanded by default since it contains the main prompt input, or collapse it and handle the toggle behavior carefully to avoid breaking the existing \"Save as Preset\" and error message insertion logic. Since those elements won't exist at script load time, I need to either initialize them as `null` in the `elements` object and assign them later in `renderGeminiSection()`, or remove them from the object entirely and add them dynamically.\n\nI'm going with the first approach: I'll remove the prompt input and generate button from the initial HTML, then create them dynamically when rendering the Gemini section. This means updating the `elements` object to exclude those references, adding a new `renderGeminiSection()` method that builds the full section with the toggle, form, and API key subsection, and then updating `init()` to call this new method instead of the separate API key rendering. I need to handle the fact that rebuilding `renderGeminiSection()` will replace the `promptInput` and `generateBtn` elements, so I'll need to re-bind events after each re-render, or store references differently to avoid losing the event listeners. Writing the render function... Building the form interface... Writing the toggle functionality... Setting up event listeners for the API key form...\n\nI'm noticing a potential issue though—when inserting the Gemini section before the paste CSS section, that target element might not exist yet, which could cause problems.\n\nLooking at the initialization order, the Gemini section gets rendered before the paste CSS section, so I should just append it instead of trying to insert before something that doesn't exist yet. When the section re-renders after saving an API key, I can handle repositioning by removing and re-inserting it at the correct spot, or I could simplify this by just appending since the order in the DOM will naturally follow the render order anyway. I need to clean up the event listener bindings since the prompt and generate button listeners are now being added directly in `renderGeminiSection()`, so I should remove those from `bindEvents()`. I also need to update `clearApiKey()` to re-render the gemini section instead of the old API key section, and make sure the saved prompt gets restored properly during initialization.\n\nFor the default state, I'll have the section open by default so users see the input UI immediately. The styling for the generate button is already handled by the existing CSS rules, so I don't need to duplicate that in the rendered markup. the minimal inline styles since the CSS already covers background, color, and border styling with `!important` rules.\n\nNow I need to verify that the PANEL_STYLE includes the generate button styling when the \"None\" theme is applied, since that's the fallback for the control panel.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1168,"cache_read_input_tokens":89309,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1168},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbLZMpwU8uMvZ3uVgsX","type":"assistant","uuid":"85a3f18f-c4a6-48d8-888d-d55e56015d5a","timestamp":"2026-02-23T07:19:30.971Z"}
{"parentUuid":"85a3f18f-c4a6-48d8-888d-d55e56015d5a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01NMtVVCQSto5yHxhiUPXs9i","type":"message","role":"assistant","content":[{"type":"text","text":"`PANEL_STYLE` と `expandApiKeySection` も確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1168,"cache_read_input_tokens":89309,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1168},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbLZMpwU8uMvZ3uVgsX","type":"assistant","uuid":"6ddbe15c-47ef-4e4f-8f69-4c90f406a8b3","timestamp":"2026-02-23T07:19:30.981Z"}
{"parentUuid":"6ddbe15c-47ef-4e4f-8f69-4c90f406a8b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01NMtVVCQSto5yHxhiUPXs9i","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HQTJ8WLTe7wHFYffcN1N7P","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":605,"limit":70},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1168,"cache_read_input_tokens":89309,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1168},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbLZMpwU8uMvZ3uVgsX","type":"assistant","uuid":"4637c209-fbc8-45bc-ae64-c9a0770a1f40","timestamp":"2026-02-23T07:19:31.999Z"}
{"parentUuid":"4637c209-fbc8-45bc-ae64-c9a0770a1f40","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01HQTJ8WLTe7wHFYffcN1N7P","toolUseID":"toolu_01HQTJ8WLTe7wHFYffcN1N7P","timestamp":"2026-02-23T07:19:32.092Z","uuid":"33bb2fed-b4a0-4b15-930a-dd5f74e51963"}
{"parentUuid":"4637c209-fbc8-45bc-ae64-c9a0770a1f40","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HQTJ8WLTe7wHFYffcN1N7P","type":"tool_result","content":"   605→ * they depend on, so the panel renders correctly with no other CSS loaded.\n   606→ */\n   607→const PANEL_STYLE = `\n   608→    :root {\n   609→        --bg: #ffffff; --text: #333333; --subtext: #888888;\n   610→        --accent: #007aff; --card-bg: #ffffff;\n   611→    }\n   612→    * { box-sizing: border-box; }\n   613→    button { font-family: inherit; cursor: pointer; }\n   614→\n   615→    /* --- Control Panel (Glassmorphism) --- */\n   616→    #theme-controls {\n   617→        view-transition-name: theme-ui;\n   618→        position: fixed;\n   619→        bottom: 20px; right: 20px;\n   620→        z-index: 10000; padding: 15px; border-radius: 12px;\n   621→        display: flex; flex-direction: column; gap: 12px;\n   622→        align-items: flex-start; max-width: 350px;\n   623→        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n   624→        color: var(--text);\n   625→        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n   626→        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n   627→        backdrop-filter: saturate(180%) blur(30px);\n   628→        -webkit-backdrop-filter: saturate(180%) blur(30px);\n   629→        transition: all 0.3s;\n   630→    }\n   631→    #theme-controls input {\n   632→        background: var(--bg); color: var(--text);\n   633→        border: 1px solid var(--subtext);\n   634→        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n   635→    }\n   636→    #theme-controls button {\n   637→        background: rgba(0,0,0,0.05); color: var(--text);\n   638→        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n   639→        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n   640→    }\n   641→    #theme-controls #generate-btn {\n   642→        background: var(--accent) !important; color: #fff;\n   643→        border: none; font-weight: 600; padding: 8px 16px;\n   644→    }\n   645→    #preset-buttons {\n   646→        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n   647→        max-height: 300px; opacity: 1; overflow: hidden;\n   648→        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n   649→    }\n   650→    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n   651→    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n   652→    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n   653→    #panel-handle { display: none; }\n   654→    @media (min-width: 769px) {\n   655→        #panel-handle {\n   656→            display: block; position: absolute; top: 0; left: 0;\n   657→            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n   658→        }\n   659→        #panel-handle::before {\n   660→            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n   661→            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n   662→        }\n   663→        #panel-handle:hover::before { opacity: 0.4; }\n   664→        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n   665→        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n   666→        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n   667→    }\n   668→    @media (max-width: 768px) {\n   669→        #theme-controls {\n   670→            bottom: 20px; right: 20px; width: auto;\n   671→            max-width: calc(100vw - 40px); padding: 15px;\n   672→            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n   673→        }\n   674→        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4fa04b65-e18c-4337-8d2d-82ad0d2d8172","timestamp":"2026-02-23T07:19:32.091Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":" * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }","numLines":70,"startLine":605,"totalLines":2100}},"sourceToolAssistantUUID":"4637c209-fbc8-45bc-ae64-c9a0770a1f40"}
{"parentUuid":"4fa04b65-e18c-4337-8d2d-82ad0d2d8172","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01NMtVVCQSto5yHxhiUPXs9i","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YFbN7Yhxi6FEMuwpjAShgR","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1888,"limit":25},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1168,"cache_read_input_tokens":89309,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1168},"output_tokens":10,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbLZMpwU8uMvZ3uVgsX","type":"assistant","uuid":"745f7356-4b13-4957-8f81-a4b5f86f8770","timestamp":"2026-02-23T07:19:32.691Z"}
{"parentUuid":"745f7356-4b13-4957-8f81-a4b5f86f8770","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01YFbN7Yhxi6FEMuwpjAShgR","toolUseID":"toolu_01YFbN7Yhxi6FEMuwpjAShgR","timestamp":"2026-02-23T07:19:32.770Z","uuid":"2e73457d-2502-4ff2-bebf-836b1770e253"}
{"parentUuid":"745f7356-4b13-4957-8f81-a4b5f86f8770","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YFbN7Yhxi6FEMuwpjAShgR","type":"tool_result","content":"  1888→        });\n  1889→\n  1890→        this.elements.themeControls.appendChild(section);\n  1891→    },\n  1892→\n  1893→    showGenerateError(err) {\n  1894→        let message;\n  1895→        switch (err.message) {\n  1896→            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n  1897→            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n  1898→            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n  1899→            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n  1900→            default:              message = `Generation failed: ${err.message}`;\n  1901→        }\n  1902→        let errEl = document.getElementById('generate-error');\n  1903→        if (!errEl) {\n  1904→            errEl = document.createElement('div');\n  1905→            errEl.id = 'generate-error';\n  1906→            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n  1907→            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n  1908→        }\n  1909→        errEl.textContent = message;\n  1910→        clearTimeout(this._errorTimeout);\n  1911→        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n  1912→    },\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"fb17b2fd-0a3e-484c-901a-49000296c02a","timestamp":"2026-02-23T07:19:32.769Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },","numLines":25,"startLine":1888,"totalLines":2100}},"sourceToolAssistantUUID":"745f7356-4b13-4957-8f81-a4b5f86f8770"}
{"parentUuid":"fb17b2fd-0a3e-484c-901a-49000296c02a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01K3BqGGepoAZ1qs6fWmYVhu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JnD3GtfRuHGm9KhMpD6WGX","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1912,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":7827,"cache_read_input_tokens":90477,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":7827},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbSjs2LGuBYyydLMjph","type":"assistant","uuid":"55c31c15-e8bb-47af-bc3a-e0784ff86c4e","timestamp":"2026-02-23T07:19:35.844Z"}
{"parentUuid":"55c31c15-e8bb-47af-bc3a-e0784ff86c4e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01JnD3GtfRuHGm9KhMpD6WGX","toolUseID":"toolu_01JnD3GtfRuHGm9KhMpD6WGX","timestamp":"2026-02-23T07:19:35.929Z","uuid":"58e2d5b1-99f8-4d69-b42e-d465f41814f1"}
{"parentUuid":"55c31c15-e8bb-47af-bc3a-e0784ff86c4e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JnD3GtfRuHGm9KhMpD6WGX","type":"tool_result","content":"  1912→    },\n  1913→\n  1914→    expandApiKeySection() {\n  1915→        const form = document.getElementById('api-key-form');\n  1916→        const icon = document.getElementById('api-key-icon');\n  1917→        if (form && form.style.display === 'none') {\n  1918→            form.style.display = 'flex';\n  1919→            if (icon) icon.style.transform = 'rotate(0deg)';\n  1920→        }\n  1921→        this.elements.themeControls.classList.remove('is-minimized');\n  1922→        const input = document.getElementById('api-key-input');\n  1923→        if (input) setTimeout(() => input.focus(), 300);\n  1924→    },\n  1925→\n  1926→    summarizePrompt(prompt) {\n  1927→        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n  1928→        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n  1929→        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n  1930→        return word.charAt(0).toUpperCase() + word.slice(1);\n  1931→    },\n  1932→\n  1933→    getSavedThemes() {\n  1934→        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n  1935→        catch (_) { return []; }\n  1936→    },\n  1937→\n  1938→    saveCurrentTheme() {\n  1939→        const css = localStorage.getItem('genhn-custom-css');\n  1940→        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n  1941→        if (!css) return;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a36e22d4-56e3-4178-8b3b-a84fa2e6bbed","timestamp":"2026-02-23T07:19:35.928Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;","numLines":30,"startLine":1912,"totalLines":2100}},"sourceToolAssistantUUID":"55c31c15-e8bb-47af-bc3a-e0784ff86c4e"}
{"parentUuid":"a36e22d4-56e3-4178-8b3b-a84fa2e6bbed","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ChjBP12U9a7vBnPZ5MfuQk","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a complete picture. Let me implement the changes:\n\n1. **`index.html`**: Remove the prompt input + apply button row\n2. **`gardener.js`**:\n   - Change `elements.promptInput` and `elements.generateBtn` to `null` (they'll be assigned dynamically)\n   - Add `renderGeminiSection()` that replaces `renderApiKeySection()`\n   - Update `init()` to call `renderGeminiSection()` instead of `renderApiKeySection()`\n   - Update `clearApiKey()` to call `renderGeminiSection()` instead of `renderApiKeySection()`\n   - Remove the prompt input/generate button event listeners from `bindEvents()` since they'll be bound in `renderGeminiSection()`\n   - Remove `renderApiKeySection()` entirely\n\nNow I'm designing the Gemini section UI with a collapsible header, theme input field with apply button, and the API key section below it. I need to match the existing inline styles from the original HTML for consistency.\n\nFor the section toggle, I'm thinking about whether it should default to open or closed—new users would benefit from seeing the main UI expanded, but I should check what the user specified about the initial state.\n\nSince the user wants the prompt input moved into Gemini AI and displayed prominently, I'll have the section open by default with the form visible and the toggle icon pointing downward.\n\nI also need to make sure `expandApiKeySection()` works properly with `renderGeminiSection()`. When expanding the API key form, I should first ensure the gemini section itself is expanded, then expand the API key form within it.\n\nBuilding the gemini section structure... Building the form interface... Writing the toggle handlers... Setting up event listeners for the API key toggle, form submission, and save functionality...\n\nNow I need to position this section in the DOM—inserting it before the paste CSS section if that exists, otherwise appending it to the theme controls. Then I'm adding methods to clear the stored API key and expand the API key section when needed, making sure the form visibility is properly managed. I need to refactor the event binding setup by removing the hardcoded listeners for the generate button and prompt input since those elements won't exist in the initial DOM. I'll also need to update the elements object to set those properties to null, remove the API key rendering function, strip out the prompt input row from the HTML, and swap in the Gemini section renderer during initialization instead.\n\nThe button insertion methods should still work fine since they're targeting the flex container parent, and when the Gemini section re-renders after saving or clearing the key, it'll properly recreate and rebind everything with fresh element references. Since `init()` calls `renderGeminiSection` before `bindEvents()`, and the new section handles its own event listeners internally, I can remove those two event binding lines from `bindEvents()` to avoid duplication.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":839,"cache_read_input_tokens":98304,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":839},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbSyNsPSYHW4jxX3bqu","type":"assistant","uuid":"c6745384-93ed-4720-b274-934877918ccb","timestamp":"2026-02-23T07:20:19.242Z"}
{"parentUuid":"c6745384-93ed-4720-b274-934877918ccb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ChjBP12U9a7vBnPZ5MfuQk","type":"message","role":"assistant","content":[{"type":"text","text":"全体像を把握しました。実装します。\n\n**変更箇所:**\n1. `index.html` からプロンプト行を削除\n2. `renderGeminiSection()` を新設（プロンプト入力 + API Key を統合）\n3. `renderApiKeySection()` を削除\n4. `bindEvents()` からプロンプト/ボタンのリスナーを削除（`renderGeminiSection()` 内で追加するため）\n5. `clearApiKey()`・`expandApiKeySection()` を更新"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":839,"cache_read_input_tokens":98304,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":839},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbSyNsPSYHW4jxX3bqu","type":"assistant","uuid":"52554025-5e91-4bf8-83bc-5ec575fc0c86","timestamp":"2026-02-23T07:20:21.525Z"}
{"type":"file-history-snapshot","messageId":"6be03f0c-fdd5-4fd8-9da8-4031503805c2","snapshot":{"messageId":"77fbcbb5-f0fb-4f10-9f78-078312db970f","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v7","version":7,"backupTime":"2026-02-23T07:13:54.200Z"},"index.html":{"backupFileName":"8bcd8970e5a99eee@v1","version":1,"backupTime":"2026-02-23T07:20:22.617Z"}},"timestamp":"2026-02-23T07:17:46.398Z"},"isSnapshotUpdate":true}
{"parentUuid":"52554025-5e91-4bf8-83bc-5ec575fc0c86","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ChjBP12U9a7vBnPZ5MfuQk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012TGgf5nRjZevhs3uQrJc8v","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/index.html","old_string":"        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">\n            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">\n            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>\n        </div>","new_string":""},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":839,"cache_read_input_tokens":98304,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":839},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbSyNsPSYHW4jxX3bqu","type":"assistant","uuid":"6be03f0c-fdd5-4fd8-9da8-4031503805c2","timestamp":"2026-02-23T07:20:22.613Z"}
{"parentUuid":"6be03f0c-fdd5-4fd8-9da8-4031503805c2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_012TGgf5nRjZevhs3uQrJc8v","toolUseID":"toolu_012TGgf5nRjZevhs3uQrJc8v","timestamp":"2026-02-23T07:20:22.619Z","uuid":"62a8c262-465d-4020-a864-0eb78aff6656"}
{"parentUuid":"6be03f0c-fdd5-4fd8-9da8-4031503805c2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012TGgf5nRjZevhs3uQrJc8v","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/index.html has been updated successfully."}]},"uuid":"62e29598-e057-4922-bc21-e3b2f82dd068","timestamp":"2026-02-23T07:20:22.618Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/index.html","oldString":"        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">\n            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">\n            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>\n        </div>","newString":"","originalFile":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>GenHN</title>\n    <style id=\"generated-style\"></style>\n    </head>\n<body>\n    <div id=\"theme-controls\">\n        <div id=\"panel-handle\"></div>\n        <div id=\"presets-toggle\" style=\"width: 100%; cursor: pointer; font-size: 11px; margin-bottom: 8px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; user-select: none;\">\n             <span style=\"text-transform: uppercase; letter-spacing: 1px; font-weight: 600;\">Presets</span>\n             <span id=\"presets-icon\" style=\"font-size: 10px;\">▼</span>\n        </div>\n        <div id=\"preset-buttons\" style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; transition: all 0.3s ease; overflow: hidden;\">\n            <!-- Buttons will be generated by gardener.js -->\n        </div>\n        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">\n            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">\n            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>\n        </div>\n    </div>\n\n    <header class=\"hn-header\">\n        <nav class=\"hn-nav\">\n            <button class=\"hn-menu-toggle\" aria-label=\"Toggle Menu\">\n                <span></span>\n                <span></span>\n                <span></span>\n            </button>\n            <a href=\"#\" class=\"hn-logo\" aria-label=\"Hacker News Home\">Y</a>\n            <span class=\"hn-site-title\">Hacker News</span>\n            <ul class=\"hn-nav-links\">\n                <li><a href=\"#\">new</a></li>\n                <li><a href=\"#\">past</a></li>\n                <li><a href=\"#\">comments</a></li>\n                <li><a href=\"#\">ask</a></li>\n                <li><a href=\"#\">show</a></li>\n                <li><a href=\"#\">jobs</a></li>\n                <li><a href=\"#\">submit</a></li>\n            </ul>\n            <div class=\"hn-auth\">\n                <a href=\"https://news.ycombinator.com/login\" target=\"_blank\">login</a>\n            </div>\n        </nav>\n    </header>\n\n    <main class=\"hn-main\">\n        <ol class=\"hn-story-list\">\n            \n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">1.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">Show HN: A brand new Hacker News experience with Generative UI</a>\n                        <span class=\"hn-story-domain\">(github.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">150 points</span> by\n                        <span class=\"hn-story-author\">generative_hacker</span>\n                        <span class=\"hn-story-time\">2 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">2.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">New AI model released as open source</a>\n                        <span class=\"hn-story-domain\">(example.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">300 points</span> by\n                        <span class=\"hn-story-author\">ai_fan</span>\n                        <span class=\"hn-story-time\">4 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">3.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">Read the latest design system guidelines</a>\n                        <span class=\"hn-story-domain\">(design.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">215 points</span> by\n                        <span class=\"hn-story-author\">design_geek</span>\n                        <span class=\"hn-story-time\">5 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n        </ol>\n        \n        <button class=\"hn-load-more\">More</button>\n    </main>\n\n    <footer class=\"hn-footer\">\n        <ul class=\"hn-footer-links\">\n            <li><a href=\"#\">Guidelines</a></li>\n            <li><a href=\"#\">FAQ</a></li>\n            <li><a href=\"#\">Lists</a></li>\n            <li><a href=\"#\">API</a></li>\n            <li><a href=\"#\">Security</a></li>\n            <li><a href=\"#\">Legal</a></li>\n            <li><a href=\"#\">Apply to YC</a></li>\n            <li><a href=\"#\">Contact</a></li>\n        </ul>\n    </footer>\n    <script src=\"gardener.js\"></script>\n</body>\n</html>","structuredPatch":[{"oldStart":16,"oldLines":10,"newStart":16,"newLines":6,"lines":["         <div id=\"preset-buttons\" style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; transition: all 0.3s ease; overflow: hidden;\">","             <!-- Buttons will be generated by gardener.js -->","         </div>","-        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">","-            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">","-            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>","-        </div>","     </div>"," ","     <header class=\"hn-header\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"6be03f0c-fdd5-4fd8-9da8-4031503805c2"}
{"parentUuid":"62e29598-e057-4922-bc21-e3b2f82dd068","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Dxu4jxmkgZk596hVxjrcFG","type":"message","role":"assistant","content":[{"type":"text","text":"次に `elements` の初期値を `null` に変更します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3431,"cache_read_input_tokens":99143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3431},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbWR6Gyou1Y2wNL3sip","type":"assistant","uuid":"6e98dfa5-d9e1-4221-ace1-313ed304cf0c","timestamp":"2026-02-23T07:20:25.150Z"}
{"parentUuid":"6e98dfa5-d9e1-4221-ace1-313ed304cf0c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Dxu4jxmkgZk596hVxjrcFG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TBFRAwTuMLgMmrx139S7jX","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),","new_string":"    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3431,"cache_read_input_tokens":99143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3431},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbWR6Gyou1Y2wNL3sip","type":"assistant","uuid":"bf5598e7-dbae-4ce8-ab01-2af4599d4ba3","timestamp":"2026-02-23T07:20:26.973Z"}
{"parentUuid":"bf5598e7-dbae-4ce8-ab01-2af4599d4ba3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01TBFRAwTuMLgMmrx139S7jX","toolUseID":"toolu_01TBFRAwTuMLgMmrx139S7jX","timestamp":"2026-02-23T07:20:26.979Z","uuid":"2d227824-3e95-4ba6-93f0-80cca5892fcf"}
{"parentUuid":"bf5598e7-dbae-4ce8-ab01-2af4599d4ba3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TBFRAwTuMLgMmrx139S7jX","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"560a5a61-153d-4ef3-9fe4-084b67f88b8e","timestamp":"2026-02-23T07:20:26.978Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),","newString":"    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1412,"oldLines":8,"newStart":1412,"newLines":8,"lines":[" ","     elements: {","         styleTag: document.getElementById('generated-style'),","-        promptInput: document.getElementById('prompt-input'),","-        generateBtn: document.getElementById('generate-btn'),","+        promptInput: null,","+        generateBtn: null,","         presetButtons: document.getElementById('preset-buttons'),","         presetsToggle: document.getElementById('presets-toggle'),","         presetsIcon: document.getElementById('presets-icon'),"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"bf5598e7-dbae-4ce8-ab01-2af4599d4ba3"}
{"parentUuid":"560a5a61-153d-4ef3-9fe4-084b67f88b8e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01A1ijua4uCAajNJNgVbKass","type":"message","role":"assistant","content":[{"type":"text","text":"`init()` を更新します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":288,"cache_read_input_tokens":102574,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":288},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbWjyq3sEkmu8767iu8","type":"assistant","uuid":"98619733-4521-44cf-9dc4-771518102231","timestamp":"2026-02-23T07:20:29.020Z"}
{"parentUuid":"98619733-4521-44cf-9dc4-771518102231","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01A1ijua4uCAajNJNgVbKass","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JH8Ps6JHTd7YmUiGWA39NM","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();","new_string":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":288,"cache_read_input_tokens":102574,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":288},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbWjyq3sEkmu8767iu8","type":"assistant","uuid":"cc51b885-8c5d-43d1-bd2a-999a860f74ae","timestamp":"2026-02-23T07:20:30.984Z"}
{"parentUuid":"cc51b885-8c5d-43d1-bd2a-999a860f74ae","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01JH8Ps6JHTd7YmUiGWA39NM","toolUseID":"toolu_01JH8Ps6JHTd7YmUiGWA39NM","timestamp":"2026-02-23T07:20:30.991Z","uuid":"f14c8e20-2640-4137-b0bb-5e6c89773906"}
{"parentUuid":"cc51b885-8c5d-43d1-bd2a-999a860f74ae","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JH8Ps6JHTd7YmUiGWA39NM","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"06b1389c-8634-4c5d-a8a8-d7101a5fd38f","timestamp":"2026-02-23T07:20:30.990Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();","newString":"        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1429,"oldLines":7,"newStart":1429,"newLines":7,"lines":["     async init() {","         this.renderPresetButtons();","         this.renderSavedThemeButtons();","-        this.renderApiKeySection();","+        this.renderGeminiSection();","         this.renderPasteCssSection();","         this.renderPromptTemplateSection();","         this.bindEvents();"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"cc51b885-8c5d-43d1-bd2a-999a860f74ae"}
{"parentUuid":"06b1389c-8634-4c5d-a8a8-d7101a5fd38f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01WpcUsGGskivCnTcjQRZW2N","type":"message","role":"assistant","content":[{"type":"text","text":"`bindEvents()` からプロンプト/ボタンのリスナーを削除します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":294,"cache_read_input_tokens":102862,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":294},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbX3cUaurk5SpKUy9SU","type":"assistant","uuid":"e906c1fd-b1b0-4971-b26d-17249a272bd3","timestamp":"2026-02-23T07:20:33.652Z"}
{"parentUuid":"e906c1fd-b1b0-4971-b26d-17249a272bd3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01WpcUsGGskivCnTcjQRZW2N","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PCkRVjQZCVymrnN2MWS9wb","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());","new_string":"    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":294,"cache_read_input_tokens":102862,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":294},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbX3cUaurk5SpKUy9SU","type":"assistant","uuid":"5f8ff87a-9364-4ba8-beed-da29c7751ae0","timestamp":"2026-02-23T07:20:35.472Z"}
{"parentUuid":"5f8ff87a-9364-4ba8-beed-da29c7751ae0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01PCkRVjQZCVymrnN2MWS9wb","toolUseID":"toolu_01PCkRVjQZCVymrnN2MWS9wb","timestamp":"2026-02-23T07:20:35.478Z","uuid":"bf1b2ee2-ba82-43b6-8173-3d748ea11d18"}
{"parentUuid":"5f8ff87a-9364-4ba8-beed-da29c7751ae0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PCkRVjQZCVymrnN2MWS9wb","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"e8e2d42d-8ed5-47e6-ab76-4fda63a0c5c0","timestamp":"2026-02-23T07:20:35.477Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());","newString":"    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1479,"oldLines":10,"newStart":1479,"newLines":6,"lines":["     },"," ","     bindEvents() {","-        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());","-        this.elements.promptInput.addEventListener('keypress', (e) => {","-            if (e.key === 'Enter') this.handleGenerate();","-        });","         this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());","         this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());","         "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5f8ff87a-9364-4ba8-beed-da29c7751ae0"}
{"parentUuid":"e8e2d42d-8ed5-47e6-ab76-4fda63a0c5c0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_011bfRsL6JuhT7RwQZfQoXx1","type":"message","role":"assistant","content":[{"type":"text","text":"`clearApiKey()` を更新します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":307,"cache_read_input_tokens":103156,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":307},"output_tokens":7,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbXNFtzt5pP5FrcXWBL","type":"assistant","uuid":"c9221acd-7a35-4e0a-99c7-8254d133d29b","timestamp":"2026-02-23T07:20:37.815Z"}
{"parentUuid":"c9221acd-7a35-4e0a-99c7-8254d133d29b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_011bfRsL6JuhT7RwQZfQoXx1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01F8J4oVTi9WkcwB3Tmx7Nb4","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1680,"limit":10},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":307,"cache_read_input_tokens":103156,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":307},"output_tokens":7,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbXNFtzt5pP5FrcXWBL","type":"assistant","uuid":"5e709c3e-26ce-4e7b-96a7-8da4f74bdda2","timestamp":"2026-02-23T07:20:38.576Z"}
{"parentUuid":"5e709c3e-26ce-4e7b-96a7-8da4f74bdda2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01F8J4oVTi9WkcwB3Tmx7Nb4","toolUseID":"toolu_01F8J4oVTi9WkcwB3Tmx7Nb4","timestamp":"2026-02-23T07:20:38.593Z","uuid":"40f2247c-70b3-412e-8464-93cd668a0875"}
{"parentUuid":"5e709c3e-26ce-4e7b-96a7-8da4f74bdda2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01F8J4oVTi9WkcwB3Tmx7Nb4","type":"tool_result","content":"  1680→        this.renderApiKeySection();\n  1681→    },\n  1682→\n  1683→    extractCss(text) {\n  1684→        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n  1685→        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n  1686→        return cleaned.trim();\n  1687→    },\n  1688→\n  1689→    async generateTheme(prompt) {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"431e2f0f-03d8-4aad-bd41-4d4bf956183b","timestamp":"2026-02-23T07:20:38.588Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {","numLines":10,"startLine":1680,"totalLines":2096}},"sourceToolAssistantUUID":"5e709c3e-26ce-4e7b-96a7-8da4f74bdda2"}
{"parentUuid":"431e2f0f-03d8-4aad-bd41-4d4bf956183b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01BPmKfQAvXrRxq7CYmrXNfF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NHFdEkuKpxgXbBJ9m8s7yq","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1670,"limit":12},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":443,"cache_read_input_tokens":103463,"output_tokens":108,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":443,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQbXbKTbNK3YqMBEL5Tn","type":"assistant","uuid":"babe5571-59ca-457d-8ad2-8949b93dfcf8","timestamp":"2026-02-23T07:20:41.434Z"}
{"parentUuid":"babe5571-59ca-457d-8ad2-8949b93dfcf8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01NHFdEkuKpxgXbBJ9m8s7yq","toolUseID":"toolu_01NHFdEkuKpxgXbBJ9m8s7yq","timestamp":"2026-02-23T07:20:41.446Z","uuid":"5821a399-cf5d-4541-8cdb-68f3ddde2ac0"}
{"parentUuid":"babe5571-59ca-457d-8ad2-8949b93dfcf8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NHFdEkuKpxgXbBJ9m8s7yq","type":"tool_result","content":"  1670→    getApiKey() {\n  1671→        return localStorage.getItem('genhn-gemini-key');\n  1672→    },\n  1673→\n  1674→    saveApiKey(key) {\n  1675→        localStorage.setItem('genhn-gemini-key', key.trim());\n  1676→    },\n  1677→\n  1678→    clearApiKey() {\n  1679→        localStorage.removeItem('genhn-gemini-key');\n  1680→        this.renderApiKeySection();\n  1681→    },\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1ad78d65-3cc4-472c-b781-42af906b076e","timestamp":"2026-02-23T07:20:41.445Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },","numLines":12,"startLine":1670,"totalLines":2096}},"sourceToolAssistantUUID":"babe5571-59ca-457d-8ad2-8949b93dfcf8"}
{"parentUuid":"1ad78d65-3cc4-472c-b781-42af906b076e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01BJMZEqtdfMLecKVUXSDRn4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014tYhEUa5yFXt6u3wkWvVW4","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },","new_string":"    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":340,"cache_read_input_tokens":103906,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":340},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbXoGnxax1wirNTECpx","type":"assistant","uuid":"8ebe9a0b-aaff-4eb1-99b3-f343014a59cf","timestamp":"2026-02-23T07:20:47.935Z"}
{"parentUuid":"8ebe9a0b-aaff-4eb1-99b3-f343014a59cf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_014tYhEUa5yFXt6u3wkWvVW4","toolUseID":"toolu_014tYhEUa5yFXt6u3wkWvVW4","timestamp":"2026-02-23T07:20:47.948Z","uuid":"05a87ee4-6461-447b-a1f9-8f7db9176237"}
{"parentUuid":"8ebe9a0b-aaff-4eb1-99b3-f343014a59cf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014tYhEUa5yFXt6u3wkWvVW4","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"c6447114-a5d4-4d53-b8ea-11dc9f06403f","timestamp":"2026-02-23T07:20:47.946Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },","newString":"    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1677,"oldLines":7,"newStart":1677,"newLines":7,"lines":[" ","     clearApiKey() {","         localStorage.removeItem('genhn-gemini-key');","-        this.renderApiKeySection();","+        this.renderGeminiSection();","     },"," ","     extractCss(text) {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"8ebe9a0b-aaff-4eb1-99b3-f343014a59cf"}
{"parentUuid":"c6447114-a5d4-4d53-b8ea-11dc9f06403f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019P8Krb4cd5UCxC77zqJNhg","type":"message","role":"assistant","content":[{"type":"text","text":"`renderApiKeySection()` を `renderGeminiSection()` に置き換えます。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":234,"cache_read_input_tokens":104246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":234},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbYJh7bx2UNswStvyFo","type":"assistant","uuid":"ecb6ebdc-b81d-42d5-a91a-0468cd5d11ea","timestamp":"2026-02-23T07:20:50.214Z"}
{"parentUuid":"ecb6ebdc-b81d-42d5-a91a-0468cd5d11ea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019P8Krb4cd5UCxC77zqJNhg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LZ1XHMLU5wnjbtNnn6nu7Z","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1731,"limit":60},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":234,"cache_read_input_tokens":104246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":234},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbYJh7bx2UNswStvyFo","type":"assistant","uuid":"e9f2bd23-9929-487e-9240-9c47ff9edda3","timestamp":"2026-02-23T07:20:50.829Z"}
{"parentUuid":"e9f2bd23-9929-487e-9240-9c47ff9edda3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01LZ1XHMLU5wnjbtNnn6nu7Z","toolUseID":"toolu_01LZ1XHMLU5wnjbtNnn6nu7Z","timestamp":"2026-02-23T07:20:50.911Z","uuid":"0e933ff0-db95-489d-ba81-f8de2dd94e77"}
{"parentUuid":"e9f2bd23-9929-487e-9240-9c47ff9edda3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LZ1XHMLU5wnjbtNnn6nu7Z","type":"tool_result","content":"  1731→    renderApiKeySection() {\n  1732→        const existing = document.getElementById('api-key-section');\n  1733→        if (existing) existing.remove();\n  1734→\n  1735→        const section = document.createElement('div');\n  1736→        section.id = 'api-key-section';\n  1737→        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n  1738→\n  1739→        if (this.getApiKey()) {\n  1740→            section.innerHTML = `\n  1741→                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n  1742→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n  1743→                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n  1744→                </div>`;\n  1745→            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n  1746→        } else {\n  1747→            section.innerHTML = `\n  1748→                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1749→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n  1750→                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n  1751→                </div>\n  1752→                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1753→                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n  1754→                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n  1755→                </div>`;\n  1756→            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n  1757→                const form = section.querySelector('#api-key-form');\n  1758→                const icon = section.querySelector('#api-key-icon');\n  1759→                const isOpen = form.style.display !== 'none';\n  1760→                form.style.display = isOpen ? 'none' : 'flex';\n  1761→                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1762→            });\n  1763→            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n  1764→                const val = section.querySelector('#api-key-input').value.trim();\n  1765→                if (!val) return;\n  1766→                this.saveApiKey(val);\n  1767→                this.renderApiKeySection();\n  1768→            });\n  1769→        }\n  1770→\n  1771→        this.elements.themeControls.appendChild(section);\n  1772→    },\n  1773→\n  1774→    renderPasteCssSection() {\n  1775→        const existing = document.getElementById('paste-css-section');\n  1776→        if (existing) existing.remove();\n  1777→\n  1778→        const section = document.createElement('div');\n  1779→        section.id = 'paste-css-section';\n  1780→        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n  1781→\n  1782→        section.innerHTML = `\n  1783→            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1784→                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n  1785→                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n  1786→            </div>\n  1787→            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1788→                <textarea id=\"paste-css-input\" placeholder=\":root {\n  1789→  --bg: #f5f5f7;        /* page background   */\n  1790→  --card-bg: #ffffff;   /* story card        */\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b8b19ace-0761-4b4c-99d2-84908c35df89","timestamp":"2026-02-23T07:20:50.910Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */","numLines":60,"startLine":1731,"totalLines":2096}},"sourceToolAssistantUUID":"e9f2bd23-9929-487e-9240-9c47ff9edda3"}
{"parentUuid":"b8b19ace-0761-4b4c-99d2-84908c35df89","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01JREtveGTPZEgySRHxtLsCX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01U7nL9v6ty1nu1vf59VRidS","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },","new_string":"    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1538,"cache_read_input_tokens":104480,"output_tokens":2190,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":1538,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQbYWBRTC7p9LTvc9Cfp","type":"assistant","uuid":"a83fc711-fa43-46b6-975a-e9527a028496","timestamp":"2026-02-23T07:21:08.830Z"}
{"parentUuid":"a83fc711-fa43-46b6-975a-e9527a028496","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01U7nL9v6ty1nu1vf59VRidS","toolUseID":"toolu_01U7nL9v6ty1nu1vf59VRidS","timestamp":"2026-02-23T07:21:08.839Z","uuid":"a6beca85-7b4f-4046-9cc2-5a7ba828696d"}
{"parentUuid":"a83fc711-fa43-46b6-975a-e9527a028496","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01U7nL9v6ty1nu1vf59VRidS","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"b3d7b4a0-f518-4afd-8437-ccefecf6f88a","timestamp":"2026-02-23T07:21:08.838Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },","newString":"    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1728,"oldLines":31,"newStart":1728,"newLines":60,"lines":["         return css;","     },"," ","-    renderApiKeySection() {","-        const existing = document.getElementById('api-key-section');","+    renderGeminiSection() {","+        const existing = document.getElementById('gemini-section');","         if (existing) existing.remove();"," ","         const section = document.createElement('div');","-        section.id = 'api-key-section';","+        section.id = 'gemini-section';","         section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';"," ","-        if (this.getApiKey()) {","-            section.innerHTML = `","-                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">","-                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>","-                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>","-                </div>`;","+        const hasKey = !!this.getApiKey();","+        section.innerHTML = `","+            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","+                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>","+                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>","+            </div>","+            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">","+                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">","+                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">","+                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>","+                </div>","+                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">","+                    ${hasKey ? `","+                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">","+                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>","+                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>","+                    </div>` : `","+                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","+                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>","+                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","+                    </div>","+                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">","+                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">","+                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>","+                    </div>`}","+                </div>","+            </div>`;","+","+        section.querySelector('#gemini-toggle').addEventListener('click', () => {","+            const form = section.querySelector('#gemini-form');","+            const icon = section.querySelector('#gemini-icon');","+            const isOpen = form.style.display !== 'none';","+            form.style.display = isOpen ? 'none' : 'flex';","+            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';","+        });","+","+        this.elements.promptInput = section.querySelector('#prompt-input');","+        this.elements.generateBtn = section.querySelector('#generate-btn');","+        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());","+        this.elements.promptInput.addEventListener('keypress', (e) => {","+            if (e.key === 'Enter') this.handleGenerate();","+        });","+","+        if (hasKey) {","             section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());","         } else {","-            section.innerHTML = `","-                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","-                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>","-                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","-                </div>","-                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">","-                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">","-                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>","-                </div>`;","             section.querySelector('#api-key-toggle').addEventListener('click', () => {","                 const form = section.querySelector('#api-key-form');","                 const icon = section.querySelector('#api-key-icon');"]},{"oldStart":1764,"oldLines":11,"newStart":1793,"newLines":16,"lines":["                 const val = section.querySelector('#api-key-input').value.trim();","                 if (!val) return;","                 this.saveApiKey(val);","-                this.renderApiKeySection();","+                this.renderGeminiSection();","             });","         }"," ","-        this.elements.themeControls.appendChild(section);","+        const pasteCss = document.getElementById('paste-css-section');","+        if (pasteCss) {","+            this.elements.themeControls.insertBefore(section, pasteCss);","+        } else {","+            this.elements.themeControls.appendChild(section);","+        }","     },"," ","     renderPasteCssSection() {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"a83fc711-fa43-46b6-975a-e9527a028496"}
{"parentUuid":"b3d7b4a0-f518-4afd-8437-ccefecf6f88a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KBHozQiXbqJShHmwujdRdG","type":"message","role":"assistant","content":[{"type":"text","text":"`expandApiKeySection()` を更新して Gemini セクション自体も展開するようにします。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2229,"cache_read_input_tokens":106018,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2229},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbZpKMSeNAbaXZbg1vc","type":"assistant","uuid":"8bf0b478-d8fe-4ab1-9dcf-595b647ba26d","timestamp":"2026-02-23T07:21:11.232Z"}
{"parentUuid":"8bf0b478-d8fe-4ab1-9dcf-595b647ba26d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01KBHozQiXbqJShHmwujdRdG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014SAddWWSwPepmEyLbgLqQv","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },","new_string":"    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2229,"cache_read_input_tokens":106018,"output_tokens":536,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2229,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQbZpKMSeNAbaXZbg1vc","type":"assistant","uuid":"a75ef140-e478-47ea-a4bd-cadcfabc6938","timestamp":"2026-02-23T07:21:15.641Z"}
{"parentUuid":"a75ef140-e478-47ea-a4bd-cadcfabc6938","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_014SAddWWSwPepmEyLbgLqQv","toolUseID":"toolu_014SAddWWSwPepmEyLbgLqQv","timestamp":"2026-02-23T07:21:15.647Z","uuid":"f2e4504c-f31d-473d-a5d2-aef5cbd66aa1"}
{"parentUuid":"a75ef140-e478-47ea-a4bd-cadcfabc6938","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014SAddWWSwPepmEyLbgLqQv","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"1b1de437-767e-439b-8c76-9622041f91a3","timestamp":"2026-02-23T07:21:15.647Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },","newString":"    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1942,"oldLines":6,"newStart":1942,"newLines":12,"lines":["     },"," ","     expandApiKeySection() {","+        const geminiForm = document.getElementById('gemini-form');","+        const geminiIcon = document.getElementById('gemini-icon');","+        if (geminiForm && geminiForm.style.display === 'none') {","+            geminiForm.style.display = 'flex';","+            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';","+        }","         const form = document.getElementById('api-key-form');","         const icon = document.getElementById('api-key-icon');","         if (form && form.style.display === 'none') {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"a75ef140-e478-47ea-a4bd-cadcfabc6938"}
{"parentUuid":"1b1de437-767e-439b-8c76-9622041f91a3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_015q3HYCwDhyXDEi7uCNN1nb","type":"message","role":"assistant","content":[{"type":"text","text":"正しく動作するか確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":575,"cache_read_input_tokens":108247,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":575},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbaKhSVpQ8NtRUWiBV1","type":"assistant","uuid":"9a7fad23-d881-4e77-99d1-c68f19f396fb","timestamp":"2026-02-23T07:21:17.645Z"}
{"parentUuid":"9a7fad23-d881-4e77-99d1-c68f19f396fb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_015q3HYCwDhyXDEi7uCNN1nb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012ZFuYkD57Kez1QHmErsnzg","name":"Bash","input":{"command":"grep -n \"renderApiKeySection\\|prompt-input\\|generate-btn\" /Users/turtlekazu/ReactProjects/GenHN/gardener.js","description":"Check for any remaining references to old elements/methods"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":575,"cache_read_input_tokens":108247,"output_tokens":129,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":575,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQbaKhSVpQ8NtRUWiBV1","type":"assistant","uuid":"cb64c5e5-022c-45e7-9692-1419b4e4fb9a","timestamp":"2026-02-23T07:21:18.809Z"}
{"parentUuid":"cb64c5e5-022c-45e7-9692-1419b4e4fb9a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012ZFuYkD57Kez1QHmErsnzg","type":"tool_result","content":"464:    #theme-controls #generate-btn {\n641:    #theme-controls #generate-btn {\n723:        #theme-controls #generate-btn { background: var(--accent) !important; }\n768:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n821:        #theme-controls #generate-btn { background: var(--red) !important; }\n865:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n896:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n926:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n952:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n1000:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n1046:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n1096:        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n1203:        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n1348:        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n1747:                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n1748:                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n1775:        this.elements.promptInput = section.querySelector('#prompt-input');\n1776:        this.elements.generateBtn = section.querySelector('#generate-btn');","is_error":false}]},"uuid":"d9137229-fe03-4fb5-acc4-84022fc3974a","timestamp":"2026-02-23T07:21:19.011Z","toolUseResult":{"stdout":"464:    #theme-controls #generate-btn {\n641:    #theme-controls #generate-btn {\n723:        #theme-controls #generate-btn { background: var(--accent) !important; }\n768:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n821:        #theme-controls #generate-btn { background: var(--red) !important; }\n865:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n896:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n926:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n952:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n1000:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n1046:        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n1096:        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n1203:        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n1348:        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n1747:                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n1748:                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n1775:        this.elements.promptInput = section.querySelector('#prompt-input');\n1776:        this.elements.generateBtn = section.querySelector('#generate-btn');","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"cb64c5e5-022c-45e7-9692-1419b4e4fb9a"}
{"parentUuid":"d9137229-fe03-4fb5-acc4-84022fc3974a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019uWGUHjGFtfrX48ed2ALSf","type":"message","role":"assistant","content":[{"type":"text","text":"`renderApiKeySection` の参照がなくなっています。`#generate-btn` と `#prompt-input` は `renderGeminiSection()` 内のみに存在しています。問題ありません。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":643,"cache_read_input_tokens":108822,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":643},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbaaCpHVKJdNwpaXxUp","type":"assistant","uuid":"f05412d2-3d5b-433f-9dcd-2c4c059c564e","timestamp":"2026-02-23T07:21:23.620Z"}
{"parentUuid":"f05412d2-3d5b-433f-9dcd-2c4c059c564e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019uWGUHjGFtfrX48ed2ALSf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014rnVBdfRPDM5bye2j9d2ar","name":"Bash","input":{"command":"grep -n \"renderApiKeySection\" /Users/turtlekazu/ReactProjects/GenHN/gardener.js","description":"Confirm no remaining renderApiKeySection references"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":643,"cache_read_input_tokens":108822,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":643},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbaaCpHVKJdNwpaXxUp","type":"assistant","uuid":"68b57d54-a0b0-4743-9eb2-24e2f478e15c","timestamp":"2026-02-23T07:21:24.370Z"}
{"parentUuid":"68b57d54-a0b0-4743-9eb2-24e2f478e15c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014rnVBdfRPDM5bye2j9d2ar","type":"tool_result","content":"","is_error":false}]},"uuid":"c6cb331f-a0ed-4d7d-ab09-91f2c4a102e9","timestamp":"2026-02-23T07:21:24.550Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false,"returnCodeInterpretation":"No matches found","noOutputExpected":false},"sourceToolAssistantUUID":"68b57d54-a0b0-4743-9eb2-24e2f478e15c"}
{"parentUuid":"c6cb331f-a0ed-4d7d-ab09-91f2c4a102e9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01QheBVMtUkzvdSysoTQgcJU","type":"message","role":"assistant","content":[{"type":"text","text":"完全に削除できています。実装完了です。\n\n---\n\n**変更内容まとめ:**\n\n**`index.html`**\n- プロンプト入力行（`#prompt-input` + `#generate-btn`）を削除\n\n**`gardener.js`**\n- `elements.promptInput` / `generateBtn` を `null` 初期値に変更（動的に割り当て）\n- `renderApiKeySection()` を廃止し、`renderGeminiSection()` に統合\n  - 「**GEMINI AI**」セクションヘッダー（折りたたみ可能）\n  - 展開時：プロンプト入力 + Apply ボタン → API Key サブセクション の順\n  - API Key 登録済みなら「Gemini AI: enabled」＋ clear、未登録なら「API Key ▼」トグル\n  - プロンプト/ボタンのイベントリスナーをセクション内で登録\n- `bindEvents()` からプロンプト/ボタンのリスナー削除\n- `clearApiKey()` → `renderGeminiSection()` を呼ぶよう更新\n- `expandApiKeySection()` → Gemini セクション自体が折りたたまれていたら先に展開するよう更新"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":281,"cache_read_input_tokens":109465,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":281},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbayjvbUTE26EUDoabS","type":"assistant","uuid":"e7bb17bb-8dd8-4f20-99e9-a16956407d73","timestamp":"2026-02-23T07:21:32.962Z"}
{"parentUuid":"e7bb17bb-8dd8-4f20-99e9-a16956407d73","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"77a23524-ce46-454b-806d-c72dce507307","toolUseID":"77a23524-ce46-454b-806d-c72dce507307","timestamp":"2026-02-23T07:21:32.997Z","uuid":"811d1979-af2a-461a-b34e-899993a24199"}
{"parentUuid":"811d1979-af2a-461a-b34e-899993a24199","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":293}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T07:21:33.292Z","uuid":"60d64db7-30b0-4a9b-85cc-05fac763c692","toolUseID":"77a23524-ce46-454b-806d-c72dce507307"}
{"parentUuid":"60d64db7-30b0-4a9b-85cc-05fac763c692","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":226896,"timestamp":"2026-02-23T07:21:33.295Z","uuid":"8a5837c2-4668-4adf-a730-bef7c06df2e4","isMeta":false}
{"type":"file-history-snapshot","messageId":"1104e381-3834-4764-bc17-1889b2e2f244","snapshot":{"messageId":"1104e381-3834-4764-bc17-1889b2e2f244","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v8","version":8,"backupTime":"2026-02-23T07:23:29.999Z"},"index.html":{"backupFileName":"8bcd8970e5a99eee@v2","version":2,"backupTime":"2026-02-23T07:23:29.999Z"}},"timestamp":"2026-02-23T07:23:29.999Z"},"isSnapshotUpdate":false}
{"parentUuid":"8a5837c2-4668-4adf-a730-bef7c06df2e4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"現在選択中のテーマ名がGemini AIセクションのテキストフィールドに入るようにする必要はありません。"},"uuid":"1104e381-3834-4764-bc17-1889b2e2f244","timestamp":"2026-02-23T07:23:29.844Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"1104e381-3834-4764-bc17-1889b2e2f244","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CSqww5Q58Rfu68joKT9Mfk","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to remove the behavior where clicking a preset button sets the prompt input value to the theme name. Let me find that code.","signature":"ErMCCkYICxgCKkAjGi9wZaJ77Uvihao1/DWevE1f6niYIwSsK66lBz1lORZ3Lci6z3lLKCchGMoxGd8DSOSSiUi2+g85yPRGytv2EgwNPANKCO9YxpsH2WEaDFRFapPXWjWU7vYHzCIwgI1WiQ8wKhO/Incw6iTsMZULqyjhHo2l2yD+1gQob6sXJuqOBT9HPUVxxtTzPoUuKpoBcqSrVhDe4gZ+RVtb/6zJwGQRTkNqWCHH5s2rVryo1xcM7e8FjdlXa26Y7mqakQOBMy+bSs5aVbzUJiY4E1/XzdCGQ9rbIOUp+lWnl2JcQWOop2qwU60rg923urJ6q558FecOcqoSnOkkV0034fSYvYfb1o0X0V9+h6WQndYAHgpFwJmJwvYtZFrsKd7kF12ICdXWrjW0ofI+nhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":43,"cache_read_input_tokens":110099,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":43},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbkEFoATpg3U8RCMF8p","type":"assistant","uuid":"2345c4a8-95cc-4516-ae01-2eb584bd4ef4","timestamp":"2026-02-23T07:23:32.454Z"}
{"parentUuid":"2345c4a8-95cc-4516-ae01-2eb584bd4ef4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CSqww5Q58Rfu68joKT9Mfk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016HrNAc5uce6tSbP97JNgpt","name":"Grep","input":{"pattern":"promptInput\\.value","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":2},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":43,"cache_read_input_tokens":110099,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":43},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbkEFoATpg3U8RCMF8p","type":"assistant","uuid":"d6ac2df1-d296-447f-9b52-55917b544397","timestamp":"2026-02-23T07:23:33.596Z"}
{"parentUuid":"d6ac2df1-d296-447f-9b52-55917b544397","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_016HrNAc5uce6tSbP97JNgpt","toolUseID":"toolu_016HrNAc5uce6tSbP97JNgpt","timestamp":"2026-02-23T07:23:33.950Z","uuid":"bb6c60eb-698e-432a-be3c-d43f5bf735be"}
{"parentUuid":"d6ac2df1-d296-447f-9b52-55917b544397","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016HrNAc5uce6tSbP97JNgpt","type":"tool_result","content":"1441-        if (savedCustom) {\n1442-            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n1443:            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n1444-            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n1445-            this.renderSaveButton(!alreadySaved);\n--\n1472-            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n1473-            btn.onclick = () => {\n1474:                this.elements.promptInput.value = themeName;\n1475-                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n1476-            };\n--\n2027-            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n2028-            btn.addEventListener('click', () => {\n2029:                this.elements.promptInput.value = theme.prompt;\n2030-                this.applyStyle(theme.css, null, theme.prompt);\n2031-                this.renderSaveButton(false);\n--\n2065-\n2066-    async handleGenerate() {\n2067:        const input = this.elements.promptInput.value.trim();\n2068-        if (!input) return;\n2069-        if (this._isGenerating) return;"}]},"uuid":"e1ae29e6-ec16-49cc-aad2-cb1f4f77ee64","timestamp":"2026-02-23T07:23:33.949Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1441-        if (savedCustom) {\n1442-            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n1443:            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n1444-            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n1445-            this.renderSaveButton(!alreadySaved);\n--\n1472-            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n1473-            btn.onclick = () => {\n1474:                this.elements.promptInput.value = themeName;\n1475-                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n1476-            };\n--\n2027-            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n2028-            btn.addEventListener('click', () => {\n2029:                this.elements.promptInput.value = theme.prompt;\n2030-                this.applyStyle(theme.css, null, theme.prompt);\n2031-                this.renderSaveButton(false);\n--\n2065-\n2066-    async handleGenerate() {\n2067:        const input = this.elements.promptInput.value.trim();\n2068-        if (!input) return;\n2069-        if (this._isGenerating) return;","numLines":23},"sourceToolAssistantUUID":"d6ac2df1-d296-447f-9b52-55917b544397"}
{"parentUuid":"e1ae29e6-ec16-49cc-aad2-cb1f4f77ee64","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_013ZB7VXw9Ly9D6nXQGiig6r","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"There are three places where `promptInput.value` is set to a theme name:\n1. Line 1443: When restoring saved custom CSS on init - this is actually useful to restore the previously typed prompt\n2. Line 1474: When a built-in preset button is clicked\n3. Line 2029: When a saved custom theme button is clickedThe user says \"現在選択中のテーマ名がGemini AIセクションのテキストフィールドに入るようにする必要はありません\" - the current theme name doesn't need to go into the Gemini AI text field.\n\nLines 1474 and 2029 are the ones that set the prompt input when selecting themes. \n\nHere is the next thinking you need to rewrite:\nLine 1443 is for restoring the previously typed Gemini prompt when loading the page, which is arguably useful.\n\nI'll remove lines 1474 and 2029 since those are about selecting presets/saved themes setting the prompt field.\n\nFor line 1443, this is about restoring the user's own Gemini prompt - that seems reasonable to keep. Actually the user said \"現在選択中のテーマ名が\" - the currently selected theme name going into the field. Line 1443 restores the prompt the user typed previously (for a Gemini-generated theme), which is different from a theme name. I'll keep that.\n\nActually, let me recons\n\n---\n\nSo I need to remove the lines where theme names get populated into the prompt field when selecting presets or saved themes. Line 1443 is different though—it's restoring the user's previously typed Gemini prompt on page load, which is the actual prompt content rather than just a theme name, so that should stay.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":561,"cache_read_input_tokens":110142,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":561},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbkWkjT3uweUARnFLFk","type":"assistant","uuid":"bd1166c9-3dc3-41da-8cfe-8cb7e65fa679","timestamp":"2026-02-23T07:23:45.807Z"}
{"parentUuid":"bd1166c9-3dc3-41da-8cfe-8cb7e65fa679","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_013ZB7VXw9Ly9D6nXQGiig6r","type":"message","role":"assistant","content":[{"type":"text","text":"2箇所削除します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":561,"cache_read_input_tokens":110142,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":561},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbkWkjT3uweUARnFLFk","type":"assistant","uuid":"789cdb87-557f-41a5-b65b-50fc945fa45a","timestamp":"2026-02-23T07:23:45.807Z"}
{"parentUuid":"789cdb87-557f-41a5-b65b-50fc945fa45a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_013ZB7VXw9Ly9D6nXQGiig6r","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015kgPKw838XW92yzxMeYSfg","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };","new_string":"            btn.onclick = () => {\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":561,"cache_read_input_tokens":110142,"output_tokens":666,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":561,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQbkWkjT3uweUARnFLFk","type":"assistant","uuid":"20644398-89d5-4c04-b9b7-c688b2d432c4","timestamp":"2026-02-23T07:23:46.019Z"}
{"parentUuid":"20644398-89d5-4c04-b9b7-c688b2d432c4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_015kgPKw838XW92yzxMeYSfg"}]},"uuid":"8194eaa9-ae45-417e-8003-990886f65931","timestamp":"2026-02-23T07:23:46.019Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it.","sourceToolAssistantUUID":"20644398-89d5-4c04-b9b7-c688b2d432c4"}
{"parentUuid":"8194eaa9-ae45-417e-8003-990886f65931","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01UZakLpoWzsC6dp6hkKFp5S","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0195DkdcQv9wQKmgHF7GRByb","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1471,"limit":8},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":708,"cache_read_input_tokens":110703,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":708},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbmQbvZbx2bAagmSAra","type":"assistant","uuid":"cf22b99d-fe46-4239-8c49-11ae38930a82","timestamp":"2026-02-23T07:23:48.182Z"}
{"parentUuid":"cf22b99d-fe46-4239-8c49-11ae38930a82","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_0195DkdcQv9wQKmgHF7GRByb","toolUseID":"toolu_0195DkdcQv9wQKmgHF7GRByb","timestamp":"2026-02-23T07:23:48.277Z","uuid":"4f587201-9c4d-4ece-af2c-f3744b623d72"}
{"parentUuid":"cf22b99d-fe46-4239-8c49-11ae38930a82","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0195DkdcQv9wQKmgHF7GRByb","type":"tool_result","content":"  1471→            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n  1472→            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n  1473→            btn.onclick = () => {\n  1474→                this.elements.promptInput.value = themeName;\n  1475→                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n  1476→            };\n  1477→            this.elements.presetButtons.appendChild(btn);\n  1478→        });\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"afe6ce8b-c4bb-4d2e-8618-c1fb30cb968a","timestamp":"2026-02-23T07:23:48.276Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });","numLines":8,"startLine":1471,"totalLines":2136}},"sourceToolAssistantUUID":"cf22b99d-fe46-4239-8c49-11ae38930a82"}
{"parentUuid":"afe6ce8b-c4bb-4d2e-8618-c1fb30cb968a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_019xhV8C2Wc1foamYba67aVs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ji2TAZR8Yp62XxBZiSiGeC","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };","new_string":"            btn.onclick = () => {\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":363,"cache_read_input_tokens":111411,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":363},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbma6gBdWqKS798siHc","type":"assistant","uuid":"b82eea3f-e3b7-4d7e-9374-19c742862c6a","timestamp":"2026-02-23T07:23:53.501Z"}
{"parentUuid":"b82eea3f-e3b7-4d7e-9374-19c742862c6a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Ji2TAZR8Yp62XxBZiSiGeC","toolUseID":"toolu_01Ji2TAZR8Yp62XxBZiSiGeC","timestamp":"2026-02-23T07:23:53.511Z","uuid":"74ad1ec7-a311-4bfc-8434-d0183ebd218a"}
{"parentUuid":"b82eea3f-e3b7-4d7e-9374-19c742862c6a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ji2TAZR8Yp62XxBZiSiGeC","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"624007e9-e4db-44a4-995f-e8e7f9d6eb6e","timestamp":"2026-02-23T07:23:53.510Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };","newString":"            btn.onclick = () => {\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1471,"oldLines":7,"newStart":1471,"newLines":6,"lines":["             btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };","             btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };","             btn.onclick = () => {","-                this.elements.promptInput.value = themeName;","                 this.applyStyle(STYLE_PRESETS[themeName], themeName);","             };","             this.elements.presetButtons.appendChild(btn);"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b82eea3f-e3b7-4d7e-9374-19c742862c6a"}
{"parentUuid":"624007e9-e4db-44a4-995f-e8e7f9d6eb6e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Pu5q1DLJZFoFNHcMvyUXC2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012tqNBZ9q1YfJy4SWZoKMHw","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":2025,"limit":8},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":245,"cache_read_input_tokens":111774,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":245},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbmxr9sTu1M7GHUoVPz","type":"assistant","uuid":"efa41b50-ee6c-4e52-b455-c7a4dde9f120","timestamp":"2026-02-23T07:23:56.050Z"}
{"parentUuid":"efa41b50-ee6c-4e52-b455-c7a4dde9f120","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_012tqNBZ9q1YfJy4SWZoKMHw","toolUseID":"toolu_012tqNBZ9q1YfJy4SWZoKMHw","timestamp":"2026-02-23T07:23:56.072Z","uuid":"f19ccaa1-9554-43f6-b9f3-2196b8fee147"}
{"parentUuid":"efa41b50-ee6c-4e52-b455-c7a4dde9f120","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012tqNBZ9q1YfJy4SWZoKMHw","type":"tool_result","content":"  2025→            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n  2026→            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n  2027→            btn.addEventListener('click', () => {\n  2028→                this.elements.promptInput.value = theme.prompt;\n  2029→                this.applyStyle(theme.css, null, theme.prompt);\n  2030→                this.renderSaveButton(false);\n  2031→                this.togglePresets(true);\n  2032→            });\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"62f23404-5a29-4690-8d2c-799c9d4d5230","timestamp":"2026-02-23T07:23:56.070Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });","numLines":8,"startLine":2025,"totalLines":2135}},"sourceToolAssistantUUID":"efa41b50-ee6c-4e52-b455-c7a4dde9f120"}
{"parentUuid":"62f23404-5a29-4690-8d2c-799c9d4d5230","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01XNscUaUHhX6VkPMkuP8i8f","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LzMYsVnRGffh32Uh91yJrT","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });","new_string":"            btn.addEventListener('click', () => {\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":367,"cache_read_input_tokens":112019,"output_tokens":247,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":367,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQbn9ufVe8QnYeojoKsd","type":"assistant","uuid":"588384e0-0bb1-4ad3-8260-6d972aa3b5af","timestamp":"2026-02-23T07:23:59.853Z"}
{"parentUuid":"588384e0-0bb1-4ad3-8260-6d972aa3b5af","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01LzMYsVnRGffh32Uh91yJrT","toolUseID":"toolu_01LzMYsVnRGffh32Uh91yJrT","timestamp":"2026-02-23T07:23:59.860Z","uuid":"11870162-0322-41c3-b663-efb874066bc3"}
{"parentUuid":"588384e0-0bb1-4ad3-8260-6d972aa3b5af","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LzMYsVnRGffh32Uh91yJrT","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"80f4b63b-fa2b-40f4-9599-ecfe0ef341d4","timestamp":"2026-02-23T07:23:59.859Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });","newString":"            btn.addEventListener('click', () => {\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":2025,"oldLines":7,"newStart":2025,"newLines":6,"lines":["             btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });","             btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });","             btn.addEventListener('click', () => {","-                this.elements.promptInput.value = theme.prompt;","                 this.applyStyle(theme.css, null, theme.prompt);","                 this.renderSaveButton(false);","                 this.togglePresets(true);"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"588384e0-0bb1-4ad3-8260-6d972aa3b5af"}
{"parentUuid":"80f4b63b-fa2b-40f4-9599-ecfe0ef341d4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ToyfgXpc77wvYEXAXKuQtT","type":"message","role":"assistant","content":[{"type":"text","text":"完了です。プリセットボタン（ビルトイン・保存済みどちらも）をクリックしても、Gemini AI セクションのテキストフィールドに何も入らなくなりました。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":286,"cache_read_input_tokens":112386,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":286},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbnRZ1C3trgYX7pi72V","type":"assistant","uuid":"cbccc9b5-e3e4-4754-a67f-1767ea4660a4","timestamp":"2026-02-23T07:24:03.016Z"}
{"parentUuid":"cbccc9b5-e3e4-4754-a67f-1767ea4660a4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"34c5620b-47f0-40f2-9147-0c6eb8cd6397","toolUseID":"34c5620b-47f0-40f2-9147-0c6eb8cd6397","timestamp":"2026-02-23T07:24:03.041Z","uuid":"f9be214e-bc86-4992-8fa5-d0a4c126d62c"}
{"parentUuid":"f9be214e-bc86-4992-8fa5-d0a4c126d62c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":271}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T07:24:03.313Z","uuid":"2845a527-9bde-49ec-a7b1-d4bc43c2b24b","toolUseID":"34c5620b-47f0-40f2-9147-0c6eb8cd6397"}
{"parentUuid":"2845a527-9bde-49ec-a7b1-d4bc43c2b24b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":33315,"timestamp":"2026-02-23T07:24:03.315Z","uuid":"4bd401e8-6094-429c-9ea6-b04af998680d","isMeta":false}
{"type":"file-history-snapshot","messageId":"36fd6117-afa9-4ac1-bc92-7532f8252218","snapshot":{"messageId":"36fd6117-afa9-4ac1-bc92-7532f8252218","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v9","version":9,"backupTime":"2026-02-23T07:25:36.693Z"},"index.html":{"backupFileName":"8bcd8970e5a99eee@v2","version":2,"backupTime":"2026-02-23T07:23:29.999Z"}},"timestamp":"2026-02-23T07:25:36.692Z"},"isSnapshotUpdate":false}
{"parentUuid":"4bd401e8-6094-429c-9ea6-b04af998680d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"リロード時に、Gemini  AIセクションは閉じているようにしてください。また、APIキーが入っていない場合は、プロンプト用のテキストフィールドを無効にして。また、テキストフィールドの順番も、APIキー入力欄の方が上にして"},"uuid":"36fd6117-afa9-4ac1-bc92-7532f8252218","timestamp":"2026-02-23T07:25:36.578Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"36fd6117-afa9-4ac1-bc92-7532f8252218","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01BNJfMWMG7QBk9YUVenrRx3","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants three changes to the Gemini AI section:\n\n1. **On reload, Gemini AI section should start collapsed** (currently it starts open)\n2. **If no API key, disable the prompt text field**\n3. **Reorder the UI: API Key input comes before the prompt text field**\n\nLet me look at the current `renderGeminiSection()` code to understand what needs to change.\n\nCurrent order in `#gemini-form`:\n1. Prompt input + Apply button\n2. API key section\n\nNew order:\n1. API key section\n2. Prompt input + Apply button\n\nChanges:\n\n\nI need to hide the form initially with CSS and rotate the collapse icon, add a disabled attribute to the prompt input when there's no API key, and swap the HTML elements so the API key section appears before the prompt input.","signature":"EugGCkYICxgCKkACoe/BPR7xdOih33eXMHLMSXgaFO8KY7TWUOQMpeGR4VS+LwqXyStWGxBhVs5WrMwnN7H6s7pFHWgfK7qZImEXEgyMub0hHUsHi8nzoS8aDL5Njb5bDM5gOSOWWSIwvKrOF73moIoLOk5WwxLYErjeywEMgqTP3ulXYF9TG/7t34XYzXqXWnir+0cE/+NrKs8F8iTlGP+9+OH7LBgWrilPQ6kMYoGm5dzS+mO7e5kfOwTEX+wST+mdb1wDeFMataf2cZ1v6K3xdC14piyb0ypCAX26rt1ue0r+Sb+1c0YkIhpcB+ILkDojWV2r7NyR9MRf/cdgmEoVyePuMigDuKQmn/xlBHh08o2cGKAM1U7JiBg2LmmgATu047vv8lZuFfPCGvrI5/m9fh1jb6XTbNjPHmH+RO2DI819Xsn1E7kvE1cOneVidGO/QFOmLkzwc9OWB0tXDD2UW/8ENsM3+0Vy5zIUZHxhfo1ZOXI0gcNIykuQiP+dzr5xi8EQZeG7Hm6+R5W5jF+N5Hc26uTz6f9K94Bnrn+8MKt7wp6Xfn/+KgpekRJRaSvXf9lKBbvuLzCGOhYcX9cm/eWetlVG+IiZD1FFFkiLt78/ZFL6cOuwDRYCuOY7k0+Y54UTeeoIEVODuuPd1ePtbFyWzFyGLhsboH8hk2I738vpVbS3r9vfZU56a3UQl+1iEXuDc3DRRj1eco8ihkAlYUkXStAl+Iyx5ZjxpvPLgHV1c0DAPOjsYAe6p3VDzyIIAK2a/f2DtyyKLHl7dXRf7LrU9aH5B/vpkysnPt4gPZfcfNeoitXRS3G6ycf21ZclQPoKmqZy0458ybLj73sjrLISohBhBHKet0gpQguB9UVtKIX1m5GA9byCAyimQx4NEza5FPy74d/6nXzf76qY3/x0yA0yszICkoGr82jGI1t/H4fna3NNSOwrCHo6HkL8LcFsGR0C/1SUitSvU9peg7DH5EQTU8cO/F4C9jRlVJpFHXAv50J2cRtLbbPusUTOqihF0BttZu+Ph5r1+UBjipbu2AHXBKJsY3574Bc3Lbr5nYzeEvJPqOvZ2tfDvIkuL2QYyZaeihWpg9RLQCAotgFfdA9QBml9oR1NSWqk5N+fmrdeDUU87ROk/xc842/+nXMAP3EaEbYYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":89,"cache_read_input_tokens":112734,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":89},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbua8dfswWdtjxujWrU","type":"assistant","uuid":"4785487e-71ca-4816-8321-d447b0dce356","timestamp":"2026-02-23T07:25:44.052Z"}
{"parentUuid":"4785487e-71ca-4816-8321-d447b0dce356","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01BNJfMWMG7QBk9YUVenrRx3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FCLibZaGpJVaoiTdJCvenn","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1731,"limit":65},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":89,"cache_read_input_tokens":112734,"output_tokens":325,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":89,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQbua8dfswWdtjxujWrU","type":"assistant","uuid":"81d87db1-fbe9-4c0d-8861-0aa88eb10cfe","timestamp":"2026-02-23T07:25:44.234Z"}
{"parentUuid":"81d87db1-fbe9-4c0d-8861-0aa88eb10cfe","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01FCLibZaGpJVaoiTdJCvenn","toolUseID":"toolu_01FCLibZaGpJVaoiTdJCvenn","timestamp":"2026-02-23T07:25:44.318Z","uuid":"e129cfe3-de6e-4b05-b9db-bc2d26abbd04"}
{"parentUuid":"81d87db1-fbe9-4c0d-8861-0aa88eb10cfe","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FCLibZaGpJVaoiTdJCvenn","type":"tool_result","content":"  1731→        const existing = document.getElementById('gemini-section');\n  1732→        if (existing) existing.remove();\n  1733→\n  1734→        const section = document.createElement('div');\n  1735→        section.id = 'gemini-section';\n  1736→        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n  1737→\n  1738→        const hasKey = !!this.getApiKey();\n  1739→        section.innerHTML = `\n  1740→            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1741→                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n  1742→                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n  1743→            </div>\n  1744→            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n  1745→                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n  1746→                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n  1747→                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n  1748→                </div>\n  1749→                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n  1750→                    ${hasKey ? `\n  1751→                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n  1752→                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n  1753→                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n  1754→                    </div>` : `\n  1755→                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1756→                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n  1757→                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n  1758→                    </div>\n  1759→                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1760→                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n  1761→                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n  1762→                    </div>`}\n  1763→                </div>\n  1764→            </div>`;\n  1765→\n  1766→        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n  1767→            const form = section.querySelector('#gemini-form');\n  1768→            const icon = section.querySelector('#gemini-icon');\n  1769→            const isOpen = form.style.display !== 'none';\n  1770→            form.style.display = isOpen ? 'none' : 'flex';\n  1771→            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1772→        });\n  1773→\n  1774→        this.elements.promptInput = section.querySelector('#prompt-input');\n  1775→        this.elements.generateBtn = section.querySelector('#generate-btn');\n  1776→        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n  1777→        this.elements.promptInput.addEventListener('keypress', (e) => {\n  1778→            if (e.key === 'Enter') this.handleGenerate();\n  1779→        });\n  1780→\n  1781→        if (hasKey) {\n  1782→            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n  1783→        } else {\n  1784→            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n  1785→                const form = section.querySelector('#api-key-form');\n  1786→                const icon = section.querySelector('#api-key-icon');\n  1787→                const isOpen = form.style.display !== 'none';\n  1788→                form.style.display = isOpen ? 'none' : 'flex';\n  1789→                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1790→            });\n  1791→            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n  1792→                const val = section.querySelector('#api-key-input').value.trim();\n  1793→                if (!val) return;\n  1794→                this.saveApiKey(val);\n  1795→                this.renderGeminiSection();\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"451e4444-411b-4ac9-b979-8c0962a215a9","timestamp":"2026-02-23T07:25:44.317Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();","numLines":65,"startLine":1731,"totalLines":2134}},"sourceToolAssistantUUID":"81d87db1-fbe9-4c0d-8861-0aa88eb10cfe"}
{"parentUuid":"451e4444-411b-4ac9-b979-8c0962a215a9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Mvtdbz9Kk1t7jVH2Kmc9Wp","type":"message","role":"assistant","content":[{"type":"text","text":"3点まとめて修正します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2015,"cache_read_input_tokens":112823,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2015},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbv8BTGT7H4Ha9hcPF4","type":"assistant","uuid":"82305a7f-f6c6-4e9c-a704-9f2b628541e9","timestamp":"2026-02-23T07:25:46.480Z"}
{"parentUuid":"82305a7f-f6c6-4e9c-a704-9f2b628541e9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Mvtdbz9Kk1t7jVH2Kmc9Wp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012ZjtK7NMw5z7yH1Cmo6DHx","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;","new_string":"        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\" ${!hasKey ? 'disabled' : ''}>\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n            </div>`;"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2015,"cache_read_input_tokens":112823,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2015},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbv8BTGT7H4Ha9hcPF4","type":"assistant","uuid":"a311e302-c8e0-49ec-910e-a30de470ecec","timestamp":"2026-02-23T07:25:57.071Z"}
{"parentUuid":"a311e302-c8e0-49ec-910e-a30de470ecec","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_012ZjtK7NMw5z7yH1Cmo6DHx","toolUseID":"toolu_012ZjtK7NMw5z7yH1Cmo6DHx","timestamp":"2026-02-23T07:25:57.079Z","uuid":"3338d998-9b51-41a5-b5df-ea1db89aa596"}
{"parentUuid":"a311e302-c8e0-49ec-910e-a30de470ecec","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012ZjtK7NMw5z7yH1Cmo6DHx","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"d1b68761-628b-4fc9-ac37-34dd232d4fea","timestamp":"2026-02-23T07:25:57.078Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;","newString":"        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\" ${!hasKey ? 'disabled' : ''}>\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n            </div>`;","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1739,"oldLines":13,"newStart":1739,"newLines":9,"lines":["         section.innerHTML = `","             <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","                 <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>","-                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s;\">▼</span>","+                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","             </div>","-            <div id=\"gemini-form\" style=\"display:flex; flex-direction:column; gap:6px;\">","-                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">","-                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\">","-                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>","-                </div>","+            <div id=\"gemini-form\" style=\"display:none; flex-direction:column; gap:6px;\">","                 <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">","                     ${hasKey ? `","                     <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">"]},{"oldStart":1761,"oldLines":6,"newStart":1757,"newLines":10,"lines":["                         <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>","                     </div>`}","                 </div>","+                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">","+                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\" ${!hasKey ? 'disabled' : ''}>","+                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>","+                </div>","             </div>`;"," ","         section.querySelector('#gemini-toggle').addEventListener('click', () => {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"a311e302-c8e0-49ec-910e-a30de470ecec"}
{"parentUuid":"d1b68761-628b-4fc9-ac37-34dd232d4fea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01LZVAc2wzoi7oZRmKAmGYhR","type":"message","role":"assistant","content":[{"type":"text","text":"APIキー保存後にプロンプトフィールドが有効になるよう、`renderGeminiSection()` 再呼び出しで自動的に反映されます。`expandApiKeySection()` の gemini-form 展開ロジックも初期状態（`display:none`）に合わせて確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1634,"cache_read_input_tokens":114838,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1634},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbw55wfH2BanxDDcSMj","type":"assistant","uuid":"965566d6-978e-44a1-84e4-84e6e4cf675e","timestamp":"2026-02-23T07:26:02.046Z"}
{"parentUuid":"965566d6-978e-44a1-84e4-84e6e4cf675e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01LZVAc2wzoi7oZRmKAmGYhR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015y3wFHcSqz6tza4MRGJaxY","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1914,"limit":15},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1634,"cache_read_input_tokens":114838,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1634},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbw55wfH2BanxDDcSMj","type":"assistant","uuid":"84f36d42-7df8-4657-a26c-84d7133f0be0","timestamp":"2026-02-23T07:26:02.684Z"}
{"parentUuid":"84f36d42-7df8-4657-a26c-84d7133f0be0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_015y3wFHcSqz6tza4MRGJaxY","toolUseID":"toolu_015y3wFHcSqz6tza4MRGJaxY","timestamp":"2026-02-23T07:26:02.697Z","uuid":"2de47689-0882-49d5-9675-4c3214868efa"}
{"parentUuid":"84f36d42-7df8-4657-a26c-84d7133f0be0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015y3wFHcSqz6tza4MRGJaxY","type":"tool_result","content":"  1914→                copyBtn.textContent = 'Copied!';\n  1915→                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n  1916→            });\n  1917→        });\n  1918→\n  1919→        this.elements.themeControls.appendChild(section);\n  1920→    },\n  1921→\n  1922→    showGenerateError(err) {\n  1923→        let message;\n  1924→        switch (err.message) {\n  1925→            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n  1926→            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n  1927→            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n  1928→            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f70d7e79-fdfa-4e44-a6a6-368d71ef0709","timestamp":"2026-02-23T07:26:02.696Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;","numLines":15,"startLine":1914,"totalLines":2134}},"sourceToolAssistantUUID":"84f36d42-7df8-4657-a26c-84d7133f0be0"}
{"parentUuid":"f70d7e79-fdfa-4e44-a6a6-368d71ef0709","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Fp1i1gzLyBZHrGYnSLuTCV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01M2PpnZsFZYEHeuAZXfkGYC","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1935,"limit":20},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":579,"cache_read_input_tokens":116472,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":579},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbwVCmsv9G65bCMfdcK","type":"assistant","uuid":"91368c90-fa34-482a-b6f5-66097534bc8c","timestamp":"2026-02-23T07:26:06.038Z"}
{"parentUuid":"91368c90-fa34-482a-b6f5-66097534bc8c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01M2PpnZsFZYEHeuAZXfkGYC","toolUseID":"toolu_01M2PpnZsFZYEHeuAZXfkGYC","timestamp":"2026-02-23T07:26:06.049Z","uuid":"5ffe0ad7-9ad2-4cc1-970f-6114bce45e2a"}
{"parentUuid":"91368c90-fa34-482a-b6f5-66097534bc8c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01M2PpnZsFZYEHeuAZXfkGYC","type":"tool_result","content":"  1935→            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n  1936→            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n  1937→        }\n  1938→        errEl.textContent = message;\n  1939→        clearTimeout(this._errorTimeout);\n  1940→        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n  1941→    },\n  1942→\n  1943→    expandApiKeySection() {\n  1944→        const geminiForm = document.getElementById('gemini-form');\n  1945→        const geminiIcon = document.getElementById('gemini-icon');\n  1946→        if (geminiForm && geminiForm.style.display === 'none') {\n  1947→            geminiForm.style.display = 'flex';\n  1948→            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n  1949→        }\n  1950→        const form = document.getElementById('api-key-form');\n  1951→        const icon = document.getElementById('api-key-icon');\n  1952→        if (form && form.style.display === 'none') {\n  1953→            form.style.display = 'flex';\n  1954→            if (icon) icon.style.transform = 'rotate(0deg)';\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"294394bb-3474-472c-a3f4-6f0292b58bf9","timestamp":"2026-02-23T07:26:06.049Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';","numLines":20,"startLine":1935,"totalLines":2134}},"sourceToolAssistantUUID":"91368c90-fa34-482a-b6f5-66097534bc8c"}
{"parentUuid":"294394bb-3474-472c-a3f4-6f0292b58bf9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01ErXfaPoTcnsyT8KbjrW9Z2","type":"message","role":"assistant","content":[{"type":"text","text":"`expandApiKeySection()` はすでに `display:none` チェックをしているので問題ありません。完了です。\n\n---\n\n3点を一度に修正しました：\n\n1. **リロード時に閉じた状態** — `#gemini-form` の初期値を `display:none`、アイコンを `-90deg` に変更\n2. **APIキーなしでプロンプトフィールドを無効化** — `disabled` 属性を `!hasKey` のときに付与（キー保存後に `renderGeminiSection()` が再呼び出しされると自動で有効になる）\n3. **順番の入れ替え** — API Key セクション → プロンプト入力の順に変更"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":573,"cache_read_input_tokens":117051,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":573},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbwjaU473G5sRzoDEm4","type":"assistant","uuid":"fe0eebf9-9065-416d-8016-1d07db357f4e","timestamp":"2026-02-23T07:26:11.653Z"}
{"parentUuid":"fe0eebf9-9065-416d-8016-1d07db357f4e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"dc00b626-6e55-4828-b69d-dc5d7f456b1c","toolUseID":"dc00b626-6e55-4828-b69d-dc5d7f456b1c","timestamp":"2026-02-23T07:26:11.749Z","uuid":"e6e3fb17-620d-4fe5-9d1e-024b3b44d4d8"}
{"parentUuid":"e6e3fb17-620d-4fe5-9d1e-024b3b44d4d8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":174}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T07:26:11.923Z","uuid":"1ffca5de-5eff-41e9-9a27-28961b01fa20","toolUseID":"dc00b626-6e55-4828-b69d-dc5d7f456b1c"}
{"parentUuid":"1ffca5de-5eff-41e9-9a27-28961b01fa20","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":35231,"timestamp":"2026-02-23T07:26:11.925Z","uuid":"57aec3ba-afd0-43ac-8f7d-b174b3e216b4","isMeta":false}
{"type":"file-history-snapshot","messageId":"4a0273cf-aab4-4180-a46f-0305f21e9006","snapshot":{"messageId":"4a0273cf-aab4-4180-a46f-0305f21e9006","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v10","version":10,"backupTime":"2026-02-23T07:26:24.738Z"},"index.html":{"backupFileName":"8bcd8970e5a99eee@v2","version":2,"backupTime":"2026-02-23T07:23:29.999Z"}},"timestamp":"2026-02-23T07:26:24.738Z"},"isSnapshotUpdate":false}
{"parentUuid":"57aec3ba-afd0-43ac-8f7d-b174b3e216b4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コミットして"},"uuid":"4a0273cf-aab4-4180-a46f-0305f21e9006","timestamp":"2026-02-23T07:26:24.610Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"4a0273cf-aab4-4180-a46f-0305f21e9006","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Vba45RWDNUF5JXGh8Yvyyr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HL5Dpkvgkz8TZjCunsNPKn","name":"Bash","input":{"command":"git status && git diff --stat","description":"Show git status and diff stat"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":7,"cache_read_input_tokens":117825,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":7},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQby7oxd7NFceVjTb3MF","type":"assistant","uuid":"0714eefc-c6ff-4914-9050-c44c8f835829","timestamp":"2026-02-23T07:26:28.032Z"}
{"parentUuid":"0714eefc-c6ff-4914-9050-c44c8f835829","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HL5Dpkvgkz8TZjCunsNPKn","type":"tool_result","content":"On branch main\nYour branch is ahead of 'origin/main' by 4 commits.\n  (use \"git push\" to publish your local commits)\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\tmodified:   index.html\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n gardener.js | 94 +++++++++++++++++++++++++++++++++++++++++--------------------\n index.html  |  4 ---\n 2 files changed, 64 insertions(+), 34 deletions(-)","is_error":false}]},"uuid":"e3575bbb-c55d-4e57-9bdf-1edcf9936d89","timestamp":"2026-02-23T07:26:28.230Z","toolUseResult":{"stdout":"On branch main\nYour branch is ahead of 'origin/main' by 4 commits.\n  (use \"git push\" to publish your local commits)\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\tmodified:   index.html\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n gardener.js | 94 +++++++++++++++++++++++++++++++++++++++++--------------------\n index.html  |  4 ---\n 2 files changed, 64 insertions(+), 34 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"0714eefc-c6ff-4914-9050-c44c8f835829"}
{"parentUuid":"e3575bbb-c55d-4e57-9bdf-1edcf9936d89","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_017ABxtmMQuCdWFhHiGZ2j2V","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018baaZ72TCZdfB9u7gFg5mo","name":"Bash","input":{"command":"git add gardener.js index.html && git commit -m \"$(cat <<'EOF'\nrefactor: integrate prompt input into Gemini AI section\n\n- Replace standalone prompt input row in index.html with a unified\n  Gemini AI collapsible section in gardener.js (renderGeminiSection).\n- Section starts collapsed on load; API Key sub-section appears above\n  the prompt input field.\n- Prompt input is disabled when no API key is set; enabled after key\n  is saved (section re-renders via renderGeminiSection).\n- Remove promptInput/generateBtn from preset button click handlers so\n  selecting a theme no longer populates the Gemini text field.\n- Move event binding for prompt/generate out of bindEvents() into\n  renderGeminiSection() so re-renders correctly rebind listeners.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Stage and commit all pending changes"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":270,"cache_read_input_tokens":117832,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":270},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbyMy1HceeD64Mv9nx1","type":"assistant","uuid":"dd6ae8f5-7b36-46cb-9455-6f266a3a47b3","timestamp":"2026-02-23T07:26:35.252Z"}
{"parentUuid":"dd6ae8f5-7b36-46cb-9455-6f266a3a47b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018baaZ72TCZdfB9u7gFg5mo","type":"tool_result","content":"[main 938ee98] refactor: integrate prompt input into Gemini AI section\n 2 files changed, 64 insertions(+), 34 deletions(-)","is_error":false}]},"uuid":"c38e32a2-2f0b-434e-b185-2b4e9badb409","timestamp":"2026-02-23T07:26:36.891Z","toolUseResult":{"stdout":"[main 938ee98] refactor: integrate prompt input into Gemini AI section\n 2 files changed, 64 insertions(+), 34 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"dd6ae8f5-7b36-46cb-9455-6f266a3a47b3"}
{"parentUuid":"c38e32a2-2f0b-434e-b185-2b4e9badb409","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CoTDg1T91MoKzUeYMuxeaD","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました。\n\n```\n938ee98 refactor: integrate prompt input into Gemini AI section\n```\n\n`gardener.js` と `index.html` の2ファイル、64行追加・34行削除です。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":342,"cache_read_input_tokens":118102,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":342},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQbz12CzQsJJxYNBBBxt","type":"assistant","uuid":"3f2f15c6-8c4a-4941-8e03-66feeea2d98e","timestamp":"2026-02-23T07:26:39.412Z"}
{"parentUuid":"3f2f15c6-8c4a-4941-8e03-66feeea2d98e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"89d373ee-bf3a-4bbf-9e5a-aaa29efdfd00","toolUseID":"89d373ee-bf3a-4bbf-9e5a-aaa29efdfd00","timestamp":"2026-02-23T07:26:39.515Z","uuid":"ce6f0fd1-ccb6-4d47-8b32-ea848b495965"}
{"parentUuid":"ce6f0fd1-ccb6-4d47-8b32-ea848b495965","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":2504}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T07:26:42.021Z","uuid":"6c44a740-07c6-4170-aef5-9b7fca5963f4","toolUseID":"89d373ee-bf3a-4bbf-9e5a-aaa29efdfd00"}
{"parentUuid":"6c44a740-07c6-4170-aef5-9b7fca5963f4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"local_command","content":"<command-name>/usage</command-name>\n            <command-message>usage</command-message>\n            <command-args></command-args>","level":"info","timestamp":"2026-02-23T07:27:20.851Z","uuid":"71ba0e25-fe9b-41ec-b1aa-1595eed30778","isMeta":false}
{"parentUuid":"71ba0e25-fe9b-41ec-b1aa-1595eed30778","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"local_command","content":"<local-command-stdout>Status dialog dismissed</local-command-stdout>","level":"info","timestamp":"2026-02-23T07:27:20.851Z","uuid":"0f93c867-7035-431a-bc8c-93013930fdd7","isMeta":false}
{"type":"file-history-snapshot","messageId":"f1d92879-2f12-4faf-862f-69d7417164e5","snapshot":{"messageId":"f1d92879-2f12-4faf-862f-69d7417164e5","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v10","version":10,"backupTime":"2026-02-23T07:26:24.738Z"},"index.html":{"backupFileName":"8bcd8970e5a99eee@v2","version":2,"backupTime":"2026-02-23T07:23:29.999Z"}},"timestamp":"2026-02-23T07:27:48.002Z"},"isSnapshotUpdate":false}
{"parentUuid":"0f93c867-7035-431a-bc8c-93013930fdd7","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コントロールパネルのPaste CSSセクションのApplyボタンを、Gemini  AIセクションのApplyボタンと同じ見た目にして"},"uuid":"f1d92879-2f12-4faf-862f-69d7417164e5","timestamp":"2026-02-23T07:27:47.852Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"f1d92879-2f12-4faf-862f-69d7417164e5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01H1wAhVtgHhBzHPiekikz7X","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants the \"Apply\" button in the Paste CSS section to look the same as the \"Apply\" button in the Gemini AI section. Let me check what styling the Gemini AI Apply button has vs the Paste CSS Apply button.\n\nThe Gemini AI Apply button: `<button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>` - this gets styled by the CSS rule `#theme-controls #generate-btn { background: var(--accent) !important; color: #fff; border: none; ... }`\n\nThe Paste CSS Apply button: `<button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>` - this gets the default `#theme-controls button` styling.\n \nThe Gemini button gets its blue accent styling from a specific CSS rule, so I need to apply that same styling to the Paste CSS button. I could either add a class to both buttons or create a new CSS rule targeting the Paste CSS button ID. The cleanest approach would be to add a shared class or create a matching CSS rule for the Paste CSS button that applies the same accent background, white text, and border styling. The theme overrides target `#generate-btn` specifically with `!important` flags, so inline styles alone won't work across all themes. I need to either add the paste button to every CSS selector across all theme presets, or give both buttons a shared class and update the selectors to target that class instead—the latter being cleaner since it avoids duplicating the selector everywhere. I'm realizing that updating all 14 CSS selector occurrences would be tedious, so instead I'll just apply an inline style directly to the paste button with the accent color and matching styling to keep it consistent with the generate button.\n\nThe tricky part is that when themes change, they override the generate button's background with specific colors, but since I'm using `var(--accent)` in the inline style, it should automatically adapt to theme changes. However, themes that explicitly set colors like `#e95420` won't cascade to the paste button unless I also update those selectors. Let me check what the themes are actually doing with the accent variable...\n\nMost themes just use `var(--accent)` with `!important`, so using that same variable inline would be functionally equivalent. I could either update all the CSS selectors and theme overrides to include the paste button, or just rely on the inline `var(--accent)` style and skip the CSS updates entirely.\n\nActually, a cleaner approach would be to use a shared CSS class for both buttons instead of ID selectors. I'd add a `primary-btn` class to both and update all the CSS selectors accordingly. Since there are about 14 occurrences of `#generate-btn` in the template literals, I can replace them all at once, but I need to be careful because that selector is used in other contexts too.\n\nThe safest move is to keep the IDs for JavaScript queries but add the class for styling, then update the CSS to target `.primary-btn` instead of the ID selectors. I need to also fix the inline style on the paste button since it's currently smaller with `font-size:11px`. My plan is to replace all occurrences of the generate-btn selector to include the paste button as well, then update the paste button's inline style to remove the font-size override and add font-weight to match.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":49,"cache_read_input_tokens":118503,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":49},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc5F1DhgGAks7zrBEDp","type":"assistant","uuid":"b0504c94-3f05-477c-a840-296eabf53644","timestamp":"2026-02-23T07:28:28.438Z"}
{"parentUuid":"b0504c94-3f05-477c-a840-296eabf53644","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01H1wAhVtgHhBzHPiekikz7X","type":"message","role":"assistant","content":[{"type":"text","text":"CSSの定義を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":49,"cache_read_input_tokens":118503,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":49},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc5F1DhgGAks7zrBEDp","type":"assistant","uuid":"36d6688f-ba55-46c5-8e34-cbdd0c4baa33","timestamp":"2026-02-23T07:28:28.458Z"}
{"parentUuid":"36d6688f-ba55-46c5-8e34-cbdd0c4baa33","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01H1wAhVtgHhBzHPiekikz7X","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ujv1sMYWgA5RBcCrepvxHQ","name":"Grep","input":{"pattern":"#theme-controls #generate-btn","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"count"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":49,"cache_read_input_tokens":118503,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":49},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc5F1DhgGAks7zrBEDp","type":"assistant","uuid":"1ca17eb1-d129-450f-9c48-708c1995ccf9","timestamp":"2026-02-23T07:28:28.778Z"}
{"parentUuid":"1ca17eb1-d129-450f-9c48-708c1995ccf9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01Ujv1sMYWgA5RBcCrepvxHQ","toolUseID":"toolu_01Ujv1sMYWgA5RBcCrepvxHQ","timestamp":"2026-02-23T07:28:29.088Z","uuid":"431062cf-9f2e-4c65-8eda-7c1a6166e689"}
{"parentUuid":"1ca17eb1-d129-450f-9c48-708c1995ccf9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ujv1sMYWgA5RBcCrepvxHQ","type":"tool_result","content":"14\n\nFound 0 total occurrences across 0 files."}]},"uuid":"1c07748c-9fd9-4bf5-ad60-ec772b5c0dbb","timestamp":"2026-02-23T07:28:29.087Z","toolUseResult":{"mode":"count","numFiles":0,"filenames":[],"content":"14","numMatches":0},"sourceToolAssistantUUID":"1ca17eb1-d129-450f-9c48-708c1995ccf9"}
{"parentUuid":"1c07748c-9fd9-4bf5-ad60-ec772b5c0dbb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_011JtCrym2TSu5NA4Gehcaw7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012yJoHxM8wJMP6oCEZ9HJpm","name":"Grep","input":{"pattern":"#theme-controls #generate-btn","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","head_limit":3},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2588,"cache_read_input_tokens":118552,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2588},"output_tokens":19,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc8GdYDUMnQKiMhNgYa","type":"assistant","uuid":"e0d41d0f-9ca3-4957-a13c-7f91cfd3e5ae","timestamp":"2026-02-23T07:28:31.660Z"}
{"parentUuid":"e0d41d0f-9ca3-4957-a13c-7f91cfd3e5ae","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_012yJoHxM8wJMP6oCEZ9HJpm","toolUseID":"toolu_012yJoHxM8wJMP6oCEZ9HJpm","timestamp":"2026-02-23T07:28:31.945Z","uuid":"b88a9bff-6a11-4026-a0af-2a66086c6023"}
{"parentUuid":"e0d41d0f-9ca3-4957-a13c-7f91cfd3e5ae","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012yJoHxM8wJMP6oCEZ9HJpm","type":"tool_result","content":"464:    #theme-controls #generate-btn {\n641:    #theme-controls #generate-btn {\n723:        #theme-controls #generate-btn { background: var(--accent) !important; }\n\n[Showing results with pagination = limit: 3, offset: 0]"}]},"uuid":"f621b267-791c-47fa-80f8-16183bc0c8fc","timestamp":"2026-02-23T07:28:31.944Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"464:    #theme-controls #generate-btn {\n641:    #theme-controls #generate-btn {\n723:        #theme-controls #generate-btn { background: var(--accent) !important; }","numLines":3,"appliedLimit":3},"sourceToolAssistantUUID":"e0d41d0f-9ca3-4957-a13c-7f91cfd3e5ae"}
{"parentUuid":"f621b267-791c-47fa-80f8-16183bc0c8fc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01A8b4baYpasgQed91s2MVA9","type":"message","role":"assistant","content":[{"type":"text","text":"14箇所あります。`replace_all` で一括置換し、inline styleも合わせます。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":213,"cache_read_input_tokens":121140,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":213},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc8UpkvZeMLjXPEHRqK","type":"assistant","uuid":"acc83090-fc79-4d04-b418-2c4cb29bb547","timestamp":"2026-02-23T07:28:34.505Z"}
{"parentUuid":"acc83090-fc79-4d04-b418-2c4cb29bb547","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01A8b4baYpasgQed91s2MVA9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019jamt3wSvhGaUSa2gsAFqQ","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","offset":1808,"limit":5},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":213,"cache_read_input_tokens":121140,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":213},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc8UpkvZeMLjXPEHRqK","type":"assistant","uuid":"9f28dcc3-5150-4fc4-8d7f-f60bb8d7c8ce","timestamp":"2026-02-23T07:28:35.288Z"}
{"parentUuid":"9f28dcc3-5150-4fc4-8d7f-f60bb8d7c8ce","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_019jamt3wSvhGaUSa2gsAFqQ","toolUseID":"toolu_019jamt3wSvhGaUSa2gsAFqQ","timestamp":"2026-02-23T07:28:35.384Z","uuid":"30335f64-595c-4855-823b-8541acff2b9b"}
{"parentUuid":"9f28dcc3-5150-4fc4-8d7f-f60bb8d7c8ce","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019jamt3wSvhGaUSa2gsAFqQ","type":"tool_result","content":"  1808→        const existing = document.getElementById('paste-css-section');\n  1809→        if (existing) existing.remove();\n  1810→\n  1811→        const section = document.createElement('div');\n  1812→        section.id = 'paste-css-section';\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"303db3c8-1711-40d0-bd31-5959e3044f1e","timestamp":"2026-02-23T07:28:35.383Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","content":"        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';","numLines":5,"startLine":1808,"totalLines":2134}},"sourceToolAssistantUUID":"9f28dcc3-5150-4fc4-8d7f-f60bb8d7c8ce"}
{"parentUuid":"303db3c8-1711-40d0-bd31-5959e3044f1e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01CtHiisxXKBQWa4uEoe7sF7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AckbjWs7z17TyqTk5eMtez","name":"Grep","input":{"pattern":"paste-css-apply-btn","path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","output_mode":"content","-C":1},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":298,"cache_read_input_tokens":121353,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":298},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc8ja2BbU4jeFFZzCkf","type":"assistant","uuid":"ffffdc7a-1e62-47c6-99c1-4c74ccbad434","timestamp":"2026-02-23T07:28:38.103Z"}
{"parentUuid":"ffffdc7a-1e62-47c6-99c1-4c74ccbad434","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01AckbjWs7z17TyqTk5eMtez","toolUseID":"toolu_01AckbjWs7z17TyqTk5eMtez","timestamp":"2026-02-23T07:28:38.381Z","uuid":"2e56c052-564b-4fc6-a230-31231885f192"}
{"parentUuid":"ffffdc7a-1e62-47c6-99c1-4c74ccbad434","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AckbjWs7z17TyqTk5eMtez","type":"tool_result","content":"1835-                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n1836:                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n1837-                </div>\n--\n1859-\n1860:        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n1861-            const css = textarea.value.trim();"}]},"uuid":"3dcc2a63-0b15-4640-9cee-b64157259717","timestamp":"2026-02-23T07:28:38.380Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1835-                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n1836:                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n1837-                </div>\n--\n1859-\n1860:        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n1861-            const css = textarea.value.trim();","numLines":7},"sourceToolAssistantUUID":"ffffdc7a-1e62-47c6-99c1-4c74ccbad434"}
{"parentUuid":"3dcc2a63-0b15-4640-9cee-b64157259717","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_015JYGjA3rEonzPde9fuBdna","type":"message","role":"assistant","content":[{"type":"text","text":"2つの変更を行います。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":279,"cache_read_input_tokens":121651,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":279},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc8xNDSvji92nXRjeDM","type":"assistant","uuid":"ee15acf5-4109-4e7f-b5df-9bb273025b50","timestamp":"2026-02-23T07:28:40.663Z"}
{"parentUuid":"ee15acf5-4109-4e7f-b5df-9bb273025b50","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_015JYGjA3rEonzPde9fuBdna","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GgQym2Vn72QtDxnjTrqJF8","name":"Edit","input":{"replace_all":true,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"#theme-controls #generate-btn","new_string":"#theme-controls #generate-btn, #theme-controls #paste-css-apply-btn"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":279,"cache_read_input_tokens":121651,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":279},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc8xNDSvji92nXRjeDM","type":"assistant","uuid":"c8c62f0f-53f8-4377-ac52-96335c22ba01","timestamp":"2026-02-23T07:28:41.800Z"}
{"parentUuid":"c8c62f0f-53f8-4377-ac52-96335c22ba01","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01GgQym2Vn72QtDxnjTrqJF8","toolUseID":"toolu_01GgQym2Vn72QtDxnjTrqJF8","timestamp":"2026-02-23T07:28:41.806Z","uuid":"2ee89a85-9b38-4d3a-9f68-84a827286fb4"}
{"parentUuid":"c8c62f0f-53f8-4377-ac52-96335c22ba01","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GgQym2Vn72QtDxnjTrqJF8","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated. All occurrences of '#theme-controls #generate-btn' were successfully replaced with '#theme-controls #generate-btn, #theme-controls #paste-css-apply-btn'."}]},"uuid":"7ee1121c-9892-401f-9d66-6f6e58651ed1","timestamp":"2026-02-23T07:28:41.805Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"#theme-controls #generate-btn","newString":"#theme-controls #generate-btn, #theme-controls #paste-css-apply-btn","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\" ${!hasKey ? 'disabled' : ''}>\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":461,"oldLines":7,"newStart":461,"newLines":7,"lines":["         font-weight: 500;","         transition: 0.2s;","     }","-    #theme-controls #generate-btn {","+    #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn {","         background: var(--accent) !important;","         color: #fff;","         border: none;"]},{"oldStart":638,"oldLines":7,"newStart":638,"newLines":7,"lines":["         border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;","         padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;","     }","-    #theme-controls #generate-btn {","+    #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn {","         background: var(--accent) !important; color: #fff;","         border: none; font-weight: 600; padding: 8px 16px;","     }"]},{"oldStart":720,"oldLines":7,"newStart":720,"newLines":7,"lines":["             color: #000;","         }","         .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }","-        #theme-controls #generate-btn { background: var(--accent) !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; }","     `,"," ","     \"Glitch\": `"]},{"oldStart":765,"oldLines":7,"newStart":765,"newLines":7,"lines":["             padding: 0 10px; width: auto;","         }","         /* Override Common Apply Button for visibility */","-        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }","     `,"," ","     \"Playful\": `"]},{"oldStart":818,"oldLines":7,"newStart":818,"newLines":7,"lines":["             width: 50px; height: 50px; font-weight: 900; opacity: 1;","         }","         /* Force Apply Button Red */","-        #theme-controls #generate-btn { background: var(--red) !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--red) !important; }","     `,"," ","     \"Glow\": `"]},{"oldStart":862,"oldLines":7,"newStart":862,"newLines":7,"lines":["             font-size: 18px;","         }","         .hn-upvote { border-color: rgba(255,255,255,0.2); }","-        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }","     `,"," ","     \"Academic\": `"]},{"oldStart":893,"oldLines":7,"newStart":893,"newLines":7,"lines":["         .hn-story-title { font-size: 28px; font-weight: 500; }","         .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }","         .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }","-        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }","     `,"," ","     \"Search\": `"]},{"oldStart":923,"oldLines":7,"newStart":923,"newLines":7,"lines":["         .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }","         .hn-story-title:hover { text-decoration: underline; }","         .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }","-        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }","     `,"," ","     \"Universal\": `"]},{"oldStart":949,"oldLines":7,"newStart":949,"newLines":7,"lines":["         .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }","         .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }","         .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }","-        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }","     `,"," ","     \"Intelligence\": `"]},{"oldStart":997,"oldLines":7,"newStart":997,"newLines":7,"lines":["         }","         @keyframes blink { 50% { opacity: 0; } }","         .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }","-        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }","     `,"," ","     \"Ghibli\": `"]},{"oldStart":1043,"oldLines":7,"newStart":1043,"newLines":7,"lines":["             border-color: rgba(93, 138, 102, 0.3);","             color: var(--accent);","         }","-        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }","     `,"," ","     \"8-Bit\": `"]},{"oldStart":1093,"oldLines":7,"newStart":1093,"newLines":7,"lines":["             border: 4px solid var(--text);","             text-transform: uppercase;","         }","-        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }","     `,"," ","     \"RaspberryPi\": `"]},{"oldStart":1200,"oldLines":7,"newStart":1200,"newLines":7,"lines":["             background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),","                         radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);","         }","-        #theme-controls #generate-btn { background: #c51a4a !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: #c51a4a !important; color: #fff !important; }","     `,"," ","     \"Ubuntu\": `"]},{"oldStart":1345,"oldLines":7,"newStart":1345,"newLines":7,"lines":["         }"," ","         /* ── Controls ── */","-        #theme-controls #generate-btn { background: #e95420 !important; color: #fff !important; }","+        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: #e95420 !important; color: #fff !important; }","     `"," };"," "]}],"userModified":false,"replaceAll":true},"sourceToolAssistantUUID":"c8c62f0f-53f8-4377-ac52-96335c22ba01"}
{"parentUuid":"7ee1121c-9892-401f-9d66-6f6e58651ed1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01H5xqzfBwv6roDuzEe75Ny8","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NKFpEUVoUFi8udEFK8vAjN","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","old_string":"<button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>","new_string":"<button id=\"paste-css-apply-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":246,"cache_read_input_tokens":121930,"output_tokens":187,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":246,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYQc9DLNez93epWZRCS6e","type":"assistant","uuid":"d0752d43-f54a-4559-b3be-8aae62693720","timestamp":"2026-02-23T07:28:45.071Z"}
{"parentUuid":"d0752d43-f54a-4559-b3be-8aae62693720","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01NKFpEUVoUFi8udEFK8vAjN","toolUseID":"toolu_01NKFpEUVoUFi8udEFK8vAjN","timestamp":"2026-02-23T07:28:45.085Z","uuid":"d5f25af5-a10f-4ec7-88d9-3cc4c2e785d7"}
{"parentUuid":"d0752d43-f54a-4559-b3be-8aae62693720","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NKFpEUVoUFi8udEFK8vAjN","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/GenHN/gardener.js has been updated successfully."}]},"uuid":"16005e69-22bd-433e-a728-8e81ead98d3f","timestamp":"2026-02-23T07:28:45.083Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/GenHN/gardener.js","oldString":"<button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>","newString":"<button id=\"paste-css-apply-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS world-builder for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\nBegin with /* world: NAME */ on the first line.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLD-BUILDING MANDATE\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nYou are not changing colors. You are creating a complete universe.\nEvery world must have ALL FOUR of these dimensions:\n\n  ① LAYOUT      — structure of the story list (grid? columns? magazine?)\n  ② INTERACTION — what happens on hover (not just color: tilt, spring, press, glow, skew...)\n  ③ ATMOSPHERE  — ambient world effect (overlay, animated bg, texture, pattern, body::before)\n  ④ IDENTITY    — header + logo that could only belong to this world\n\nProducing only color + font changes = FAILURE. The layout must shift. Something must animate.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCONTRAST LAW (mandatory)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nDARK bg  → --text:#e0e0e0+  --subtext:#aaa+  --card-bg noticeably lighter\nLIGHT bg → --text:#1a1a1a   --subtext:#666   --card-bg noticeably darker\nWRONG: --bg:#1a1a3e + --text:#2a2a7e  (both dark, unreadable)\nRIGHT: --bg:#1a1a3e + --text:#eeeeff  (dark bg → near-white text)\nButtons: --more-btn-color vs --more-btn-bg = light-on-dark or dark-on-light.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nWORLDS — pick one, apply its complete interaction model\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTERMINAL\n  Layout:  default vertical list, dense gap (--story-gap:8px), 0px radius\n  Hover:   border flashes to accent instantly (transition:border-color 0.05s steps(1))\n  Atm:     body::before scanline · .hn-logo blinks (@keyframes blink) or glows\n  Identity: monospace font · phosphor green/amber/cyan · header= solid dark bar\n\nBRUTALIST\n  Layout:  0px radius · 5-6px solid black borders · hard offset box-shadow (no blur)\n           .hn-story-item:hover { transform:translate(-4px,-4px); box-shadow:<bigger offset>; }\n  Hover:   press-down effect (translate in shadow direction, shadow shrinks)\n  Atm:     body{text-transform:uppercase} · stark flat header, no blur anywhere\n  Identity: Impact/condensed font · max 3 colors · masthead-style header\n\nEDITORIAL\n  Layout:  0px radius · no card borders · 50px+ vertical padding · separator lines only\n           --story-gap:0 · .hn-story-item{border:none;border-bottom:1px solid} · --title-size:28px+\n  Hover:   .hn-story-title slides left (padding-left grows) or accent color only — NO lift\n  Atm:     warm paper bg · fine hairlines · body font-size slightly larger · spacious\n  Identity: Georgia/serif · subdued accent · newspaper masthead header\n\nPLAYFUL\n  Layout:  display:grid, minmax(280-320px,1fr) · 28-40px radius · thick colored borders (5-6px)\n           float rank badge (position:absolute top:-14px) · --upvote-size:50px\n  Hover:   spring physics: cubic-bezier(0.34,1.56,0.64,1) · translateY(-12px) · shadow grows\n  Atm:     bright solid bg · 2-3 vivid colors · colorful header stripe\n  Identity: rounded font · logo pill (border-radius:100px, border, box-shadow:4px 4px 0)\n\nNEON / CYBERPUNK\n  Layout:  list · subtle glow border on cards · 4-8px radius\n  Hover:   glow intensifies (box-shadow expands 2×) + translateY(-6px)\n           @keyframes: continuous ambient pulse on .hn-logo or header\n  Atm:     body radial-gradient from corner · header glows · scanline optional\n  Identity: logo multi-layer text-shadow glow · very dark bg\n\nMAGAZINE / BROADSHEET\n  Layout:  display:grid, grid-template-columns:1fr 1fr · 0px radius\n           .hn-story-item:first-child{grid-column:1/-1; padding:48px; font-size:1.4em}\n           .hn-story-list{gap:2px;background:var(--text)} (gutters = text color)\n  Hover:   first child: title grows (font-size transition) · others: bg darkens\n  Atm:     high contrast · editorial typography · no card shadows\n  Identity: condensed or serif font · header = thick top border only\n\nRETRO GUI\n  Layout:  0px radius · .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\n  Hover:   border reverses (inset simulation) + bg darkens slightly\n  Atm:     body{background:#c0c0c0} · header = solid navy/teal bar · system font\n  Identity: dialog-box feel · .hn-logo in title-bar style\n\nVAPORWAVE\n  Layout:  large radius (16-24px) · glassmorphism cards (rgba + backdrop-filter:blur(12px))\n  Hover:   filter:hue-rotate(20deg) brightness(1.15) + scale(1.02) · dreamy\n  Atm:     body animated gradient (@keyframes hueshift via hue-rotate on ::before)\n           body::before{content:\"\";position:fixed;inset:0;background:linear-gradient(135deg,#ff6ec7,#a855f7,#06b6d4);opacity:0.15;z-index:-1;animation:hueshift 8s linear infinite}\n           @keyframes hueshift{to{filter:hue-rotate(360deg)}}\n  Identity: cursive or display font · pink/purple/teal palette · soft glow header\n\nNATURE / ORGANIC\n  Layout:  asymmetric radius (e.g.0 20px 20px 0) · border-left:3px solid var(--accent)\n           generous gap · no card bg (transparent) · ruled separator\n  Hover:   translateY(-4px) + shadow (gentle, no spring) · border-left thickens to 6px\n  Atm:     body{background:linear-gradient(160deg, <earthy1> 0%, <earthy2> 100%)}\n  Identity: serif or soft sans · muted green/terracotta/sand · organic header\n\nISOMETRIC / 3D\n  Layout:  grid · cards with 3D depth illusion via box-shadow direction\n  Hover:   transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)\n           transition:transform 0.3s ease, box-shadow 0.3s\n  Atm:     strong directional shadow (bottom-right) · flat colors for depth contrast\n  Identity: geometric sans-serif · structured header\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nCSS ARSENAL (mix freely — every theme should use several)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nScanline overlay:  body::before{content:\"\";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,0.07) 0,rgba(0,0,0,0.07) 1px,transparent 1px,transparent 3px)}\nGlow pulse:        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--accent)}50%{box-shadow:0 0 24px var(--accent),0 0 48px var(--accent)}}\nLogo flicker:      @keyframes flicker{0%,94%,96%,100%{opacity:1}95%,97%{opacity:0.3}} .hn-logo{animation:flicker 5s infinite}\nLogo blink cursor: .hn-logo::after{content:\"_\";animation:blink 1s step-end infinite} @keyframes blink{50%{opacity:0}}\nSpring hover:      --item-transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.5s\nPress hover:       .hn-story-item{box-shadow:5px 5px 0 var(--text)} .hn-story-item:hover{box-shadow:2px 2px 0 var(--text);transform:translate(3px,3px)}\n3D tilt:           .hn-story-item:hover{transform:perspective(600px) rotateX(4deg) rotateY(-4deg) translateZ(10px)}\nGrid layout:       .hn-story-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}\nFloat rank:        .hn-story-rank{position:absolute;top:-14px;left:16px;width:auto;padding:2px 12px;border-radius:20px;background:var(--accent);color:#fff;font-weight:900}\nClip path card:    .hn-story-item{clip-path:polygon(0 0,97% 0,100% 12%,100% 100%,3% 100%,0 88%)}\nDiagonal header:   .hn-header{clip-path:polygon(0 0,100% 0,100% 65%,0 100%);height:80px}\nBevel card:        .hn-story-item{border:2px solid #fff;border-right-color:#808080;border-bottom-color:#808080;background:linear-gradient(180deg,#e0e0e0,#c8c8c8)}\nHue hover:         .hn-story-item:hover{filter:hue-rotate(25deg) brightness(1.1)}\nTitle slide:       .hn-story-item:hover .hn-story-title{padding-left:8px;transition:padding-left 0.2s}\nMasthead header:   .hn-header{border-bottom:6px double var(--text);backdrop-filter:none}\nPill header:       .hn-header{margin:12px 20px;border-radius:100px;top:12px;height:50px}\nStripe header:     .hn-header{background:var(--accent);backdrop-filter:none;border-bottom:4px solid var(--text);color:var(--bg)}\nAmbient gradient:  body::before{content:\"\";position:fixed;inset:0;z-index:-1;opacity:0.12;background:radial-gradient(ellipse at 20% 20%,var(--accent),transparent 60%)}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\nTEMPLATE (fill every value; all blocks are required)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --header-height:   /* 50-80px */\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --story-gap:       /* 0-40px */\n    --title-size:      /* 15-32px */\n    --upvote-size:     /* 24-52px */\n    --load-more-radius: /* 0px=square · 100px=pill */\n    --item-transition: /* full transition value — use cubic-bezier for spring */\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n.hn-header { background: ; backdrop-filter: ; border-bottom: ; /* + shape property */ }\n.hn-logo { /* ≥3 properties — make it unmistakable */ }\n.hn-story-item { }\n.hn-story-item:hover { /* must be more than just color — use transform, filter, or animation */ }\n.hn-story-rank { }\n.hn-upvote { }\n/* Required: at least one of body::before, @keyframes+animation, .hn-story-list grid */\n/* Optional: .hn-story-title, .hn-nav-links a, .hn-story-item:first-child, body */\n`;\n\nconst EXTERNAL_AI_PROMPT_TEMPLATE = `You are a CSS world-builder for a Hacker News reader app called GenHN.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\nTheme request: [DESCRIBE YOUR THEME HERE — e.g. \"brutalist newspaper\" or \"cozy dark cafe\"]\n\n━━━ RULES ━━━\nEvery theme must have ALL FOUR dimensions:\n  LAYOUT      — change the story list structure (grid? columns? dense? airy?)\n  INTERACTION — hover effects using transform, animation, or filter (not just color)\n  ATMOSPHERE  — ambient effect via body::before, @keyframes, or background\n  IDENTITY    — a header + logo that could only belong to this world\n\nCONTRAST LAW (mandatory):\n  DARK bg  → --text: light (#e0e0e0+)  --subtext: mid (#aaa+)  --card-bg: noticeably lighter\n  LIGHT bg → --text: dark (#1a1a1a)    --subtext: mid (#666)   --card-bg: noticeably darker\n\n━━━ CSS VARIABLES (:root) ━━━\n--bg              page background\n--card-bg         story card background\n--text            main text color\n--subtext         metadata / secondary text\n--accent          links & interactive elements\n--header-bg       nav header background\n--header-border   header bottom border (e.g. \"1px solid #ccc\")\n--header-height   nav height in px (50–80px)\n--font-main       main typeface\n--item-radius     card corner radius\n--item-border     card border (e.g. \"1px solid rgba(0,0,0,0.08)\")\n--item-shadow     card box-shadow\n--item-transition full transition value (use cubic-bezier for spring physics)\n--story-gap       gap between cards (0–40px)\n--title-size      story title font-size (15–32px)\n--upvote-size     upvote button size (24–52px)\n--load-more-radius \"More\" button border-radius (0=square, 100px=pill)\n--more-btn-bg     \"More\" button background\n--more-btn-color  \"More\" button text color\n--mobile-upvote-bg     mobile upvote background\n--mobile-upvote-color  mobile upvote text color\n\n━━━ KEY CLASSES ━━━\n.hn-header            sticky top nav bar\n.hn-logo              the \"Y\" site logo\n.hn-story-list        <ol> containing all cards\n.hn-story-item        individual story card\n.hn-story-item:hover  card hover state\n.hn-story-rank        rank number (1. 2. 3.)\n.hn-story-title       headline link\n.hn-story-meta        points / author / time row\n.hn-upvote            upvote triangle button\nbody::before          use for overlays / atmospheric effects`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n\n        /* Theme-controllable layout */\n        --story-gap: 16px;\n        --title-size: 18px;\n        --upvote-size: 32px;\n        --item-transition: transform 0.2s, box-shadow 0.2s;\n        --header-height: 60px;\n        --load-more-radius: 100px;\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: var(--header-height);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: var(--story-gap);\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: var(--item-transition);\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: var(--title-size);\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: var(--upvote-size);\n        height: var(--upvote-size);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: var(--load-more-radius);\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0 !important; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Panel-only CSS — applied when the \"None\" theme is active.\n * Contains just the control panel styles + the minimal :root variables\n * they depend on, so the panel renders correctly with no other CSS loaded.\n */\nconst PANEL_STYLE = `\n    :root {\n        --bg: #ffffff; --text: #333333; --subtext: #888888;\n        --accent: #007aff; --card-bg: #ffffff;\n    }\n    * { box-sizing: border-box; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls {\n        view-transition-name: theme-ui;\n        position: fixed;\n        bottom: 20px; right: 20px;\n        z-index: 10000; padding: 15px; border-radius: 12px;\n        display: flex; flex-direction: column; gap: 12px;\n        align-items: flex-start; max-width: 350px;\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg); color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px; border-radius: 6px; outline: none; flex: 1; opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05); color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1); border-radius: 6px;\n        padding: 6px 12px; font-size: 12px; font-weight: 500; transition: 0.2s;\n    }\n    #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn {\n        background: var(--accent) !important; color: #fff;\n        border: none; font-weight: 600; padding: 8px 16px;\n    }\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2,0.8,0.2,1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%; background: transparent; cursor: ew-resize; z-index: 20;\n        }\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%); transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        #theme-controls { padding-left: 20px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.2,1); }\n        #theme-controls.is-minimized { transform: translateX(calc(100% - 20px)); }\n        #theme-controls.is-minimized > *:not(#panel-handle) { opacity: 0 !important; pointer-events: none; transition: opacity 0.2s; }\n    }\n    @media (max-width: 768px) {\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px); padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"None\": \"\",\n\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `,\n\n    \"RaspberryPi\": `\n        /* world: TERMINAL — Raspberry Pi official palette: #c51a4a (red) × #2d9e6b (PCB green) */\n        :root {\n            --bg: #0a0a0a;\n            --card-bg: #111318;\n            --text: #e2e8f0;\n            --subtext: #94a3b8;\n            --accent: #c51a4a;\n            --header-bg: #0a0a0a;\n            --header-border: 2px solid #c51a4a;\n            --header-height: 54px;\n            --font-main: 'Courier New', Courier, monospace;\n            --item-radius: 0px;\n            --item-border: 1px solid rgba(197,26,74,0.2);\n            --item-shadow: none;\n            --story-gap: 4px;\n            --title-size: 15px;\n            --upvote-size: 30px;\n            --load-more-radius: 0px;\n            --item-transition: border-color 0.05s steps(1), background 0.1s;\n            --more-btn-bg: #c51a4a;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #c51a4a;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Header ── */\n        .hn-header {\n            background: #0a0a0a;\n            backdrop-filter: none;\n            border-bottom: 2px solid #c51a4a;\n            box-shadow: 0 0 20px rgba(197,26,74,0.3);\n        }\n        .hn-logo {\n            color: #c51a4a;\n            font-size: 20px;\n            letter-spacing: 0.2em;\n            text-transform: uppercase;\n            text-shadow: 0 0 8px #c51a4a, 0 0 24px rgba(197,26,74,0.5);\n        }\n        .hn-logo::after {\n            content: '_';\n            animation: rpi-blink 1s step-end infinite;\n            color: #c51a4a;\n        }\n        @keyframes rpi-blink { 50% { opacity: 0; } }\n\n        .hn-nav-links a { font-size: 12px; letter-spacing: 0.05em; }\n        .hn-nav-links a:hover { color: #2d9e6b; opacity: 1; }\n\n        /* ── Story items ── */\n        .hn-story-item {\n            border-left: 3px solid #c51a4a;\n            border-top: none;\n            border-right: none;\n            border-bottom: 1px solid rgba(197,26,74,0.15);\n            background: #111318;\n        }\n        .hn-story-item:hover {\n            background: #180e14;\n            border-left: 3px solid #ff2060;\n            border-bottom-color: rgba(197,26,74,0.35);\n            box-shadow: -4px 0 16px rgba(197,26,74,0.4), inset 0 0 40px rgba(197,26,74,0.04);\n        }\n        .hn-story-rank { color: rgba(197,26,74,0.7); font-weight: 600; }\n\n        /* ── Upvote: PCB green ── */\n        .hn-upvote {\n            border-radius: 0;\n            border: 1px solid #2d9e6b;\n            color: #2d9e6b;\n            background: rgba(45,158,107,0.08);\n            opacity: 1;\n        }\n        .hn-upvote:hover {\n            background: rgba(45,158,107,0.2);\n            border-color: #3dce8b;\n            color: #3dce8b;\n            opacity: 1;\n        }\n\n        /* ── Atmosphere: scanline + ambient glow ── */\n        body { letter-spacing: 0.02em; }\n        body::before {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: 9999;\n            background: repeating-linear-gradient(\n                0deg,\n                rgba(0,0,0,0.06) 0, rgba(0,0,0,0.06) 1px,\n                transparent 1px, transparent 3px\n            );\n        }\n        body::after {\n            content: \"\";\n            position: fixed;\n            inset: 0;\n            pointer-events: none;\n            z-index: -1;\n            background: radial-gradient(ellipse at 10% 90%, rgba(197,26,74,0.08) 0%, transparent 55%),\n                        radial-gradient(ellipse at 90% 10%, rgba(45,158,107,0.06) 0%, transparent 50%);\n        }\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: #c51a4a !important; color: #fff !important; }\n    `,\n\n    \"Ubuntu\": `\n        /* world: UNITY DESKTOP — Aubergine × Ubuntu Orange (E95420) */\n        :root {\n            --bg: #2c001e;\n            --card-bg: #3b0028;\n            --text: #f7f7f7;\n            --subtext: #aea79f;\n            --accent: #e95420;\n            --header-bg: #300a24;\n            --header-border: 3px solid #e95420;\n            --header-height: 52px;\n            --font-main: system-ui, 'Segoe UI', sans-serif;\n            --item-radius: 18px;\n            --item-border: 1px solid rgba(233,84,32,0.18);\n            --item-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            --story-gap: 22px;\n            --title-size: 16px;\n            --upvote-size: 38px;\n            --load-more-radius: 100px;\n            --item-transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s ease, border-color 0.3s;\n            --more-btn-bg: #e95420;\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: #e95420;\n            --mobile-upvote-color: #fff;\n        }\n\n        /* ── Atmosphere: aubergine with orange warmth ── */\n        body {\n            background:\n                radial-gradient(ellipse 55% 35% at 12% 3%, rgba(233,84,32,0.14) 0%, transparent 60%),\n                radial-gradient(ellipse 45% 55% at 88% 97%, rgba(77,0,52,0.7) 0%, transparent 55%),\n                var(--bg);\n        }\n\n        /* ── Header: Unity panel style ── */\n        .hn-header {\n            background: linear-gradient(180deg, #3e1028 0%, #300a24 100%);\n            backdrop-filter: none;\n            border-bottom: 3px solid #e95420;\n            box-shadow: 0 3px 28px rgba(233,84,32,0.28);\n        }\n\n        /* ── Logo: orange circle mark ── */\n        .hn-logo {\n            background: #e95420;\n            color: #fff;\n            border-radius: 50%;\n            width: 34px;\n            height: 34px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 900;\n            font-size: 17px;\n            box-shadow: 0 0 0 2px rgba(233,84,32,0.35), 0 2px 14px rgba(233,84,32,0.5);\n            transition: box-shadow 0.35s cubic-bezier(0.34,1.56,0.64,1), transform 0.35s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-logo:hover {\n            transform: scale(1.15);\n            box-shadow: 0 0 0 5px rgba(233,84,32,0.38), 0 0 32px rgba(233,84,32,0.65);\n        }\n\n        .hn-nav-links a:hover, .hn-auth a:hover { color: #e95420; opacity: 1; }\n\n        /* ── Story grid ── */\n        .hn-story-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));\n            gap: var(--story-gap);\n        }\n\n        /* ── Cards: dark notification panels ── */\n        .hn-story-item {\n            background: linear-gradient(145deg, #3e0a2c 0%, #2e001f 100%);\n            border: 1px solid rgba(233,84,32,0.18);\n            border-radius: 18px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.04);\n            padding: 22px 18px 18px 20px;\n            position: relative;\n            overflow: visible;\n        }\n        /* Top-edge spotlight line */\n        .hn-story-item::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 14px; right: 14px;\n            height: 2px;\n            background: linear-gradient(90deg, transparent, #e95420, transparent);\n            border-radius: 2px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n        .hn-story-item:hover {\n            transform: translateY(-9px) scale(1.015);\n            border-color: rgba(233,84,32,0.55);\n            box-shadow: 0 22px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(233,84,32,0.3), inset 0 1px 0 rgba(255,255,255,0.07);\n        }\n        .hn-story-item:hover::before { opacity: 1; }\n\n        /* ── Rank: floating orange pill ── */\n        .hn-story-rank {\n            position: absolute;\n            top: -13px;\n            left: 14px;\n            background: #e95420;\n            color: #fff;\n            font-weight: 700;\n            font-size: 12px;\n            padding: 3px 11px;\n            border-radius: 100px;\n            box-shadow: 0 3px 12px rgba(233,84,32,0.55);\n            width: auto;\n        }\n\n        /* ── Upvote: orange circle with spring pop ── */\n        .hn-upvote {\n            background: transparent;\n            border: 2px solid rgba(233,84,32,0.45);\n            border-radius: 50%;\n            color: #e95420;\n            width: 38px;\n            height: 38px;\n            opacity: 1;\n            font-size: 14px;\n            transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);\n        }\n        .hn-upvote:hover {\n            background: #e95420;\n            color: #fff;\n            border-color: #e95420;\n            transform: scale(1.25);\n            box-shadow: 0 0 20px rgba(233,84,32,0.6);\n            opacity: 1;\n        }\n\n        /* ── Footer ── */\n        .hn-footer {\n            background: #1c0013;\n            border-top: 2px solid rgba(233,84,32,0.18);\n        }\n\n        /* ── Controls ── */\n        #theme-controls #generate-btn, #theme-controls #paste-css-apply-btn { background: #e95420 !important; color: #fff !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: null,\n        generateBtn: null,\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderGeminiSection();\n        this.renderPasteCssSection();\n        this.renderPromptTemplateSection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('genhn-theme');\n        const savedCustom = localStorage.getItem('genhn-custom-css');\n        const savedPrompt = localStorage.getItem('genhn-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('genhn-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('genhn-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('genhn-gemini-key');\n        this.renderGeminiSection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1800 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        const css = this.extractCss(rawText);\n        console.log('Generated CSS:\\n', css);\n        return css;\n    },\n\n    renderGeminiSection() {\n        const existing = document.getElementById('gemini-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'gemini-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        const hasKey = !!this.getApiKey();\n        section.innerHTML = `\n            <div id=\"gemini-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI</span>\n                <span id=\"gemini-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"gemini-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <div id=\"api-key-section\" style=\"display:flex; flex-direction:column; gap:6px;\">\n                    ${hasKey ? `\n                    <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                        <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                    </div>` : `\n                    <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                        <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">API Key</span>\n                        <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                    </div>\n                    <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                        <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                        <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                    </div>`}\n                </div>\n                <div style=\"display:flex; gap:10px; align-items:center; width:100%;\">\n                    <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"min-width:0;\" ${!hasKey ? 'disabled' : ''}>\n                    <button id=\"generate-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#gemini-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#gemini-form');\n            const icon = section.querySelector('#gemini-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        this.elements.promptInput = section.querySelector('#prompt-input');\n        this.elements.generateBtn = section.querySelector('#generate-btn');\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n\n        if (hasKey) {\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderGeminiSection();\n            });\n        }\n\n        const pasteCss = document.getElementById('paste-css-section');\n        if (pasteCss) {\n            this.elements.themeControls.insertBefore(section, pasteCss);\n        } else {\n            this.elements.themeControls.appendChild(section);\n        }\n    },\n\n    renderPasteCssSection() {\n        const existing = document.getElementById('paste-css-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'paste-css-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"paste-css-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Paste CSS</span>\n                <span id=\"paste-css-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"paste-css-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <textarea id=\"paste-css-input\" placeholder=\":root {\n  --bg: #f5f5f7;        /* page background   */\n  --card-bg: #ffffff;   /* story card        */\n  --text: #1d1d1f;      /* main text         */\n  --subtext: #86868b;   /* metadata / nav    */\n  --accent: #0066cc;    /* links & buttons   */\n  --header-bg: rgba(255,255,255,0.8);\n  --font-main: sans-serif;\n}\n\n/* optional: component overrides */\n.hn-story-item { border-radius: 16px; }\n.hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>\n                <div style=\"display:flex; gap:6px; align-items:center;\">\n                    <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">\n                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>\n                </div>\n                <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">\n                    <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>\n                </div>\n            </div>`;\n\n        section.querySelector('#paste-css-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#paste-css-form');\n            const icon = section.querySelector('#paste-css-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#paste-css-input');\n        const saveRow = section.querySelector('#paste-css-save-row');\n        const saveBtn = section.querySelector('#paste-css-save-btn');\n\n        textarea.addEventListener('input', () => {\n            saveRow.style.display = 'none';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        section.querySelector('#paste-css-apply-btn').addEventListener('click', () => {\n            const css = textarea.value.trim();\n            if (!css) return;\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            this.applyStyle(css, null, name);\n            saveRow.style.display = 'flex';\n            saveBtn.textContent = 'Save as Preset';\n        });\n\n        saveBtn.addEventListener('click', () => {\n            const css = textarea.value.trim();\n            const name = section.querySelector('#paste-css-name').value.trim() || 'Custom CSS';\n            const saved = this.saveThemeAs(css, name);\n            saveBtn.textContent = saved ? 'Saved!' : 'Already saved';\n            setTimeout(() => { saveBtn.textContent = 'Save as Preset'; }, 2000);\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    renderPromptTemplateSection() {\n        const existing = document.getElementById('prompt-template-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'prompt-template-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        section.innerHTML = `\n            <div id=\"prompt-template-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">AI Prompt Template</span>\n                <span id=\"prompt-template-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"prompt-template-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <p style=\"font-size:10px; opacity:0.55; margin:0; line-height:1.5;\">Copy this prompt, paste it into ChatGPT / Claude / Gemini, and replace the bracketed line with your theme idea. Then paste the resulting CSS into the <strong>Paste CSS</strong> section above.</p>\n                <textarea id=\"prompt-template-text\" readonly style=\"font-size:10px; min-width:0; width:100%; height:180px; resize:vertical; font-family:monospace; box-sizing:border-box; opacity:0.75;\"></textarea>\n                <button id=\"prompt-template-copy-btn\" style=\"font-size:11px; align-self:flex-end;\">Copy Prompt</button>\n            </div>`;\n\n        section.querySelector('#prompt-template-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#prompt-template-form');\n            const icon = section.querySelector('#prompt-template-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n\n        const textarea = section.querySelector('#prompt-template-text');\n        textarea.value = EXTERNAL_AI_PROMPT_TEMPLATE;\n\n        const copyBtn = section.querySelector('#prompt-template-copy-btn');\n        copyBtn.addEventListener('click', () => {\n            navigator.clipboard.writeText(EXTERNAL_AI_PROMPT_TEMPLATE).then(() => {\n                const original = copyBtn.textContent;\n                copyBtn.textContent = 'Copied!';\n                setTimeout(() => { copyBtn.textContent = original; }, 2000);\n            });\n        });\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const geminiForm = document.getElementById('gemini-form');\n        const geminiIcon = document.getElementById('gemini-icon');\n        if (geminiForm && geminiForm.style.display === 'none') {\n            geminiForm.style.display = 'flex';\n            if (geminiIcon) geminiIcon.style.transform = 'rotate(0deg)';\n        }\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('genhn-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('genhn-custom-css');\n        const prompt = localStorage.getItem('genhn-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    saveThemeAs(css, name) {\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return false;\n\n        let finalName = name;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(finalName)) { finalName = `${name} ${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name: finalName, css, prompt: name });\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        return true;\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('genhn-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('genhn-theme', themeName);\n            localStorage.removeItem('genhn-custom-css');\n            localStorage.removeItem('genhn-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('genhn-custom-css', css);\n            localStorage.setItem('genhn-custom-prompt', customPrompt);\n            localStorage.removeItem('genhn-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = css === \"\" ? PANEL_STYLE : SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1833,"oldLines":7,"newStart":1833,"newLines":7,"lines":[" .hn-header { backdrop-filter: blur(20px); }\" style=\"font-size:11px; min-width:0; width:100%; height:160px; resize:vertical; font-family:monospace; box-sizing:border-box;\"></textarea>","                 <div style=\"display:flex; gap:6px; align-items:center;\">","                     <input type=\"text\" id=\"paste-css-name\" placeholder=\"Theme name (optional)\" style=\"font-size:11px; min-width:0; flex:1;\">","-                    <button id=\"paste-css-apply-btn\" style=\"font-size:11px; white-space:nowrap;\">Apply</button>","+                    <button id=\"paste-css-apply-btn\" style=\"white-space:nowrap; font-weight:600;\">Apply</button>","                 </div>","                 <div id=\"paste-css-save-row\" style=\"display:none; justify-content:flex-end;\">","                     <button id=\"paste-css-save-btn\" style=\"font-size:11px;\">Save as Preset</button>"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"d0752d43-f54a-4559-b3be-8aae62693720"}
{"parentUuid":"16005e69-22bd-433e-a728-8e81ead98d3f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01XYVtV71uZ3go8oYzGhynFz","type":"message","role":"assistant","content":[{"type":"text","text":"完了です。CSSセレクターを全14箇所 `replace_all` で一括更新したので、テーマごとのアクセントカラー上書きも含めて Paste CSS の Apply ボタンに正しく反映されます。inline style も `font-size:11px` を除いて `font-weight:600` を追加し、Gemini AI の Apply と揃えました。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":226,"cache_read_input_tokens":122176,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":226},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQc9T2t9bPQv9QEbnyAc","type":"assistant","uuid":"cec8bcf9-b004-41d8-a995-c45bc42067c6","timestamp":"2026-02-23T07:28:49.468Z"}
{"parentUuid":"cec8bcf9-b004-41d8-a995-c45bc42067c6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"4fa99c2f-eb3e-41ec-8428-76d19c5f2928","toolUseID":"4fa99c2f-eb3e-41ec-8428-76d19c5f2928","timestamp":"2026-02-23T07:28:49.565Z","uuid":"903638db-bb66-4254-a32f-ad1f31b83978"}
{"parentUuid":"903638db-bb66-4254-a32f-ad1f31b83978","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":199}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-23T07:28:49.765Z","uuid":"79872ed2-f4c2-4c1c-89a4-785d075d335b","toolUseID":"4fa99c2f-eb3e-41ec-8428-76d19c5f2928"}
{"parentUuid":"79872ed2-f4c2-4c1c-89a4-785d075d335b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"system","subtype":"turn_duration","durationMs":61765,"timestamp":"2026-02-23T07:28:49.768Z","uuid":"634def28-323d-4bb2-8e42-437953324f87","isMeta":false}
{"type":"file-history-snapshot","messageId":"3924406f-2cb2-4dcf-b3e2-68ef9bcda3f4","snapshot":{"messageId":"3924406f-2cb2-4dcf-b3e2-68ef9bcda3f4","trackedFileBackups":{"README.md":{"backupFileName":"e69a6f3b0cffece2@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"README-ja.md":{"backupFileName":"7822d6fdce336c38@v2","version":2,"backupTime":"2026-02-23T06:21:02.066Z"},"gardener.js":{"backupFileName":"40f3125b2264d826@v11","version":11,"backupTime":"2026-02-23T07:29:17.618Z"},"index.html":{"backupFileName":"8bcd8970e5a99eee@v2","version":2,"backupTime":"2026-02-23T07:23:29.999Z"}},"timestamp":"2026-02-23T07:29:17.617Z"},"isSnapshotUpdate":false}
{"parentUuid":"634def28-323d-4bb2-8e42-437953324f87","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","type":"user","message":{"role":"user","content":"コミット"},"uuid":"3924406f-2cb2-4dcf-b3e2-68ef9bcda3f4","timestamp":"2026-02-23T07:29:17.496Z","todos":[],"permissionMode":"acceptEdits"}
{"parentUuid":"3924406f-2cb2-4dcf-b3e2-68ef9bcda3f4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/GenHN","sessionId":"93f41555-98a8-41ed-8ad7-ce937df9adf9","version":"2.1.50","gitBranch":"main","slug":"velvet-fluttering-lollipop","message":{"model":"claude-sonnet-4-6","id":"msg_01Pr2pgStJqRR5MJppTN4RSn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NYqj3dF5fu6spK5qr68jJM","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nstyle: match Paste CSS Apply button appearance to Gemini AI Apply button\n\nExtend all #generate-btn CSS rules (14 occurrences) to also target\n#paste-css-apply-btn, so both buttons share the same accent color and\ntheme-specific overrides. Update inline style on paste-css-apply-btn\nto remove font-size:11px and add font-weight:600.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Stage and commit button style changes"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":6,"cache_read_input_tokens":122510,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYQcBrZYb7BeobyWXMmiM","type":"assistant","uuid":"b3aeb51a-b63f-4e7a-be83-b5486c46f571","timestamp":"2026-02-23T07:29:24.399Z"}

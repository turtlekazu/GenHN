{"type":"file-history-snapshot","messageId":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","snapshot":{"messageId":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","trackedFileBackups":{},"timestamp":"2026-02-22T14:34:21.205Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:clear","command":"entire hooks claude-code session-start"},"parentToolUseID":"6fc46677-fe40-48c5-a17d-0e2082ae1d07","toolUseID":"6fc46677-fe40-48c5-a17d-0e2082ae1d07","timestamp":"2026-02-22T14:34:21.007Z","uuid":"224a8b7b-57b0-4538-9571-0e56ba15a0d8"}
{"parentUuid":"224a8b7b-57b0-4538-9571-0e56ba15a0d8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"Implement the following plan:\n\n# AI Theme Generation — Implementation Plan\n\n## Context\n\n現在の `handleGenerate()` はプリセット名の部分一致のみで、AI生成は未実装。\n自由記述のプロンプト（例: \"brutalist newspaper with orange ink\"）をGemini APIに送り、\nCSSを動的生成してページに反映させる機能を追加する。\n\n**選択API:** Google Gemini 2.0 Flash（無料枠: 1,500 req/日, 15 req/分）\n**アーキテクチャ:** ブラウザ完結。サーバー追加なし。APIキーはlocalStorage保存。\n**index.html 変更なし。gardener.js のみ修正。**\n\n---\n\n## 変更ファイル\n\n- `/Users/turtlekazu/ReactProjects/acephale/gardener.js` — 唯一の変更対象\n\n---\n\n## localStorage キー一覧\n\n| キー | 用途 |\n|------|------|\n| `acephale-theme` | 既存: プリセット名 |\n| `acephale-custom-css` | 新規: AI生成CSSの全文 |\n| `acephale-custom-prompt` | 新規: AI生成時のプロンプト文字列 |\n| `acephale-gemini-key` | 新規: ユーザーのGemini APIキー |\n\n---\n\n## 実装手順（この順で実装すること）\n\n### Step 1: モジュールレベルの定数を追加\n\n`BASE_URL` の直後に追加:\n\n```javascript\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n```\n\n---\n\n### Step 2: App オブジェクトに新メソッドを追加\n\n#### APIキー管理（3メソッド）\n\n```javascript\ngetApiKey() {\n    return localStorage.getItem('acephale-gemini-key');\n},\nsaveApiKey(key) {\n    localStorage.setItem('acephale-gemini-key', key.trim());\n},\nclearApiKey() {\n    localStorage.removeItem('acephale-gemini-key');\n    this.renderApiKeySection();\n},\n```\n\n#### CSS抽出（Geminiがmarkdown fence で返した場合に除去）\n\n```javascript\nextractCss(text) {\n    let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n    cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n    return cleaned.trim();\n},\n```\n\n#### Gemini API呼び出し\n\n```javascript\nasync generateTheme(prompt) {\n    const key = this.getApiKey();\n    if (!key) throw new Error('NO_API_KEY');\n\n    const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n    const body = {\n        system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n        contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n        generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n    };\n\n    const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n        const status = response.status;\n        if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n        if (status === 429) throw new Error('RATE_LIMIT');\n        throw new Error(`API_ERROR:${status}`);\n    }\n\n    const data = await response.json();\n    const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n    if (!rawText) throw new Error('EMPTY_RESPONSE');\n    return this.extractCss(rawText);\n},\n```\n\n#### APIキー設定UI のレンダリング\n\n`init()` から呼ばれる。`clearApiKey()` 後の再描画にも使う。\n`#theme-controls` の末尾に `#api-key-section` として追加する。\nキーが保存済みかどうかで2状態を描画する:\n\n- **State A（キーなし）**: \"GEMINI API KEY ▼\" トグル + password input + Save ボタン（デフォルト折りたたみ）\n- **State B（キーあり）**: \"GEMINI AI: ENABLED\" + \"clear\" ボタン\n\n完全な実装:\n\n```javascript\nrenderApiKeySection() {\n    const existing = document.getElementById('api-key-section');\n    if (existing) existing.remove();\n\n    const section = document.createElement('div');\n    section.id = 'api-key-section';\n    section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n    if (this.getApiKey()) {\n        // State B\n        section.innerHTML = `\n            <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n            </div>`;\n        section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n    } else {\n        // State A\n        section.innerHTML = `\n            <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n            </div>`;\n        section.querySelector('#api-key-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#api-key-form');\n            const icon = section.querySelector('#api-key-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n        section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n            const val = section.querySelector('#api-key-input').value.trim();\n            if (!val) return;\n            this.saveApiKey(val);\n            this.renderApiKeySection();\n        });\n    }\n\n    this.elements.themeControls.appendChild(section);\n},\n```\n\n#### エラー表示（alert廃止 → インライン表示）\n\n```javascript\nshowGenerateError(err) {\n    let message;\n    switch (err.message) {\n        case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n        case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n        case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n        case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n        default:              message = `Generation failed: ${err.message}`;\n    }\n    let errEl = document.getElementById('generate-error');\n    if (!errEl) {\n        errEl = document.createElement('div');\n        errEl.id = 'generate-error';\n        errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n    }\n    errEl.textContent = message;\n    clearTimeout(this._errorTimeout);\n    this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n},\n```\n\n#### APIキーセクションを展開するヘルパー\n\n```javascript\nexpandApiKeySection() {\n    const form = document.getElementById('api-key-form');\n    const icon = document.getElementById('api-key-icon');\n    if (form && form.style.display === 'none') {\n        form.style.display = 'flex';\n        if (icon) icon.style.transform = 'rotate(0deg)';\n    }\n    this.elements.themeControls.classList.remove('is-minimized');\n    const input = document.getElementById('api-key-input');\n    if (input) setTimeout(() => input.focus(), 300);\n},\n```\n\n---\n\n### Step 3: `handleGenerate()` を async に更新\n\n既存の同期版と置き換える。同時リクエスト防止のガードも追加:\n\n```javascript\nasync handleGenerate() {\n    const input = this.elements.promptInput.value.trim();\n    if (!input) return;\n    if (this._isGenerating) return;  // 連打防止\n\n    // プリセット一致チェック（既存動作を維持）\n    const presetCss = this.matchStyle(input);\n    if (presetCss) {\n        this.applyStyle(presetCss, input);\n        this.togglePresets(true);\n        return;\n    }\n\n    // キーなし → 入力欄を展開\n    if (!this.getApiKey()) {\n        this.expandApiKeySection();\n        return;\n    }\n\n    // AI生成\n    this._isGenerating = true;\n    const btn = this.elements.generateBtn;\n    const originalText = btn.textContent;\n    btn.textContent = 'Generating...';\n    btn.disabled = true;\n\n    try {\n        const css = await this.generateTheme(input);\n        this.applyStyle(css, null, input);\n        this.togglePresets(true);\n    } catch (err) {\n        this.showGenerateError(err);\n    } finally {\n        btn.textContent = originalText;\n        btn.disabled = false;\n        this._isGenerating = false;\n    }\n},\n```\n\n---\n\n### Step 4: `applyStyle()` のシグネチャと永続化ロジックを更新\n\n`applyStyle(css, themeName, customPrompt = null)` に変更:\n\n```javascript\napplyStyle(css, themeName, customPrompt = null) {\n    this.toggleMenu(false);\n\n    if (themeName && STYLE_PRESETS[themeName]) {\n        // プリセット\n        localStorage.setItem('acephale-theme', themeName);\n        localStorage.removeItem('acephale-custom-css');\n        localStorage.removeItem('acephale-custom-prompt');\n    } else if (customPrompt) {\n        // AI生成テーマ\n        localStorage.setItem('acephale-custom-css', css);\n        localStorage.setItem('acephale-custom-prompt', customPrompt);\n        localStorage.removeItem('acephale-theme');\n    }\n\n    const applyFn = () => {\n        this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n    };\n\n    if (!document.startViewTransition) { applyFn(); return; }\n    document.startViewTransition(applyFn);\n},\n```\n\n---\n\n### Step 5: `init()` を更新\n\n`renderApiKeySection()` 呼び出しの追加と、AI生成テーマの復元ロジックを追加:\n\n```javascript\nasync init() {\n    this.renderPresetButtons();\n    this.renderApiKeySection();   // 追加\n    this.bindEvents();\n\n    const savedPreset  = localStorage.getItem('acephale-theme');\n    const savedCustom  = localStorage.getItem('acephale-custom-css');\n    const savedPrompt  = localStorage.getItem('acephale-custom-prompt');\n\n    if (savedCustom) {\n        this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n        if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n    } else {\n        const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n    }\n\n    await this.loadInitial();\n},\n```\n\n---\n\n## UIレイアウト（#theme-controls 最終形）\n\n```\n┌─────────────────────────────────────────┐\n│  [drag handle]                          │\n│  PRESETS ▼                              │\n│  [Mini] [Glitch] [Playful] ...          │\n│  [Enter theme.................] [Apply] │\n│  (error message if any)                 │\n│  GEMINI API KEY ▼  ← 折りたたみ済み     │\n│  (or: GEMINI AI: ENABLED        clear)  │\n└─────────────────────────────────────────┘\n```\n\n---\n\n## 動作フロー\n\n```\nユーザーが \"brutalist newspaper\" と入力 → Apply\n├─ matchStyle() → 一致なし\n├─ getApiKey() → キーなし → expandApiKeySection() → STOP\n│\n└─ getApiKey() → キーあり\n    ├─ ボタン \"Generating...\" + disabled\n    ├─ Gemini API へ fetch()\n    │   ├─ 200 OK → extractCss() → applyStyle(css, null, prompt)\n    │   │           → View Transition → CSS適用 + localStorage保存\n    │   ├─ 400/403 → showGenerateError(\"Invalid API key\") + 入力欄展開\n    │   ├─ 429    → showGenerateError(\"Rate limit hit\")\n    │   └─ その他 → showGenerateError(\"Generation failed: ...\")\n    └─ finally: ボタン復元\n```\n\n---\n\n## 検証方法\n\n1. ブラウザで `index.html` を開く\n2. \"minimalist\" と入力 → Apply → プリセット適用される（既存動作の確認）\n3. \"brutalist newspaper\" と入力 → Apply → API Key セクションが展開される\n4. APIキーを入力して Save → \"GEMINI AI: ENABLED\" に切り替わる\n5. \"brutalist newspaper\" と入力 → Apply → \"Generating...\" 表示後にテーマ適用\n6. ページをリロード → AI生成テーマが復元される\n7. プリセットボタンをクリック → プリセットに切り替わり、custom CSS がクリアされる\n8. clear ボタン → \"GEMINI API KEY ▼\" に戻る\n\n\nIf you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /Users/turtlekazu/.REDACTED.jsonl"},"uuid":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","timestamp":"2026-02-22T14:34:20.891Z","planContent":"# AI Theme Generation — Implementation Plan\n\n## Context\n\n現在の `handleGenerate()` はプリセット名の部分一致のみで、AI生成は未実装。\n自由記述のプロンプト（例: \"brutalist newspaper with orange ink\"）をGemini APIに送り、\nCSSを動的生成してページに反映させる機能を追加する。\n\n**選択API:** Google Gemini 2.0 Flash（無料枠: 1,500 req/日, 15 req/分）\n**アーキテクチャ:** ブラウザ完結。サーバー追加なし。APIキーはlocalStorage保存。\n**index.html 変更なし。gardener.js のみ修正。**\n\n---\n\n## 変更ファイル\n\n- `/Users/turtlekazu/ReactProjects/acephale/gardener.js` — 唯一の変更対象\n\n---\n\n## localStorage キー一覧\n\n| キー | 用途 |\n|------|------|\n| `acephale-theme` | 既存: プリセット名 |\n| `acephale-custom-css` | 新規: AI生成CSSの全文 |\n| `acephale-custom-prompt` | 新規: AI生成時のプロンプト文字列 |\n| `acephale-gemini-key` | 新規: ユーザーのGemini APIキー |\n\n---\n\n## 実装手順（この順で実装すること）\n\n### Step 1: モジュールレベルの定数を追加\n\n`BASE_URL` の直後に追加:\n\n```javascript\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n```\n\n---\n\n### Step 2: App オブジェクトに新メソッドを追加\n\n#### APIキー管理（3メソッド）\n\n```javascript\ngetApiKey() {\n    return localStorage.getItem('acephale-gemini-key');\n},\nsaveApiKey(key) {\n    localStorage.setItem('acephale-gemini-key', key.trim());\n},\nclearApiKey() {\n    localStorage.removeItem('acephale-gemini-key');\n    this.renderApiKeySection();\n},\n```\n\n#### CSS抽出（Geminiがmarkdown fence で返した場合に除去）\n\n```javascript\nextractCss(text) {\n    let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n    cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n    return cleaned.trim();\n},\n```\n\n#### Gemini API呼び出し\n\n```javascript\nasync generateTheme(prompt) {\n    const key = this.getApiKey();\n    if (!key) throw new Error('NO_API_KEY');\n\n    const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n    const body = {\n        system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n        contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n        generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n    };\n\n    const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n        const status = response.status;\n        if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n        if (status === 429) throw new Error('RATE_LIMIT');\n        throw new Error(`API_ERROR:${status}`);\n    }\n\n    const data = await response.json();\n    const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n    if (!rawText) throw new Error('EMPTY_RESPONSE');\n    return this.extractCss(rawText);\n},\n```\n\n#### APIキー設定UI のレンダリング\n\n`init()` から呼ばれる。`clearApiKey()` 後の再描画にも使う。\n`#theme-controls` の末尾に `#api-key-section` として追加する。\nキーが保存済みかどうかで2状態を描画する:\n\n- **State A（キーなし）**: \"GEMINI API KEY ▼\" トグル + password input + Save ボタン（デフォルト折りたたみ）\n- **State B（キーあり）**: \"GEMINI AI: ENABLED\" + \"clear\" ボタン\n\n完全な実装:\n\n```javascript\nrenderApiKeySection() {\n    const existing = document.getElementById('api-key-section');\n    if (existing) existing.remove();\n\n    const section = document.createElement('div');\n    section.id = 'api-key-section';\n    section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n    if (this.getApiKey()) {\n        // State B\n        section.innerHTML = `\n            <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n            </div>`;\n        section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n    } else {\n        // State A\n        section.innerHTML = `\n            <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n            </div>\n            <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n            </div>`;\n        section.querySelector('#api-key-toggle').addEventListener('click', () => {\n            const form = section.querySelector('#api-key-form');\n            const icon = section.querySelector('#api-key-icon');\n            const isOpen = form.style.display !== 'none';\n            form.style.display = isOpen ? 'none' : 'flex';\n            icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n        });\n        section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n            const val = section.querySelector('#api-key-input').value.trim();\n            if (!val) return;\n            this.saveApiKey(val);\n            this.renderApiKeySection();\n        });\n    }\n\n    this.elements.themeControls.appendChild(section);\n},\n```\n\n#### エラー表示（alert廃止 → インライン表示）\n\n```javascript\nshowGenerateError(err) {\n    let message;\n    switch (err.message) {\n        case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n        case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n        case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n        case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n        default:              message = `Generation failed: ${err.message}`;\n    }\n    let errEl = document.getElementById('generate-error');\n    if (!errEl) {\n        errEl = document.createElement('div');\n        errEl.id = 'generate-error';\n        errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n    }\n    errEl.textContent = message;\n    clearTimeout(this._errorTimeout);\n    this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n},\n```\n\n#### APIキーセクションを展開するヘルパー\n\n```javascript\nexpandApiKeySection() {\n    const form = document.getElementById('api-key-form');\n    const icon = document.getElementById('api-key-icon');\n    if (form && form.style.display === 'none') {\n        form.style.display = 'flex';\n        if (icon) icon.style.transform = 'rotate(0deg)';\n    }\n    this.elements.themeControls.classList.remove('is-minimized');\n    const input = document.getElementById('api-key-input');\n    if (input) setTimeout(() => input.focus(), 300);\n},\n```\n\n---\n\n### Step 3: `handleGenerate()` を async に更新\n\n既存の同期版と置き換える。同時リクエスト防止のガードも追加:\n\n```javascript\nasync handleGenerate() {\n    const input = this.elements.promptInput.value.trim();\n    if (!input) return;\n    if (this._isGenerating) return;  // 連打防止\n\n    // プリセット一致チェック（既存動作を維持）\n    const presetCss = this.matchStyle(input);\n    if (presetCss) {\n        this.applyStyle(presetCss, input);\n        this.togglePresets(true);\n        return;\n    }\n\n    // キーなし → 入力欄を展開\n    if (!this.getApiKey()) {\n        this.expandApiKeySection();\n        return;\n    }\n\n    // AI生成\n    this._isGenerating = true;\n    const btn = this.elements.generateBtn;\n    const originalText = btn.textContent;\n    btn.textContent = 'Generating...';\n    btn.disabled = true;\n\n    try {\n        const css = await this.generateTheme(input);\n        this.applyStyle(css, null, input);\n        this.togglePresets(true);\n    } catch (err) {\n        this.showGenerateError(err);\n    } finally {\n        btn.textContent = originalText;\n        btn.disabled = false;\n        this._isGenerating = false;\n    }\n},\n```\n\n---\n\n### Step 4: `applyStyle()` のシグネチャと永続化ロジックを更新\n\n`applyStyle(css, themeName, customPrompt = null)` に変更:\n\n```javascript\napplyStyle(css, themeName, customPrompt = null) {\n    this.toggleMenu(false);\n\n    if (themeName && STYLE_PRESETS[themeName]) {\n        // プリセット\n        localStorage.setItem('acephale-theme', themeName);\n        localStorage.removeItem('acephale-custom-css');\n        localStorage.removeItem('acephale-custom-prompt');\n    } else if (customPrompt) {\n        // AI生成テーマ\n        localStorage.setItem('acephale-custom-css', css);\n        localStorage.setItem('acephale-custom-prompt', customPrompt);\n        localStorage.removeItem('acephale-theme');\n    }\n\n    const applyFn = () => {\n        this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n    };\n\n    if (!document.startViewTransition) { applyFn(); return; }\n    document.startViewTransition(applyFn);\n},\n```\n\n---\n\n### Step 5: `init()` を更新\n\n`renderApiKeySection()` 呼び出しの追加と、AI生成テーマの復元ロジックを追加:\n\n```javascript\nasync init() {\n    this.renderPresetButtons();\n    this.renderApiKeySection();   // 追加\n    this.bindEvents();\n\n    const savedPreset  = localStorage.getItem('acephale-theme');\n    const savedCustom  = localStorage.getItem('acephale-custom-css');\n    const savedPrompt  = localStorage.getItem('acephale-custom-prompt');\n\n    if (savedCustom) {\n        this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n        if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n    } else {\n        const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n    }\n\n    await this.loadInitial();\n},\n```\n\n---\n\n## UIレイアウト（#theme-controls 最終形）\n\n```\n┌─────────────────────────────────────────┐\n│  [drag handle]                          │\n│  PRESETS ▼                              │\n│  [Mini] [Glitch] [Playful] ...          │\n│  [Enter theme.................] [Apply] │\n│  (error message if any)                 │\n│  GEMINI API KEY ▼  ← 折りたたみ済み     │\n│  (or: GEMINI AI: ENABLED        clear)  │\n└─────────────────────────────────────────┘\n```\n\n---\n\n## 動作フロー\n\n```\nユーザーが \"brutalist newspaper\" と入力 → Apply\n├─ matchStyle() → 一致なし\n├─ getApiKey() → キーなし → expandApiKeySection() → STOP\n│\n└─ getApiKey() → キーあり\n    ├─ ボタン \"Generating...\" + disabled\n    ├─ Gemini API へ fetch()\n    │   ├─ 200 OK → extractCss() → applyStyle(css, null, prompt)\n    │   │           → View Transition → CSS適用 + localStorage保存\n    │   ├─ 400/403 → showGenerateError(\"Invalid API key\") + 入力欄展開\n    │   ├─ 429    → showGenerateError(\"Rate limit hit\")\n    │   └─ その他 → showGenerateError(\"Generation failed: ...\")\n    └─ finally: ボタン復元\n```\n\n---\n\n## 検証方法\n\n1. ブラウザで `index.html` を開く\n2. \"minimalist\" と入力 → Apply → プリセット適用される（既存動作の確認）\n3. \"brutalist newspaper\" と入力 → Apply → API Key セクションが展開される\n4. APIキーを入力して Save → \"GEMINI AI: ENABLED\" に切り替わる\n5. \"brutalist newspaper\" と入力 → Apply → \"Generating...\" 表示後にテーマ適用\n6. ページをリロード → AI生成テーマが復元される\n7. プリセットボタンをクリック → プリセットに切り替わり、custom CSS がクリアされる\n8. clear ボタン → \"GEMINI API KEY ▼\" に戻る\n"}
{"parentUuid":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01G9YePErd8uP9zgzPvzh1XC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me start by reading the current state of `gardener.js` to understand the existing code structure before making changes.","signature":"EqQCCkYICxgCKkBohEX4D3WfkFxrqO0iTvv4mNcW/Furnc+lmanGntNyLFrFbvPc2Lm36K2lraCI6FvL+hn8rmD9zV6INCk8GQ0OEgwvHhCcyXK+RyxJJecaDBgk5roX05zWrR0JHSIwbvv2w6/BuBwNWMn8Rv5OcaN4tdFGKnh6MwMKlooGcZOiztmdY/sZnihW9kEYnzh1KosBWxbrEyl2VFpVjGRQhASR+CxhrX5XzuXd1t0JKR3I8JnEuUaOrqAeCYJrv0H3Ly8hXfcKci9GJ7LmDsY11/Mw50vZm+k0Yk9TVVY2rpUhSsLeGZxJ5vJaEJudM8RzN+MIQJ5mcA5Pv1mgE/UFTd5oKktI25qATCSM9kdGYH8pIJzW10m2wqjzR1km1xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":6432,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6432},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGnv3nSYwnM1FzGJzB8","type":"assistant","uuid":"115e461a-0121-4a97-8f84-e80f19e6a646","timestamp":"2026-02-22T14:34:23.220Z"}
{"parentUuid":"115e461a-0121-4a97-8f84-e80f19e6a646","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01G9YePErd8uP9zgzPvzh1XC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01W3hvyN3sbpbM1EejPQg78x","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":6432,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6432},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGnv3nSYwnM1FzGJzB8","type":"assistant","uuid":"c702b596-17fb-451d-ae79-ace4527d8971","timestamp":"2026-02-22T14:34:23.659Z"}
{"parentUuid":"c702b596-17fb-451d-ae79-ace4527d8971","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01W3hvyN3sbpbM1EejPQg78x","toolUseID":"toolu_01W3hvyN3sbpbM1EejPQg78x","timestamp":"2026-02-22T14:34:23.922Z","uuid":"fd64c2dc-3de6-4bc0-ad6c-243af4d63d12"}
{"parentUuid":"c702b596-17fb-451d-ae79-ace4527d8971","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01W3hvyN3sbpbM1EejPQg78x","type":"tool_result","content":"     1→/**\n     2→ * Acephale OS | Gardener.js\n     3→ * Hacker News Interface Styling & Data Fetching\n     4→ */\n     5→\n     6→const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n     7→\n     8→/**\n     9→ * System Core Styles (Layout, Typography Base, Responsive Logic)\n    10→ * Themes should override variables in :root or specific classes if needed.\n    11→ */\n    12→const SYSTEM_STYLE = `\n    13→    :root {\n    14→        /* Default Variables (Fallback) */\n    15→        --bg: #ffffff;\n    16→        --text: #333333;\n    17→        --subtext: #888888;\n    18→        --accent: #007aff;\n    19→        --card-bg: #ffffff;\n    20→        --header-bg: rgba(255,255,255,0.9);\n    21→        --header-border: 1px solid rgba(0,0,0,0.1);\n    22→        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    23→        \n    24→        /* Component Specific Defaults */\n    25→        --item-padding: 24px;\n    26→        --item-radius: 12px;\n    27→        --item-border: 1px solid rgba(0,0,0,0.05);\n    28→        --item-shadow: none;\n    29→        --item-gap: 20px;\n    30→        \n    31→        /* Mobile Defaults */\n    32→        --mobile-upvote-bg: rgba(0,0,0,0.05);\n    33→        --mobile-upvote-color: inherit;\n    34→        --mobile-upvote-border: none;\n    35→        --mobile-upvote-radius: 8px;\n    36→        --mobile-rank-opacity: 0.5;\n    37→        --mobile-rank-color: inherit;\n    38→\n    39→        /* More Button Defaults */\n    40→        --more-btn-bg: var(--text);\n    41→        --more-btn-color: var(--bg);\n    42→    }\n    43→\n    44→    /* --- Transition Animation --- */\n    45→    ::view-transition-group(*) {\n    46→        animation-duration: 1.2s;\n    47→    }\n    48→\n    49→    /* --- Base Layout --- */\n    50→    body {\n    51→        background: var(--bg);\n    52→        color: var(--text);\n    53→        font-family: var(--font-main);\n    54→        margin: 0;\n    55→        display: flex;\n    56→        flex-direction: column;\n    57→        min-height: 100vh;\n    58→        transition: background 0.5s, color 0.5s;\n    59→    }\n    60→    * { box-sizing: border-box; }\n    61→    ul, ol { list-style: none; padding: 0; margin: 0; }\n    62→    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    63→    button { font-family: inherit; cursor: pointer; }\n    64→\n    65→    /* --- Header --- */\n    66→    .hn-header {\n    67→        background: var(--header-bg);\n    68→        border-bottom: var(--header-border);\n    69→        backdrop-filter: saturate(180%) blur(20px);\n    70→        padding: 0 20px;\n    71→        height: 60px;\n    72→        display: flex;\n    73→        align-items: center;\n    74→        justify-content: center;\n    75→        position: sticky;\n    76→        top: 0;\n    77→        z-index: 100;\n    78→        view-transition-name: main-header;\n    79→    }\n    80→    .hn-nav {\n    81→        width: 100%;\n    82→        max-width: 1000px;\n    83→        display: flex;\n    84→        align-items: center;\n    85→        justify-content: space-between;\n    86→    }\n    87→    .hn-logo {\n    88→        font-weight: 900;\n    89→        font-size: 20px;\n    90→        color: var(--accent);\n    91→        view-transition-name: main-logo;\n    92→    }\n    93→    .hn-nav-links { display: flex; gap: 24px; }\n    94→    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    95→    .hn-nav-links a:hover { color: var(--text); }\n    96→    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n    97→\n    98→    /* --- Main Content --- */\n    99→    .hn-main {\n   100→        max-width: 1000px;\n   101→        margin: 0 auto;\n   102→        padding: 40px 20px;\n   103→        flex: 1;\n   104→        width: 100%;\n   105→        view-transition-name: main-content;\n   106→    }\n   107→    .hn-story-list {\n   108→        display: flex;\n   109→        flex-direction: column;\n   110→        gap: 16px;\n   111→        view-transition-name: story-list;\n   112→    }\n   113→\n   114→    /* --- Story Item (Desktop Standard) --- */\n   115→    .hn-story-item {\n   116→        background: var(--item-bg, var(--card-bg));\n   117→        border: var(--item-border);\n   118→        border-radius: var(--item-radius);\n   119→        padding: var(--item-padding);\n   120→        box-shadow: var(--item-shadow);\n   121→        display: flex;\n   122→        flex-direction: row;\n   123→        align-items: center;\n   124→        gap: var(--item-gap);\n   125→        transition: transform 0.2s, box-shadow 0.2s;\n   126→        position: relative;\n   127→    }\n   128→    .hn-story-rank {\n   129→        order: -2;\n   130→        font-size: 16px;\n   131→        color: var(--subtext);\n   132→        width: 30px;\n   133→        text-align: right;\n   134→        font-feature-settings: \"tnum\";\n   135→    }\n   136→    .hn-story-content { flex: 1; min-width: 0; }\n   137→    .hn-story-title {\n   138→        display: block;\n   139→        font-size: 18px;\n   140→        font-weight: 600;\n   141→        color: var(--text);\n   142→        line-height: 1.3;\n   143→        margin-bottom: 6px;\n   144→    }\n   145→    .hn-story-title:hover { color: var(--accent); }\n   146→    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n   147→    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n   148→    \n   149→    /* Standard Desktop Upvote */\n   150→    .hn-upvote {\n   151→        order: -1;\n   152→        background: transparent;\n   153→        border: 1px solid var(--subtext);\n   154→        color: var(--subtext);\n   155→        width: 32px;\n   156→        height: 32px;\n   157→        border-radius: 50%;\n   158→        display: flex;\n   159→        align-items: center;\n   160→        justify-content: center;\n   161→        font-size: 10px;\n   162→        flex-shrink: 0;\n   163→        transition: 0.2s;\n   164→        opacity: 0.6;\n   165→    }\n   166→    .hn-upvote:hover {\n   167→        border-color: var(--accent);\n   168→        color: var(--accent);\n   169→        opacity: 1;\n   170→    }\n   171→\n   172→    /* --- Load More --- */\n   173→    .hn-load-more {\n   174→        display: block;\n   175→        margin: 60px auto;\n   176→        padding: 12px 40px;\n   177→        background: var(--more-btn-bg);\n   178→        color: var(--more-btn-color);\n   179→        border: none;\n   180→        border-radius: 100px;\n   181→        font-weight: 600;\n   182→        transition: transform 0.2s;\n   183→    }\n   184→    .hn-load-more:hover { transform: scale(1.05); }\n   185→\n   186→    /* --- Footer --- */\n   187→    .hn-footer {\n   188→        padding: 60px 20px;\n   189→        border-top: 1px solid var(--header-border);\n   190→        text-align: center;\n   191→        font-size: 13px;\n   192→        color: var(--subtext);\n   193→        background: var(--bg);\n   194→        view-transition-name: main-footer;\n   195→    }\n   196→    .hn-footer-links {\n   197→        display: flex;\n   198→        justify-content: center;\n   199→        gap: 20px;\n   200→        margin-bottom: 20px;\n   201→    }\n   202→\n   203→    /* --- Control Panel (Glassmorphism) --- */\n   204→    #theme-controls { \n   205→        view-transition-name: theme-ui;\n   206→        position: fixed; \n   207→        bottom: 20px; \n   208→        right: 20px; \n   209→        z-index: 10000; \n   210→        padding: 15px; \n   211→        border-radius: 12px; \n   212→        display: flex; \n   213→        flex-direction: column; \n   214→        gap: 12px; \n   215→        align-items: flex-start; \n   216→        max-width: 350px;\n   217→\n   218→        /* Glass Style */\n   219→        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n   220→        color: var(--text);\n   221→        border: 1px solid rgba(255, 255, 255, 0.15);\n   222→        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n   223→        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n   224→        backdrop-filter: saturate(180%) blur(30px);\n   225→        -webkit-backdrop-filter: saturate(180%) blur(30px);\n   226→        transition: all 0.3s;\n   227→    }\n   228→    #theme-controls input {\n   229→        background: var(--bg);\n   230→        color: var(--text);\n   231→        border: 1px solid var(--subtext);\n   232→        padding: 8px 12px;\n   233→        border-radius: 6px;\n   234→        outline: none;\n   235→        flex: 1;\n   236→        opacity: 0.8;\n   237→    }\n   238→    #theme-controls button {\n   239→        background: rgba(0,0,0,0.05);\n   240→        color: var(--text);\n   241→        border: 1px solid rgba(0,0,0,0.1);\n   242→        border-radius: 6px;\n   243→        padding: 6px 12px;\n   244→        font-size: 12px;\n   245→        font-weight: 500;\n   246→        transition: 0.2s;\n   247→    }\n   248→    #theme-controls #generate-btn {\n   249→        background: var(--accent) !important;\n   250→        color: #fff;\n   251→        border: none;\n   252→        font-weight: 600;\n   253→        padding: 8px 16px;\n   254→    }\n   255→    \n   256→    /* Collapsible Logic */\n   257→    #preset-buttons {\n   258→        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n   259→        max-height: 300px; opacity: 1; overflow: hidden;\n   260→        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n   261→    }\n   262→    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n   263→    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n   264→    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n   265→\n   266→    /* --- Desktop Panel Toggle (Drag Handle) --- */\n   267→    #panel-handle { display: none; }\n   268→    @media (min-width: 769px) {\n   269→        #panel-handle {\n   270→            display: block; position: absolute; top: 0; left: 0;\n   271→            width: 20px; height: 100%;\n   272→            background: transparent;\n   273→            cursor: ew-resize;\n   274→            z-index: 20;\n   275→        }\n   276→        /* Visual cue */\n   277→        #panel-handle::before {\n   278→            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n   279→            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n   280→            transition: 0.2s;\n   281→        }\n   282→        #panel-handle:hover::before { opacity: 0.4; }\n   283→        \n   284→        #theme-controls { \n   285→            padding-left: 20px; \n   286→            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n   287→        }\n   288→        #theme-controls.is-minimized {\n   289→            transform: translateX(calc(100% - 20px));\n   290→        }\n   291→        #theme-controls.is-minimized > *:not(#panel-handle) {\n   292→            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n   293→        }\n   294→    }\n   295→\n   296→    /* --- Mobile Overrides (Unified) --- */\n   297→    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n   298→    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n   299→\n   300→    @media (max-width: 768px) {\n   301→        /* Mobile Nav */\n   302→        .hn-menu-toggle { display: block; order: 999; }\n   303→        .hn-nav-links {\n   304→            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n   305→            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n   306→            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n   307→        }\n   308→        .hn-nav-links.is-open { display: flex; }\n   309→        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n   310→        .hn-auth { display: none; }\n   311→        .hn-header { padding: 0 15px; height: 60px; }\n   312→        .hn-main { padding: 20px 15px; }\n   313→        \n   314→        /* Mobile Story Item */\n   315→        .hn-story-item {\n   316→            padding: 15px;\n   317→            gap: 12px;\n   318→            flex-direction: row;\n   319→            align-items: flex-start;\n   320→        }\n   321→        .hn-story-title { font-size: 17px; line-height: 1.3; }\n   322→        \n   323→        /* Mobile Rank */\n   324→        .hn-story-rank {\n   325→            display: block;\n   326→            width: auto;\n   327→            min-width: 18px;\n   328→            margin-right: 8px;\n   329→            font-size: 14px;\n   330→            \n   331→            /* Reset & Variable Application */\n   332→            position: static;\n   333→            background: var(--mobile-rank-bg, transparent);\n   334→            border: var(--mobile-rank-border, none);\n   335→            padding: var(--mobile-rank-padding, 0);\n   336→            border-radius: var(--mobile-rank-radius, 0);\n   337→            opacity: var(--mobile-rank-opacity, 0.5);\n   338→            color: var(--mobile-rank-color, inherit);\n   339→            font-weight: var(--mobile-rank-font-weight, 400);\n   340→            \n   341→            align-self: flex-start;\n   342→            margin-top: 2px;\n   343→            flex-shrink: 0;\n   344→            white-space: nowrap;\n   345→            text-align: center;\n   346→        }\n   347→\n   348→        /* Mobile Upvote */\n   349→        .hn-upvote {\n   350→            width: 32px;\n   351→            height: 32px;\n   352→            margin-top: 2px;\n   353→            align-self: flex-start;\n   354→            display: flex;\n   355→            align-items: center;\n   356→            justify-content: center;\n   357→            font-size: 10px;\n   358→            opacity: 1; /* Reset opacity */\n   359→            \n   360→            /* Variable Application */\n   361→            background: var(--mobile-upvote-bg);\n   362→            border: var(--mobile-upvote-border);\n   363→            color: var(--mobile-upvote-color);\n   364→            border-radius: var(--mobile-upvote-radius);\n   365→        }\n   366→\n   367→        /* Mobile Control Panel */\n   368→        #theme-controls {\n   369→            bottom: 20px; right: 20px; width: auto;\n   370→            max-width: calc(100vw - 40px);\n   371→            padding: 15px;\n   372→            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n   373→        }\n   374→        .hn-footer { padding: 40px 20px 160px; }\n   375→        .hn-footer-links { flex-direction: column; gap: 10px; }\n   376→        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n   377→        #presets-toggle { margin-bottom: 2px; }\n   378→        \n   379→        /* Mobile Menu State */\n   380→        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n   381→        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n   382→        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n   383→    }\n   384→`;\n   385→\n   386→/**\n   387→ * Themes\n   388→ * Define variables and minimal specific overrides.\n   389→ */\n   390→const STYLE_PRESETS = {\n   391→    \"Minimalist\": `\n   392→        :root {\n   393→            --bg: #f5f5f7;\n   394→            --card-bg: #ffffff;\n   395→            --text: #1d1d1f;\n   396→            --subtext: #86868b;\n   397→            --accent: #0066cc;\n   398→            --header-bg: rgba(251, 251, 253, 0.8);\n   399→            \n   400→            /* Mobile */\n   401→            --mobile-upvote-bg: #e8e8ed;\n   402→            --mobile-upvote-radius: 50%;\n   403→\n   404→            /* More Button */\n   405→            --more-btn-bg: var(--accent);\n   406→            --more-btn-color: #fff;\n   407→        }\n   408→        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n   409→        .hn-header { \n   410→            background: rgba(255, 255, 255, 0.7); \n   411→            border: 0.5px solid rgba(0,0,0,0.05);\n   412→            backdrop-filter: saturate(180%) blur(20px);\n   413→            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n   414→            margin: 12px 20px;\n   415→            border-radius: 100px;\n   416→            height: 50px;\n   417→            top: 12px;\n   418→        }\n   419→        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n   420→        .hn-logo { \n   421→            text-transform: uppercase; \n   422→            letter-spacing: 0.2em; \n   423→            font-size: 14px; \n   424→            font-weight: 300;\n   425→            color: #000;\n   426→        }\n   427→        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n   428→        #theme-controls #generate-btn { background: var(--accent) !important; }\n   429→    `,\n   430→\n   431→    \"Glitch\": `\n   432→        :root {\n   433→            --bg: #050a0e;\n   434→            --card-bg: rgba(5, 10, 14, 0.9);\n   435→            --text: #fcee0a; /* Yellow */\n   436→            --subtext: #00f0ff; /* Blue */\n   437→            --accent: #ff003c; /* Pink */\n   438→            --header-bg: var(--text);\n   439→            --font-main: sans-serif;\n   440→            \n   441→            /* Mobile */\n   442→            --mobile-upvote-bg: var(--accent);\n   443→            --mobile-upvote-color: #fff;\n   444→            --mobile-upvote-radius: 0;\n   445→\n   446→            /* More Button */\n   447→            --more-btn-bg: var(--text);\n   448→            --more-btn-color: #000;\n   449→        }\n   450→        \n   451→        body { text-transform: uppercase; }\n   452→        body::before {\n   453→            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n   454→            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n   455→            pointer-events: none; z-index: 1000;\n   456→        }\n   457→        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n   458→        .hn-header.is-open-active { clip-path: none; }\n   459→        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n   460→        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n   461→        .hn-story-item { \n   462→            border: 2px solid var(--subtext);\n   463→            background: rgba(255, 0, 60, 0.05);\n   464→            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n   465→        }\n   466→        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n   467→        .hn-upvote { \n   468→            background: var(--accent); color: #fff; border: none; border-radius: 0; \n   469→            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n   470→            padding: 0 10px; width: auto;\n   471→        }\n   472→        /* Override Common Apply Button for visibility */\n   473→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   474→    `,\n   475→\n   476→    \"Playful\": `\n   477→        :root {\n   478→            --red: #e60012;\n   479→            --blue: #00a0e9;\n   480→            --bg: #eee;\n   481→            --card-bg: #fff;\n   482→            --text: #333;\n   483→            --subtext: #8c8c8c;\n   484→            --accent: var(--blue);\n   485→            --header-bg: var(--red);\n   486→            \n   487→            /* Mobile */\n   488→            --mobile-upvote-bg: var(--red);\n   489→            --mobile-upvote-color: #fff;\n   490→            --mobile-upvote-border: 3px solid #000;\n   491→            --mobile-upvote-radius: 12px;\n   492→            \n   493→            --mobile-rank-opacity: 1;\n   494→            --mobile-rank-color: #fff;\n   495→            --mobile-rank-bg: var(--blue);\n   496→            --mobile-rank-border: 3px solid #000;\n   497→            --mobile-rank-radius: 12px;\n   498→            --mobile-rank-padding: 2px 8px;\n   499→            --mobile-rank-font-weight: 900;\n   500→            \n   501→            --button-bg: var(--red);\n   502→\n   503→            /* More Button */\n   504→            --more-btn-bg: var(--red);\n   505→            --more-btn-color: #fff;\n   506→        }\n   507→        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n   508→        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n   509→        \n   510→        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n   511→        .hn-story-item { \n   512→            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n   513→            align-items: center; padding: 30px;\n   514→        }\n   515→        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n   516→        .hn-story-rank { \n   517→            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n   518→            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n   519→            width: auto; text-align: center;\n   520→        }\n   521→        .hn-upvote { \n   522→            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n   523→            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n   524→        }\n   525→        /* Force Apply Button Red */\n   526→        #theme-controls #generate-btn { background: var(--red) !important; }\n   527→    `,\n   528→\n   529→    \"Glow\": `\n   530→        :root {\n   531→            --bg: #0a0d14;\n   532→            --card-bg: rgba(20, 25, 35, 0.8);\n   533→            --text: #ffffff;\n   534→            --subtext: rgba(255, 255, 255, 0.6);\n   535→            --accent: #0037c1;\n   536→            --header-bg: transparent;\n   537→            --header-border: 1px solid rgba(255,255,255,0.05);\n   538→            \n   539→            /* Mobile */\n   540→            --mobile-upvote-bg: transparent;\n   541→            --mobile-upvote-color: var(--subtext);\n   542→            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n   543→\n   544→            /* More Button */\n   545→            --more-btn-bg: var(--accent);\n   546→            --more-btn-color: #fff;\n   547→        }\n   548→        body {\n   549→            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n   550→                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n   551→        }\n   552→        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n   553→        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n   554→        .hn-header { \n   555→            border: 1px solid rgba(0, 55, 193, 0.3); \n   556→            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n   557→            margin: 15px 20px;\n   558→            border-radius: 12px;\n   559→            background: rgba(10, 13, 20, 0.8);\n   560→            top: 15px;\n   561→        }\n   562→        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n   563→        .hn-logo { \n   564→            text-transform: uppercase; \n   565→            letter-spacing: 4px; \n   566→            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n   567→            font-size: 18px;\n   568→        }\n   569→        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n   570→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   571→    `,\n   572→\n   573→    \"Academic\": `\n   574→        :root {\n   575→            --bg: #fdfaf5;\n   576→            --card-bg: #ffffff;\n   577→            --text: #1b1b1b;\n   578→            --subtext: #666;\n   579→            --accent: #d97757;\n   580→            --header-bg: #fdfaf5;\n   581→            --font-main: serif;\n   582→            \n   583→            --item-border: none;\n   584→            --item-padding: 50px 0;\n   585→            --item-radius: 0;\n   586→            --item-shadow: none;\n   587→            \n   588→            /* Mobile */\n   589→            --mobile-upvote-bg: transparent;\n   590→            --mobile-upvote-color: #999;\n   591→            --mobile-upvote-border: 1.5px solid #ccc;\n   592→\n   593→            /* More Button */\n   594→            --more-btn-bg: var(--accent);\n   595→            --more-btn-color: #fff;\n   596→        }\n   597→        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n   598→        .hn-story-title { font-size: 28px; font-weight: 500; }\n   599→        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n   600→        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n   601→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   602→    `,\n   603→\n   604→    \"Search\": `\n   605→        :root {\n   606→            --bg: #fff;\n   607→            --card-bg: #fff;\n   608→            --text: #202124;\n   609→            --subtext: #5f6368;\n   610→            --accent: #1a73e8;\n   611→            --header-bg: #fff;\n   612→            --font-main: sans-serif;\n   613→            \n   614→            --item-padding: 16px 0;\n   615→            --item-radius: 0;\n   616→            --item-border: none;\n   617→            --item-shadow: none;\n   618→            \n   619→            /* Mobile */\n   620→            --mobile-upvote-bg: transparent;\n   621→            --mobile-upvote-color: #70757a;\n   622→            --mobile-upvote-border: 1px solid #dadce0;\n   623→\n   624→            /* More Button */\n   625→            --more-btn-bg: #f8f9fa;\n   626→            --more-btn-color: #3c4043;\n   627→        }\n   628→        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n   629→        .hn-story-title:hover { text-decoration: underline; }\n   630→        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n   631→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   632→    `,\n   633→\n   634→    \"Universal\": `\n   635→        :root {\n   636→            --bg: #fff;\n   637→            --card-bg: #f4f4f4;\n   638→            --text: #000;\n   639→            --subtext: #666;\n   640→            --accent: #034EA2;\n   641→            --header-bg: #fff;\n   642→            \n   643→            /* Mobile */\n   644→            --mobile-upvote-bg: var(--accent);\n   645→            --mobile-upvote-color: #fff;\n   646→            --mobile-upvote-radius: 50%;\n   647→\n   648→            /* More Button */\n   649→            --more-btn-bg: var(--accent);\n   650→            --more-btn-color: #fff;\n   651→        }\n   652→        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n   653→        .hn-story-item { padding: 30px; border-radius: 40px; }\n   654→        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n   655→        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n   656→        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n   657→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   658→    `,\n   659→\n   660→    \"Intelligence\": `\n   661→        :root {\n   662→            --bg: #0d0d0d;\n   663→            --card-bg: #171717;\n   664→            --text: #ececec;\n   665→            --subtext: #b4b4b4;\n   666→            --accent: #10a37f;\n   667→            --header-bg: rgba(13, 13, 13, 0.8);\n   668→            \n   669→            --item-border: 1px solid rgba(255,255,255,0.1);\n   670→            \n   671→            /* Mobile */\n   672→            --mobile-upvote-bg: transparent;\n   673→            --mobile-upvote-color: var(--subtext);\n   674→            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n   675→\n   676→            /* More Button */\n   677→            --more-btn-bg: var(--accent);\n   678→            --more-btn-color: #fff;\n   679→        }\n   680→        .hn-story-item:hover { border-color: var(--accent); }\n   681→        .hn-header { \n   682→            border: 1px solid rgba(16, 163, 127, 0.3); \n   683→            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n   684→            background: rgba(13, 13, 13, 0.9);\n   685→            margin: 10px 15px;\n   686→            border-radius: 4px;\n   687→            top: 10px;\n   688→        }\n   689→        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n   690→        .hn-logo { \n   691→            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n   692→            font-size: 16px; \n   693→            color: var(--accent); \n   694→            display: flex; \n   695→            align-items: center; \n   696→        }\n   697→        .hn-logo::after { \n   698→            content: '_'; \n   699→            margin-left: 4px; \n   700→            animation: blink 1s step-end infinite; \n   701→            color: var(--accent);\n   702→        }\n   703→        @keyframes blink { 50% { opacity: 0; } }\n   704→        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n   705→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   706→    `,\n   707→\n   708→    \"Ghibli\": `\n   709→        :root {\n   710→            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n   711→            --card-bg: #ffffff;\n   712→            --text: #433422; /* 焦茶色の文字 */\n   713→            --subtext: #8c7355; /* 土のような茶色 */\n   714→            --accent: #5d8a66; /* 深い森の緑 */\n   715→            --header-bg: rgba(253, 250, 240, 0.85);\n   716→            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n   717→            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n   718→\n   719→            /* Component Overrides */\n   720→            --item-radius: 20px;\n   721→            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n   722→            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n   723→\n   724→            /* More & Upvote Colors */\n   725→            --more-btn-bg: var(--accent);\n   726→            --more-btn-color: #fff;\n   727→            --mobile-upvote-bg: var(--accent);\n   728→            --mobile-upvote-color: #fff;\n   729→            --mobile-rank-color: var(--subtext);\n   730→            --mobile-rank-opacity: 1;\n   731→        }\n   732→        .hn-story-item {\n   733→            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n   734→            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n   735→        }\n   736→        .hn-story-item:hover {\n   737→            transform: translateY(-2px);\n   738→            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n   739→            border-color: var(--accent);\n   740→        }\n   741→        .hn-logo {\n   742→            font-style: italic;\n   743→            color: var(--accent);\n   744→            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n   745→        }\n   746→        .hn-upvote {\n   747→            background: rgba(93, 138, 102, 0.05);\n   748→            border-color: rgba(93, 138, 102, 0.3);\n   749→            color: var(--accent);\n   750→        }\n   751→        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n   752→    `,\n   753→\n   754→    \"8-Bit\": `\n   755→        :root {\n   756→            --bg: #000000; /* 漆黒の背景 */\n   757→            --card-bg: #111111;\n   758→            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n   759→            --subtext: #008800;\n   760→            --accent: #00ffff; /* シアンのアクセント */\n   761→            --header-bg: #000000;\n   762→            --header-border: 4px solid #00ffff;\n   763→            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n   764→\n   765→            /* Component Overrides */\n   766→            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n   767→            --item-border: 4px solid #008800;\n   768→            --item-padding: 20px;\n   769→            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n   770→\n   771→            /* More & Upvote Colors */\n   772→            --more-btn-bg: var(--accent);\n   773→            --more-btn-color: #000;\n   774→            --mobile-upvote-bg: var(--accent);\n   775→            --mobile-upvote-color: #000;\n   776→            --mobile-rank-color: var(--text);\n   777→            --mobile-rank-opacity: 1;\n   778→        }\n   779→        body {\n   780→            image-rendering: pixelated;\n   781→        }\n   782→        .hn-story-item:hover {\n   783→            border-color: var(--accent);\n   784→            box-shadow: 4px 4px 0px var(--subtext);\n   785→            transform: translate(4px, 4px); /* 押し込み感 */\n   786→        }\n   787→        .hn-upvote {\n   788→            border-radius: 0;\n   789→            border: 2px solid var(--accent);\n   790→            background: #000;\n   791→            color: var(--accent);\n   792→        }\n   793→        .hn-logo {\n   794→            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n   795→        }\n   796→        .hn-load-more {\n   797→            border-radius: 0;\n   798→            border: 4px solid var(--text);\n   799→            text-transform: uppercase;\n   800→        }\n   801→        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n   802→    `\n   803→};\n   804→\n   805→/**\n   806→ * Data Fetching Logic\n   807→ */\n   808→const HNData = {\n   809→    allStoryIds: [],\n   810→    currentType: 'top',\n   811→\n   812→    setType(type) {\n   813→        if (this.currentType === type) return;\n   814→        this.currentType = type;\n   815→        this.allStoryIds = []; // Clear cache\n   816→    },\n   817→\n   818→    async fetchAllIds() {\n   819→        if (this.allStoryIds.length > 0) return this.allStoryIds;\n   820→        try {\n   821→            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n   822→            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n   823→            this.allStoryIds = await response.json();\n   824→            return this.allStoryIds;\n   825→        } catch (error) {\n   826→            console.error(\"Failed to fetch ID list:\", error);\n   827→            return [];\n   828→        }\n   829→    },\n   830→\n   831→    async fetchStoriesBatch(offset, limit = 30) {\n   832→        const ids = await this.fetchAllIds();\n   833→        const batchIds = ids.slice(offset, offset + limit);\n   834→\n   835→        const storyPromises = batchIds.map(async (id) => {\n   836→            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n   837→            return await storyRes.json();\n   838→        });\n   839→\n   840→        return await Promise.all(storyPromises);\n   841→    },\n   842→\n   843→    formatTime(timestamp) {\n   844→        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n   845→        let interval = Math.floor(seconds / 31536000);\n   846→        if (interval > 1) return interval + \" years ago\";\n   847→        interval = Math.floor(seconds / 2592000);\n   848→        if (interval > 1) return interval + \" months ago\";\n   849→        interval = Math.floor(seconds / 86400);\n   850→        if (interval > 1) return interval + \" days ago\";\n   851→        interval = Math.floor(seconds / 3600);\n   852→        if (interval > 1) return interval + \" hours ago\";\n   853→        interval = Math.floor(seconds / 60);\n   854→        if (interval > 1) return interval + \" minutes ago\";\n   855→        return Math.floor(seconds) + \" seconds ago\";\n   856→    }\n   857→};\n   858→\n   859→/**\n   860→ * Application Controller\n   861→ */\n   862→const App = {\n   863→    currentOffset: 0,\n   864→    isLoading: false,\n   865→\n   866→    elements: {\n   867→        styleTag: document.getElementById('generated-style'),\n   868→        promptInput: document.getElementById('prompt-input'),\n   869→        generateBtn: document.getElementById('generate-btn'),\n   870→        presetButtons: document.getElementById('preset-buttons'),\n   871→        presetsToggle: document.getElementById('presets-toggle'),\n   872→        presetsIcon: document.getElementById('presets-icon'),\n   873→        listElement: document.querySelector('.hn-story-list'),\n   874→        loadMoreBtn: document.querySelector('.hn-load-more'),\n   875→        menuToggle: document.querySelector('.hn-menu-toggle'),\n   876→        navLinks: document.querySelector('.hn-nav-links'),\n   877→        header: document.querySelector('.hn-header'),\n   878→        themeControls: document.getElementById('theme-controls'),\n   879→        panelHandle: document.getElementById('panel-handle')\n   880→    },\n   881→\n   882→    async init() {\n   883→        this.renderPresetButtons();\n   884→        this.bindEvents();\n   885→        console.log(\"Generative UI - Architecture Refactored.\");\n   886→        \n   887→        // Restore saved theme or fallback to Minimalist\n   888→        const savedTheme = localStorage.getItem('acephale-theme');\n   889→        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n   890→        \n   891→        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n   892→\n   893→        // Initial load\n   894→        await this.loadInitial();\n   895→    },\n   896→\n   897→    renderPresetButtons() {\n   898→        this.elements.presetButtons.innerHTML = '';\n   899→        Object.keys(STYLE_PRESETS).forEach(themeName => {\n   900→            const btn = document.createElement('button');\n   901→            btn.textContent = themeName;\n   902→            btn.style.cssText = `\n   903→                padding: 6px 12px;\n   904→                background: rgba(0,0,0,0.05);\n   905→                border: 1px solid rgba(0,0,0,0.1);\n   906→                border-radius: 6px;\n   907→                font-size: 12px;\n   908→                font-weight: 500;\n   909→                cursor: pointer;\n   910→                transition: all 0.2s;\n   911→                color: var(--text);\n   912→                flex-shrink: 0;\n   913→            `;\n   914→            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n   915→            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n   916→            btn.onclick = () => {\n   917→                this.elements.promptInput.value = themeName;\n   918→                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n   919→                this.togglePresets(true);\n   920→            };\n   921→            this.elements.presetButtons.appendChild(btn);\n   922→        });\n   923→    },\n   924→\n   925→    bindEvents() {\n   926→        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n   927→        this.elements.promptInput.addEventListener('keypress', (e) => {\n   928→            if (e.key === 'Enter') this.handleGenerate();\n   929→        });\n   930→        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n   931→        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n   932→        \n   933→        if (this.elements.presetsToggle) {\n   934→            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n   935→        }\n   936→\n   937→        if (this.elements.panelHandle) {\n   938→            let isDragging = false;\n   939→            let startX = 0;\n   940→            const threshold = 50;\n   941→\n   942→            const startDrag = (e) => {\n   943→                if (window.innerWidth < 769) return;\n   944→                isDragging = true;\n   945→                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n   946→                this.elements.themeControls.style.transition = 'none';\n   947→            };\n   948→\n   949→            const doDrag = (e) => {\n   950→                if (!isDragging) return;\n   951→                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n   952→                const deltaX = clientX - startX;\n   953→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n   954→\n   955→                if (!isMin && deltaX > 0) {\n   956→                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n   957→                } else if (isMin && deltaX < 0) {\n   958→                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n   959→                }\n   960→            };\n   961→\n   962→            const endDrag = (e) => {\n   963→                if (!isDragging) return;\n   964→                isDragging = false;\n   965→                this.elements.themeControls.style.transition = '';\n   966→                \n   967→                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n   968→                const deltaX = clientX - startX;\n   969→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n   970→\n   971→                this.elements.themeControls.style.transform = '';\n   972→\n   973→                if (Math.abs(deltaX) < 10) {\n   974→                    this.elements.themeControls.classList.toggle('is-minimized');\n   975→                } else {\n   976→                    if (!isMin && deltaX > threshold) {\n   977→                        this.elements.themeControls.classList.add('is-minimized');\n   978→                    } else if (isMin && deltaX < -threshold) {\n   979→                        this.elements.themeControls.classList.remove('is-minimized');\n   980→                    }\n   981→                }\n   982→            };\n   983→\n   984→            const handle = this.elements.panelHandle;\n   985→            handle.addEventListener('mousedown', startDrag);\n   986→            handle.addEventListener('touchstart', startDrag, {passive: true});\n   987→            \n   988→            document.addEventListener('mousemove', doDrag);\n   989→            document.addEventListener('touchmove', doDrag, {passive: true});\n   990→            \n   991→            document.addEventListener('mouseup', endDrag);\n   992→            document.addEventListener('touchend', endDrag);\n   993→        }\n   994→        \n   995→        // Handle navigation\n   996→        this.elements.navLinks.addEventListener('click', (e) => {\n   997→            if (e.target.tagName === 'A') {\n   998→                e.preventDefault();\n   999→                const type = e.target.textContent.trim().toLowerCase();\n  1000→                \n  1001→                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n  1002→                    this.switchFeed(type);\n  1003→                } else if (type === 'submit') {\n  1004→                    this.toggleMenu(false);\n  1005→                    window.open('https://news.ycombinator.com/submit', '_blank');\n  1006→                } else {\n  1007→                    this.toggleMenu(false);\n  1008→                    alert('This feature is currently unavailable in the Generative UI.');\n  1009→                }\n  1010→            }\n  1011→        });\n  1012→    },\n  1013→\n  1014→    togglePresets(collapse) {\n  1015→        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n  1016→        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n  1017→        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n  1018→    },\n  1019→\n  1020→    toggleMenu(force) {\n  1021→        if (!this.elements.menuToggle) return;\n  1022→        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n  1023→        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n  1024→        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n  1025→        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n  1026→    },\n  1027→\n  1028→    async switchFeed(type) {\n  1029→        if (this.isLoading) return;\n  1030→        this.isLoading = true;\n  1031→        \n  1032→        // Update HNData\n  1033→        HNData.setType(type);\n  1034→        \n  1035→        // Reset state\n  1036→        this.currentOffset = 0;\n  1037→        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n  1038→        \n  1039→        // Close menu (if open)\n  1040→        this.toggleMenu(false);\n  1041→        \n  1042→        // Load\n  1043→        await this.loadAndRender();\n  1044→        this.isLoading = false;\n  1045→    },\n  1046→\n  1047→    async loadInitial() {\n  1048→        this.currentOffset = 0;\n  1049→        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n  1050→        await this.loadAndRender();\n  1051→    },\n  1052→\n  1053→    async loadMore() {\n  1054→        if (this.isLoading) return;\n  1055→        this.isLoading = true;\n  1056→        const originalText = this.elements.loadMoreBtn.textContent;\n  1057→        this.elements.loadMoreBtn.textContent = 'Loading...';\n  1058→        \n  1059→        await this.loadAndRender(true);\n  1060→        \n  1061→        this.elements.loadMoreBtn.textContent = originalText;\n  1062→        this.isLoading = false;\n  1063→    },\n  1064→\n  1065→    async loadAndRender(append = false) {\n  1066→        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n  1067→        this.renderStories(stories, append);\n  1068→        this.currentOffset += stories.length;\n  1069→    },\n  1070→\n  1071→    renderStories(stories, append = false) {\n  1072→        if (!append) {\n  1073→            this.elements.listElement.innerHTML = '';\n  1074→        }\n  1075→\n  1076→        stories.forEach((story, index) => {\n  1077→            if (!story) return;\n  1078→            \n  1079→            const rank = this.currentOffset + index + 1;\n  1080→            const domain = story.url ? new URL(story.url).hostname : '';\n  1081→            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n  1082→            const timeAgo = HNData.formatTime(story.time);\n  1083→            \n  1084→            // Escape HTML in user content\n  1085→            const title = this.escapeHtml(story.title || '');\n  1086→            const author = this.escapeHtml(story.by || '');\n  1087→\n  1088→            const listItem = document.createElement('li');\n  1089→            listItem.className = 'hn-story-item';\n  1090→            listItem.innerHTML = `\n  1091→                <div class=\"hn-story-rank\">${rank}</div>\n  1092→                <div class=\"hn-story-content\">\n  1093→                    <div class=\"hn-story-title-row\">\n  1094→                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n  1095→                        ${domainHtml}\n  1096→                    </div>\n  1097→                    <div class=\"hn-story-meta\">\n  1098→                        <span class=\"hn-story-points\">${story.score} pts</span> • \n  1099→                        <span class=\"hn-story-author\">${author}</span> • \n  1100→                        <span class=\"hn-story-time\">${timeAgo}</span>\n  1101→                    </div>\n  1102→                </div>\n  1103→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n  1104→            `;\n  1105→            this.elements.listElement.appendChild(listItem);\n  1106→        });\n  1107→    },\n  1108→\n  1109→    escapeHtml(unsafe) {\n  1110→        return unsafe\n  1111→            .replace(/&/g, \"&amp;\")\n  1112→            .replace(/</g, \"&lt;\")\n  1113→            .replace(/>/g, \"&gt;\")\n  1114→            .replace(/\"/g, \"&quot;\")\n  1115→            .replace(/'/g, \"&#039;\");\n  1116→    },\n  1117→\n  1118→    handleGenerate() {\n  1119→        const input = this.elements.promptInput.value.trim();\n  1120→        if (!input) return;\n  1121→\n  1122→        const style = this.matchStyle(input);\n  1123→        \n  1124→        if (style) {\n  1125→            this.applyStyle(style, input);\n  1126→            this.togglePresets(true);\n  1127→        } else {\n  1128→            this.showError();\n  1129→        }\n  1130→    },\n  1131→\n  1132→    matchStyle(input) {\n  1133→        const normalizedInput = input.toLowerCase();\n  1134→        for (const key in STYLE_PRESETS) {\n  1135→            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n  1136→        }\n  1137→        return null;\n  1138→    },\n  1139→\n  1140→    applyStyle(css, themeName) {\n  1141→        console.log(`Applying theme: ${themeName}`);\n  1142→        this.toggleMenu(false); // Close menu on theme change\n  1143→        \n  1144→        // Save to local storage for persistence\n  1145→        if (STYLE_PRESETS[themeName]) {\n  1146→            localStorage.setItem('acephale-theme', themeName);\n  1147→        }\n  1148→\n  1149→        // Fallback for browsers that don't support View Transition API\n  1150→        if (!document.startViewTransition) {\n  1151→            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n  1152→            return;\n  1153→        }\n  1154→\n  1155→        // Smooth transition using View Transition API\n  1156→        document.startViewTransition(() => {\n  1157→            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n  1158→        });\n  1159→    },\n  1160→\n  1161→    showError() {\n  1162→        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n  1163→        alert(`Please enter a supported theme:\\n\"${available}\"`);\n  1164→    }\n  1165→};\n  1166→\n  1167→// Start the application\n  1168→document.addEventListener('DOMContentLoaded', () => App.init());\n  1169→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1751b3cb-f5ca-4a9a-b0a0-4fae2e4b579e","timestamp":"2026-02-22T14:34:23.921Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","numLines":1169,"startLine":1,"totalLines":1169}},"sourceToolAssistantUUID":"c702b596-17fb-451d-ae79-ace4527d8971"}
{"parentUuid":"1751b3cb-f5ca-4a9a-b0a0-4fae2e4b579e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01TdbgoC7nP9g6n3byUbvbjw","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a full picture of the current code. Let me implement the plan step by step:\n\n1. Add `GEMINI_SYSTEM_PROMPT` constant after `BASE_URL`\n2. Add new methods to the `App` object: `getApiKey()`, `saveApiKey()`, `clearApiKey()`, `extractCss()`, `generateTheme()`, `renderApiKeySection()`, `showGenerateError()`, `expandApiKeySection()`\n3. Replace `handleGenerate()` with the async version\n4. Update `applyStyle()` signature and logic\n5. Update `init()` to call `renderApiKeySection()` and restore AI-generated themes\n\n\n6. Remove the old `showError` method since it's being replaced by `showGenerateError`\n\nLet me start implementing these changes carefully.","signature":"ErcJCkYICxgCKkA2674z5IPUc7QsumMUja+wWfEKWJpeWN4j0RVoTarxuYSv0dpssJbrNVhYyNHLlsv7LbmQCvDd50fT8LF7l2ytEgzFMYbPkt+CTiRFsJEaDPUv1jpA1seRMoKc8yIwhfiojOMopeHJkK61FIEBL5f0b6IJEcYIUWsgj1i0WTIdRCW+3uDOx0xV4G/6DfteKp4Itx7LY498exryMldREHqCYQUvZYRg7MncRooBI1TjqzUbpZbNLZirN8VhcIT6VjzNIGCV+StrAbqWD+H1Q150QFxVtyGETODlMtnA/PaeWBSDlLdZ1V46FUYhIjqokhBj5vZH/c8uD7qXnqknmcYneCBuXtzUzySHGAfZIT/sAafYnKW777n9ANNVSmMYVvo01JetPs0rVQAz2PTxP/eMN86/epVhxIuwu81vdQSY1oEgSVfMCe+F+gSAgw2dimS4xo8OTd+bYe5YQgUbTygaKk/ezyKreq2PXV4I4zYenZqQcw6Ew48cNeaO/BHipfF4rbDCODBN2jXogJ0nWkwt/Gtb0du3HV4oz4Cc2h5+KrGoOKiYhcbnzRZQ//Pws9Ltk6RNQZE5KB52yeSlq6UiJ95jb3CaIqPsG+1IfnfuoGMr0w574LvB5CCBRoumD88FsO23bgiealnWf5sg8vbxaVKtg7WBvM7Lh98zrWPp3u1gpwbUoc/ElWjDn6S8QkpaTfnwTi6NPhDvB89gWfO735IN4Porc2E7frmL2vFSoan+903UXuIeEFIzxzxxHpOOYIa6W6MrOm1CXBYeMuXuKAsmJgpUmpyk27lNjSpRQrtVNfYIRSNZT7w0/13H7JGa2nadILFuXB7y84z/rtuM3bgo+BwUaU9eN1Mh19mzPLM6LHibiSCXWPHa+zwppnuI8FtZ8Jdtm8cT0FiohsHKFYTKw2RQ+ui2Zqn5yAxf7PooOTgI7oJ415ALPRUdcp7G8elJdg0NrZ5UssqMXsj2UAegdvkdi16MoeTyddM6u9ktO8SAWuP6d8nIgz3cn8jb3KBN/s3TQKFKnLM1oIPic5yMox5SGwdev90VRnQljs1+GcEa5jbdAXASWva2ztBM0W14cll8Cdh5MsiDeaLocLUkz8RrSbpxNBc+eHbpLv7g+pnPw76SRBvCca3jp00W7NvIlUzk2xUPPCbPMyCnNOcE3HEMpRJdJkDRXB+kM7mvhHvcUmyQwAVVOygLli6lwAIPJJ/14g+x9XxGPLYX8cuI537kGwd6bxrc43ZDyDroaBHb1ha/phb4XOeFVZlei3NkPwemHCn9T0zwg2ot4MPaq/ibAd/22+UurFVsulNwCvX/tyihlnUHm8Zwsq3gIzDTity3K00fh3ly+9fUfX0LRmKVhznHO0UcWG4W13x92L7jyCNqyvcix9FJu7WkSs5NzvkTKyzaJF/gXpM299zDQYb3Tt+azuuUy7+DwlIydtzzaKBRpGIOTAS9N8hfmIsDm91LaG5xf38oBImYYqaENKXqhbw4pZ+WT7FyjMoEMNbvqHMVVbtfwjNtjGCg0MASqo/UEfhYdZV3aeXVMGPquya/yI61HXfo60Eo1V4v05TGIIyTxX1mE10r0xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":17988,"cache_read_input_tokens":25080,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":17988},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGo7TsuXBL2msr4L7zy","type":"assistant","uuid":"d3d0cbf1-e96c-484a-bf42-18359f6b682a","timestamp":"2026-02-22T14:34:32.049Z"}
{"parentUuid":"d3d0cbf1-e96c-484a-bf42-18359f6b682a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01TdbgoC7nP9g6n3byUbvbjw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UemV4Z8Xuy7F7PBxMKKZUi","name":"TaskCreate","input":{"subject":"Implement AI Theme Generation via Gemini API","description":"Add Gemini 2.0 Flash integration to gardener.js for AI-powered CSS theme generation. Steps: 1) Add GEMINI_SYSTEM_PROMPT constant, 2) Add API key management methods, 3) Add generateTheme/extractCss methods, 4) Add renderApiKeySection/showGenerateError/expandApiKeySection UI methods, 5) Replace handleGenerate with async version, 6) Update applyStyle signature, 7) Update init()","activeForm":"Implementing AI theme generation"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":17988,"cache_read_input_tokens":25080,"output_tokens":544,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":17988,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYPGo7TsuXBL2msr4L7zy","type":"assistant","uuid":"45f385e9-492d-4853-8c84-af5538429629","timestamp":"2026-02-22T14:34:34.305Z"}
{"parentUuid":"45f385e9-492d-4853-8c84-af5538429629","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UemV4Z8Xuy7F7PBxMKKZUi","type":"tool_result","content":"Task #1 created successfully: Implement AI Theme Generation via Gemini API"}]},"uuid":"c8a57300-a532-4e04-888e-7d1ade8e3b17","timestamp":"2026-02-22T14:34:34.310Z","toolUseResult":{"task":{"id":"1","subject":"Implement AI Theme Generation via Gemini API"}},"sourceToolAssistantUUID":"45f385e9-492d-4853-8c84-af5538429629"}
{"parentUuid":"c8a57300-a532-4e04-888e-7d1ade8e3b17","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01VsUfHUARUGGXiLin1n2J4d","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014tmFmQkW6N5nznbRksGkhM","name":"TaskUpdate","input":{"taskId":"1","status":"in_progress"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":563,"cache_read_input_tokens":43068,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":563},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGosqcVgTw7ZnPJYNz1","type":"assistant","uuid":"c2b93044-e1be-4539-ad19-6b6405b134f2","timestamp":"2026-02-22T14:34:35.952Z"}
{"parentUuid":"c2b93044-e1be-4539-ad19-6b6405b134f2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014tmFmQkW6N5nznbRksGkhM","type":"tool_result","content":"Updated task #1 status"}]},"uuid":"46838c84-b715-4e18-8cba-e917a66d0be8","timestamp":"2026-02-22T14:34:35.953Z","toolUseResult":{"success":true,"taskId":"1","updatedFields":["status"],"statusChange":{"from":"pending","to":"in_progress"}},"sourceToolAssistantUUID":"c2b93044-e1be-4539-ad19-6b6405b134f2"}
{"parentUuid":"46838c84-b715-4e18-8cba-e917a66d0be8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01C72AeQrEEY6yeTUmRZKjda","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll implement all the changes. Let me start with Step 1 — adding the `GEMINI_SYSTEM_PROMPT` constant:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":90,"cache_read_input_tokens":43631,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":90},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGp12D1eTj3frr6Dnpd","type":"assistant","uuid":"96e67994-5159-4ae6-8135-5cda2fd6b505","timestamp":"2026-02-22T14:34:37.675Z"}
{"type":"file-history-snapshot","messageId":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","snapshot":{"messageId":"3a2b7faa-5798-47c5-be1a-5a4f8e6976a0","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v1","version":1,"backupTime":"2026-02-22T14:34:45.643Z"}},"timestamp":"2026-02-22T14:34:21.205Z"},"isSnapshotUpdate":true}
{"parentUuid":"96e67994-5159-4ae6-8135-5cda2fd6b505","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01C72AeQrEEY6yeTUmRZKjda","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018RdLEuz7feB1VhMGvwEeSz","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';","new_string":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":90,"cache_read_input_tokens":43631,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":90},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGp12D1eTj3frr6Dnpd","type":"assistant","uuid":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","timestamp":"2026-02-22T14:34:45.641Z"}
{"parentUuid":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_018RdLEuz7feB1VhMGvwEeSz","toolUseID":"toolu_018RdLEuz7feB1VhMGvwEeSz","timestamp":"2026-02-22T14:34:45.646Z","uuid":"487e9811-d2b6-4c86-acdc-b6fe325053a3"}
{"parentUuid":"5e95d4e0-f697-42bb-bb0e-5962537d77bf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018RdLEuz7feB1VhMGvwEeSz","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"358797c1-21a5-4a7f-a68c-90ee6646aae9","timestamp":"2026-02-22T14:34:45.646Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';","newString":"const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":5,"oldLines":6,"newStart":5,"newLines":31,"lines":[" "," const BASE_URL = 'https://hacker-news.firebaseio.com/v0';"," ","+const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.","+Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.","+","+Define all of these CSS custom properties on :root, then optionally add component overrides:","+","+:root {","+    --bg:                  /* page background */;","+    --card-bg:             /* story card background */;","+    --text:                /* primary text */;","+    --subtext:             /* secondary/meta text */;","+    --accent:              /* links and accent */;","+    --header-bg:           /* header background (rgba allowed) */;","+    --font-main:           /* font stack */;","+    --item-radius:         /* card border-radius */;","+    --item-border:         /* border shorthand or none */;","+    --item-shadow:         /* box-shadow or none */;","+    --more-btn-bg:         /* More button background */;","+    --more-btn-color:      /* More button text color */;","+    --mobile-upvote-bg:    /* upvote bg on mobile */;","+    --mobile-upvote-color: /* upvote text on mobile */;","+}","+","+Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.","+Output nothing except the CSS.`;","+"," /**","  * System Core Styles (Layout, Typography Base, Responsive Logic)","  * Themes should override variables in :root or specific classes if needed."]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5e95d4e0-f697-42bb-bb0e-5962537d77bf"}
{"parentUuid":"358797c1-21a5-4a7f-a68c-90ee6646aae9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01BDCzyAypvAzQVNkZKi93Qk","type":"message","role":"assistant","content":[{"type":"text","text":"Now Step 2 — add new methods to the `App` object. I'll insert them before `handleGenerate`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":589,"cache_read_input_tokens":43721,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":589},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGpiMsp1VpHNZUDTyBc","type":"assistant","uuid":"6291c92b-5e9a-460d-8dd2-e6f461de9dda","timestamp":"2026-02-22T14:34:47.385Z"}
{"parentUuid":"6291c92b-5e9a-460d-8dd2-e6f461de9dda","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01BDCzyAypvAzQVNkZKi93Qk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MTa3geMpDJkuRK8Uj76iWy","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },","new_string":"    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":589,"cache_read_input_tokens":43721,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":589},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGpiMsp1VpHNZUDTyBc","type":"assistant","uuid":"bd65e73f-5d32-43be-990c-3226c0cbac75","timestamp":"2026-02-22T14:35:13.318Z"}
{"parentUuid":"bd65e73f-5d32-43be-990c-3226c0cbac75","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01MTa3geMpDJkuRK8Uj76iWy","toolUseID":"toolu_01MTa3geMpDJkuRK8Uj76iWy","timestamp":"2026-02-22T14:35:13.323Z","uuid":"cd5b3ecc-5464-4012-980c-1b7d09172de3"}
{"parentUuid":"bd65e73f-5d32-43be-990c-3226c0cbac75","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MTa3geMpDJkuRK8Uj76iWy","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"df105684-e7de-426d-8ca3-cf41a8ce5178","timestamp":"2026-02-22T14:35:13.323Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },","newString":"    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n\n        const style = this.matchStyle(input);\n        \n        if (style) {\n            this.applyStyle(style, input);\n            this.togglePresets(true);\n        } else {\n            this.showError();\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1140,"oldLines":18,"newStart":1140,"newLines":165,"lines":["             .replace(/'/g, \"&#039;\");","     },"," ","-    handleGenerate() {","+    getApiKey() {","+        return localStorage.getItem('acephale-gemini-key');","+    },","+","+    saveApiKey(key) {","+        localStorage.setItem('acephale-gemini-key', key.trim());","+    },","+","+    clearApiKey() {","+        localStorage.removeItem('acephale-gemini-key');","+        this.renderApiKeySection();","+    },","+","+    extractCss(text) {","+        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');","+        cleaned = cleaned.replace(/\\s*```\\s*$/, '');","+        return cleaned.trim();","+    },","+","+    async generateTheme(prompt) {","+        const key = this.getApiKey();","+        if (!key) throw new Error('NO_API_KEY');","+","+        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;","+        const body = {","+            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },","+            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],","+            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }","+        };","+","+        const response = await fetch(endpoint, {","+            method: 'POST',","+            headers: { 'Content-Type': 'application/json' },","+            body: JSON.stringify(body)","+        });","+","+        if (!response.ok) {","+            const status = response.status;","+            if (status === 400 || status === 403) throw new Error('INVALID_KEY');","+            if (status === 429) throw new Error('RATE_LIMIT');","+            throw new Error(`API_ERROR:${status}`);","+        }","+","+        const data = await response.json();","+        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;","+        if (!rawText) throw new Error('EMPTY_RESPONSE');","+        return this.extractCss(rawText);","+    },","+","+    renderApiKeySection() {","+        const existing = document.getElementById('api-key-section');","+        if (existing) existing.remove();","+","+        const section = document.createElement('div');","+        section.id = 'api-key-section';","+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';","+","+        if (this.getApiKey()) {","+            section.innerHTML = `","+                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">","+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>","+                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>","+                </div>`;","+            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());","+        } else {","+            section.innerHTML = `","+                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">","+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>","+                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>","+                </div>","+                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">","+                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">","+                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>","+                </div>`;","+            section.querySelector('#api-key-toggle').addEventListener('click', () => {","+                const form = section.querySelector('#api-key-form');","+                const icon = section.querySelector('#api-key-icon');","+                const isOpen = form.style.display !== 'none';","+                form.style.display = isOpen ? 'none' : 'flex';","+                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';","+            });","+            section.querySelector('#api-key-save-btn').addEventListener('click', () => {","+                const val = section.querySelector('#api-key-input').value.trim();","+                if (!val) return;","+                this.saveApiKey(val);","+                this.renderApiKeySection();","+            });","+        }","+","+        this.elements.themeControls.appendChild(section);","+    },","+","+    showGenerateError(err) {","+        let message;","+        switch (err.message) {","+            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;","+            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;","+            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","+            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;","+            default:              message = `Generation failed: ${err.message}`;","+        }","+        let errEl = document.getElementById('generate-error');","+        if (!errEl) {","+            errEl = document.createElement('div');","+            errEl.id = 'generate-error';","+            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';","+            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);","+        }","+        errEl.textContent = message;","+        clearTimeout(this._errorTimeout);","+        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);","+    },","+","+    expandApiKeySection() {","+        const form = document.getElementById('api-key-form');","+        const icon = document.getElementById('api-key-icon');","+        if (form && form.style.display === 'none') {","+            form.style.display = 'flex';","+            if (icon) icon.style.transform = 'rotate(0deg)';","+        }","+        this.elements.themeControls.classList.remove('is-minimized');","+        const input = document.getElementById('api-key-input');","+        if (input) setTimeout(() => input.focus(), 300);","+    },","+","+    async handleGenerate() {","         const input = this.elements.promptInput.value.trim();","         if (!input) return;","+        if (this._isGenerating) return;"," ","-        const style = this.matchStyle(input);","-        ","-        if (style) {","-            this.applyStyle(style, input);","+        const presetCss = this.matchStyle(input);","+        if (presetCss) {","+            this.applyStyle(presetCss, input);","             this.togglePresets(true);","-        } else {","-            this.showError();","+            return;","         }","+","+        if (!this.getApiKey()) {","+            this.expandApiKeySection();","+            return;","+        }","+","+        this._isGenerating = true;","+        const btn = this.elements.generateBtn;","+        const originalText = btn.textContent;","+        btn.textContent = 'Generating...';","+        btn.disabled = true;","+","+        try {","+            const css = await this.generateTheme(input);","+            this.applyStyle(css, null, input);","+            this.togglePresets(true);","+        } catch (err) {","+            this.showGenerateError(err);","+        } finally {","+            btn.textContent = originalText;","+            btn.disabled = false;","+            this._isGenerating = false;","+        }","     },"," ","     matchStyle(input) {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"bd65e73f-5d32-43be-990c-3226c0cbac75"}
{"parentUuid":"df105684-e7de-426d-8ca3-cf41a8ce5178","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01W7gNU37LDPnLbJk35RPKm2","type":"message","role":"assistant","content":[{"type":"text","text":"Now Step 4 — update `applyStyle()`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2307,"cache_read_input_tokens":44310,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2307},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGrkn3VqUtYz8JhTAW4","type":"assistant","uuid":"49f63cfc-da76-4af9-a317-e8c9225eed3c","timestamp":"2026-02-22T14:35:15.282Z"}
{"parentUuid":"49f63cfc-da76-4af9-a317-e8c9225eed3c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01W7gNU37LDPnLbJk35RPKm2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VKi2yMPWnYh1MGccyhXUNo","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }","new_string":"    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2307,"cache_read_input_tokens":44310,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2307},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGrkn3VqUtYz8JhTAW4","type":"assistant","uuid":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb","timestamp":"2026-02-22T14:35:22.595Z"}
{"parentUuid":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01VKi2yMPWnYh1MGccyhXUNo","toolUseID":"toolu_01VKi2yMPWnYh1MGccyhXUNo","timestamp":"2026-02-22T14:35:22.601Z","uuid":"0d462c38-97c3-4dce-91ca-04f8d461d9aa"}
{"parentUuid":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VKi2yMPWnYh1MGccyhXUNo","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"33b16794-3493-4bf6-bfdd-73f2c9e22c91","timestamp":"2026-02-22T14:35:22.600Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }","newString":"    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName) {\n        console.log(`Applying theme: ${themeName}`);\n        this.toggleMenu(false); // Close menu on theme change\n        \n        // Save to local storage for persistence\n        if (STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n        }\n\n        // Fallback for browsers that don't support View Transition API\n        if (!document.startViewTransition) {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n            return;\n        }\n\n        // Smooth transition using View Transition API\n        document.startViewTransition(() => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        });\n    },\n\n    showError() {\n        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n        alert(`Please enter a supported theme:\\n\"${available}\"`);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1309,"oldLines":30,"newStart":1309,"newLines":25,"lines":["         return null;","     },"," ","-    applyStyle(css, themeName) {","-        console.log(`Applying theme: ${themeName}`);","-        this.toggleMenu(false); // Close menu on theme change","-        ","-        // Save to local storage for persistence","-        if (STYLE_PRESETS[themeName]) {","+    applyStyle(css, themeName, customPrompt = null) {","+        this.toggleMenu(false);","+","+        if (themeName && STYLE_PRESETS[themeName]) {","             localStorage.setItem('acephale-theme', themeName);","+            localStorage.removeItem('acephale-custom-css');","+            localStorage.removeItem('acephale-custom-prompt');","+        } else if (customPrompt) {","+            localStorage.setItem('acephale-custom-css', css);","+            localStorage.setItem('acephale-custom-prompt', customPrompt);","+            localStorage.removeItem('acephale-theme');","         }"," ","-        // Fallback for browsers that don't support View Transition API","-        if (!document.startViewTransition) {","+        const applyFn = () => {","             this.elements.styleTag.textContent = SYSTEM_STYLE + css;","-            return;","-        }","+        };"," ","-        // Smooth transition using View Transition API","-        document.startViewTransition(() => {","-            this.elements.styleTag.textContent = SYSTEM_STYLE + css;","-        });","-    },","-","-    showError() {","-        const available = Object.keys(STYLE_PRESETS).join('\", \"');","-        alert(`Please enter a supported theme:\\n\"${available}\"`);","+        if (!document.startViewTransition) { applyFn(); return; }","+        document.startViewTransition(applyFn);","     }"," };"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"0312e53d-8a7a-4508-a3f0-4aa8b04c8bcb"}
{"parentUuid":"33b16794-3493-4bf6-bfdd-73f2c9e22c91","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LWyUSmNcpoKXszepU119GQ","type":"message","role":"assistant","content":[{"type":"text","text":"Now Step 5 — update `init()`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":641,"cache_read_input_tokens":46617,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":641},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsSG66ZA6tKbRWfrzo","type":"assistant","uuid":"02d6cd53-616c-4c18-b3e1-cadcc9eee458","timestamp":"2026-02-22T14:35:23.821Z"}
{"parentUuid":"02d6cd53-616c-4c18-b3e1-cadcc9eee458","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LWyUSmNcpoKXszepU119GQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XoKCHMqQBjgqyG9nES74sH","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },","new_string":"    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":641,"cache_read_input_tokens":46617,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":641},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsSG66ZA6tKbRWfrzo","type":"assistant","uuid":"08855215-c7f6-4d73-889e-8217fa51fc18","timestamp":"2026-02-22T14:35:29.291Z"}
{"parentUuid":"08855215-c7f6-4d73-889e-8217fa51fc18","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01XoKCHMqQBjgqyG9nES74sH","toolUseID":"toolu_01XoKCHMqQBjgqyG9nES74sH","timestamp":"2026-02-22T14:35:29.295Z","uuid":"69a0db94-6838-490a-98c9-e291ee1afa36"}
{"parentUuid":"08855215-c7f6-4d73-889e-8217fa51fc18","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XoKCHMqQBjgqyG9nES74sH","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"dffb2b16-32bd-49e7-8e19-9ed212198961","timestamp":"2026-02-22T14:35:29.294Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },","newString":"    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.bindEvents();\n        console.log(\"Generative UI - Architecture Refactored.\");\n        \n        // Restore saved theme or fallback to Minimalist\n        const savedTheme = localStorage.getItem('acephale-theme');\n        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n        \n        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n\n        // Initial load\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":906,"oldLines":16,"newStart":906,"newLines":21,"lines":[" ","     async init() {","         this.renderPresetButtons();","+        this.renderApiKeySection();","         this.bindEvents();","-        console.log(\"Generative UI - Architecture Refactored.\");","-        ","-        // Restore saved theme or fallback to Minimalist","-        const savedTheme = localStorage.getItem('acephale-theme');","-        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";","-        ","-        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);"," ","-        // Initial load","+        const savedPreset = localStorage.getItem('acephale-theme');","+        const savedCustom = localStorage.getItem('acephale-custom-css');","+        const savedPrompt = localStorage.getItem('acephale-custom-prompt');","+","+        if (savedCustom) {","+            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');","+            if (savedPrompt) this.elements.promptInput.value = savedPrompt;","+        } else {","+            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';","+            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);","+        }","+","         await this.loadInitial();","     },"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"08855215-c7f6-4d73-889e-8217fa51fc18"}
{"parentUuid":"dffb2b16-32bd-49e7-8e19-9ed212198961","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_016S3jvMbS9u49nAsiDPF76e","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to fix the `matchStyle()` call in the new `handleGenerate()` — the old `matchStyle` returns the CSS string, but we're now also calling `applyStyle` with the input as themeName. Let me check how `matchStyle` works and how `handleGenerate` uses it:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":557,"cache_read_input_tokens":47258,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":557},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsw8Ac9ZdACMAd8Ah9","type":"assistant","uuid":"0901bb75-700d-457e-87f8-b3ec776be156","timestamp":"2026-02-22T14:35:32.996Z"}
{"parentUuid":"0901bb75-700d-457e-87f8-b3ec776be156","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_016S3jvMbS9u49nAsiDPF76e","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BCFs3a2VbU24T7ov9nUcNr","name":"Grep","input":{"pattern":"matchStyle","file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":557,"cache_read_input_tokens":47258,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":557},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGsw8Ac9ZdACMAd8Ah9","type":"assistant","uuid":"3a8a9169-be7c-4313-ae63-0cf3b7ccdcca","timestamp":"2026-02-22T14:35:33.735Z"}
{"parentUuid":"3a8a9169-be7c-4313-ae63-0cf3b7ccdcca","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>InputValidationError: Grep failed due to the following issue:\nAn unexpected parameter `file_path` was provided</tool_use_error>","is_error":true,"tool_use_id":"toolu_01BCFs3a2VbU24T7ov9nUcNr"}]},"uuid":"f9e48c36-b73f-43f7-8fba-56f99547197a","timestamp":"2026-02-22T14:35:33.735Z","toolUseResult":"InputValidationError: [\n  {\n    \"code\": \"unrecognized_keys\",\n    \"keys\": [\n      \"file_path\"\n    ],\n    \"path\": [],\n    \"message\": \"Unrecognized key: \\\"file_path\\\"\"\n  }\n]","sourceToolAssistantUUID":"3a8a9169-be7c-4313-ae63-0cf3b7ccdcca"}
{"parentUuid":"f9e48c36-b73f-43f7-8fba-56f99547197a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LpAunsgpBebtSTCaBBd8Vy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RZwBvPc9sGB9VE8uBugog6","name":"Grep","input":{"pattern":"matchStyle","path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":376,"cache_read_input_tokens":47815,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":376},"output_tokens":19,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtGCt7sd9YBCz8FxuT","type":"assistant","uuid":"ef127d44-e668-433d-8c5e-88e00fd3eeeb","timestamp":"2026-02-22T14:35:35.454Z"}
{"parentUuid":"ef127d44-e668-433d-8c5e-88e00fd3eeeb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_01RZwBvPc9sGB9VE8uBugog6","toolUseID":"toolu_01RZwBvPc9sGB9VE8uBugog6","timestamp":"2026-02-22T14:35:35.762Z","uuid":"455e37a0-f1d3-43aa-a79e-633475968e09"}
{"parentUuid":"ef127d44-e668-433d-8c5e-88e00fd3eeeb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RZwBvPc9sGB9VE8uBugog6","type":"tool_result","content":"1278:        const presetCss = this.matchStyle(input);\n1309:    matchStyle(input) {"}]},"uuid":"68079487-da59-4cfa-be9a-a2ffcb637f11","timestamp":"2026-02-22T14:35:35.761Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1278:        const presetCss = this.matchStyle(input);\n1309:    matchStyle(input) {","numLines":2},"sourceToolAssistantUUID":"ef127d44-e668-433d-8c5e-88e00fd3eeeb"}
{"parentUuid":"68079487-da59-4cfa-be9a-a2ffcb637f11","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_011A4MhmX2WtekdjtUDY9dCt","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The `matchStyle` function returns the CSS string if a match is found. In the new `handleGenerate`, when we call `this.applyStyle(presetCss, input)`, we're passing `input` (e.g. \"minimalist\") as `themeName`. But `applyStyle` checks `STYLE_PRESETS[themeName]` which requires the exact key (e.g. \"Minimalist\"). \n\nThe `matchStyle` returns the CSS value, but we also need the matched key name. Let me look at the current `matchStyle` and `handleGenerate` code more carefully.\n\nIn the old `handleGenerate`:\n\n\nI'm calling `matchStyle` to find the CSS, then passing the user's raw input to `applyStyle` as the theme name. But `applyStyle` tries to look up that input directly in `STYLE_PRESETS`, which won't work because the user typed \"minimalist\" (lowercase) while the actual key is \"Minimalist\" (capitalized).\n\nThe fix is to have `matchStyle` return both the CSS and the matched key name from `STYLE_PRESETS`, so I can save the correct theme name to localStorage. the theme won't save if the case doesn't match exactly. I could fix this by having `matchStyle` return both the CSS and the matched preset key, then pass that key to `applyStyle` for proper storage. But looking at the plan, it specifies implementing `handleGenerate` exactly as written with the existing `matchStyle` behavior, so I'll stick with that approach even though it means the theme won't persist correctly on case mismatches.\n\nThe preset buttons bypass this issue entirely since they call `applyStyle` directly with the correct key from the preset object, so that path works fine. When a user types a preset name in `handleGenerate`, it'll apply the style but only save properly if the case matches exactly.\n\nUpdating applyStyle...","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":149,"cache_read_input_tokens":48191,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":149},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtQafC59Nv8g5GgQA2","type":"assistant","uuid":"9c591a0f-d54f-44ca-9b6d-96093998b977","timestamp":"2026-02-22T14:35:56.216Z"}
{"parentUuid":"9c591a0f-d54f-44ca-9b6d-96093998b977","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_011A4MhmX2WtekdjtUDY9dCt","type":"message","role":"assistant","content":[{"type":"text","text":"I need to check the interaction between `matchStyle` and `applyStyle` — the user input passed as `themeName` may not match the exact `STYLE_PRESETS` key. Let me update `matchStyle` to return both the key and CSS, fixing the localStorage saving:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":149,"cache_read_input_tokens":48191,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":149},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtQafC59Nv8g5GgQA2","type":"assistant","uuid":"b26ea366-7830-4255-983d-02a1823d6acd","timestamp":"2026-02-22T14:35:57.182Z"}
{"parentUuid":"b26ea366-7830-4255-983d-02a1823d6acd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_011A4MhmX2WtekdjtUDY9dCt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011WYduNN6stxB68g93RWhFG","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1270,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":149,"cache_read_input_tokens":48191,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":149},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGtQafC59Nv8g5GgQA2","type":"assistant","uuid":"501191e8-fbc9-4cc1-9715-a264a599e7d6","timestamp":"2026-02-22T14:35:57.908Z"}
{"parentUuid":"501191e8-fbc9-4cc1-9715-a264a599e7d6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_011WYduNN6stxB68g93RWhFG","toolUseID":"toolu_011WYduNN6stxB68g93RWhFG","timestamp":"2026-02-22T14:35:57.984Z","uuid":"0ec95002-7381-4b51-b680-fa59fb9e1a50"}
{"parentUuid":"501191e8-fbc9-4cc1-9715-a264a599e7d6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011WYduNN6stxB68g93RWhFG","type":"tool_result","content":"  1270→        if (input) setTimeout(() => input.focus(), 300);\n  1271→    },\n  1272→\n  1273→    async handleGenerate() {\n  1274→        const input = this.elements.promptInput.value.trim();\n  1275→        if (!input) return;\n  1276→        if (this._isGenerating) return;\n  1277→\n  1278→        const presetCss = this.matchStyle(input);\n  1279→        if (presetCss) {\n  1280→            this.applyStyle(presetCss, input);\n  1281→            this.togglePresets(true);\n  1282→            return;\n  1283→        }\n  1284→\n  1285→        if (!this.getApiKey()) {\n  1286→            this.expandApiKeySection();\n  1287→            return;\n  1288→        }\n  1289→\n  1290→        this._isGenerating = true;\n  1291→        const btn = this.elements.generateBtn;\n  1292→        const originalText = btn.textContent;\n  1293→        btn.textContent = 'Generating...';\n  1294→        btn.disabled = true;\n  1295→\n  1296→        try {\n  1297→            const css = await this.generateTheme(input);\n  1298→            this.applyStyle(css, null, input);\n  1299→            this.togglePresets(true);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ae88bb0f-d485-40eb-9461-545df2c43e33","timestamp":"2026-02-22T14:35:57.984Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);","numLines":30,"startLine":1270,"totalLines":1341}},"sourceToolAssistantUUID":"501191e8-fbc9-4cc1-9715-a264a599e7d6"}
{"parentUuid":"ae88bb0f-d485-40eb-9461-545df2c43e33","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01L9XGpvThKCFddnQS1QFkfw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QY2REXM9b79yBSjeWeyQti","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1305,"limit":25},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1906,"cache_read_input_tokens":48340,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1906},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGv3afefcsGK7FqHECF","type":"assistant","uuid":"4c9ef107-e343-4005-ba6b-46a70fc6aa45","timestamp":"2026-02-22T14:35:59.612Z"}
{"parentUuid":"4c9ef107-e343-4005-ba6b-46a70fc6aa45","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01QY2REXM9b79yBSjeWeyQti","toolUseID":"toolu_01QY2REXM9b79yBSjeWeyQti","timestamp":"2026-02-22T14:35:59.622Z","uuid":"13a43c4d-1bfc-437b-83e8-18ed7dc5982f"}
{"parentUuid":"4c9ef107-e343-4005-ba6b-46a70fc6aa45","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QY2REXM9b79yBSjeWeyQti","type":"tool_result","content":"  1305→            this._isGenerating = false;\n  1306→        }\n  1307→    },\n  1308→\n  1309→    matchStyle(input) {\n  1310→        const normalizedInput = input.toLowerCase();\n  1311→        for (const key in STYLE_PRESETS) {\n  1312→            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n  1313→        }\n  1314→        return null;\n  1315→    },\n  1316→\n  1317→    applyStyle(css, themeName, customPrompt = null) {\n  1318→        this.toggleMenu(false);\n  1319→\n  1320→        if (themeName && STYLE_PRESETS[themeName]) {\n  1321→            localStorage.setItem('acephale-theme', themeName);\n  1322→            localStorage.removeItem('acephale-custom-css');\n  1323→            localStorage.removeItem('acephale-custom-prompt');\n  1324→        } else if (customPrompt) {\n  1325→            localStorage.setItem('acephale-custom-css', css);\n  1326→            localStorage.setItem('acephale-custom-prompt', customPrompt);\n  1327→            localStorage.removeItem('acephale-theme');\n  1328→        }\n  1329→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8e7334d9-14c7-417d-94ee-8f7d088afd9d","timestamp":"2026-02-22T14:35:59.621Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n","numLines":25,"startLine":1305,"totalLines":1341}},"sourceToolAssistantUUID":"4c9ef107-e343-4005-ba6b-46a70fc6aa45"}
{"parentUuid":"8e7334d9-14c7-417d-94ee-8f7d088afd9d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HNbjvYcSfn7iYzepF5kE8V","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I see the issue: `matchStyle` returns the CSS value but not the key name. When `handleGenerate` calls `this.applyStyle(presetCss, input)`, `input` is the user's typed text (e.g., \"minimalist\") which won't exactly match a key in `STYLE_PRESETS` (e.g., \"Minimalist\"). So the localStorage save won't happen for preset matches via the input field.\n\nI'll update `matchStyle` to return the matched key name instead of the CSS, and update `handleGenerate` to look up the CSS from `STYLE_PRESETS` using the key name.","signature":"EqUFCkYICxgCKkBf3QN7dYbuiCtcD9r7RwMe8ua9vBQbsNlFzyN4c8zW/2u+dbZywQuyBwk7VtSL5gyMMzSB3nB5FjUURvrRBRS7EgxRFAp18j1256coCoMaDKFWi9uMlffAJUFTpSIw8Ueb6sT0dZ0o3GY6AJNiuD6XFDe8yAGHH9gHRgYijvVp+Mx5N+jyclYvwXlVYwcAKowERPBrQB0iNXkEZEhYhXyU7FM3pvYWQHJ6uhc2UDR4KYaRhOrSJuPWcVn+H1U+A7m2sTh23cO3M2V5BytuirMlaU0g1PLW1AuZ2ntgCFtrsC0lGtIejOrhOk24UcoFE0K7avneiuP+/heNgoYXLb55Smrsq14tMI4lCB4hrThSqdeze4ZQsfPINMG7rrRJI7EHV/0+Z97gyfLitEmKITMHt+paFJ44zEa/8FUr29CyiHgJjbO/NlJh8oyIpRFuGmDEtGsYLvF1eGOrHzIvj57qVREskIXtP1PyNe2aVTdgJ/A2rNHVfwlqUHCv2n07zV5ShwRGQvvAFUhbMxNXGqZvTiT3/lKLAoiQQ5InFms/vy/iUs9AnFDEsRInoyf55lK+NBedOiRBSlqcQn6RswtJ7vnKDhNpH+o7DdMdYB/ESZ3suMmTYgC67gguRMgAFnQGw7ihwyXw0IM4Wd5JsD658AuWJgZ7jrk+qjSGaS0uyE8YUutD6jQSN/YFQDT/S2YlroYPeMUv0Z++vbaLBLQhR6Ja4ju1Oeejbliz/te5t8FonqIlPtsqw4P/xwjIgonSuHzdpfOrZ07PujhcG1jiVitTaceyE7puxNaPSVo2qrIMXR0clPoAsPIZuctez+ZJeAJG3PY4bY82ELGS/J9dIP8tgqnvgnj6no0yS608b8Ig20KJx/unWMiqMsEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":50246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvArUPxyU4nBqBGsSA","type":"assistant","uuid":"9644f116-12cb-4480-afba-a929da76fd64","timestamp":"2026-02-22T14:36:03.829Z"}
{"parentUuid":"9644f116-12cb-4480-afba-a929da76fd64","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HNbjvYcSfn7iYzepF5kE8V","type":"message","role":"assistant","content":[{"type":"text","text":"I need to fix `matchStyle` to return the key name (not just CSS) so `applyStyle` can correctly save to localStorage. I'll update both `matchStyle` and `handleGenerate`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":50246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvArUPxyU4nBqBGsSA","type":"assistant","uuid":"09ca1203-b9c2-4c7b-b297-80dc568ec6e0","timestamp":"2026-02-22T14:36:05.088Z"}
{"parentUuid":"09ca1203-b9c2-4c7b-b297-80dc568ec6e0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HNbjvYcSfn7iYzepF5kE8V","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014gX1z5AewDG4aa6pQFvCct","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },","new_string":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":543,"cache_read_input_tokens":50246,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":543},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvArUPxyU4nBqBGsSA","type":"assistant","uuid":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c","timestamp":"2026-02-22T14:36:06.654Z"}
{"parentUuid":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_014gX1z5AewDG4aa6pQFvCct","toolUseID":"toolu_014gX1z5AewDG4aa6pQFvCct","timestamp":"2026-02-22T14:36:06.658Z","uuid":"102656fe-e6a6-4c23-b3b0-77605de045b7"}
{"parentUuid":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014gX1z5AewDG4aa6pQFvCct","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"d70d8f3a-e296-45b1-bbe0-4dca0971a590","timestamp":"2026-02-22T14:36:06.658Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },","newString":"    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1309,"oldLines":7,"newStart":1309,"newLines":7,"lines":["     matchStyle(input) {","         const normalizedInput = input.toLowerCase();","         for (const key in STYLE_PRESETS) {","-            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];","+            if (normalizedInput.includes(key.toLowerCase())) return key;","         }","         return null;","     },"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ca8f5eb5-1b1b-4e8f-b182-45aa2689a85c"}
{"parentUuid":"d70d8f3a-e296-45b1-bbe0-4dca0971a590","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01UwqN8iYrpRRCuhLE2rtUpo","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }","new_string":"        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":503,"cache_read_input_tokens":50789,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":503},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvgs1JCGjvRdQ7hnF6","type":"assistant","uuid":"f042d611-60e8-4cdc-8adb-43928d9171bb","timestamp":"2026-02-22T14:36:09.687Z"}
{"parentUuid":"f042d611-60e8-4cdc-8adb-43928d9171bb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","toolUseID":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","timestamp":"2026-02-22T14:36:09.693Z","uuid":"f4dfba0a-08a0-4ac2-b692-a5aa2d3f15d3"}
{"parentUuid":"f042d611-60e8-4cdc-8adb-43928d9171bb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XH2ZZYuKY8yXXHFVN4F9by","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"c808059c-50ac-4585-989d-974d3032e52a","timestamp":"2026-02-22T14:36:09.692Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }","newString":"        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetCss = this.matchStyle(input);\n        if (presetCss) {\n            this.applyStyle(presetCss, input);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1275,"oldLines":9,"newStart":1275,"newLines":9,"lines":["         if (!input) return;","         if (this._isGenerating) return;"," ","-        const presetCss = this.matchStyle(input);","-        if (presetCss) {","-            this.applyStyle(presetCss, input);","+        const presetKey = this.matchStyle(input);","+        if (presetKey) {","+            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);","             this.togglePresets(true);","             return;","         }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f042d611-60e8-4cdc-8adb-43928d9171bb"}
{"parentUuid":"c808059c-50ac-4585-989d-974d3032e52a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01XK69VqmgqJSzk3MEYWfkrj","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me verify the final state of the key sections of the file:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":285,"cache_read_input_tokens":51292,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":285},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvudxWekVxga4tk293","type":"assistant","uuid":"0942eec2-0a2d-4d9a-aa00-173a162eb27f","timestamp":"2026-02-22T14:36:11.230Z"}
{"parentUuid":"0942eec2-0a2d-4d9a-aa00-173a162eb27f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01XK69VqmgqJSzk3MEYWfkrj","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0135eSfTujK1i4kHGev27Nr5","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":285,"cache_read_input_tokens":51292,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":285},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGvudxWekVxga4tk293","type":"assistant","uuid":"b380e773-024e-4e45-ad0c-435313b2d2cc","timestamp":"2026-02-22T14:36:11.954Z"}
{"parentUuid":"b380e773-024e-4e45-ad0c-435313b2d2cc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_0135eSfTujK1i4kHGev27Nr5","toolUseID":"toolu_0135eSfTujK1i4kHGev27Nr5","timestamp":"2026-02-22T14:36:11.972Z","uuid":"8e37b299-3de1-46ef-8a40-bea56198e32b"}
{"parentUuid":"b380e773-024e-4e45-ad0c-435313b2d2cc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0135eSfTujK1i4kHGev27Nr5","type":"tool_result","content":"     1→/**\n     2→ * Acephale OS | Gardener.js\n     3→ * Hacker News Interface Styling & Data Fetching\n     4→ */\n     5→\n     6→const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n     7→\n     8→const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n     9→Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n    10→\n    11→Define all of these CSS custom properties on :root, then optionally add component overrides:\n    12→\n    13→:root {\n    14→    --bg:                  /* page background */;\n    15→    --card-bg:             /* story card background */;\n    16→    --text:                /* primary text */;\n    17→    --subtext:             /* secondary/meta text */;\n    18→    --accent:              /* links and accent */;\n    19→    --header-bg:           /* header background (rgba allowed) */;\n    20→    --font-main:           /* font stack */;\n    21→    --item-radius:         /* card border-radius */;\n    22→    --item-border:         /* border shorthand or none */;\n    23→    --item-shadow:         /* box-shadow or none */;\n    24→    --more-btn-bg:         /* More button background */;\n    25→    --more-btn-color:      /* More button text color */;\n    26→    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    27→    --mobile-upvote-color: /* upvote text on mobile */;\n    28→}\n    29→\n    30→Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7843eb03-bc50-4c3c-b761-abf8f4a75387","timestamp":"2026-02-22T14:36:11.971Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.","numLines":30,"startLine":1,"totalLines":1341}},"sourceToolAssistantUUID":"b380e773-024e-4e45-ad0c-435313b2d2cc"}
{"parentUuid":"7843eb03-bc50-4c3c-b761-abf8f4a75387","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_0164UttQjZT7CC48tUHdBrNh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VJz8KkQpRaBPkZPHoex4mh","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":980,"limit":60},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":702,"cache_read_input_tokens":51577,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":702},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGw5gCNwGADZVYYdwQT","type":"assistant","uuid":"ab7666d3-cf62-45aa-a11d-b17c3e31c489","timestamp":"2026-02-22T14:36:13.833Z"}
{"parentUuid":"ab7666d3-cf62-45aa-a11d-b17c3e31c489","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01VJz8KkQpRaBPkZPHoex4mh","toolUseID":"toolu_01VJz8KkQpRaBPkZPHoex4mh","timestamp":"2026-02-22T14:36:13.847Z","uuid":"c104aa78-5291-4a92-a97f-82c518c46403"}
{"parentUuid":"ab7666d3-cf62-45aa-a11d-b17c3e31c489","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VJz8KkQpRaBPkZPHoex4mh","type":"tool_result","content":"   980→                if (!isDragging) return;\n   981→                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n   982→                const deltaX = clientX - startX;\n   983→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n   984→\n   985→                if (!isMin && deltaX > 0) {\n   986→                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n   987→                } else if (isMin && deltaX < 0) {\n   988→                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n   989→                }\n   990→            };\n   991→\n   992→            const endDrag = (e) => {\n   993→                if (!isDragging) return;\n   994→                isDragging = false;\n   995→                this.elements.themeControls.style.transition = '';\n   996→                \n   997→                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n   998→                const deltaX = clientX - startX;\n   999→                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n  1000→\n  1001→                this.elements.themeControls.style.transform = '';\n  1002→\n  1003→                if (Math.abs(deltaX) < 10) {\n  1004→                    this.elements.themeControls.classList.toggle('is-minimized');\n  1005→                } else {\n  1006→                    if (!isMin && deltaX > threshold) {\n  1007→                        this.elements.themeControls.classList.add('is-minimized');\n  1008→                    } else if (isMin && deltaX < -threshold) {\n  1009→                        this.elements.themeControls.classList.remove('is-minimized');\n  1010→                    }\n  1011→                }\n  1012→            };\n  1013→\n  1014→            const handle = this.elements.panelHandle;\n  1015→            handle.addEventListener('mousedown', startDrag);\n  1016→            handle.addEventListener('touchstart', startDrag, {passive: true});\n  1017→            \n  1018→            document.addEventListener('mousemove', doDrag);\n  1019→            document.addEventListener('touchmove', doDrag, {passive: true});\n  1020→            \n  1021→            document.addEventListener('mouseup', endDrag);\n  1022→            document.addEventListener('touchend', endDrag);\n  1023→        }\n  1024→        \n  1025→        // Handle navigation\n  1026→        this.elements.navLinks.addEventListener('click', (e) => {\n  1027→            if (e.target.tagName === 'A') {\n  1028→                e.preventDefault();\n  1029→                const type = e.target.textContent.trim().toLowerCase();\n  1030→                \n  1031→                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n  1032→                    this.switchFeed(type);\n  1033→                } else if (type === 'submit') {\n  1034→                    this.toggleMenu(false);\n  1035→                    window.open('https://news.ycombinator.com/submit', '_blank');\n  1036→                } else {\n  1037→                    this.toggleMenu(false);\n  1038→                    alert('This feature is currently unavailable in the Generative UI.');\n  1039→                }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5ba0dfac-1aaf-4889-9fdf-f44696ef6a4d","timestamp":"2026-02-22T14:36:13.846Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }","numLines":60,"startLine":980,"totalLines":1341}},"sourceToolAssistantUUID":"ab7666d3-cf62-45aa-a11d-b17c3e31c489"}
{"parentUuid":"5ba0dfac-1aaf-4889-9fdf-f44696ef6a4d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01MsU8tHYA2NG7wxWwgPWFfg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1100,"limit":120},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1281,"cache_read_input_tokens":52279,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1281},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwDcwL6wMQLfukYsrv","type":"assistant","uuid":"87136c38-e273-4095-8cd6-a9b43899a24b","timestamp":"2026-02-22T14:36:16.457Z"}
{"parentUuid":"87136c38-e273-4095-8cd6-a9b43899a24b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","toolUseID":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","timestamp":"2026-02-22T14:36:16.465Z","uuid":"bed967fa-e5ed-4e2e-94a9-e07de13887f1"}
{"parentUuid":"87136c38-e273-4095-8cd6-a9b43899a24b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Whbc2JYWzdN2ZtKLYACzfF","type":"tool_result","content":"  1100→\n  1101→    renderStories(stories, append = false) {\n  1102→        if (!append) {\n  1103→            this.elements.listElement.innerHTML = '';\n  1104→        }\n  1105→\n  1106→        stories.forEach((story, index) => {\n  1107→            if (!story) return;\n  1108→            \n  1109→            const rank = this.currentOffset + index + 1;\n  1110→            const domain = story.url ? new URL(story.url).hostname : '';\n  1111→            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n  1112→            const timeAgo = HNData.formatTime(story.time);\n  1113→            \n  1114→            // Escape HTML in user content\n  1115→            const title = this.escapeHtml(story.title || '');\n  1116→            const author = this.escapeHtml(story.by || '');\n  1117→\n  1118→            const listItem = document.createElement('li');\n  1119→            listItem.className = 'hn-story-item';\n  1120→            listItem.innerHTML = `\n  1121→                <div class=\"hn-story-rank\">${rank}</div>\n  1122→                <div class=\"hn-story-content\">\n  1123→                    <div class=\"hn-story-title-row\">\n  1124→                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n  1125→                        ${domainHtml}\n  1126→                    </div>\n  1127→                    <div class=\"hn-story-meta\">\n  1128→                        <span class=\"hn-story-points\">${story.score} pts</span> • \n  1129→                        <span class=\"hn-story-author\">${author}</span> • \n  1130→                        <span class=\"hn-story-time\">${timeAgo}</span>\n  1131→                    </div>\n  1132→                </div>\n  1133→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n  1134→            `;\n  1135→            this.elements.listElement.appendChild(listItem);\n  1136→        });\n  1137→    },\n  1138→\n  1139→    escapeHtml(unsafe) {\n  1140→        return unsafe\n  1141→            .replace(/&/g, \"&amp;\")\n  1142→            .replace(/</g, \"&lt;\")\n  1143→            .replace(/>/g, \"&gt;\")\n  1144→            .replace(/\"/g, \"&quot;\")\n  1145→            .replace(/'/g, \"&#039;\");\n  1146→    },\n  1147→\n  1148→    getApiKey() {\n  1149→        return localStorage.getItem('acephale-gemini-key');\n  1150→    },\n  1151→\n  1152→    saveApiKey(key) {\n  1153→        localStorage.setItem('acephale-gemini-key', key.trim());\n  1154→    },\n  1155→\n  1156→    clearApiKey() {\n  1157→        localStorage.removeItem('acephale-gemini-key');\n  1158→        this.renderApiKeySection();\n  1159→    },\n  1160→\n  1161→    extractCss(text) {\n  1162→        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n  1163→        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n  1164→        return cleaned.trim();\n  1165→    },\n  1166→\n  1167→    async generateTheme(prompt) {\n  1168→        const key = this.getApiKey();\n  1169→        if (!key) throw new Error('NO_API_KEY');\n  1170→\n  1171→        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n  1172→        const body = {\n  1173→            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n  1174→            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n  1175→            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n  1176→        };\n  1177→\n  1178→        const response = await fetch(endpoint, {\n  1179→            method: 'POST',\n  1180→            headers: { 'Content-Type': 'application/json' },\n  1181→            body: JSON.stringify(body)\n  1182→        });\n  1183→\n  1184→        if (!response.ok) {\n  1185→            const status = response.status;\n  1186→            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n  1187→            if (status === 429) throw new Error('RATE_LIMIT');\n  1188→            throw new Error(`API_ERROR:${status}`);\n  1189→        }\n  1190→\n  1191→        const data = await response.json();\n  1192→        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n  1193→        if (!rawText) throw new Error('EMPTY_RESPONSE');\n  1194→        return this.extractCss(rawText);\n  1195→    },\n  1196→\n  1197→    renderApiKeySection() {\n  1198→        const existing = document.getElementById('api-key-section');\n  1199→        if (existing) existing.remove();\n  1200→\n  1201→        const section = document.createElement('div');\n  1202→        section.id = 'api-key-section';\n  1203→        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n  1204→\n  1205→        if (this.getApiKey()) {\n  1206→            section.innerHTML = `\n  1207→                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n  1208→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n  1209→                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n  1210→                </div>`;\n  1211→            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n  1212→        } else {\n  1213→            section.innerHTML = `\n  1214→                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n  1215→                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n  1216→                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n  1217→                </div>\n  1218→                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n  1219→                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"25e140b3-a120-4270-a1ab-95438b811f85","timestamp":"2026-02-22T14:36:16.464Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">","numLines":120,"startLine":1100,"totalLines":1341}},"sourceToolAssistantUUID":"87136c38-e273-4095-8cd6-a9b43899a24b"}
{"parentUuid":"25e140b3-a120-4270-a1ab-95438b811f85","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01VsmG6jAJgq43C2tT67cp9k","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01X3FcYTwgDZhCruKwUENAgL","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1220,"limit":120},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2247,"cache_read_input_tokens":53560,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2247},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwQp8uhSeNqVHKtrvU","type":"assistant","uuid":"7e07ca0c-b040-46dd-a2b3-ad37479257c3","timestamp":"2026-02-22T14:36:19.363Z"}
{"parentUuid":"7e07ca0c-b040-46dd-a2b3-ad37479257c3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01X3FcYTwgDZhCruKwUENAgL","toolUseID":"toolu_01X3FcYTwgDZhCruKwUENAgL","timestamp":"2026-02-22T14:36:19.373Z","uuid":"2cde12c2-627f-4ab0-af83-b0af78b32445"}
{"parentUuid":"7e07ca0c-b040-46dd-a2b3-ad37479257c3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01X3FcYTwgDZhCruKwUENAgL","type":"tool_result","content":"  1220→                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n  1221→                </div>`;\n  1222→            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n  1223→                const form = section.querySelector('#api-key-form');\n  1224→                const icon = section.querySelector('#api-key-icon');\n  1225→                const isOpen = form.style.display !== 'none';\n  1226→                form.style.display = isOpen ? 'none' : 'flex';\n  1227→                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n  1228→            });\n  1229→            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n  1230→                const val = section.querySelector('#api-key-input').value.trim();\n  1231→                if (!val) return;\n  1232→                this.saveApiKey(val);\n  1233→                this.renderApiKeySection();\n  1234→            });\n  1235→        }\n  1236→\n  1237→        this.elements.themeControls.appendChild(section);\n  1238→    },\n  1239→\n  1240→    showGenerateError(err) {\n  1241→        let message;\n  1242→        switch (err.message) {\n  1243→            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n  1244→            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n  1245→            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n  1246→            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n  1247→            default:              message = `Generation failed: ${err.message}`;\n  1248→        }\n  1249→        let errEl = document.getElementById('generate-error');\n  1250→        if (!errEl) {\n  1251→            errEl = document.createElement('div');\n  1252→            errEl.id = 'generate-error';\n  1253→            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n  1254→            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n  1255→        }\n  1256→        errEl.textContent = message;\n  1257→        clearTimeout(this._errorTimeout);\n  1258→        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n  1259→    },\n  1260→\n  1261→    expandApiKeySection() {\n  1262→        const form = document.getElementById('api-key-form');\n  1263→        const icon = document.getElementById('api-key-icon');\n  1264→        if (form && form.style.display === 'none') {\n  1265→            form.style.display = 'flex';\n  1266→            if (icon) icon.style.transform = 'rotate(0deg)';\n  1267→        }\n  1268→        this.elements.themeControls.classList.remove('is-minimized');\n  1269→        const input = document.getElementById('api-key-input');\n  1270→        if (input) setTimeout(() => input.focus(), 300);\n  1271→    },\n  1272→\n  1273→    async handleGenerate() {\n  1274→        const input = this.elements.promptInput.value.trim();\n  1275→        if (!input) return;\n  1276→        if (this._isGenerating) return;\n  1277→\n  1278→        const presetKey = this.matchStyle(input);\n  1279→        if (presetKey) {\n  1280→            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n  1281→            this.togglePresets(true);\n  1282→            return;\n  1283→        }\n  1284→\n  1285→        if (!this.getApiKey()) {\n  1286→            this.expandApiKeySection();\n  1287→            return;\n  1288→        }\n  1289→\n  1290→        this._isGenerating = true;\n  1291→        const btn = this.elements.generateBtn;\n  1292→        const originalText = btn.textContent;\n  1293→        btn.textContent = 'Generating...';\n  1294→        btn.disabled = true;\n  1295→\n  1296→        try {\n  1297→            const css = await this.generateTheme(input);\n  1298→            this.applyStyle(css, null, input);\n  1299→            this.togglePresets(true);\n  1300→        } catch (err) {\n  1301→            this.showGenerateError(err);\n  1302→        } finally {\n  1303→            btn.textContent = originalText;\n  1304→            btn.disabled = false;\n  1305→            this._isGenerating = false;\n  1306→        }\n  1307→    },\n  1308→\n  1309→    matchStyle(input) {\n  1310→        const normalizedInput = input.toLowerCase();\n  1311→        for (const key in STYLE_PRESETS) {\n  1312→            if (normalizedInput.includes(key.toLowerCase())) return key;\n  1313→        }\n  1314→        return null;\n  1315→    },\n  1316→\n  1317→    applyStyle(css, themeName, customPrompt = null) {\n  1318→        this.toggleMenu(false);\n  1319→\n  1320→        if (themeName && STYLE_PRESETS[themeName]) {\n  1321→            localStorage.setItem('acephale-theme', themeName);\n  1322→            localStorage.removeItem('acephale-custom-css');\n  1323→            localStorage.removeItem('acephale-custom-prompt');\n  1324→        } else if (customPrompt) {\n  1325→            localStorage.setItem('acephale-custom-css', css);\n  1326→            localStorage.setItem('acephale-custom-prompt', customPrompt);\n  1327→            localStorage.removeItem('acephale-theme');\n  1328→        }\n  1329→\n  1330→        const applyFn = () => {\n  1331→            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n  1332→        };\n  1333→\n  1334→        if (!document.startViewTransition) { applyFn(); return; }\n  1335→        document.startViewTransition(applyFn);\n  1336→    }\n  1337→};\n  1338→\n  1339→// Start the application\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8bd5ad82-b829-4c15-8210-367aa5c346ea","timestamp":"2026-02-22T14:36:19.372Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application","numLines":120,"startLine":1220,"totalLines":1341}},"sourceToolAssistantUUID":"7e07ca0c-b040-46dd-a2b3-ad37479257c3"}
{"parentUuid":"8bd5ad82-b829-4c15-8210-367aa5c346ea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01SLNY7GRB1b1tVEz2AXsm5Q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019KJbkyBSNumB9WFe6hNj1V","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":905,"limit":40},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2004,"cache_read_input_tokens":55807,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2004},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwdHUjfosHkGaLcNcR","type":"assistant","uuid":"1689422e-6858-436e-a42f-81c7cb920faf","timestamp":"2026-02-22T14:36:21.905Z"}
{"parentUuid":"1689422e-6858-436e-a42f-81c7cb920faf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_019KJbkyBSNumB9WFe6hNj1V","toolUseID":"toolu_019KJbkyBSNumB9WFe6hNj1V","timestamp":"2026-02-22T14:36:21.917Z","uuid":"73d918d7-dd8e-4234-984e-57dc268cee22"}
{"parentUuid":"1689422e-6858-436e-a42f-81c7cb920faf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019KJbkyBSNumB9WFe6hNj1V","type":"tool_result","content":"   905→    },\n   906→\n   907→    async init() {\n   908→        this.renderPresetButtons();\n   909→        this.renderApiKeySection();\n   910→        this.bindEvents();\n   911→\n   912→        const savedPreset = localStorage.getItem('acephale-theme');\n   913→        const savedCustom = localStorage.getItem('acephale-custom-css');\n   914→        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n   915→\n   916→        if (savedCustom) {\n   917→            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n   918→            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n   919→        } else {\n   920→            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n   921→            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n   922→        }\n   923→\n   924→        await this.loadInitial();\n   925→    },\n   926→\n   927→    renderPresetButtons() {\n   928→        this.elements.presetButtons.innerHTML = '';\n   929→        Object.keys(STYLE_PRESETS).forEach(themeName => {\n   930→            const btn = document.createElement('button');\n   931→            btn.textContent = themeName;\n   932→            btn.style.cssText = `\n   933→                padding: 6px 12px;\n   934→                background: rgba(0,0,0,0.05);\n   935→                border: 1px solid rgba(0,0,0,0.1);\n   936→                border-radius: 6px;\n   937→                font-size: 12px;\n   938→                font-weight: 500;\n   939→                cursor: pointer;\n   940→                transition: all 0.2s;\n   941→                color: var(--text);\n   942→                flex-shrink: 0;\n   943→            `;\n   944→            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2ba9989d-3ef8-4d5e-9bf5-b077e83e8d37","timestamp":"2026-02-22T14:36:21.916Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };","numLines":40,"startLine":905,"totalLines":1341}},"sourceToolAssistantUUID":"1689422e-6858-436e-a42f-81c7cb920faf"}
{"parentUuid":"2ba9989d-3ef8-4d5e-9bf5-b077e83e8d37","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01KGzHaTLYhBV4ATSxkmzd6J","type":"message","role":"assistant","content":[{"type":"text","text":"Everything looks correct. Let me do a final check to ensure there are no remaining references to the old `showError` method:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":773,"cache_read_input_tokens":57811,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":773},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwosDa5kTuXqzNeg4J","type":"assistant","uuid":"44a37241-922b-4da3-8f10-8484213f4a16","timestamp":"2026-02-22T14:36:23.604Z"}
{"parentUuid":"44a37241-922b-4da3-8f10-8484213f4a16","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01KGzHaTLYhBV4ATSxkmzd6J","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018dmMTWv9Jp42aEvHvNnv4y","name":"Grep","input":{"pattern":"showError","path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","output_mode":"content"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":773,"cache_read_input_tokens":57811,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":773},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGwosDa5kTuXqzNeg4J","type":"assistant","uuid":"85db4133-7007-46ca-9341-c28157582296","timestamp":"2026-02-22T14:36:24.467Z"}
{"parentUuid":"85db4133-7007-46ca-9341-c28157582296","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Grep","command":"callback"},"parentToolUseID":"toolu_018dmMTWv9Jp42aEvHvNnv4y","toolUseID":"toolu_018dmMTWv9Jp42aEvHvNnv4y","timestamp":"2026-02-22T14:36:24.925Z","uuid":"9ed46cb1-40cc-4863-9e23-53d0accc2e31"}
{"parentUuid":"85db4133-7007-46ca-9341-c28157582296","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018dmMTWv9Jp42aEvHvNnv4y","type":"tool_result","content":"No matches found"}]},"uuid":"5676f08d-1e3f-4f4a-b3a9-12f419fef898","timestamp":"2026-02-22T14:36:24.924Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"","numLines":0},"sourceToolAssistantUUID":"85db4133-7007-46ca-9341-c28157582296"}
{"parentUuid":"5676f08d-1e3f-4f4a-b3a9-12f419fef898","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_0136yDBLAKPbQ9LKffidsmya","type":"message","role":"assistant","content":[{"type":"text","text":"Good, the old `showError` is gone. Let me also verify line count to confirm the file is complete:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":151,"cache_read_input_tokens":58584,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":151},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGx2hPnR3EDNpBvtFYa","type":"assistant","uuid":"7d9ce31c-9c85-4f1d-a2a9-9508542b69b3","timestamp":"2026-02-22T14:36:26.623Z"}
{"parentUuid":"7d9ce31c-9c85-4f1d-a2a9-9508542b69b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_0136yDBLAKPbQ9LKffidsmya","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QStiyi3oaDNDmNgrYAERcq","name":"Bash","input":{"command":"wc -l /Users/turtlekazu/ReactProjects/acephale/gardener.js","description":"Count lines in gardener.js"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":151,"cache_read_input_tokens":58584,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":151},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGx2hPnR3EDNpBvtFYa","type":"assistant","uuid":"3f6afaf4-7d7f-457a-ab99-18b69fc9b560","timestamp":"2026-02-22T14:36:27.310Z"}
{"parentUuid":"3f6afaf4-7d7f-457a-ab99-18b69fc9b560","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QStiyi3oaDNDmNgrYAERcq","type":"tool_result","content":"    1340 /Users/turtlekazu/ReactProjects/acephale/gardener.js","is_error":false}]},"uuid":"0f561833-88af-4f4d-8da5-c0df4892ed4a","timestamp":"2026-02-22T14:36:27.452Z","toolUseResult":{"stdout":"    1340 /Users/turtlekazu/ReactProjects/acephale/gardener.js","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"3f6afaf4-7d7f-457a-ab99-18b69fc9b560"}
{"parentUuid":"0f561833-88af-4f4d-8da5-c0df4892ed4a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_017LTbR2jTScD7xqPJSV6set","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1337,"limit":4},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":161,"cache_read_input_tokens":58735,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":161},"output_tokens":24,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGxDXWQeFJUuGKVWiTW","type":"assistant","uuid":"665100d1-8714-4c06-8d73-2f3e49f38c14","timestamp":"2026-02-22T14:36:29.192Z"}
{"parentUuid":"665100d1-8714-4c06-8d73-2f3e49f38c14","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","toolUseID":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","timestamp":"2026-02-22T14:36:29.208Z","uuid":"69823556-65a5-4e24-987c-be5581f09acc"}
{"parentUuid":"665100d1-8714-4c06-8d73-2f3e49f38c14","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MYCP1BDMwLz2X2MWR1JW1w","type":"tool_result","content":"  1337→};\n  1338→\n  1339→// Start the application\n  1340→document.addEventListener('DOMContentLoaded', () => App.init());\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3897bdf9-3957-4552-945b-eed3921750f4","timestamp":"2026-02-22T14:36:29.206Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());","numLines":4,"startLine":1337,"totalLines":1341}},"sourceToolAssistantUUID":"665100d1-8714-4c06-8d73-2f3e49f38c14"}
{"parentUuid":"3897bdf9-3957-4552-945b-eed3921750f4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01355gfDdmXsxW5gHA7n4M6h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Uuk4tzPuFtDUSCChkaaABY","name":"TaskUpdate","input":{"taskId":"1","status":"completed"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":240,"cache_read_input_tokens":58896,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":240},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGxMKKjiy3Y68esS7df","type":"assistant","uuid":"a4c1925f-0ed8-4f61-a14b-3fd8aa059807","timestamp":"2026-02-22T14:36:30.898Z"}
{"parentUuid":"a4c1925f-0ed8-4f61-a14b-3fd8aa059807","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Uuk4tzPuFtDUSCChkaaABY","type":"tool_result","content":"Updated task #1 status"}]},"uuid":"5f75a2d9-1d4b-4234-a9b0-5b156fe20299","timestamp":"2026-02-22T14:36:30.902Z","toolUseResult":{"success":true,"taskId":"1","updatedFields":["status"],"statusChange":{"from":"in_progress","to":"completed"}},"sourceToolAssistantUUID":"a4c1925f-0ed8-4f61-a14b-3fd8aa059807"}
{"parentUuid":"5f75a2d9-1d4b-4234-a9b0-5b156fe20299","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_017eLe2vtnx8Lz1SrAFkp2so","type":"message","role":"assistant","content":[{"type":"text","text":"All changes are complete. Here's a summary of what was implemented in `gardener.js`:\n\n**Step 1** — Added `GEMINI_SYSTEM_PROMPT` constant after `BASE_URL`, instructing Gemini to output raw CSS only with all required custom properties.\n\n**Step 2** — Added 8 new methods to `App`:\n- `getApiKey()` / `saveApiKey()` / `clearApiKey()` — localStorage key management\n- `extractCss()` — strips markdown fences if Gemini wraps its output\n- `generateTheme()` — async Gemini 2.0 Flash API call with structured error handling (400/403 → INVALID_KEY, 429 → RATE_LIMIT)\n- `renderApiKeySection()` — renders either \"Gemini AI: enabled + clear\" or the collapsed \"GEMINI API KEY ▼\" form into `#theme-controls`\n- `showGenerateError()` — inline error display (no more `alert()`), auto-clears after 5s\n- `expandApiKeySection()` — opens the API key form and focuses the input\n\n**Step 3** — Replaced `handleGenerate()` with async version: preset match → apply preset; no key → expand key section; otherwise → call Gemini with loading state guard.\n\n**Step 4** — Updated `applyStyle(css, themeName, customPrompt)` to persist AI-generated CSS to `acephale-custom-css`/`acephale-custom-prompt` and clear them when switching to a preset.\n\n**Step 5** — Updated `init()` to call `renderApiKeySection()` and restore AI-generated themes from localStorage on page load.\n\n**Fix** — `matchStyle()` now returns the matched preset key name (not CSS), so `applyStyle` can correctly save the preset name to localStorage."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":88,"cache_read_input_tokens":59136,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":88},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPGxUdcFDfjNTKhrQd8f","type":"assistant","uuid":"8499604b-4977-4fd9-b07c-6c65ab379987","timestamp":"2026-02-22T14:36:43.536Z"}
{"parentUuid":"8499604b-4977-4fd9-b07c-6c65ab379987","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"cc411e8b-9aaa-49c2-be88-6d80236c01fd","toolUseID":"cc411e8b-9aaa-49c2-be88-6d80236c01fd","timestamp":"2026-02-22T14:36:43.608Z","uuid":"7ca5886d-b951-4607-a325-e8cc96e587cd"}
{"parentUuid":"7ca5886d-b951-4607-a325-e8cc96e587cd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":232}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-22T14:36:43.840Z","uuid":"b1d28ddf-1b88-450d-a715-fbca880f8ab0","toolUseID":"cc411e8b-9aaa-49c2-be88-6d80236c01fd"}
{"parentUuid":"b1d28ddf-1b88-450d-a715-fbca880f8ab0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"turn_duration","durationMs":142636,"timestamp":"2026-02-22T14:36:43.842Z","uuid":"e2358f39-3d87-4058-a443-6b48dc3e9419","isMeta":false}
{"type":"file-history-snapshot","messageId":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","snapshot":{"messageId":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v2","version":2,"backupTime":"2026-02-22T14:54:27.338Z"}},"timestamp":"2026-02-22T14:54:27.337Z"},"isSnapshotUpdate":false}
{"parentUuid":"e2358f39-3d87-4058-a443-6b48dc3e9419","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"GEMINI API KEYを入れても、Rate limit hitというエラーが出てしまいました。"},"uuid":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","timestamp":"2026-02-22T14:54:27.213Z","permissionMode":"acceptEdits"}
{"parentUuid":"7e8df31b-5d6f-4967-ab07-af1589b2f1e1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01ScGDWuDpFh4hrZxbdZhRN5","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is saying that even after entering a Gemini API key, they get a \"Rate limit hit\" error. Let me look at the error handling in `generateTheme()` to understand what might be causing this.\n\nLooking at the code:\n\n```javascript\nif (!response.ok) {\n    const status = response.status;\n    if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n    if (status === 429) throw new Error('RATE_LIMIT');\n    throw new Error(`API_ERROR:${status}`);\n}\n```\n\nHTTP 429 is \"Too Many Requests\" which is the rate limit status code. \n\nBut if they just got the key and are using it for the first time, that shouldn't be the issue. The free tier might have extremely strict limits even for new users, or Gemini could be returning a 429 for quota exceeded or other reasons beyond just rate limiting.\n\nLooking at the Gemini 2.0 Flash free tier limits—15 requests per minute, 1,500 per day, 1 million tokens per minute—a 429 on the first try could mean the API key itself has an issue, or maybe Gemini returns 429 for things like regional restrictions or disabled APIs rather than the status codes we're mapping to INVALID_KEY. I'm wondering if the issue might be something else entirely—maybe the user is hitting a real rate limit right after entering the key, or there's a problem with how the request is structured. Let me reconsider the endpoint and request body to see if there's a mismatch with what the Gemini API actually expects, particularly around the system_instruction field or the model name. I'm wondering if the model name might be incorrect—it could need to be `gemini-2.0-flash-exp` or another variant instead. The user is hitting a 429 rate limit error even on their first request, which is unusual, so it might be a quota issue or the API returning 429 for a different reason like an invalid model name.\n\nThe best approach would be to add better error logging to see what Gemini's actual response body says, then potentially adjust the error handling or try a different model name.\n\nUpdating the error handling... I'm wondering if the `system_instruction` field might be formatted differently in the Gemini API, or if the API key doesn't have access to that feature depending on the version. There's also a possibility the API is returning a 200 status with an error in the response body, which would cause the parsing to fail when trying to extract the text. But the user is seeing a 429, so that points to rate limiting—though I should help them verify what's actually in the API response and consider trying a different model ID if needed.\n\nWriting the error handling fix... I'm handling the error responses from the API call—mapping status codes like 400 and 403 to an invalid key error, 429 to rate limiting, and other statuses to a generic API error. But looking back at the user's issue, they're reporting a rate limit error even after providing a valid API key, which makes me wonder if Gemini is returning 429 for other reasons like quota exhaustion rather than just hitting request limits.\n\nThe real problem could be that the API key is valid but the project doesn't have Gemini enabled, there are regional restrictions, or the quota is already maxed out. Since I can't see the actual response without more debugging, I should log the full error details and improve the 429 message to clarify it might be a quota issue, not just rate limiting. I'm also considering whether the model name `gemini-2.0-flash` might not be available in certain regions, which could be another source of the problem. I'm looking at the different error response formats Google's API returns—400 for invalid keys, 429 for rate limits or quota issues—and the status codes seem to map correctly. Let me verify that CORS isn't causing the issue to be misinterpreted.\n\nThe most likely culprit is that the user has a valid API key but is hitting rate limits on a free-tier account, or the 429 is being triggered for a reason we haven't considered. I should update the error handling to log the actual response body and extract Google's error message directly, then display something more informative to the user.\n\nWriting the updated error handling... Handling the error responses from the API—checking for invalid keys, rate limits, and other failures—then extracting the CSS from the response data. But I'm realizing that even with proper error handling, a genuine 429 rate limit error is still a problem that needs addressing at a deeper level.\n\nLet me think about what else could be causing this. The API key might be valid but the user could be missing billing setup, using the wrong type of key, or lacking access to the specific model. Or maybe the Gemini API is throttling requests at the IP or region level before it even validates the key. Without seeing the actual error response, the best approach is to log the full error body for better diagnostics and then improve the error messaging to help users troubleshoot.\n\nI'm also wondering if the `system_instruction` field could be the culprit—maybe certain model versions don't support it. Though I'm pretty confident Gemini 1.5+ models handle system instructions fine. Another thought: could `gemini-2.0-flash` require a different API version like v1 instead of v1beta?\n\nLooking at the endpoints, both v1 and v1beta should work for this model according to Google's docs. But stepping back, the user's actual problem is a 429 rate limit error, so I should focus on the most practical causes: either they're genuinely hitting quota limits, or there's something about how the request is being made that's triggering the rate limiter. The user might be in Japan where there could be regional availability issues, though the Gemini API should work globally. Most likely the problem is either quota exhaustion on their API key or a newly created key that hasn't been activated yet by Google. I'll improve the error handling by logging the full response body, making the 429 message clearer about potential quota issues, and surfacing the actual error details to the user.\n\nUpdating the API call... I'm realizing that passing custom properties on Error objects isn't reliable across the catch chain, so I need a cleaner approach to handle the rate limit detail message. I'm considering whether the issue might be with the model or endpoint choice, but v1beta should work fine with gemini-2.0-flash. The simplest approach is to log the actual Google API error response to the console and update the rate limit message to direct users there, so we can see what's really happening without making unnecessary changes.\n\nNow I'm looking at the rate limit specifics for the free tier—15 requests per minute and 1.5 million tokens per day—which shouldn't be exceeded on a fresh API key unless there's existing usage on that project or some account restriction. I'm also wondering if the `system_instruction` field or request formatting could be causing Google to return a 429 error, though that seems unlikely.\n\nActually, I think the real issue might be that the API key needs the Generative Language API explicitly enabled in Google Cloud Console, even though Google AI Studio should handle this automatically. Let me reconsider the error handling—maybe I have the 403 vs 429 distinction backwards, especially if a valid key is being rejected by Gemini 2.0 Flash.\n\nLooking at what's actually happening: the user is getting 429 (rate limit), not 403 (invalid key), so the status code is clear. The most likely culprits are either Gemini 2.0 Flash having stricter rate limits on the free tier than expected, a regional quota issue since they're in Japan, or pre-existing quota usage on their account. I should improve the error logging to capture the full response body, update the rate limit message to mention quota exceeded and point them to the AI Studio dashboard, and add a link to check their quota page.\n\nAdding error logging and updating the error messages...\n\nActually, let me reconsider whether there's something else causing the 429 errors. Looking at the request structure with the system instruction and content body, I'm wondering if the issue might be in how we're formatting the API call itself rather than just a quota problem.\n\nThe system instruction field could be the culprit here—I need to verify whether the Gemini API expects camelCase (`systemInstruction`) instead of snake_case (`system_instruction`). If the API doesn't recognize the field, it might either silently ignore it or throw an error, which could explain why we're hitting rate limits unexpectedly.\n\nActually, looking at the REST API documentation more carefully, the field should be `system_instruction` in snake_case since that's how gRPC-transcoded APIs typically handle proto3 fields. But I'm also wondering if this could be a CORS preflight issue—when the browser sends a POST request with JSON content, it first sends an OPTIONS request to check permissions, and if that fails, the actual request might not even reach the API.\n\nBut focusing on what I can actually address: I should add better error logging to see what response we're getting, and improve the 429 error message to be more helpful. \n\nWait, the user's comment \"GEMINI API KEYを入れても\" suggests they successfully entered the key and the UI confirmed it was enabled, then got the rate limit error when actually trying to generate a theme. So the issue isn't with the key validation itself—it's happening during the actual API call after everything seems to be working.\n\nThis points to either a quota restriction on their API key or project, or possibly a regional/model availability issue. The Gemini 2.0 Flash model might have restrictions I'm not aware of. Let me check the model name and then improve the error handling to give the user more actionable feedback about what might be causing the 429.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29,"cache_read_input_tokens":59658,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":29},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJKpyv2ats2vgNQ9CLM","type":"assistant","uuid":"ef32dd5f-1751-4a6e-bc96-8d967a0270d1","timestamp":"2026-02-22T14:56:31.478Z"}
{"parentUuid":"ef32dd5f-1751-4a6e-bc96-8d967a0270d1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01ScGDWuDpFh4hrZxbdZhRN5","type":"message","role":"assistant","content":[{"type":"text","text":"まず現状のエラーハンドリングと `generateTheme` を確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29,"cache_read_input_tokens":59658,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":29},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJKpyv2ats2vgNQ9CLM","type":"assistant","uuid":"1926f5f7-78de-4af2-8cd4-4e11928416ff","timestamp":"2026-02-22T14:56:31.878Z"}
{"parentUuid":"1926f5f7-78de-4af2-8cd4-4e11928416ff","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01ScGDWuDpFh4hrZxbdZhRN5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WLVxkJKgzfLVEGzYWccaKo","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1167,"limit":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29,"cache_read_input_tokens":59658,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":29},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJKpyv2ats2vgNQ9CLM","type":"assistant","uuid":"87258e71-17fd-48d7-9cb9-542932ed015b","timestamp":"2026-02-22T14:56:33.254Z"}
{"parentUuid":"87258e71-17fd-48d7-9cb9-542932ed015b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01WLVxkJKgzfLVEGzYWccaKo","toolUseID":"toolu_01WLVxkJKgzfLVEGzYWccaKo","timestamp":"2026-02-22T14:56:33.333Z","uuid":"785e11d6-cacb-49c0-a757-1f6cee205e31"}
{"parentUuid":"87258e71-17fd-48d7-9cb9-542932ed015b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WLVxkJKgzfLVEGzYWccaKo","type":"tool_result","content":"  1167→    async generateTheme(prompt) {\n  1168→        const key = this.getApiKey();\n  1169→        if (!key) throw new Error('NO_API_KEY');\n  1170→\n  1171→        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n  1172→        const body = {\n  1173→            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n  1174→            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n  1175→            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n  1176→        };\n  1177→\n  1178→        const response = await fetch(endpoint, {\n  1179→            method: 'POST',\n  1180→            headers: { 'Content-Type': 'application/json' },\n  1181→            body: JSON.stringify(body)\n  1182→        });\n  1183→\n  1184→        if (!response.ok) {\n  1185→            const status = response.status;\n  1186→            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n  1187→            if (status === 429) throw new Error('RATE_LIMIT');\n  1188→            throw new Error(`API_ERROR:${status}`);\n  1189→        }\n  1190→\n  1191→        const data = await response.json();\n  1192→        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n  1193→        if (!rawText) throw new Error('EMPTY_RESPONSE');\n  1194→        return this.extractCss(rawText);\n  1195→    },\n  1196→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"dc514f58-b68b-4b31-a22c-4d1c7dae8841","timestamp":"2026-02-22T14:56:33.332Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n","numLines":30,"startLine":1167,"totalLines":1341}},"sourceToolAssistantUUID":"87258e71-17fd-48d7-9cb9-542932ed015b"}
{"parentUuid":"dc514f58-b68b-4b31-a22c-4d1c7dae8841","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01JP8ZUBiBBL2PZfRmBSkLv2","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The issue is that when the API returns 429, we just throw `RATE_LIMIT` without reading the response body or logging it. This means we don't know the actual reason for the 429.\n\nThe fix:\n1. Read the response body before throwing the error\n2. Log it to console  \n3. Pass the actual Google error message through to the user\n\nAlso, I should think about whether the problem could be with:\n- The API model name\n- The request format\n\nBut without seeing the actual error from Google, I can't be sure. The best immediate fix is to:\n1. Read and log the error body  \n2. Pass the error message to the user via the error detail\n\n\n3. Modify the error handling to capture the response body and attach it to the Error object, then update the error display to show this detail for 429 responses","signature":"EpAICkYICxgCKkAkVFCQ3n7jcJ3A0cIiokLbfZSTLO2BkMJytS2tTdtEL+BPmBNX9odPa8SbF3kFFKMN9zw8BizADhe1KPfR6mlgEgxVG5Wefq+XDUh+jY0aDP+8FwDczcxipZgWdyIwQyMy+VEVEtdgEB8VZuw23qjcWucLzByIplHx5pLrzZYsb4f5yhUINbwl/l6mnVuKKvcGvGMpuz6+0vguMgJnQf+qqWJWEbdXMpwhWsOr4EQ70PqvEIusH7kSsmYIQ/iS6HWG8VGw4L3KOprWIKwrb0tH/g2yOrFEx+7d7e3b81boecFbId2UOAjBMwO3GFSqMBGK+owyacgAUgm4PDi+BI97muYoeuc+6reoC8/810w5MrqVu9Gd/8FJqkOW9eSZQZQxoD+fgvQ2U0iv5FSMJrz9JPu01QjgBNEU4u2QWPvdJ/mEEIFYFOZ28xcl3Xi0cl8uXaOJ0RPGxReie4ncayqKBMpwVvGlihVlG0iKB3NBe45U+c+Hn16cSduV4czK2JAtu9Dz0zgQT1hiFaD2QY0+5aWbEqzzkoT8FzU5d4l8QQsID3gS9W6uF2tKzs6xDkYYJ/H6qsrRv1e2qMLPsICBMeXEqWamoUe8ytJLm8cry+iDIWIEDbF/qeQ4/GIvkUWFh9G+RLcs6ibW+c37XmfAvrk3mxKGQor8sYe/nUSi4SBGxFrlnSItiZAr8hWjnhGxbveeWnmzdAR8Fw8wefcJ4/yEo4Lu82/dRRqEIOCo3QlDqFLRPtRnfemtvjdWuPQg4YczCLEIVwwOglMJdSAj4tB3LUfVrq2XjAQgZ5+ywdvCXdtdihU9jD1CwdSAs52a0oEHORqZ3ONU2c2aNtacf3S0fq4DbBHjkqgQ2KdaCAepdaUHEFGRcPyQ/S5de6zv75AasXOBtwtZ3FShdGvuXDmnOncPvx/sNkDM8CnsxIY873m6Ol4ZB3B/j3OlQ4/eVmowGyaRN4UmICj+oXpjTEVV1aa2qCmaHiE82yeVMH6VIyyl38anCl/hXgkFSoRpuQWvaZfQlsZhtoz8k5WAD88c9mRaq5V8aujmAgyVFxwSJsAKpof+jfIL71aSlS/UUZZg714PHI+zEhQfImtRvhLgman0B7aZl9dEQGSPLX/uL10XHbfUhD4tW3e0lJSTcFqAzoDPVZ7LgHIIuHOYk9ZWwcKgVY46jJG2/58I1JH1J3wn5KcgxBm/4fePSw2hHqEMDWwPwgYTkjVvKspxkR5dXjHhtdNX3kvZCpPaHaX3JuSZXe/hkw4L3sDgncb5VBTbqaYCA7HCU2KxOlYSxESL1JvcJ91QXzWGFVdmMcF8Ac3g0neh81ZT7WCyJoOdQaUX+8fip+TUbslSu5Cnv/BelbqT/oAYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8302,"cache_read_input_tokens":59687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8302},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJV7KvssxiHnb2GwEB3","type":"assistant","uuid":"c6b327aa-c9fb-4d7f-b84b-a81b1ef6ea27","timestamp":"2026-02-22T14:56:40.916Z"}
{"parentUuid":"c6b327aa-c9fb-4d7f-b84b-a81b1ef6ea27","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01JP8ZUBiBBL2PZfRmBSkLv2","type":"message","role":"assistant","content":[{"type":"text","text":"429 が返ってきているのに、Gemini から届く実際のエラー本文を読んでいないため原因が分かりません。エラーボディを読んでコンソールに出力し、メッセージも UI に表示するよう修正します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8302,"cache_read_input_tokens":59687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8302},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJV7KvssxiHnb2GwEB3","type":"assistant","uuid":"704e9502-7d35-4dfe-b63d-9fd4e85390a9","timestamp":"2026-02-22T14:56:41.006Z"}
{"parentUuid":"704e9502-7d35-4dfe-b63d-9fd4e85390a9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01JP8ZUBiBBL2PZfRmBSkLv2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QX7ePTSStYemwqAhYKLijv","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }","new_string":"        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8302,"cache_read_input_tokens":59687,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8302},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJV7KvssxiHnb2GwEB3","type":"assistant","uuid":"bd22f03f-4965-4528-ae33-8f0e1fe1a744","timestamp":"2026-02-22T14:56:43.881Z"}
{"parentUuid":"bd22f03f-4965-4528-ae33-8f0e1fe1a744","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01QX7ePTSStYemwqAhYKLijv","toolUseID":"toolu_01QX7ePTSStYemwqAhYKLijv","timestamp":"2026-02-22T14:56:43.886Z","uuid":"534cff18-c1aa-46c0-8ef1-b63160814415"}
{"parentUuid":"bd22f03f-4965-4528-ae33-8f0e1fe1a744","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QX7ePTSStYemwqAhYKLijv","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"b09cc8fa-a671-48c5-9894-1c28cee9e1ea","timestamp":"2026-02-22T14:56:43.885Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }","newString":"        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) throw new Error('RATE_LIMIT');\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1183,"oldLines":8,"newStart":1183,"newLines":18,"lines":[" ","         if (!response.ok) {","             const status = response.status;","+            let apiMessage = '';","+            try {","+                const errData = await response.json();","+                apiMessage = errData?.error?.message || '';","+                console.error('Gemini API error:', status, errData);","+            } catch (_) {}","             if (status === 400 || status === 403) throw new Error('INVALID_KEY');","-            if (status === 429) throw new Error('RATE_LIMIT');","+            if (status === 429) {","+                const e = new Error('RATE_LIMIT');","+                e.detail = apiMessage;","+                throw e;","+            }","             throw new Error(`API_ERROR:${status}`);","         }"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"bd22f03f-4965-4528-ae33-8f0e1fe1a744"}
{"parentUuid":"b09cc8fa-a671-48c5-9894-1c28cee9e1ea","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01WAzcoR7jxa658SwBeB3Nye","type":"message","role":"assistant","content":[{"type":"text","text":"次に `showGenerateError` の RATE_LIMIT ケースを更新して、Google からの実際のメッセージを表示するようにします。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":712,"cache_read_input_tokens":67989,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":712},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJVtRpQaEyvgnFexGWx","type":"assistant","uuid":"f91aee2a-4abb-4e7d-a2a7-90a18a1f4c43","timestamp":"2026-02-22T14:56:45.880Z"}
{"parentUuid":"f91aee2a-4abb-4e7d-a2a7-90a18a1f4c43","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01WAzcoR7jxa658SwBeB3Nye","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","new_string":"            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":712,"cache_read_input_tokens":67989,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":712},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJVtRpQaEyvgnFexGWx","type":"assistant","uuid":"5946e4fc-d084-447e-acf2-535f89caf4b3","timestamp":"2026-02-22T14:56:47.714Z"}
{"parentUuid":"5946e4fc-d084-447e-acf2-535f89caf4b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","toolUseID":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","timestamp":"2026-02-22T14:56:47.720Z","uuid":"2a3cfb09-be61-4486-8bc3-cec29ff744ce"}
{"parentUuid":"5946e4fc-d084-447e-acf2-535f89caf4b3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SPEQ4V6K1XzTdz2MdJbj19","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"0e7f39d6-5254-4839-b940-4151c7595b99","timestamp":"2026-02-22T14:56:47.720Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","newString":"            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1252,"oldLines":7,"newStart":1252,"newLines":7,"lines":["         switch (err.message) {","             case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;","             case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;","-            case 'RATE_LIMIT':    message = 'Rate limit hit. Please try again in a moment.'; break;","+            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;","             case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;","             default:              message = `Generation failed: ${err.message}`;","         }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5946e4fc-d084-447e-acf2-535f89caf4b3"}
{"parentUuid":"0e7f39d6-5254-4839-b940-4151c7595b99","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01WwA91trKQ5qQXvqEYZLrDE","type":"message","role":"assistant","content":[{"type":"text","text":"これで「Apply」を押したとき、ブラウザの開発者コンソール（F12）に Gemini からの生のエラー JSON が出るようになります。\n\n**次の手順でデバッグしてください：**\n\n1. ブラウザで F12 → Console タブを開く\n2. プロンプトを入力して Apply を押す\n3. コンソールに `Gemini API error: 429 {...}` が出るので、その中の `message` フィールドを確認する\n4. UI にも Google の実際のエラー文言が表示されます\n\n---\n\n**429 の主な原因として考えられるもの：**\n\n| 原因 | `error.message` の例 |\n|------|---------------------|\n| 1日の無料枠上限 | `\"You exceeded your current quota...\"` |\n| プロジェクトに API が未有効化 | `\"Generative Language API has not been used...\"` |\n| API キーの制限設定 | `\"API key not valid...\"` (本来は 400 だが 429 で返す場合も) |\n| 地域制限 | `\"User location is not supported...\"` |\n\nコンソールに表示されたメッセージを教えていただければ、ピンポイントで対処できます。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":279,"cache_read_input_tokens":68701,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":279},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPJWB2TL4uPYdK4qoDJN","type":"assistant","uuid":"fec37826-0d01-46d9-86e6-f2cf4b7df8dd","timestamp":"2026-02-22T14:56:56.053Z"}
{"parentUuid":"fec37826-0d01-46d9-86e6-f2cf4b7df8dd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"f58cc474-2237-4bb9-8393-2da4949ca818","toolUseID":"f58cc474-2237-4bb9-8393-2da4949ca818","timestamp":"2026-02-22T14:56:56.085Z","uuid":"7719c605-465b-4089-a761-83e53371e9f1"}
{"parentUuid":"7719c605-465b-4089-a761-83e53371e9f1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":227}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-22T14:56:56.314Z","uuid":"baf353ac-0ab6-431b-8f33-fb08f24f0930","toolUseID":"f58cc474-2237-4bb9-8393-2da4949ca818"}
{"parentUuid":"baf353ac-0ab6-431b-8f33-fb08f24f0930","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"turn_duration","durationMs":148977,"timestamp":"2026-02-22T14:56:56.316Z","uuid":"363b39fa-8ed5-430e-90d2-9de3aaf15fa2","isMeta":false}
{"type":"file-history-snapshot","messageId":"1f668307-2ca4-433a-af2c-260c64ed4201","snapshot":{"messageId":"1f668307-2ca4-433a-af2c-260c64ed4201","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v3","version":3,"backupTime":"2026-02-22T15:09:08.632Z"}},"timestamp":"2026-02-22T15:09:08.632Z"},"isSnapshotUpdate":false}
{"parentUuid":"363b39fa-8ed5-430e-90d2-9de3aaf15fa2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flashに変更したらうまくいきました。現在の実装でコミットして"},"uuid":"1f668307-2ca4-433a-af2c-260c64ed4201","timestamp":"2026-02-22T15:09:08.525Z","permissionMode":"acceptEdits"}
{"parentUuid":"1f668307-2ca4-433a-af2c-260c64ed4201","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01H8dxn9rfb8D2ChMXx96SMx","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user changed the model from `gemini-2.0-flash` to `gemini-2.5-flash` and it worked. They want to commit the current implementation. Let me do a git commit.","signature":"EsgCCkYICxgCKkB8fCoxGI3wcMPbPrBI7UGjnr73ppkD53Yj0kTpjYVIFTKJdf83UcdMNcbpG6T1H5FCY8ccKL9CATtMlUNZnPsGEgzcZE2amij5fT1dh44aDGZWU8DCVkfbFCPqSiIwOKLu31hOu9Z+34R9aoxPMTD1pigeFuBudwatAlg3vYvssSDTKLq1rXNZlCx8WNfAKq8B1/M0e71uyRs5Mt3P08Risst4n37hLUox6NAQrPfzszhjXiCJPeMIdduZZUMcQcCnlHjZ1e3Luff1rK9DmqTyni6jgk4YjugtbUKKTAYX3ye1F5bhWk8V300B7Wz0CMGw4Q+c87CvvmWSOr/UWYOMenMlk5vzTljxC0fZQeCHnHoyVm+g+v6bHsG6QP7MyI35+GcSl34SZxBEWnDbpJk0nUHrQhK78rErrXhpfGB5khgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":51169,"cache_read_input_tokens":18648,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":51169},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKSniYzMWTdcC9ReBDZ","type":"assistant","uuid":"db41c324-c38b-4109-837c-1d28e2c272f7","timestamp":"2026-02-22T15:09:11.954Z"}
{"parentUuid":"db41c324-c38b-4109-837c-1d28e2c272f7","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01H8dxn9rfb8D2ChMXx96SMx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YXMQuni45VxPUXLUFZWmxX","name":"Bash","input":{"command":"git diff && git status","description":"Show diff and status before committing"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":51169,"cache_read_input_tokens":18648,"output_tokens":158,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":51169,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYPKSniYzMWTdcC9ReBDZ","type":"assistant","uuid":"994cc2d8-c130-484d-80fe-c7c579a6eb7c","timestamp":"2026-02-22T15:09:12.825Z"}
{"parentUuid":"994cc2d8-c130-484d-80fe-c7c579a6eb7c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YXMQuni45VxPUXLUFZWmxX","type":"tool_result","content":"diff --git a/gardener.js b/gardener.js\nindex 9423c1b..aec6265 100644\n--- a/gardener.js\n+++ b/gardener.js\n@@ -5,6 +5,31 @@\n \n const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n \n+const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n+Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n+\n+Define all of these CSS custom properties on :root, then optionally add component overrides:\n+\n+:root {\n+    --bg:                  /* page background */;\n+    --card-bg:             /* story card background */;\n+    --text:                /* primary text */;\n+    --subtext:             /* secondary/meta text */;\n+    --accent:              /* links and accent */;\n+    --header-bg:           /* header background (rgba allowed) */;\n+    --font-main:           /* font stack */;\n+    --item-radius:         /* card border-radius */;\n+    --item-border:         /* border shorthand or none */;\n+    --item-shadow:         /* box-shadow or none */;\n+    --more-btn-bg:         /* More button background */;\n+    --more-btn-color:      /* More button text color */;\n+    --mobile-upvote-bg:    /* upvote bg on mobile */;\n+    --mobile-upvote-color: /* upvote text on mobile */;\n+}\n+\n+Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\n+Output nothing except the CSS.`;\n+\n /**\n  * System Core Styles (Layout, Typography Base, Responsive Logic)\n  * Themes should override variables in :root or specific classes if needed.\n@@ -881,16 +906,21 @@ const App = {\n \n     async init() {\n         this.renderPresetButtons();\n+        this.renderApiKeySection();\n         this.bindEvents();\n-        console.log(\"Generative UI - Architecture Refactored.\");\n-        \n-        // Restore saved theme or fallback to Minimalist\n-        const savedTheme = localStorage.getItem('acephale-theme');\n-        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n-        \n-        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n \n-        // Initial load\n+        const savedPreset = localStorage.getItem('acephale-theme');\n+        const savedCustom = localStorage.getItem('acephale-custom-css');\n+        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n+\n+        if (savedCustom) {\n+            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n+            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n+        } else {\n+            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n+            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n+        }\n+\n         await this.loadInitial();\n     },\n \n@@ -1115,52 +1145,204 @@ const App = {\n             .replace(/'/g, \"&#039;\");\n     },\n \n-    handleGenerate() {\n+    getApiKey() {\n+        return localStorage.getItem('acephale-gemini-key');\n+    },\n+\n+    saveApiKey(key) {\n+        localStorage.setItem('acephale-gemini-key', key.trim());\n+    },\n+\n+    clearApiKey() {\n+        localStorage.removeItem('acephale-gemini-key');\n+        this.renderApiKeySection();\n+    },\n+\n+    extractCss(text) {\n+        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n+        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n+        return cleaned.trim();\n+    },\n+\n+    async generateTheme(prompt) {\n+        const key = this.getApiKey();\n+        if (!key) throw new Error('NO_API_KEY');\n+\n+        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n+        const body = {\n+            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n+            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n+            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n+        };\n+\n+        const response = await fetch(endpoint, {\n+            method: 'POST',\n+            headers: { 'Content-Type': 'application/json' },\n+            body: JSON.stringify(body)\n+        });\n+\n+        if (!response.ok) {\n+            const status = response.status;\n+            let apiMessage = '';\n+            try {\n+                const errData = await response.json();\n+                apiMessage = errData?.error?.message || '';\n+                console.error('Gemini API error:', status, errData);\n+            } catch (_) {}\n+            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n+            if (status === 429) {\n+                const e = new Error('RATE_LIMIT');\n+                e.detail = apiMessage;\n+                throw e;\n+            }\n+            throw new Error(`API_ERROR:${status}`);\n+        }\n+\n+        const data = await response.json();\n+        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n+        if (!rawText) throw new Error('EMPTY_RESPONSE');\n+        return this.extractCss(rawText);\n+    },\n+\n+    renderApiKeySection() {\n+        const existing = document.getElementById('api-key-section');\n+        if (existing) existing.remove();\n+\n+        const section = document.createElement('div');\n+        section.id = 'api-key-section';\n+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n+\n+        if (this.getApiKey()) {\n+            section.innerHTML = `\n+                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n+                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n+                </div>`;\n+            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n+        } else {\n+            section.innerHTML = `\n+                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n+                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n+                </div>\n+                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n+                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n+                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n+                </div>`;\n+            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n+                const form = section.querySelector('#api-key-form');\n+                const icon = section.querySelector('#api-key-icon');\n+                const isOpen = form.style.display !== 'none';\n+                form.style.display = isOpen ? 'none' : 'flex';\n+                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n+            });\n+            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n+                const val = section.querySelector('#api-key-input').value.trim();\n+                if (!val) return;\n+                this.saveApiKey(val);\n+                this.renderApiKeySection();\n+            });\n+        }\n+\n+        this.elements.themeControls.appendChild(section);\n+    },\n+\n+    showGenerateError(err) {\n+        let message;\n+        switch (err.message) {\n+            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n+            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n+            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n+            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n+            default:              message = `Generation failed: ${err.message}`;\n+        }\n+        let errEl = document.getElementById('generate-error');\n+        if (!errEl) {\n+            errEl = document.createElement('div');\n+            errEl.id = 'generate-error';\n+            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n+            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n+        }\n+        errEl.textContent = message;\n+        clearTimeout(this._errorTimeout);\n+        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n+    },\n+\n+    expandApiKeySection() {\n+        const form = document.getElementById('api-key-form');\n+        const icon = document.getElementById('api-key-icon');\n+        if (form && form.style.display === 'none') {\n+            form.style.display = 'flex';\n+            if (icon) icon.style.transform = 'rotate(0deg)';\n+        }\n+        this.elements.themeControls.classList.remove('is-minimized');\n+        const input = document.getElementById('api-key-input');\n+        if (input) setTimeout(() => input.focus(), 300);\n+    },\n+\n+    async handleGenerate() {\n         const input = this.elements.promptInput.value.trim();\n         if (!input) return;\n+        if (this._isGenerating) return;\n \n-        const style = this.matchStyle(input);\n-        \n-        if (style) {\n-            this.applyStyle(style, input);\n+        const presetKey = this.matchStyle(input);\n+        if (presetKey) {\n+            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n             this.togglePresets(true);\n-        } else {\n-            this.showError();\n+            return;\n+        }\n+\n+        if (!this.getApiKey()) {\n+            this.expandApiKeySection();\n+            return;\n+        }\n+\n+        this._isGenerating = true;\n+        const btn = this.elements.generateBtn;\n+        const originalText = btn.textContent;\n+        btn.textContent = 'Generating...';\n+        btn.disabled = true;\n+\n+        try {\n+            const css = await this.generateTheme(input);\n+            this.applyStyle(css, null, input);\n+            this.togglePresets(true);\n+        } catch (err) {\n+            this.showGenerateError(err);\n+        } finally {\n+            btn.textContent = originalText;\n+            btn.disabled = false;\n+            this._isGenerating = false;\n         }\n     },\n \n     matchStyle(input) {\n         const normalizedInput = input.toLowerCase();\n         for (const key in STYLE_PRESETS) {\n-            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n+            if (normalizedInput.includes(key.toLowerCase())) return key;\n         }\n         return null;\n     },\n \n-    applyStyle(css, themeName) {\n-        console.log(`Applying theme: ${themeName}`);\n-        this.toggleMenu(false); // Close menu on theme change\n-        \n-        // Save to local storage for persistence\n-        if (STYLE_PRESETS[themeName]) {\n-            localStorage.setItem('acephale-theme', themeName);\n-        }\n+    applyStyle(css, themeName, customPrompt = null) {\n+        this.toggleMenu(false);\n \n-        // Fallback for browsers that don't support View Transition API\n-        if (!document.startViewTransition) {\n-            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-            return;\n+        if (themeName && STYLE_PRESETS[themeName]) {\n+            localStorage.setItem('acephale-theme', themeName);\n+            localStorage.removeItem('acephale-custom-css');\n+            localStorage.removeItem('acephale-custom-prompt');\n+        } else if (customPrompt) {\n+            localStorage.setItem('acephale-custom-css', css);\n+            localStorage.setItem('acephale-custom-prompt', customPrompt);\n+            localStorage.removeItem('acephale-theme');\n         }\n \n-        // Smooth transition using View Transition API\n-        document.startViewTransition(() => {\n+        const applyFn = () => {\n             this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-        });\n-    },\n+        };\n \n-    showError() {\n-        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n-        alert(`Please enter a supported theme:\\n\"${available}\"`);\n+        if (!document.startViewTransition) { applyFn(); return; }\n+        document.startViewTransition(applyFn);\n     }\n };\n \nOn branch main\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")","is_error":false}]},"uuid":"3ad422a7-7a48-4b74-a320-37094aa7eee5","timestamp":"2026-02-22T15:09:12.973Z","toolUseResult":{"stdout":"diff --git a/gardener.js b/gardener.js\nindex 9423c1b..aec6265 100644\n--- a/gardener.js\n+++ b/gardener.js\n@@ -5,6 +5,31 @@\n \n const BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n \n+const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n+Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n+\n+Define all of these CSS custom properties on :root, then optionally add component overrides:\n+\n+:root {\n+    --bg:                  /* page background */;\n+    --card-bg:             /* story card background */;\n+    --text:                /* primary text */;\n+    --subtext:             /* secondary/meta text */;\n+    --accent:              /* links and accent */;\n+    --header-bg:           /* header background (rgba allowed) */;\n+    --font-main:           /* font stack */;\n+    --item-radius:         /* card border-radius */;\n+    --item-border:         /* border shorthand or none */;\n+    --item-shadow:         /* box-shadow or none */;\n+    --more-btn-bg:         /* More button background */;\n+    --more-btn-color:      /* More button text color */;\n+    --mobile-upvote-bg:    /* upvote bg on mobile */;\n+    --mobile-upvote-color: /* upvote text on mobile */;\n+}\n+\n+Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\n+Output nothing except the CSS.`;\n+\n /**\n  * System Core Styles (Layout, Typography Base, Responsive Logic)\n  * Themes should override variables in :root or specific classes if needed.\n@@ -881,16 +906,21 @@ const App = {\n \n     async init() {\n         this.renderPresetButtons();\n+        this.renderApiKeySection();\n         this.bindEvents();\n-        console.log(\"Generative UI - Architecture Refactored.\");\n-        \n-        // Restore saved theme or fallback to Minimalist\n-        const savedTheme = localStorage.getItem('acephale-theme');\n-        const themeToApply = (savedTheme && STYLE_PRESETS[savedTheme]) ? savedTheme : \"Minimalist\";\n-        \n-        this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n \n-        // Initial load\n+        const savedPreset = localStorage.getItem('acephale-theme');\n+        const savedCustom = localStorage.getItem('acephale-custom-css');\n+        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n+\n+        if (savedCustom) {\n+            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n+            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n+        } else {\n+            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n+            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n+        }\n+\n         await this.loadInitial();\n     },\n \n@@ -1115,52 +1145,204 @@ const App = {\n             .replace(/'/g, \"&#039;\");\n     },\n \n-    handleGenerate() {\n+    getApiKey() {\n+        return localStorage.getItem('acephale-gemini-key');\n+    },\n+\n+    saveApiKey(key) {\n+        localStorage.setItem('acephale-gemini-key', key.trim());\n+    },\n+\n+    clearApiKey() {\n+        localStorage.removeItem('acephale-gemini-key');\n+        this.renderApiKeySection();\n+    },\n+\n+    extractCss(text) {\n+        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n+        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n+        return cleaned.trim();\n+    },\n+\n+    async generateTheme(prompt) {\n+        const key = this.getApiKey();\n+        if (!key) throw new Error('NO_API_KEY');\n+\n+        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n+        const body = {\n+            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n+            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n+            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n+        };\n+\n+        const response = await fetch(endpoint, {\n+            method: 'POST',\n+            headers: { 'Content-Type': 'application/json' },\n+            body: JSON.stringify(body)\n+        });\n+\n+        if (!response.ok) {\n+            const status = response.status;\n+            let apiMessage = '';\n+            try {\n+                const errData = await response.json();\n+                apiMessage = errData?.error?.message || '';\n+                console.error('Gemini API error:', status, errData);\n+            } catch (_) {}\n+            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n+            if (status === 429) {\n+                const e = new Error('RATE_LIMIT');\n+                e.detail = apiMessage;\n+                throw e;\n+            }\n+            throw new Error(`API_ERROR:${status}`);\n+        }\n+\n+        const data = await response.json();\n+        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n+        if (!rawText) throw new Error('EMPTY_RESPONSE');\n+        return this.extractCss(rawText);\n+    },\n+\n+    renderApiKeySection() {\n+        const existing = document.getElementById('api-key-section');\n+        if (existing) existing.remove();\n+\n+        const section = document.createElement('div');\n+        section.id = 'api-key-section';\n+        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n+\n+        if (this.getApiKey()) {\n+            section.innerHTML = `\n+                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n+                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n+                </div>`;\n+            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n+        } else {\n+            section.innerHTML = `\n+                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n+                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n+                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n+                </div>\n+                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n+                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n+                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n+                </div>`;\n+            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n+                const form = section.querySelector('#api-key-form');\n+                const icon = section.querySelector('#api-key-icon');\n+                const isOpen = form.style.display !== 'none';\n+                form.style.display = isOpen ? 'none' : 'flex';\n+                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n+            });\n+            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n+                const val = section.querySelector('#api-key-input').value.trim();\n+                if (!val) return;\n+                this.saveApiKey(val);\n+                this.renderApiKeySection();\n+            });\n+        }\n+\n+        this.elements.themeControls.appendChild(section);\n+    },\n+\n+    showGenerateError(err) {\n+        let message;\n+        switch (err.message) {\n+            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n+            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n+            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n+            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n+            default:              message = `Generation failed: ${err.message}`;\n+        }\n+        let errEl = document.getElementById('generate-error');\n+        if (!errEl) {\n+            errEl = document.createElement('div');\n+            errEl.id = 'generate-error';\n+            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n+            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n+        }\n+        errEl.textContent = message;\n+        clearTimeout(this._errorTimeout);\n+        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n+    },\n+\n+    expandApiKeySection() {\n+        const form = document.getElementById('api-key-form');\n+        const icon = document.getElementById('api-key-icon');\n+        if (form && form.style.display === 'none') {\n+            form.style.display = 'flex';\n+            if (icon) icon.style.transform = 'rotate(0deg)';\n+        }\n+        this.elements.themeControls.classList.remove('is-minimized');\n+        const input = document.getElementById('api-key-input');\n+        if (input) setTimeout(() => input.focus(), 300);\n+    },\n+\n+    async handleGenerate() {\n         const input = this.elements.promptInput.value.trim();\n         if (!input) return;\n+        if (this._isGenerating) return;\n \n-        const style = this.matchStyle(input);\n-        \n-        if (style) {\n-            this.applyStyle(style, input);\n+        const presetKey = this.matchStyle(input);\n+        if (presetKey) {\n+            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n             this.togglePresets(true);\n-        } else {\n-            this.showError();\n+            return;\n+        }\n+\n+        if (!this.getApiKey()) {\n+            this.expandApiKeySection();\n+            return;\n+        }\n+\n+        this._isGenerating = true;\n+        const btn = this.elements.generateBtn;\n+        const originalText = btn.textContent;\n+        btn.textContent = 'Generating...';\n+        btn.disabled = true;\n+\n+        try {\n+            const css = await this.generateTheme(input);\n+            this.applyStyle(css, null, input);\n+            this.togglePresets(true);\n+        } catch (err) {\n+            this.showGenerateError(err);\n+        } finally {\n+            btn.textContent = originalText;\n+            btn.disabled = false;\n+            this._isGenerating = false;\n         }\n     },\n \n     matchStyle(input) {\n         const normalizedInput = input.toLowerCase();\n         for (const key in STYLE_PRESETS) {\n-            if (normalizedInput.includes(key.toLowerCase())) return STYLE_PRESETS[key];\n+            if (normalizedInput.includes(key.toLowerCase())) return key;\n         }\n         return null;\n     },\n \n-    applyStyle(css, themeName) {\n-        console.log(`Applying theme: ${themeName}`);\n-        this.toggleMenu(false); // Close menu on theme change\n-        \n-        // Save to local storage for persistence\n-        if (STYLE_PRESETS[themeName]) {\n-            localStorage.setItem('acephale-theme', themeName);\n-        }\n+    applyStyle(css, themeName, customPrompt = null) {\n+        this.toggleMenu(false);\n \n-        // Fallback for browsers that don't support View Transition API\n-        if (!document.startViewTransition) {\n-            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-            return;\n+        if (themeName && STYLE_PRESETS[themeName]) {\n+            localStorage.setItem('acephale-theme', themeName);\n+            localStorage.removeItem('acephale-custom-css');\n+            localStorage.removeItem('acephale-custom-prompt');\n+        } else if (customPrompt) {\n+            localStorage.setItem('acephale-custom-css', css);\n+            localStorage.setItem('acephale-custom-prompt', customPrompt);\n+            localStorage.removeItem('acephale-theme');\n         }\n \n-        // Smooth transition using View Transition API\n-        document.startViewTransition(() => {\n+        const applyFn = () => {\n             this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n-        });\n-    },\n+        };\n \n-    showError() {\n-        const available = Object.keys(STYLE_PRESETS).join('\", \"');\n-        alert(`Please enter a supported theme:\\n\"${available}\"`);\n+        if (!document.startViewTransition) { applyFn(); return; }\n+        document.startViewTransition(applyFn);\n     }\n };\n \nOn branch main\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   gardener.js\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"994cc2d8-c130-484d-80fe-c7c579a6eb7c"}
{"parentUuid":"3ad422a7-7a48-4b74-a320-37094aa7eee5","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LR9mKUfpShNJWRhwHoZx1R","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014k9jFcscZwK1X2hjm6c4RW","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nAdd AI theme generation via Gemini 2.5 Flash API\n\n- Add GEMINI_SYSTEM_PROMPT for structured CSS-only output\n- Add Gemini API key management (save/clear/renderApiKeySection)\n- Add generateTheme() with error handling (INVALID_KEY, RATE_LIMIT, etc.)\n- Add extractCss() to strip markdown fences from API response\n- Replace synchronous handleGenerate() with async version\n- Update applyStyle() to persist AI-generated CSS to localStorage\n- Update init() to restore AI-generated themes on page load\n- Use gemini-2.5-flash model endpoint\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Stage and commit AI theme generation implementation"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4108,"cache_read_input_tokens":69817,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4108},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKT74s7A8ahxbKwKuyz","type":"assistant","uuid":"b61621c6-39a2-4026-9a74-059ad8915589","timestamp":"2026-02-22T15:09:30.976Z"}
{"parentUuid":"b61621c6-39a2-4026-9a74-059ad8915589","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014k9jFcscZwK1X2hjm6c4RW","type":"tool_result","content":"[main edba4d6] Add AI theme generation via Gemini 2.5 Flash API\n 1 file changed, 217 insertions(+), 35 deletions(-)","is_error":false}]},"uuid":"4510b4a8-98e8-4ed6-b064-24ad51eca67f","timestamp":"2026-02-22T15:09:31.748Z","toolUseResult":{"stdout":"[main edba4d6] Add AI theme generation via Gemini 2.5 Flash API\n 1 file changed, 217 insertions(+), 35 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"b61621c6-39a2-4026-9a74-059ad8915589"}
{"parentUuid":"4510b4a8-98e8-4ed6-b064-24ad51eca67f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01U5JM3Xgwkxu4LkER8gd5KD","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました (`edba4d6`)。`gemini-2.5-flash` に変更されていたので、それも含めてコミットメッセージに反映しています。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":435,"cache_read_input_tokens":73925,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":435},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKUVRYuzKct4t869iEN","type":"assistant","uuid":"9e84e150-98ad-4afe-a249-2bfb0910b5d9","timestamp":"2026-02-22T15:09:34.821Z"}
{"parentUuid":"9e84e150-98ad-4afe-a249-2bfb0910b5d9","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"5c8a716e-431f-49d0-abae-866403348204","toolUseID":"5c8a716e-431f-49d0-abae-866403348204","timestamp":"2026-02-22T15:09:34.916Z","uuid":"c1206659-af86-44d7-a915-8b047c8b4cb6"}
{"parentUuid":"c1206659-af86-44d7-a915-8b047c8b4cb6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":669}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-22T15:09:35.586Z","uuid":"69f57a92-fbcc-43f9-8907-867ce5fada69","toolUseID":"5c8a716e-431f-49d0-abae-866403348204"}
{"type":"file-history-snapshot","messageId":"208c8620-12e5-469b-b562-6e98b5815a41","snapshot":{"messageId":"208c8620-12e5-469b-b562-6e98b5815a41","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v3","version":3,"backupTime":"2026-02-22T15:09:08.632Z"}},"timestamp":"2026-02-22T15:12:04.420Z"},"isSnapshotUpdate":false}
{"parentUuid":"69f57a92-fbcc-43f9-8907-867ce5fada69","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"生成したテーマを、ローカル上で保存して、Presetsとして選べるようにしたいです。その際、Presetsのボタンとしては1単語にプロンプトを要約し、ボタンの枠線を太くしてください。"},"uuid":"208c8620-12e5-469b-b562-6e98b5815a41","timestamp":"2026-02-22T15:12:04.298Z","permissionMode":"acceptEdits"}
{"parentUuid":"208c8620-12e5-469b-b562-6e98b5815a41","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Dr3QWP7BKsw6fbCVJ9xKFC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to:\n1. Save AI-generated themes locally (to localStorage)\n2. Show them as preset buttons in the Presets section\n3. The button label should be a 1-word summary of the prompt\n4. The button border should be thicker than regular preset buttons\n\nLet me think about the design:\n\n1. **Storage**: Need a new localStorage key for saved AI themes. Something like `acephale-saved-themes` which stores an array of `{name, css, prompt}` objects.\n\n2. **1-word summary**: This could be:\n   - Ask Gemini to also provide a 1-word name\n   - Extract the first word of the prompt\n   - Ask the user to provide a name\n\nFor the 1-word summary, I could extract a meaningful word from the prompt by filtering out common stop words, or I could have Gemini return a structured response that includes a theme name alongside the CSS. The structured approach would be cleaner, but extracting a significant word from the prompt is simpler and doesn't require an extra API call.\n\nI'll go with extracting the first meaningful word from the prompt—skip the common words like \"a\", \"the\", \"with\"—then capitalize it for the theme name. After generating a theme, I'll add a save button that lets users store their AI-generated theme with that summarized name, and saved themes will display with a distinct visual indicator to separate them from the built-in presets. border: 2px solid rgba(0,0,0,0.3)`) vs regular preset buttons (`border: 1px solid rgba(0,0,0,0.1)`). I could also give them a slightly different visual treatment to make them stand out more.\n\nFor deletion, I'll keep it straightforward and add a small × button directly on each saved theme button so users can remove them if needed.\n\nNow I'm mapping out the implementation: I'll need a localStorage key to store the saved themes as JSON objects with id, name, css, and prompt. Then I'll write a function to extract a single meaningful word from the prompt by filtering out common stop words, a getter to retrieve all saved themes, a method to persist the current theme, and a delete function to remove themes by id.\n\nFor the UI, I'll add a \"Save\" button that appears after generating an AI theme, and I'll integrate the saved theme buttons directly into the preset buttons area since the user specifically asked to be able to select them as presets—that's cleaner than keeping them separate. I can check localStorage to see if a custom theme is currently active by looking for the `acephale-custom-css` key. Now I'm mapping out the implementation: I need to add methods to summarize prompts into single words, retrieve and save themes, render the saved theme buttons alongside the presets, and show a save button after generating a custom theme. I'm also working through how to extract meaningful one-word summaries from the theme prompts—like pulling \"Brutalist\" from \"brutalist newspaper with orange ink\" or finding the most distinctive word from longer descriptions. I need to think through the save button implementation—it should appear after a theme is generated so users can immediately save their custom AI theme. I'll place saved themes below the built-in presets in the button list, giving them a slightly thicker border to distinguish them, and add a delete option for each one. A subtle separator line between the preset and saved sections would help organize them visually. I'll go with a persistent \"Save as Preset\" button in the control panel that appears whenever a custom AI theme is active. I'm adding a method to summarize the prompt into a concise name by filtering out common stop words...\n\nStill writing helper methods... Finishing up the naming logic to ensure uniqueness, then saving the theme to storage and refreshing the UI. After that, I'm adding methods to delete saved themes and re-render the theme buttons whenever the list changes.\n\nNow I'm building out the button elements for each saved theme... Still writing button styles... I need to track whether we're in a \"just generated, not yet saved\" state—the simplest approach is to show the save button whenever there's custom CSS in localStorage that hasn't been added to the saved themes list yet. I'll make the save button always visible after generation, and it disappears once the user saves it or navigates to a preset.\n\nFor the implementation, I'll add the save button to the control panel between the generate row and API key section. After calling `applyStyle()` in `handleGenerate`, I'll trigger `renderSaveButton(true)` to display it, then hide it with `renderSaveButton(false)` once saved or when a preset is applied.\n\nBuilding out the helper methods...\n\nNow I'm figuring out where to place the save button in the DOM—it needs to go between the generate row and the API key section. I'm checking the HTML structure to understand how `#theme-controls` is organized and where exactly to insert the new element.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":79,"cache_read_input_tokens":74410,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":79},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKfkEM3R7iQTZ9NE5R3","type":"assistant","uuid":"5abe7e06-fa7c-49a8-8bb2-1be0324be850","timestamp":"2026-02-22T15:13:19.102Z"}
{"parentUuid":"5abe7e06-fa7c-49a8-8bb2-1be0324be850","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Dr3QWP7BKsw6fbCVJ9xKFC","type":"message","role":"assistant","content":[{"type":"text","text":"まず `index.html` の構造を確認してから設計します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":79,"cache_read_input_tokens":74410,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":79},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKfkEM3R7iQTZ9NE5R3","type":"assistant","uuid":"4f21b7bb-b53d-46a8-ae0c-e1b878ae2df0","timestamp":"2026-02-22T15:13:19.534Z"}
{"parentUuid":"4f21b7bb-b53d-46a8-ae0c-e1b878ae2df0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Dr3QWP7BKsw6fbCVJ9xKFC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011FMMqYC9FxPQoUHdFHM8wT","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/index.html"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":79,"cache_read_input_tokens":74410,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":79},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKfkEM3R7iQTZ9NE5R3","type":"assistant","uuid":"f9d1d1fd-304e-4ff4-950d-8e66d52b2feb","timestamp":"2026-02-22T15:13:19.923Z"}
{"parentUuid":"f9d1d1fd-304e-4ff4-950d-8e66d52b2feb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_011FMMqYC9FxPQoUHdFHM8wT","toolUseID":"toolu_011FMMqYC9FxPQoUHdFHM8wT","timestamp":"2026-02-22T15:13:19.937Z","uuid":"82e09304-57a9-40de-9ce8-fcb1315e9ea7"}
{"parentUuid":"f9d1d1fd-304e-4ff4-950d-8e66d52b2feb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011FMMqYC9FxPQoUHdFHM8wT","type":"tool_result","content":"     1→<!DOCTYPE html>\n     2→<html lang=\"en\">\n     3→<head>\n     4→    <meta charset=\"UTF-8\">\n     5→    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n     6→    <title>GenHN</title>\n     7→    <style id=\"generated-style\"></style>\n     8→    </head>\n     9→<body>\n    10→    <div id=\"theme-controls\">\n    11→        <div id=\"panel-handle\"></div>\n    12→        <div id=\"presets-toggle\" style=\"width: 100%; cursor: pointer; font-size: 11px; margin-bottom: 8px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; user-select: none;\">\n    13→             <span style=\"text-transform: uppercase; letter-spacing: 1px; font-weight: 600;\">Presets</span>\n    14→             <span id=\"presets-icon\" style=\"font-size: 10px;\">▼</span>\n    15→        </div>\n    16→        <div id=\"preset-buttons\" style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; transition: all 0.3s ease; overflow: hidden;\">\n    17→            <!-- Buttons will be generated by gardener.js -->\n    18→        </div>\n    19→        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">\n    20→            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">\n    21→            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>\n    22→        </div>\n    23→    </div>\n    24→\n    25→    <header class=\"hn-header\">\n    26→        <nav class=\"hn-nav\">\n    27→            <button class=\"hn-menu-toggle\" aria-label=\"Toggle Menu\">\n    28→                <span></span>\n    29→                <span></span>\n    30→                <span></span>\n    31→            </button>\n    32→            <a href=\"#\" class=\"hn-logo\" aria-label=\"Hacker News Home\">Y</a>\n    33→            <span class=\"hn-site-title\">Hacker News</span>\n    34→            <ul class=\"hn-nav-links\">\n    35→                <li><a href=\"#\">new</a></li>\n    36→                <li><a href=\"#\">past</a></li>\n    37→                <li><a href=\"#\">comments</a></li>\n    38→                <li><a href=\"#\">ask</a></li>\n    39→                <li><a href=\"#\">show</a></li>\n    40→                <li><a href=\"#\">jobs</a></li>\n    41→                <li><a href=\"#\">submit</a></li>\n    42→            </ul>\n    43→            <div class=\"hn-auth\">\n    44→                <a href=\"https://news.ycombinator.com/login\" target=\"_blank\">login</a>\n    45→            </div>\n    46→        </nav>\n    47→    </header>\n    48→\n    49→    <main class=\"hn-main\">\n    50→        <ol class=\"hn-story-list\">\n    51→            \n    52→            <li class=\"hn-story-item\">\n    53→                <div class=\"hn-story-rank\">1.</div>\n    54→                <div class=\"hn-story-content\">\n    55→                    <div class=\"hn-story-title-row\">\n    56→                        <a href=\"#\" class=\"hn-story-title\">Show HN: A brand new Hacker News experience with Generative UI</a>\n    57→                        <span class=\"hn-story-domain\">(github.com)</span>\n    58→                    </div>\n    59→                    <div class=\"hn-story-meta\">\n    60→                        <span class=\"hn-story-points\">150 points</span> by\n    61→                        <span class=\"hn-story-author\">generative_hacker</span>\n    62→                        <span class=\"hn-story-time\">2 hours ago</span>\n    63→                    </div>\n    64→                </div>\n    65→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n    66→            </li>\n    67→\n    68→            <li class=\"hn-story-item\">\n    69→                <div class=\"hn-story-rank\">2.</div>\n    70→                <div class=\"hn-story-content\">\n    71→                    <div class=\"hn-story-title-row\">\n    72→                        <a href=\"#\" class=\"hn-story-title\">New AI model released as open source</a>\n    73→                        <span class=\"hn-story-domain\">(example.com)</span>\n    74→                    </div>\n    75→                    <div class=\"hn-story-meta\">\n    76→                        <span class=\"hn-story-points\">300 points</span> by\n    77→                        <span class=\"hn-story-author\">ai_fan</span>\n    78→                        <span class=\"hn-story-time\">4 hours ago</span>\n    79→                    </div>\n    80→                </div>\n    81→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n    82→            </li>\n    83→\n    84→            <li class=\"hn-story-item\">\n    85→                <div class=\"hn-story-rank\">3.</div>\n    86→                <div class=\"hn-story-content\">\n    87→                    <div class=\"hn-story-title-row\">\n    88→                        <a href=\"#\" class=\"hn-story-title\">Read the latest design system guidelines</a>\n    89→                        <span class=\"hn-story-domain\">(design.com)</span>\n    90→                    </div>\n    91→                    <div class=\"hn-story-meta\">\n    92→                        <span class=\"hn-story-points\">215 points</span> by\n    93→                        <span class=\"hn-story-author\">design_geek</span>\n    94→                        <span class=\"hn-story-time\">5 hours ago</span>\n    95→                    </div>\n    96→                </div>\n    97→                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n    98→            </li>\n    99→\n   100→        </ol>\n   101→        \n   102→        <button class=\"hn-load-more\">More</button>\n   103→    </main>\n   104→\n   105→    <footer class=\"hn-footer\">\n   106→        <ul class=\"hn-footer-links\">\n   107→            <li><a href=\"#\">Guidelines</a></li>\n   108→            <li><a href=\"#\">FAQ</a></li>\n   109→            <li><a href=\"#\">Lists</a></li>\n   110→            <li><a href=\"#\">API</a></li>\n   111→            <li><a href=\"#\">Security</a></li>\n   112→            <li><a href=\"#\">Legal</a></li>\n   113→            <li><a href=\"#\">Apply to YC</a></li>\n   114→            <li><a href=\"#\">Contact</a></li>\n   115→        </ul>\n   116→    </footer>\n   117→    <script src=\"gardener.js\"></script>\n   118→</body>\n   119→</html>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c42961b0-8ba4-4df6-a760-91526bd9c86c","timestamp":"2026-02-22T15:13:19.936Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/index.html","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>GenHN</title>\n    <style id=\"generated-style\"></style>\n    </head>\n<body>\n    <div id=\"theme-controls\">\n        <div id=\"panel-handle\"></div>\n        <div id=\"presets-toggle\" style=\"width: 100%; cursor: pointer; font-size: 11px; margin-bottom: 8px; opacity: 0.6; display: flex; justify-content: space-between; align-items: center; user-select: none;\">\n             <span style=\"text-transform: uppercase; letter-spacing: 1px; font-weight: 600;\">Presets</span>\n             <span id=\"presets-icon\" style=\"font-size: 10px;\">▼</span>\n        </div>\n        <div id=\"preset-buttons\" style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; transition: all 0.3s ease; overflow: hidden;\">\n            <!-- Buttons will be generated by gardener.js -->\n        </div>\n        <div style=\"display: flex; gap: 10px; align-items: center; width: 100%;\">\n            <input type=\"text\" id=\"prompt-input\" placeholder=\"Enter theme...\" style=\"padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; outline: none; flex: 1; min-width: 0;\">\n            <button id=\"generate-btn\" style=\"padding: 8px 16px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; white-space: nowrap;\">Apply</button>\n        </div>\n    </div>\n\n    <header class=\"hn-header\">\n        <nav class=\"hn-nav\">\n            <button class=\"hn-menu-toggle\" aria-label=\"Toggle Menu\">\n                <span></span>\n                <span></span>\n                <span></span>\n            </button>\n            <a href=\"#\" class=\"hn-logo\" aria-label=\"Hacker News Home\">Y</a>\n            <span class=\"hn-site-title\">Hacker News</span>\n            <ul class=\"hn-nav-links\">\n                <li><a href=\"#\">new</a></li>\n                <li><a href=\"#\">past</a></li>\n                <li><a href=\"#\">comments</a></li>\n                <li><a href=\"#\">ask</a></li>\n                <li><a href=\"#\">show</a></li>\n                <li><a href=\"#\">jobs</a></li>\n                <li><a href=\"#\">submit</a></li>\n            </ul>\n            <div class=\"hn-auth\">\n                <a href=\"https://news.ycombinator.com/login\" target=\"_blank\">login</a>\n            </div>\n        </nav>\n    </header>\n\n    <main class=\"hn-main\">\n        <ol class=\"hn-story-list\">\n            \n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">1.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">Show HN: A brand new Hacker News experience with Generative UI</a>\n                        <span class=\"hn-story-domain\">(github.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">150 points</span> by\n                        <span class=\"hn-story-author\">generative_hacker</span>\n                        <span class=\"hn-story-time\">2 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">2.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">New AI model released as open source</a>\n                        <span class=\"hn-story-domain\">(example.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">300 points</span> by\n                        <span class=\"hn-story-author\">ai_fan</span>\n                        <span class=\"hn-story-time\">4 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n            <li class=\"hn-story-item\">\n                <div class=\"hn-story-rank\">3.</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"#\" class=\"hn-story-title\">Read the latest design system guidelines</a>\n                        <span class=\"hn-story-domain\">(design.com)</span>\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">215 points</span> by\n                        <span class=\"hn-story-author\">design_geek</span>\n                        <span class=\"hn-story-time\">5 hours ago</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            </li>\n\n        </ol>\n        \n        <button class=\"hn-load-more\">More</button>\n    </main>\n\n    <footer class=\"hn-footer\">\n        <ul class=\"hn-footer-links\">\n            <li><a href=\"#\">Guidelines</a></li>\n            <li><a href=\"#\">FAQ</a></li>\n            <li><a href=\"#\">Lists</a></li>\n            <li><a href=\"#\">API</a></li>\n            <li><a href=\"#\">Security</a></li>\n            <li><a href=\"#\">Legal</a></li>\n            <li><a href=\"#\">Apply to YC</a></li>\n            <li><a href=\"#\">Contact</a></li>\n        </ul>\n    </footer>\n    <script src=\"gardener.js\"></script>\n</body>\n</html>","numLines":119,"startLine":1,"totalLines":119}},"sourceToolAssistantUUID":"f9d1d1fd-304e-4ff4-950d-8e66d52b2feb"}
{"parentUuid":"c42961b0-8ba4-4df6-a760-91526bd9c86c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01VY3uSk63kaZEpMV3Cn1gze","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a clear picture of the structure. The `#theme-controls` div contains:\n1. `#panel-handle`\n2. `#presets-toggle` (static, with the \"Presets ▼\" label)\n3. `#preset-buttons` (where preset buttons are rendered)\n4. A div with `#prompt-input` and `#generate-btn`\n5. (dynamically added) `#api-key-section`\n\nMy plan:\n1. Add saved theme buttons to `#preset-buttons` (after built-in presets), with thicker border\n2. Add a \"Save as Preset\" button that appears after AI generation (inserted after the generate row, before `#api-key-section`)\n\n\n3. I need to implement helper functions to render saved themes, extract a one-word name from the prompt, handle saving and deletion, and manage the save button visibility—showing it after generation completes and hiding it when switching presets or applying a new theme.\n\n4. For placement, I'll insert the save button row right after the generate button and before the API key section using a dynamic element with id `#save-theme-row`.\n\n5. On the delete interaction, I'm settling on always showing a small × button on the saved theme buttons rather than relying on hover, since that won't work on mobile—I'll style it subtly so it doesn't clutter the interface.\n\n6. For the CSS implementation, I'm creating a wrapper for each saved theme button that positions the delete button absolutely, using opacity changes to make it semi-visible on touch devices and fully visible on hover for desktop users.\n\nStyling the delete button positioning... Setting up event listeners...\n\nFor the save button, I'll add a `renderSaveButton()` method that creates or removes a \"Save as Preset\" button positioned after the generate row and before the API key section. I also need a `summarizePrompt()` helper that filters out common words to create concise preset names. Writing theme management logic... Writing the theme button styles... Writing the delete button... Writing the save button handler... I'm realizing the save button should only appear after fresh AI generation, not on page reload even if there's a custom theme stored. And when saving, there's already a check to prevent duplicates if the theme matches an existing saved one.\n\nNow I need to add the call to render saved theme buttons in the init function, and I'm thinking through whether the save button should appear when applying a saved theme—it shouldn't, since I'm only explicitly triggering it after AI generation.\n\nOn page reload, if there's a saved custom theme, I should apply it, but I need to decide whether to show the save button. The logic should be: only show it if the theme isn't already saved.\n\nChecking the initialization flow... Writing the save button logic...\n\nNow I need to figure out where to place these new methods in the App class and make sure I'm modifying the right sections of the existing code.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":6897,"cache_read_input_tokens":74489,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6897},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKmJtm5P429GMpEM9RW","type":"assistant","uuid":"6f133e7b-c232-416b-94b3-c8baa292c6a8","timestamp":"2026-02-22T15:14:25.983Z"}
{"parentUuid":"6f133e7b-c232-416b-94b3-c8baa292c6a8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01VY3uSk63kaZEpMV3Cn1gze","type":"message","role":"assistant","content":[{"type":"text","text":"構造を把握しました。実装設計をまとめると：\n\n- **保存**: `acephale-saved-themes` (JSON配列) に `{id, name, css, prompt}` で保存\n- **1単語要約**: ストップワードを除いた最初の意味ある単語を抽出・大文字化\n- **Saveボタン**: AI生成成功時のみ表示（生成行の直下）、保存済みなら非表示\n- **削除**: ボタンへのホバーで × が現れる\n- **太枠**: `border: 2px solid rgba(0,0,0,0.25)` (通常は `1px solid rgba(0,0,0,0.1)`)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":6897,"cache_read_input_tokens":74489,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6897},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKmJtm5P429GMpEM9RW","type":"assistant","uuid":"081873d4-005d-4e1a-86d0-d4df7cb9aced","timestamp":"2026-02-22T15:14:29.645Z"}
{"parentUuid":"081873d4-005d-4e1a-86d0-d4df7cb9aced","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01VY3uSk63kaZEpMV3Cn1gze","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Dt9M7VayqsB9MRuyL3Cdk2","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":907,"limit":20},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":6897,"cache_read_input_tokens":74489,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6897},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKmJtm5P429GMpEM9RW","type":"assistant","uuid":"e2cf4db8-5893-418a-8b9b-aee11d8e5565","timestamp":"2026-02-22T15:14:30.811Z"}
{"parentUuid":"e2cf4db8-5893-418a-8b9b-aee11d8e5565","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Dt9M7VayqsB9MRuyL3Cdk2","toolUseID":"toolu_01Dt9M7VayqsB9MRuyL3Cdk2","timestamp":"2026-02-22T15:14:30.892Z","uuid":"0f77633d-5857-4953-b392-659338364740"}
{"parentUuid":"e2cf4db8-5893-418a-8b9b-aee11d8e5565","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Dt9M7VayqsB9MRuyL3Cdk2","type":"tool_result","content":"   907→    async init() {\n   908→        this.renderPresetButtons();\n   909→        this.renderApiKeySection();\n   910→        this.bindEvents();\n   911→\n   912→        const savedPreset = localStorage.getItem('acephale-theme');\n   913→        const savedCustom = localStorage.getItem('acephale-custom-css');\n   914→        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n   915→\n   916→        if (savedCustom) {\n   917→            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n   918→            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n   919→        } else {\n   920→            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n   921→            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n   922→        }\n   923→\n   924→        await this.loadInitial();\n   925→    },\n   926→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"9aded8c2-b944-4736-9a7c-3e9f40749e06","timestamp":"2026-02-22T15:14:30.891Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n","numLines":20,"startLine":907,"totalLines":1351}},"sourceToolAssistantUUID":"e2cf4db8-5893-418a-8b9b-aee11d8e5565"}
{"parentUuid":"9aded8c2-b944-4736-9a7c-3e9f40749e06","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Fz8i95wYje6hBtodJKeuu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012V5yvYbrLArm6ReHmz7Rbx","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":1290,"limit":65},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":5033,"cache_read_input_tokens":81386,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5033},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKrYKHwpHXiutaBwYpx","type":"assistant","uuid":"1e82e73b-1065-4799-862b-e7f6490190e2","timestamp":"2026-02-22T15:14:33.832Z"}
{"parentUuid":"1e82e73b-1065-4799-862b-e7f6490190e2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_012V5yvYbrLArm6ReHmz7Rbx","toolUseID":"toolu_012V5yvYbrLArm6ReHmz7Rbx","timestamp":"2026-02-22T15:14:33.913Z","uuid":"0746995a-d85f-4685-bd90-0eacf5d643d5"}
{"parentUuid":"1e82e73b-1065-4799-862b-e7f6490190e2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012V5yvYbrLArm6ReHmz7Rbx","type":"tool_result","content":"  1290→            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n  1291→            this.togglePresets(true);\n  1292→            return;\n  1293→        }\n  1294→\n  1295→        if (!this.getApiKey()) {\n  1296→            this.expandApiKeySection();\n  1297→            return;\n  1298→        }\n  1299→\n  1300→        this._isGenerating = true;\n  1301→        const btn = this.elements.generateBtn;\n  1302→        const originalText = btn.textContent;\n  1303→        btn.textContent = 'Generating...';\n  1304→        btn.disabled = true;\n  1305→\n  1306→        try {\n  1307→            const css = await this.generateTheme(input);\n  1308→            this.applyStyle(css, null, input);\n  1309→            this.togglePresets(true);\n  1310→        } catch (err) {\n  1311→            this.showGenerateError(err);\n  1312→        } finally {\n  1313→            btn.textContent = originalText;\n  1314→            btn.disabled = false;\n  1315→            this._isGenerating = false;\n  1316→        }\n  1317→    },\n  1318→\n  1319→    matchStyle(input) {\n  1320→        const normalizedInput = input.toLowerCase();\n  1321→        for (const key in STYLE_PRESETS) {\n  1322→            if (normalizedInput.includes(key.toLowerCase())) return key;\n  1323→        }\n  1324→        return null;\n  1325→    },\n  1326→\n  1327→    applyStyle(css, themeName, customPrompt = null) {\n  1328→        this.toggleMenu(false);\n  1329→\n  1330→        if (themeName && STYLE_PRESETS[themeName]) {\n  1331→            localStorage.setItem('acephale-theme', themeName);\n  1332→            localStorage.removeItem('acephale-custom-css');\n  1333→            localStorage.removeItem('acephale-custom-prompt');\n  1334→        } else if (customPrompt) {\n  1335→            localStorage.setItem('acephale-custom-css', css);\n  1336→            localStorage.setItem('acephale-custom-prompt', customPrompt);\n  1337→            localStorage.removeItem('acephale-theme');\n  1338→        }\n  1339→\n  1340→        const applyFn = () => {\n  1341→            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n  1342→        };\n  1343→\n  1344→        if (!document.startViewTransition) { applyFn(); return; }\n  1345→        document.startViewTransition(applyFn);\n  1346→    }\n  1347→};\n  1348→\n  1349→// Start the application\n  1350→document.addEventListener('DOMContentLoaded', () => App.init());\n  1351→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1dfba436-1f06-4ccc-a2eb-0da58b044114","timestamp":"2026-02-22T15:14:33.912Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","numLines":62,"startLine":1290,"totalLines":1351}},"sourceToolAssistantUUID":"1e82e73b-1065-4799-862b-e7f6490190e2"}
{"parentUuid":"1dfba436-1f06-4ccc-a2eb-0da58b044114","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_012VcCFd3HWCxkMKxNxEGooq","type":"message","role":"assistant","content":[{"type":"text","text":"全体像を把握しました。では実装します。まず `init()` の更新から："}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":990,"cache_read_input_tokens":86419,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":990},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKrmEBM9AzWYMWMdtYv","type":"assistant","uuid":"dc229064-a61c-4af1-9b9b-58e905fef607","timestamp":"2026-02-22T15:14:36.248Z"}
{"parentUuid":"dc229064-a61c-4af1-9b9b-58e905fef607","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_012VcCFd3HWCxkMKxNxEGooq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013cuHTwghJn49YGfe3iho28","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },","new_string":"    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":990,"cache_read_input_tokens":86419,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":990},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKrmEBM9AzWYMWMdtYv","type":"assistant","uuid":"7c06afcc-8c8c-4bec-9930-5f8c0e9068cf","timestamp":"2026-02-22T15:14:40.562Z"}
{"parentUuid":"7c06afcc-8c8c-4bec-9930-5f8c0e9068cf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_013cuHTwghJn49YGfe3iho28","toolUseID":"toolu_013cuHTwghJn49YGfe3iho28","timestamp":"2026-02-22T15:14:40.568Z","uuid":"5ad8c4f0-8eba-4432-8361-bc395388de4e"}
{"parentUuid":"7c06afcc-8c8c-4bec-9930-5f8c0e9068cf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013cuHTwghJn49YGfe3iho28","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"862d7eda-9c20-42e0-bbc3-f05d8f8446fd","timestamp":"2026-02-22T15:14:40.567Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },","newString":"    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":906,"oldLines":6,"newStart":906,"newLines":7,"lines":[" ","     async init() {","         this.renderPresetButtons();","+        this.renderSavedThemeButtons();","         this.renderApiKeySection();","         this.bindEvents();"," "]},{"oldStart":916,"oldLines":6,"newStart":917,"newLines":8,"lines":["         if (savedCustom) {","             this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');","             if (savedPrompt) this.elements.promptInput.value = savedPrompt;","+            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);","+            this.renderSaveButton(!alreadySaved);","         } else {","             const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';","             this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"7c06afcc-8c8c-4bec-9930-5f8c0e9068cf"}
{"parentUuid":"862d7eda-9c20-42e0-bbc3-f05d8f8446fd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01UtZPg14PzAw9iwRkuJaNgy","type":"message","role":"assistant","content":[{"type":"text","text":"次に新メソッド群を `expandApiKeySection` の直後、`handleGenerate` の前に追加します："}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":697,"cache_read_input_tokens":87409,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":697},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKsFhwUaqYiagoBJgsH","type":"assistant","uuid":"35d80f67-e051-4021-90ea-782feaac076e","timestamp":"2026-02-22T15:14:43.121Z"}
{"parentUuid":"35d80f67-e051-4021-90ea-782feaac076e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01UtZPg14PzAw9iwRkuJaNgy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012etAjeLSN7SbtyvJeG1nw2","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"    async handleGenerate() {","new_string":"    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('acephale-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('acephale-custom-css');\n        const prompt = localStorage.getItem('acephale-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":697,"cache_read_input_tokens":87409,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":697},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKsFhwUaqYiagoBJgsH","type":"assistant","uuid":"b3c78e1a-0039-4f9d-ab16-7892255490bd","timestamp":"2026-02-22T15:15:00.052Z"}
{"parentUuid":"b3c78e1a-0039-4f9d-ab16-7892255490bd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_012etAjeLSN7SbtyvJeG1nw2","toolUseID":"toolu_012etAjeLSN7SbtyvJeG1nw2","timestamp":"2026-02-22T15:15:00.061Z","uuid":"e520923f-7ac4-4f97-a991-253cdbe41e63"}
{"parentUuid":"b3c78e1a-0039-4f9d-ab16-7892255490bd","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012etAjeLSN7SbtyvJeG1nw2","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"15da2db5-3f77-48fa-9d8c-14d8d3301576","timestamp":"2026-02-22T15:15:00.060Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"    async handleGenerate() {","newString":"    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('acephale-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('acephale-custom-css');\n        const prompt = localStorage.getItem('acephale-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1283,"oldLines":6,"newStart":1283,"newLines":95,"lines":["         if (input) setTimeout(() => input.focus(), 300);","     },"," ","+    summarizePrompt(prompt) {","+        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);","+        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);","+        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';","+        return word.charAt(0).toUpperCase() + word.slice(1);","+    },","+","+    getSavedThemes() {","+        try { return JSON.parse(localStorage.getItem('acephale-saved-themes') || '[]'); }","+        catch (_) { return []; }","+    },","+","+    saveCurrentTheme() {","+        const css = localStorage.getItem('acephale-custom-css');","+        const prompt = localStorage.getItem('acephale-custom-prompt') || 'Custom';","+        if (!css) return;","+","+        const baseName = this.summarizePrompt(prompt);","+        const saved = this.getSavedThemes();","+        if (saved.some(t => t.css === css)) return;","+","+        let name = baseName;","+        const existingNames = new Set(saved.map(t => t.name));","+        let i = 2;","+        while (existingNames.has(name)) { name = `${baseName}${i++}`; }","+","+        saved.push({ id: Date.now().toString(), name, css, prompt });","+        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));","+        this.renderSavedThemeButtons();","+        this.renderSaveButton(false);","+    },","+","+    deleteSavedTheme(id) {","+        const saved = this.getSavedThemes().filter(t => t.id !== id);","+        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));","+        this.renderSavedThemeButtons();","+    },","+","+    renderSavedThemeButtons() {","+        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());","+","+        this.getSavedThemes().forEach(theme => {","+            const wrapper = document.createElement('div');","+            wrapper.className = 'saved-theme-btn-wrapper';","+            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';","+","+            const btn = document.createElement('button');","+            btn.textContent = theme.name;","+            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';","+            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });","+            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });","+            btn.addEventListener('click', () => {","+                this.elements.promptInput.value = theme.prompt;","+                this.applyStyle(theme.css, null, theme.prompt);","+                this.renderSaveButton(false);","+                this.togglePresets(true);","+            });","+","+            const delBtn = document.createElement('button');","+            delBtn.textContent = '×';","+            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';","+            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });","+            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });","+            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });","+","+            wrapper.appendChild(btn);","+            wrapper.appendChild(delBtn);","+            this.elements.presetButtons.appendChild(wrapper);","+        });","+    },","+","+    renderSaveButton(show) {","+        const existing = document.getElementById('save-theme-row');","+        if (existing) existing.remove();","+        if (!show) return;","+","+        const row = document.createElement('div');","+        row.id = 'save-theme-row';","+        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';","+","+        const btn = document.createElement('button');","+        btn.textContent = 'Save as Preset';","+        btn.style.cssText = 'font-size:11px;';","+        btn.addEventListener('click', () => this.saveCurrentTheme());","+","+        row.appendChild(btn);","+        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);","+    },","+","     async handleGenerate() {","         const input = this.elements.promptInput.value.trim();","         if (!input) return;"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b3c78e1a-0039-4f9d-ab16-7892255490bd"}
{"parentUuid":"15da2db5-3f77-48fa-9d8c-14d8d3301576","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_014zyC2EzEfxzyrLDpSH7mg1","type":"message","role":"assistant","content":[{"type":"text","text":"次に `handleGenerate` の成功後に Save ボタンを表示："}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1756,"cache_read_input_tokens":88106,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1756},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKthMZit9ZdjR3gYEf3","type":"assistant","uuid":"7efc2f53-d965-4400-9ffa-29b8b0dd2f33","timestamp":"2026-02-22T15:15:02.365Z"}
{"parentUuid":"7efc2f53-d965-4400-9ffa-29b8b0dd2f33","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_014zyC2EzEfxzyrLDpSH7mg1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01U1o1ZExLUh7NicYqfvbTCn","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {","new_string":"        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1756,"cache_read_input_tokens":88106,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1756},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKthMZit9ZdjR3gYEf3","type":"assistant","uuid":"1fed0d16-903e-437c-879e-794851f2015d","timestamp":"2026-02-22T15:15:04.252Z"}
{"parentUuid":"1fed0d16-903e-437c-879e-794851f2015d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01U1o1ZExLUh7NicYqfvbTCn","toolUseID":"toolu_01U1o1ZExLUh7NicYqfvbTCn","timestamp":"2026-02-22T15:15:04.257Z","uuid":"07fadfb0-25c8-46c8-bec1-3a4fa7d05faf"}
{"parentUuid":"1fed0d16-903e-437c-879e-794851f2015d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01U1o1ZExLUh7NicYqfvbTCn","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"bc195692-ca4d-4c3d-9e18-603c9dca43a0","timestamp":"2026-02-22T15:15:04.257Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {","newString":"        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('acephale-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('acephale-custom-css');\n        const prompt = localStorage.getItem('acephale-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1399,"oldLines":6,"newStart":1399,"newLines":7,"lines":["             const css = await this.generateTheme(input);","             this.applyStyle(css, null, input);","             this.togglePresets(true);","+            this.renderSaveButton(true);","         } catch (err) {","             this.showGenerateError(err);","         } finally {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"1fed0d16-903e-437c-879e-794851f2015d"}
{"parentUuid":"bc195692-ca4d-4c3d-9e18-603c9dca43a0","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HK3y7iECnTdTu2mipR1Hrx","type":"message","role":"assistant","content":[{"type":"text","text":"最後に `applyStyle` でプリセット選択時は Save ボタンを消す："}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":298,"cache_read_input_tokens":89862,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":298},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKu1dQck42n2B5oUBkt","type":"assistant","uuid":"d7461942-9118-4625-8832-7b6afd990521","timestamp":"2026-02-22T15:15:07.641Z"}
{"parentUuid":"d7461942-9118-4625-8832-7b6afd990521","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01HK3y7iECnTdTu2mipR1Hrx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018UswdvH85nAZu2fXRyaE5E","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {","new_string":"        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":298,"cache_read_input_tokens":89862,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":298},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKu1dQck42n2B5oUBkt","type":"assistant","uuid":"b1cd9d84-2626-4276-a93e-c8dc797367dc","timestamp":"2026-02-22T15:15:10.121Z"}
{"parentUuid":"b1cd9d84-2626-4276-a93e-c8dc797367dc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_018UswdvH85nAZu2fXRyaE5E","toolUseID":"toolu_018UswdvH85nAZu2fXRyaE5E","timestamp":"2026-02-22T15:15:10.125Z","uuid":"09122536-5f65-4e4b-817c-1f22e70f128f"}
{"parentUuid":"b1cd9d84-2626-4276-a93e-c8dc797367dc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018UswdvH85nAZu2fXRyaE5E","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"a479a9cd-d936-46e9-bba1-791c3cac0f2e","timestamp":"2026-02-22T15:15:10.124Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {","newString":"        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('acephale-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('acephale-custom-css');\n        const prompt = localStorage.getItem('acephale-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":1424,"oldLines":6,"newStart":1424,"newLines":7,"lines":["             localStorage.setItem('acephale-theme', themeName);","             localStorage.removeItem('acephale-custom-css');","             localStorage.removeItem('acephale-custom-prompt');","+            this.renderSaveButton(false);","         } else if (customPrompt) {","             localStorage.setItem('acephale-custom-css', css);","             localStorage.setItem('acephale-custom-prompt', customPrompt);"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b1cd9d84-2626-4276-a93e-c8dc797367dc"}
{"parentUuid":"a479a9cd-d936-46e9-bba1-791c3cac0f2e","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Ut2xdArjc4p2XeFk5rsyH8","type":"message","role":"assistant","content":[{"type":"text","text":"動作を確認してからコミットします："}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":353,"cache_read_input_tokens":90160,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":353},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKuSHUqmYcrSpD49z4M","type":"assistant","uuid":"a275e463-e9b5-4fad-9e81-5d01160f8d93","timestamp":"2026-02-22T15:15:13.837Z"}
{"parentUuid":"a275e463-e9b5-4fad-9e81-5d01160f8d93","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Ut2xdArjc4p2XeFk5rsyH8","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VhuMxt1v7PzaPm6etWy7mU","name":"Bash","input":{"command":"node --input-type=module <<'EOF'\n// Minimal sanity check: parse the file for syntax errors\nimport { readFileSync } from 'fs';\nconst src = readFileSync('/Users/turtlekazu/ReactProjects/acephale/gardener.js', 'utf8');\n// Wrap in an async IIFE to allow top-level await-like parsing\ntry {\n  new Function(src);\n  console.log('Syntax OK');\n} catch (e) {\n  console.error('Syntax error:', e.message);\n}\nEOF","description":"Check gardener.js for syntax errors"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":353,"cache_read_input_tokens":90160,"output_tokens":223,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":353,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYPKuSHUqmYcrSpD49z4M","type":"assistant","uuid":"9827b57b-d3b3-4421-8a02-e991c41a7f2c","timestamp":"2026-02-22T15:15:14.998Z"}
{"parentUuid":"9827b57b-d3b3-4421-8a02-e991c41a7f2c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VhuMxt1v7PzaPm6etWy7mU","type":"tool_result","content":"Syntax OK","is_error":false}]},"uuid":"5108fbd9-6485-4ef2-9287-9d69e5138ace","timestamp":"2026-02-22T15:15:26.317Z","toolUseResult":{"stdout":"Syntax OK","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"9827b57b-d3b3-4421-8a02-e991c41a7f2c"}
{"parentUuid":"5108fbd9-6485-4ef2-9287-9d69e5138ace","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_013V12iKwsjiTUWExkaCMBX7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017uyZ4yKLARTqyhF47cYhZt","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nAdd saved AI themes as user presets\n\n- Add getSavedThemes / saveCurrentTheme / deleteSavedTheme methods\n- Add summarizePrompt() to extract a 1-word name from the prompt\n- Add renderSavedThemeButtons() — saved themes appear in the Presets\n  section with a thicker border (2px) to distinguish from built-ins\n- Add renderSaveButton() — \"Save as Preset\" button shown after AI\n  generation, hidden on preset selection or after saving\n- × delete button on each saved-theme button (hover to reveal)\n- On page reload, show Save button if custom theme is not yet saved\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Commit saved themes feature"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":238,"cache_read_input_tokens":90513,"output_tokens":270,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":238,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYPKvdKHWmZnPAzhcQYEu","type":"assistant","uuid":"29c14ea2-436d-4eb2-8004-982a148cccfb","timestamp":"2026-02-22T15:15:33.890Z"}
{"parentUuid":"29c14ea2-436d-4eb2-8004-982a148cccfb","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017uyZ4yKLARTqyhF47cYhZt","type":"tool_result","content":"[main 9c9114d] Add saved AI themes as user presets\n 1 file changed, 94 insertions(+)","is_error":false}]},"uuid":"1d8470ce-08b5-4732-ba8a-e9676e02eb95","timestamp":"2026-02-22T15:15:34.832Z","toolUseResult":{"stdout":"[main 9c9114d] Add saved AI themes as user presets\n 1 file changed, 94 insertions(+)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"29c14ea2-436d-4eb2-8004-982a148cccfb"}
{"parentUuid":"1d8470ce-08b5-4732-ba8a-e9676e02eb95","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_018dvWBGPP9CaM2wo2GmUHLg","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました (`9c9114d`)。動作の流れ：\n\n1. **AI生成後** → `Apply` → テーマ適用と同時に「**Save as Preset**」ボタンが入力行の下に出現\n2. **Save as Preset をクリック** → プロンプトから1単語を抽出してボタン名に（例: \"brutalist newspaper\" → `Brutalist`）、Presets 欄に**太枠ボタン**として追加\n3. **× 削除** → ボタンにホバーすると右上に × が浮かび上がり、クリックで削除\n4. **ページリロード** → 保存済みテーマはそのまま残り、未保存の AI テーマには再び Save ボタンが表示される"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":312,"cache_read_input_tokens":90751,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":312},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPKwFiYM79kMoqLqUp7D","type":"assistant","uuid":"73517346-39c3-4ae7-ad09-f0f65530b7a2","timestamp":"2026-02-22T15:15:41.182Z"}
{"parentUuid":"73517346-39c3-4ae7-ad09-f0f65530b7a2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"58fed34d-aae7-41d1-9cd1-958a2470c1ef","toolUseID":"58fed34d-aae7-41d1-9cd1-958a2470c1ef","timestamp":"2026-02-22T15:15:41.360Z","uuid":"458a4df3-83ea-413f-9596-4f7190097255"}
{"parentUuid":"458a4df3-83ea-413f-9596-4f7190097255","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":936}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-22T15:15:42.297Z","uuid":"aaa60426-081e-4465-b642-b3bcd36e0eb8","toolUseID":"58fed34d-aae7-41d1-9cd1-958a2470c1ef"}
{"parentUuid":"aaa60426-081e-4465-b642-b3bcd36e0eb8","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"turn_duration","durationMs":206797,"timestamp":"2026-02-22T15:15:42.299Z","uuid":"2c032a9a-7667-4061-95bd-da7372d4b40a","isMeta":false}
{"type":"file-history-snapshot","messageId":"11fa9c71-3447-4301-b306-5073c37f33e4","snapshot":{"messageId":"11fa9c71-3447-4301-b306-5073c37f33e4","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v4","version":4,"backupTime":"2026-02-22T15:18:02.934Z"}},"timestamp":"2026-02-22T15:18:02.934Z"},"isSnapshotUpdate":false}
{"parentUuid":"2c032a9a-7667-4061-95bd-da7372d4b40a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"生成されるテーマが、いまいちバリエーションに欠けているのと、コントラストが悪い配色の時があり、見づらい場合があります。この部分をプロンプトで改良してください。"},"uuid":"11fa9c71-3447-4301-b306-5073c37f33e4","timestamp":"2026-02-22T15:18:02.816Z","permissionMode":"acceptEdits"}
{"parentUuid":"11fa9c71-3447-4301-b306-5073c37f33e4","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01W1PXo4owfHHpyShQScmv6C","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to improve the `GEMINI_SYSTEM_PROMPT` to generate more varied themes with better contrast. Let me read the current prompt and think about what improvements to make.\n\nCurrent prompt:\n```\nYou are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* up\n\nDefining CSS custom properties for theming... I'm thinking through what makes themes visually distinct—color extremes ranging from very dark to neon, typography choices like serif versus monospace, and different layout approaches. I also need to ensure accessibility by maintaining proper contrast ratios: text needs at least 7:1 against the background, subtext needs 4.5:1, and button colors need similar contrast. The key is committing fully to each theme's personality with unexpected color combinations and dramatic typography variations rather than defaulting to safe palettes.\n\nNow I'm refining the prompt to be more specific about these requirements...\n\nGenerating CSS theme rules... Still writing CSS variables... I'm thinking through better contrast rules that are practical for the model to apply—using simple luminance-based logic rather than precise WCAG calculations. The key insight is to keep text near black or white while letting backgrounds be more colorful, and ensuring subtler text elements maintain visibility against the background. I should also clarify that card backgrounds need to be visually distinct from the main background so they actually stand out.\n\nWriting the CSS theme generator prompt... Defining CSS variables...\n\nI'm refining the approach—removing verbose comments from the variable declarations and making the variety rules more concrete with specific guidance on aesthetic extremes. I should also push harder on component overrides to inject personality, and consider adding font recommendations that create distinct visual styles, like serif fonts for editorial themes versus modern sans-serifs for tech-forward designs. I'm laying out different font families as examples to spark creativity—from terminal aesthetics to elegant serifs. I should include these in the prompt to guide the model toward diverse typographic choices.\n\nI'm also refining the prompt structure to remove variable comments for cleaner output, then providing a comprehensive system prompt that emphasizes readability constraints and variety requirements for the CSS theme generator. Defining the CSS variables... I'm settling on specific hex values for text contrast—light backgrounds need dark text like #222 or #111, while dark backgrounds work best with #eee or #fff. For secondary text, I'm aiming for #666 on light backgrounds and #999 on dark ones, which gives me contrast ratios well above WCAG AA standards. I should also make sure the card background stands out visibly from the main background, and consider how the header background fits into this scheme.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":69,"cache_read_input_tokens":91283,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":69},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPL8B9WoskuxTh7pCHTL","type":"assistant","uuid":"b5986076-edcb-4b27-83e1-10fd3c33ac80","timestamp":"2026-02-22T15:19:10.387Z"}
{"parentUuid":"b5986076-edcb-4b27-83e1-10fd3c33ac80","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01W1PXo4owfHHpyShQScmv6C","type":"message","role":"assistant","content":[{"type":"text","text":"現在のシステムプロンプトを確認して、改善版を設計します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":69,"cache_read_input_tokens":91283,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":69},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPL8B9WoskuxTh7pCHTL","type":"assistant","uuid":"ab4a2d48-9173-4a98-8502-ac937cc5f72f","timestamp":"2026-02-22T15:19:10.556Z"}
{"parentUuid":"ab4a2d48-9173-4a98-8502-ac937cc5f72f","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01W1PXo4owfHHpyShQScmv6C","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PTXQNgSar8EaLHh3UQAhwa","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":8,"limit":35},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":69,"cache_read_input_tokens":91283,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":69},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPL8B9WoskuxTh7pCHTL","type":"assistant","uuid":"dd10d6b7-3103-4c86-b4b7-e9d8a28f2f01","timestamp":"2026-02-22T15:19:11.589Z"}
{"parentUuid":"dd10d6b7-3103-4c86-b4b7-e9d8a28f2f01","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01PTXQNgSar8EaLHh3UQAhwa","toolUseID":"toolu_01PTXQNgSar8EaLHh3UQAhwa","timestamp":"2026-02-22T15:19:11.680Z","uuid":"9c8c1e7d-f292-453b-b1ec-482b858eb1fc"}
{"parentUuid":"dd10d6b7-3103-4c86-b4b7-e9d8a28f2f01","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PTXQNgSar8EaLHh3UQAhwa","type":"tool_result","content":"     8→const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n     9→Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n    10→\n    11→Define all of these CSS custom properties on :root, then optionally add component overrides:\n    12→\n    13→:root {\n    14→    --bg:                  /* page background */;\n    15→    --card-bg:             /* story card background */;\n    16→    --text:                /* primary text */;\n    17→    --subtext:             /* secondary/meta text */;\n    18→    --accent:              /* links and accent */;\n    19→    --header-bg:           /* header background (rgba allowed) */;\n    20→    --font-main:           /* font stack */;\n    21→    --item-radius:         /* card border-radius */;\n    22→    --item-border:         /* border shorthand or none */;\n    23→    --item-shadow:         /* box-shadow or none */;\n    24→    --more-btn-bg:         /* More button background */;\n    25→    --more-btn-color:      /* More button text color */;\n    26→    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    27→    --mobile-upvote-color: /* upvote text on mobile */;\n    28→}\n    29→\n    30→Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\n    31→Output nothing except the CSS.`;\n    32→\n    33→/**\n    34→ * System Core Styles (Layout, Typography Base, Responsive Logic)\n    35→ * Themes should override variables in :root or specific classes if needed.\n    36→ */\n    37→const SYSTEM_STYLE = `\n    38→    :root {\n    39→        /* Default Variables (Fallback) */\n    40→        --bg: #ffffff;\n    41→        --text: #333333;\n    42→        --subtext: #888888;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"660a02d4-c7d6-4b7b-bc33-b39c1eb82608","timestamp":"2026-02-22T15:19:11.679Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;","numLines":35,"startLine":8,"totalLines":1445}},"sourceToolAssistantUUID":"dd10d6b7-3103-4c86-b4b7-e9d8a28f2f01"}
{"parentUuid":"660a02d4-c7d6-4b7b-bc33-b39c1eb82608","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01AGgk7RVh5oGdizthRXU3iV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I can see the current prompt. The issues are:\n\n1. No contrast requirements at all\n2. \"optionally add component overrides\" - too weak, should be \"required\"\n3. No variety guidance - the model will default to safe choices\n4. The variable comments in the CSS are verbose and take up output tokens\n\nLet me write the improved prompt.","signature":"EvADCkYICxgCKkD2A7VjvrhxZUvFREWVDgmydm1XwjWO/iltxTtffq6p+7BXyERKROScMiG4r6+dj6wIqGqqQNMSPLwFT7FZk59VEgyQcUnwhc4k+XwJpJMaDKy5H2tvGl9SE/UfGCIwYS6jJfd4WUdIFj+QoRt6nOlu3W5a6t0InqsxR/o7oLfrtqLT6lJof8BkTUBffU56KtcCWLTztMvphxtlzWLIImfrwTc/bxzQfYsRDL2PMwN/sPcU6AGJufMQ2SchQ8XfzoTbt7K8ybkWdnscBLRlTgZJhP3as4GksykRgrYc5buKFWV4xGyMUgDOAPAqncW8xQrE0cFQcGyqB08gtVE8tD8sIkasn9TQpLD0U/hNgQDE7LlgF8nz6qEO0jfe5ilgfHwPlrZxWbQLkY4bPjYcM/x6DPnUxv8qEqtuRrEzDNmfZ/EG4OvFoZ0HQrgTSuXccdnlcLf7KuRJmqk1zrsYi7dUj7KIwb04OoOflXdvkD6FouKy19pBK+IHxI/Lvwkjmz1zkgLxinABtJQqAWqGvSSE0tSvhyO3vM9hCLsKt0DLSbOKCrfMU3IHCpQqJXviF2AbQLwiBZPza0N3l6qXy5SFoKLL1mip4K6kRO14rA2pDm7wmTcQxoLCUX8oCO43g4AywX7LjrpTaxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4692,"cache_read_input_tokens":91352,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4692},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLDEs9FNtFPSTYNZdpS","type":"assistant","uuid":"fe673edd-fe91-48e1-ad72-e72b070e9e37","timestamp":"2026-02-22T15:19:14.928Z"}
{"parentUuid":"fe673edd-fe91-48e1-ad72-e72b070e9e37","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01AGgk7RVh5oGdizthRXU3iV","type":"message","role":"assistant","content":[{"type":"text","text":"問題点の分析：\n- **コントラスト**: 一切指定なし → モデルが近似輝度の色を選びやすい\n- **バリエーション**: \"optionally add component overrides\" が弱すぎ → 安全策に逃げる\n- **変数コメント**: トークンを消費しているが役に立っていない"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4692,"cache_read_input_tokens":91352,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4692},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLDEs9FNtFPSTYNZdpS","type":"assistant","uuid":"e0eb0bf3-3f00-4e2b-99a4-9b15e5a7d510","timestamp":"2026-02-22T15:19:17.299Z"}
{"parentUuid":"e0eb0bf3-3f00-4e2b-99a4-9b15e5a7d510","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01AGgk7RVh5oGdizthRXU3iV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014JhdxCCBeycHW1iUxYf4Ad","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;","new_string":"const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\n=== READABILITY (mandatory) ===\nFirst decide: is the theme DARK or LIGHT based on --bg luminance?\n  DARK  bg → --text must be #ddd or lighter  | --subtext must be #999 or lighter\n  LIGHT bg → --text must be #333 or darker   | --subtext must be #666 or darker\n  --card-bg must be a noticeably different shade/hue from --bg (never identical).\n  --more-btn-color must clearly contrast --more-btn-bg (light-on-dark or dark-on-light).\n  --mobile-upvote-color must clearly contrast --mobile-upvote-bg.\n\n=== VARIETY (mandatory) ===\nCommit fully to the prompt's aesthetic. Generic white or light-gray --bg is forbidden.\nPick a bold, on-theme background (deep navy, warm parchment, neon black, terracotta, etc.).\n\nVary these dimensions to match the mood:\n  --font-main:   'Georgia,serif' for editorial | 'Courier New,monospace' for terminal/hacker |\n                 Impact,'Arial Narrow',sans-serif for bold/poster | system-ui for clean\n  --item-radius: 0px = raw/brutalist | 6-10px = modern | 20-40px = playful/bubbly\n  --item-border / --item-shadow: use thick borders for brutalist, glows for neon, none for minimal\n\nAfter :root, add component overrides — this is REQUIRED, not optional.\nUse .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,\nclip-paths, gradients, box-shadows, text-shadows, or keyframe animations that\nmake the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4692,"cache_read_input_tokens":91352,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4692},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLDEs9FNtFPSTYNZdpS","type":"assistant","uuid":"cf4aef03-3136-4519-8c01-f465258c9e09","timestamp":"2026-02-22T15:19:28.714Z"}
{"parentUuid":"cf4aef03-3136-4519-8c01-f465258c9e09","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_014JhdxCCBeycHW1iUxYf4Ad","toolUseID":"toolu_014JhdxCCBeycHW1iUxYf4Ad","timestamp":"2026-02-22T15:19:28.720Z","uuid":"f293011e-35dc-44a1-af43-d8e4ca90e819"}
{"parentUuid":"cf4aef03-3136-4519-8c01-f465258c9e09","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014JhdxCCBeycHW1iUxYf4Ad","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"b27c49e7-a455-4ef2-8b89-a9b1203f8adc","timestamp":"2026-02-22T15:19:28.719Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;","newString":"const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\n=== READABILITY (mandatory) ===\nFirst decide: is the theme DARK or LIGHT based on --bg luminance?\n  DARK  bg → --text must be #ddd or lighter  | --subtext must be #999 or lighter\n  LIGHT bg → --text must be #333 or darker   | --subtext must be #666 or darker\n  --card-bg must be a noticeably different shade/hue from --bg (never identical).\n  --more-btn-color must clearly contrast --more-btn-bg (light-on-dark or dark-on-light).\n  --mobile-upvote-color must clearly contrast --mobile-upvote-bg.\n\n=== VARIETY (mandatory) ===\nCommit fully to the prompt's aesthetic. Generic white or light-gray --bg is forbidden.\nPick a bold, on-theme background (deep navy, warm parchment, neon black, terracotta, etc.).\n\nVary these dimensions to match the mood:\n  --font-main:   'Georgia,serif' for editorial | 'Courier New,monospace' for terminal/hacker |\n                 Impact,'Arial Narrow',sans-serif for bold/poster | system-ui for clean\n  --item-radius: 0px = raw/brutalist | 6-10px = modern | 20-40px = playful/bubbly\n  --item-border / --item-shadow: use thick borders for brutalist, glows for neon, none for minimal\n\nAfter :root, add component overrides — this is REQUIRED, not optional.\nUse .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,\nclip-paths, gradients, box-shadows, text-shadows, or keyframe animations that\nmake the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations. No markdown. No code fences. No comments.\n\nDefine all of these CSS custom properties on :root, then optionally add component overrides:\n\n:root {\n    --bg:                  /* page background */;\n    --card-bg:             /* story card background */;\n    --text:                /* primary text */;\n    --subtext:             /* secondary/meta text */;\n    --accent:              /* links and accent */;\n    --header-bg:           /* header background (rgba allowed) */;\n    --font-main:           /* font stack */;\n    --item-radius:         /* card border-radius */;\n    --item-border:         /* border shorthand or none */;\n    --item-shadow:         /* box-shadow or none */;\n    --more-btn-bg:         /* More button background */;\n    --more-btn-color:      /* More button text color */;\n    --mobile-upvote-bg:    /* upvote bg on mobile */;\n    --mobile-upvote-color: /* upvote text on mobile */;\n}\n\nOptional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body.\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('acephale-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('acephale-custom-css');\n        const prompt = localStorage.getItem('acephale-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":6,"oldLines":28,"newStart":6,"newLines":49,"lines":[" const BASE_URL = 'https://hacker-news.firebaseio.com/v0';"," "," const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.","-Output ONLY raw CSS. No explanations. No markdown. No code fences. No comments.","+Output ONLY raw CSS. No explanations, markdown, code fences, or comments."," ","-Define all of these CSS custom properties on :root, then optionally add component overrides:","+=== READABILITY (mandatory) ===","+First decide: is the theme DARK or LIGHT based on --bg luminance?","+  DARK  bg → --text must be #ddd or lighter  | --subtext must be #999 or lighter","+  LIGHT bg → --text must be #333 or darker   | --subtext must be #666 or darker","+  --card-bg must be a noticeably different shade/hue from --bg (never identical).","+  --more-btn-color must clearly contrast --more-btn-bg (light-on-dark or dark-on-light).","+  --mobile-upvote-color must clearly contrast --mobile-upvote-bg."," ","+=== VARIETY (mandatory) ===","+Commit fully to the prompt's aesthetic. Generic white or light-gray --bg is forbidden.","+Pick a bold, on-theme background (deep navy, warm parchment, neon black, terracotta, etc.).","+","+Vary these dimensions to match the mood:","+  --font-main:   'Georgia,serif' for editorial | 'Courier New,monospace' for terminal/hacker |","+                 Impact,'Arial Narrow',sans-serif for bold/poster | system-ui for clean","+  --item-radius: 0px = raw/brutalist | 6-10px = modern | 20-40px = playful/bubbly","+  --item-border / --item-shadow: use thick borders for brutalist, glows for neon, none for minimal","+","+After :root, add component overrides — this is REQUIRED, not optional.","+Use .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,","+clip-paths, gradients, box-shadows, text-shadows, or keyframe animations that","+make the aesthetic unmistakable. A theme with only :root variables is incomplete.","+","+=== VARIABLES ==="," :root {","-    --bg:                  /* page background */;","-    --card-bg:             /* story card background */;","-    --text:                /* primary text */;","-    --subtext:             /* secondary/meta text */;","-    --accent:              /* links and accent */;","-    --header-bg:           /* header background (rgba allowed) */;","-    --font-main:           /* font stack */;","-    --item-radius:         /* card border-radius */;","-    --item-border:         /* border shorthand or none */;","-    --item-shadow:         /* box-shadow or none */;","-    --more-btn-bg:         /* More button background */;","-    --more-btn-color:      /* More button text color */;","-    --mobile-upvote-bg:    /* upvote bg on mobile */;","-    --mobile-upvote-color: /* upvote text on mobile */;","+    --bg:","+    --card-bg:","+    --text:","+    --subtext:","+    --accent:","+    --header-bg:","+    --font-main:","+    --item-radius:","+    --item-border:","+    --item-shadow:","+    --more-btn-bg:","+    --more-btn-color:","+    --mobile-upvote-bg:","+    --mobile-upvote-color:"," }"," ","-Optional selectors to override: .hn-header, .hn-story-item, .hn-story-title, .hn-upvote, .hn-logo, body."," Output nothing except the CSS.`;"," "," /**"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"cf4aef03-3136-4519-8c01-f465258c9e09"}
{"parentUuid":"b27c49e7-a455-4ef2-8b89-a9b1203f8adc","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_014P5NNg3XdVEpdp2rZcAfud","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A4QEzbyJGzpdQx4vThMbje","name":"Bash","input":{"command":"node --input-type=module <<'EOF'\nimport { readFileSync } from 'fs';\nconst src = readFileSync('/Users/turtlekazu/ReactProjects/acephale/gardener.js', 'utf8');\ntry { new Function(src); console.log('Syntax OK'); }\ncatch (e) { console.error('Syntax error:', e.message); }\nEOF","description":"Syntax check gardener.js"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1313,"cache_read_input_tokens":96044,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1313},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLEVuJLBq9U8fQNxaoV","type":"assistant","uuid":"f5ebcbea-d19d-4979-9a97-468f9c0b6460","timestamp":"2026-02-22T15:19:32.266Z"}
{"parentUuid":"f5ebcbea-d19d-4979-9a97-468f9c0b6460","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A4QEzbyJGzpdQx4vThMbje","type":"tool_result","content":"Syntax OK","is_error":false}]},"uuid":"3eb69a5d-5a4f-4d35-9138-f535c28755e1","timestamp":"2026-02-22T15:19:32.587Z","toolUseResult":{"stdout":"Syntax OK","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"f5ebcbea-d19d-4979-9a97-468f9c0b6460"}
{"parentUuid":"3eb69a5d-5a4f-4d35-9138-f535c28755e1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01PeE2QU4KVGtNNzZCBuvw4L","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RrhLYT6PnmtTrsYcyZ2a6g","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nImprove GEMINI_SYSTEM_PROMPT for contrast and variety\n\n- Add explicit READABILITY rules: dark/light text thresholds (#ddd/#333),\n  subtext minimums (#999/#666), and card-bg contrast requirement\n- Add VARIETY rules: forbid generic white/gray bg, specify bold palette\n  examples, font-stack guidance (serif/mono/display per aesthetic),\n  and item-radius semantics (0px=brutalist, 20px+=playful)\n- Make component overrides REQUIRED (not optional) with concrete examples\n  of hover effects, gradients, shadows, animations\n- Remove verbose variable comments to free up output tokens\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Commit improved system prompt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":184,"cache_read_input_tokens":97357,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":184},"output_tokens":19,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLEnDKaEfq5DSQQqPsY","type":"assistant","uuid":"89a9f5a3-1f14-4509-b3ac-7ae210f8bc5d","timestamp":"2026-02-22T15:19:39.603Z"}
{"parentUuid":"89a9f5a3-1f14-4509-b3ac-7ae210f8bc5d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RrhLYT6PnmtTrsYcyZ2a6g","type":"tool_result","content":"[main 48c2b37] Improve GEMINI_SYSTEM_PROMPT for contrast and variety\n 1 file changed, 40 insertions(+), 19 deletions(-)","is_error":false}]},"uuid":"e62bbc9e-a6db-40a2-b4ff-77e11b0db6fe","timestamp":"2026-02-22T15:19:40.541Z","toolUseResult":{"stdout":"[main 48c2b37] Improve GEMINI_SYSTEM_PROMPT for contrast and variety\n 1 file changed, 40 insertions(+), 19 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"89a9f5a3-1f14-4509-b3ac-7ae210f8bc5d"}
{"parentUuid":"e62bbc9e-a6db-40a2-b4ff-77e11b0db6fe","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_017yF9aD2sFvptEC6LiriPKg","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました (`48c2b37`)。変更の要点：\n\n**コントラスト改善**\n- 暗背景 → `--text` は `#ddd` 以上、`--subtext` は `#999` 以上と数値で明示\n- 明背景 → `--text` は `#333` 以下、`--subtext` は `#666` 以下\n- `--card-bg` を `--bg` と明確に異なる色にすることを要求\n- ボタン・アップボートの文字色も対コントラスト必須と指定\n\n**バリエーション改善**\n- 白・明灰色の背景を明示的に禁止\n- フォントの選び方をテーマ別に具体例付きで誘導（serif, monospace, display など）\n- `--item-radius` に意味を付けてモデルの判断を誘導（0px=brutalist, 20px+=playful）\n- コンポーネントオーバーライドを「任意」から「**必須**」に変更し、具体的なテクニック（hover, clip-path, glow, animation など）を列挙\n\n試しに同じプロンプトを複数回叩いてみると、以前より個性的な結果が出るはずです。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":327,"cache_read_input_tokens":97541,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":327},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLFN9FoZziD36LuLZQZ","type":"assistant","uuid":"4a535672-4fe2-465a-9c62-213d2bdec875","timestamp":"2026-02-22T15:19:49.537Z"}
{"parentUuid":"4a535672-4fe2-465a-9c62-213d2bdec875","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"f575fbe5-234f-484d-9b91-667990c7ff28","toolUseID":"f575fbe5-234f-484d-9b91-667990c7ff28","timestamp":"2026-02-22T15:19:49.657Z","uuid":"978f0c4b-0db5-466e-9d04-76684d7edbe2"}
{"parentUuid":"978f0c4b-0db5-466e-9d04-76684d7edbe2","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"stop_hook_summary","hookCount":1,"hookInfos":[{"command":"entire hooks claude-code stop","durationMs":882}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-22T15:19:50.539Z","uuid":"dfd8404b-310b-4b52-9c3b-0a27a0cd5931","toolUseID":"f575fbe5-234f-484d-9b91-667990c7ff28"}
{"parentUuid":"dfd8404b-310b-4b52-9c3b-0a27a0cd5931","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"system","subtype":"turn_duration","durationMs":107605,"timestamp":"2026-02-22T15:19:50.541Z","uuid":"c8cd38d8-b027-4ba6-9712-7b6a23c48d4c","isMeta":false}
{"type":"file-history-snapshot","messageId":"f1e917f8-9529-4970-afce-0fe2059405ed","snapshot":{"messageId":"f1e917f8-9529-4970-afce-0fe2059405ed","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v5","version":5,"backupTime":"2026-02-22T15:23:16.782Z"}},"timestamp":"2026-02-22T15:23:16.781Z"},"isSnapshotUpdate":false}
{"parentUuid":"c8cd38d8-b027-4ba6-9712-7b6a23c48d4c","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"ヘッダーの部分のスタイルがぜんぜん変化しないです。本体と同様に、スタイルを生成し、適用してください。"},"uuid":"f1e917f8-9529-4970-afce-0fe2059405ed","timestamp":"2026-02-22T15:23:16.663Z","permissionMode":"acceptEdits"}
{"parentUuid":"f1e917f8-9529-4970-afce-0fe2059405ed","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Request interrupted by user]"}]},"uuid":"404177df-66b1-4b7b-ab6c-85331c862cb3","timestamp":"2026-02-22T15:23:26.636Z"}
{"type":"file-history-snapshot","messageId":"e20fec0d-ab83-4a7e-80b9-2e6c763bfcee","snapshot":{"messageId":"e20fec0d-ab83-4a7e-80b9-2e6c763bfcee","trackedFileBackups":{"gardener.js":{"backupFileName":"2aa82fbc0707f863@v5","version":5,"backupTime":"2026-02-22T15:23:16.782Z"}},"timestamp":"2026-02-22T15:23:39.325Z"},"isSnapshotUpdate":false}
{"parentUuid":"404177df-66b1-4b7b-ab6c-85331c862cb3","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":"ヘッダーの部分のスタイルがぜんぜん変化しないです。本体と同様に、スタイルを生成し、適用させるようなプロンプトに改良してください。"},"uuid":"e20fec0d-ab83-4a7e-80b9-2e6c763bfcee","timestamp":"2026-02-22T15:23:39.183Z","permissionMode":"acceptEdits"}
{"parentUuid":"e20fec0d-ab83-4a7e-80b9-2e6c763bfcee","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LVnvf8hA6xsPUt8754B4po","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants the header to also be styled by the AI-generated themes. Let me look at the current header styles in SYSTEM_STYLE and understand what's happening.\n\nThe issue is that the header has quite opinionated default styles in `SYSTEM_STYLE`, and the themes only get applied if `.hn-header` is overridden in the component overrides section. But since the system prompt mentions `.hn-header` as one of the optional (now required) selectors, but the SYSTEM_STYLE has very specific styles for `.hn-header`, the generated CSS might not be overriding them effectively.\n\nLet me look at the header-related styles in SYSTEM_STYLE to understand what needs to be overridden.","signature":"EsYGCkYICxgCKkBprJn9zeAVNXe7KDg5YafI7BKYNUqYXnU37Fsnsr5skX+EThDRXpXtkoRuUeKt/pdIW5R80t7qQwOi2Wq0ltA1EgzCWUPct497egKpowIaDLHClzaLqqfv8eAs8iIwxdUZnx/Z30v2xmJHVQHWQZtpaNapznRmmToNgv5qlz9+mT79bq1VNRROiYA1lyLNKq0FE2qFqVsllkyN6b0qBaVEU8kvnQ+2r1LY7DUwA8GkScd6NQ64QoaQwJXIt5eNZE2XkLtbvfTmzJPm1wqDfrzQOQtxn+6zGdcdrcW2OYqBQE/dmfF+wh6LWYZvhgBiz+z6+JiZ3zjS3hTvSeKbZv9PTO+xZARLbcM8D4+zraIJptuNTsf6JfdBkIGZ1fwCJqfmkM4+PjF/QSEtuvJuw21PYRbNQjTzZcldvZO0p7Xs7O03k2obblP1rAreMhESp/d9frynSt1nc+B0OtnXbekrMBMP6c/BDcyBMxAZaHrkByqgjcCgfIqsUtMMRhBKWHG6y5mRaber9M76ISESHVlSnpmQThq9k2oozH5rVFvttsv4mg0metvekJiFqwFC1Ag7XlJI3Zq2hy/oyO9/5I/0bjg3zJtNYjKneyw+MwMRtsXzK/c143rASRRep/CV0iyXnHJPrzCzc0f04KDVvTmtsTj9mZSR3xVom6VtYniEB1J69hADDORhG1VwYv6Zf7o2ML1dmWFFPyQoXPd9gwMtw9kAxRGBABCz3MnEf0Q/RLiBkFTQVpq4dirHouZ+XWmIwXasw8Ra8nTn+6fSdpUWDoCbY6ikyrYKjbFTGF7Zc1hm3fpcYNnPkGoGSldbegzWZ0BVu2ZVwo7qJg+ZWvKiAyVojxH7Nef3tq6m4cu9//632XtOq4rEKthCXj8pZetPxw+rGr3R5mtOMC/2yL3XW0f7s44uEbwz3TasNCFeAx17nHRu/R9FAzmSh0Lof/0tFZMa4TCOr/584EXFhlxGeojT5j+g5Ii7mURyj/KYm8bPGYIjOwe90fns1crj0mb5BXns24puzCH8yqrumfFODbA9nxLEA+GVK0KpKqyN3+KzQAwqh3aBrtcpLPGGslMnmnmpqQtRuIkC46VlOxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":66,"cache_read_input_tokens":98276,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":66},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLYyFM2x7hiSL2m39H5","type":"assistant","uuid":"bd47ada9-d636-42b2-a884-1e1580b8bbe6","timestamp":"2026-02-22T15:23:44.664Z"}
{"parentUuid":"bd47ada9-d636-42b2-a884-1e1580b8bbe6","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LVnvf8hA6xsPUt8754B4po","type":"message","role":"assistant","content":[{"type":"text","text":"まず header 周りの既存スタイルを確認します。"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":66,"cache_read_input_tokens":98276,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":66},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLYyFM2x7hiSL2m39H5","type":"assistant","uuid":"2c26fb82-b8f4-41af-9d1a-2789077968ff","timestamp":"2026-02-22T15:23:45.308Z"}
{"parentUuid":"2c26fb82-b8f4-41af-9d1a-2789077968ff","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01LVnvf8hA6xsPUt8754B4po","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PM62fue5c3xV3q7r8DXeWR","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":8,"limit":110},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":66,"cache_read_input_tokens":98276,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":66},"output_tokens":0,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLYyFM2x7hiSL2m39H5","type":"assistant","uuid":"209be1d4-1551-48eb-845e-4835247c30a1","timestamp":"2026-02-22T15:23:46.058Z"}
{"parentUuid":"209be1d4-1551-48eb-845e-4835247c30a1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01PM62fue5c3xV3q7r8DXeWR","toolUseID":"toolu_01PM62fue5c3xV3q7r8DXeWR","timestamp":"2026-02-22T15:23:46.169Z","uuid":"c5762f2f-275b-4769-bfdb-8609473b5f64"}
{"parentUuid":"209be1d4-1551-48eb-845e-4835247c30a1","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PM62fue5c3xV3q7r8DXeWR","type":"tool_result","content":"     8→const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\n     9→Output ONLY raw CSS. No explanations, markdown, code fences, or comments.\n    10→\n    11→=== READABILITY (mandatory) ===\n    12→First decide: is the theme DARK or LIGHT based on --bg luminance?\n    13→  DARK  bg → --text must be #ddd or lighter  | --subtext must be #999 or lighter\n    14→  LIGHT bg → --text must be #333 or darker   | --subtext must be #666 or darker\n    15→  --card-bg must be a noticeably different shade/hue from --bg (never identical).\n    16→  --more-btn-color must clearly contrast --more-btn-bg (light-on-dark or dark-on-light).\n    17→  --mobile-upvote-color must clearly contrast --mobile-upvote-bg.\n    18→\n    19→=== VARIETY (mandatory) ===\n    20→Commit fully to the prompt's aesthetic. Generic white or light-gray --bg is forbidden.\n    21→Pick a bold, on-theme background (deep navy, warm parchment, neon black, terracotta, etc.).\n    22→\n    23→Vary these dimensions to match the mood:\n    24→  --font-main:   'Georgia,serif' for editorial | 'Courier New,monospace' for terminal/hacker |\n    25→                 Impact,'Arial Narrow',sans-serif for bold/poster | system-ui for clean\n    26→  --item-radius: 0px = raw/brutalist | 6-10px = modern | 20-40px = playful/bubbly\n    27→  --item-border / --item-shadow: use thick borders for brutalist, glows for neon, none for minimal\n    28→\n    29→After :root, add component overrides — this is REQUIRED, not optional.\n    30→Use .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,\n    31→clip-paths, gradients, box-shadows, text-shadows, or keyframe animations that\n    32→make the aesthetic unmistakable. A theme with only :root variables is incomplete.\n    33→\n    34→=== VARIABLES ===\n    35→:root {\n    36→    --bg:\n    37→    --card-bg:\n    38→    --text:\n    39→    --subtext:\n    40→    --accent:\n    41→    --header-bg:\n    42→    --font-main:\n    43→    --item-radius:\n    44→    --item-border:\n    45→    --item-shadow:\n    46→    --more-btn-bg:\n    47→    --more-btn-color:\n    48→    --mobile-upvote-bg:\n    49→    --mobile-upvote-color:\n    50→}\n    51→\n    52→Output nothing except the CSS.`;\n    53→\n    54→/**\n    55→ * System Core Styles (Layout, Typography Base, Responsive Logic)\n    56→ * Themes should override variables in :root or specific classes if needed.\n    57→ */\n    58→const SYSTEM_STYLE = `\n    59→    :root {\n    60→        /* Default Variables (Fallback) */\n    61→        --bg: #ffffff;\n    62→        --text: #333333;\n    63→        --subtext: #888888;\n    64→        --accent: #007aff;\n    65→        --card-bg: #ffffff;\n    66→        --header-bg: rgba(255,255,255,0.9);\n    67→        --header-border: 1px solid rgba(0,0,0,0.1);\n    68→        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    69→        \n    70→        /* Component Specific Defaults */\n    71→        --item-padding: 24px;\n    72→        --item-radius: 12px;\n    73→        --item-border: 1px solid rgba(0,0,0,0.05);\n    74→        --item-shadow: none;\n    75→        --item-gap: 20px;\n    76→        \n    77→        /* Mobile Defaults */\n    78→        --mobile-upvote-bg: rgba(0,0,0,0.05);\n    79→        --mobile-upvote-color: inherit;\n    80→        --mobile-upvote-border: none;\n    81→        --mobile-upvote-radius: 8px;\n    82→        --mobile-rank-opacity: 0.5;\n    83→        --mobile-rank-color: inherit;\n    84→\n    85→        /* More Button Defaults */\n    86→        --more-btn-bg: var(--text);\n    87→        --more-btn-color: var(--bg);\n    88→    }\n    89→\n    90→    /* --- Transition Animation --- */\n    91→    ::view-transition-group(*) {\n    92→        animation-duration: 1.2s;\n    93→    }\n    94→\n    95→    /* --- Base Layout --- */\n    96→    body {\n    97→        background: var(--bg);\n    98→        color: var(--text);\n    99→        font-family: var(--font-main);\n   100→        margin: 0;\n   101→        display: flex;\n   102→        flex-direction: column;\n   103→        min-height: 100vh;\n   104→        transition: background 0.5s, color 0.5s;\n   105→    }\n   106→    * { box-sizing: border-box; }\n   107→    ul, ol { list-style: none; padding: 0; margin: 0; }\n   108→    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n   109→    button { font-family: inherit; cursor: pointer; }\n   110→\n   111→    /* --- Header --- */\n   112→    .hn-header {\n   113→        background: var(--header-bg);\n   114→        border-bottom: var(--header-border);\n   115→        backdrop-filter: saturate(180%) blur(20px);\n   116→        padding: 0 20px;\n   117→        height: 60px;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2af1459a-79ac-4bdc-8c74-b2cd44a6f764","timestamp":"2026-02-22T15:23:46.169Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"const GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\n=== READABILITY (mandatory) ===\nFirst decide: is the theme DARK or LIGHT based on --bg luminance?\n  DARK  bg → --text must be #ddd or lighter  | --subtext must be #999 or lighter\n  LIGHT bg → --text must be #333 or darker   | --subtext must be #666 or darker\n  --card-bg must be a noticeably different shade/hue from --bg (never identical).\n  --more-btn-color must clearly contrast --more-btn-bg (light-on-dark or dark-on-light).\n  --mobile-upvote-color must clearly contrast --mobile-upvote-bg.\n\n=== VARIETY (mandatory) ===\nCommit fully to the prompt's aesthetic. Generic white or light-gray --bg is forbidden.\nPick a bold, on-theme background (deep navy, warm parchment, neon black, terracotta, etc.).\n\nVary these dimensions to match the mood:\n  --font-main:   'Georgia,serif' for editorial | 'Courier New,monospace' for terminal/hacker |\n                 Impact,'Arial Narrow',sans-serif for bold/poster | system-ui for clean\n  --item-radius: 0px = raw/brutalist | 6-10px = modern | 20-40px = playful/bubbly\n  --item-border / --item-shadow: use thick borders for brutalist, glows for neon, none for minimal\n\nAfter :root, add component overrides — this is REQUIRED, not optional.\nUse .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,\nclip-paths, gradients, box-shadows, text-shadows, or keyframe animations that\nmake the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;","numLines":110,"startLine":8,"totalLines":1466}},"sourceToolAssistantUUID":"209be1d4-1551-48eb-845e-4835247c30a1"}
{"parentUuid":"2af1459a-79ac-4bdc-8c74-b2cd44a6f764","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01TzASYUvST1dYGb1Huwq36B","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PnHeo2tNW8Cc1tZ1haeA3T","name":"Read","input":{"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","offset":110,"limit":50},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2033,"cache_read_input_tokens":98342,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2033},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLZUKaSXdyTWcDvcohH","type":"assistant","uuid":"eaaacc5e-4d1a-4a5b-a018-db162ce6598b","timestamp":"2026-02-22T15:23:49.021Z"}
{"parentUuid":"eaaacc5e-4d1a-4a5b-a018-db162ce6598b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01PnHeo2tNW8Cc1tZ1haeA3T","toolUseID":"toolu_01PnHeo2tNW8Cc1tZ1haeA3T","timestamp":"2026-02-22T15:23:49.126Z","uuid":"c9e594e8-9d88-4c22-904b-7e28ac3b6c98"}
{"parentUuid":"eaaacc5e-4d1a-4a5b-a018-db162ce6598b","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PnHeo2tNW8Cc1tZ1haeA3T","type":"tool_result","content":"   110→\n   111→    /* --- Header --- */\n   112→    .hn-header {\n   113→        background: var(--header-bg);\n   114→        border-bottom: var(--header-border);\n   115→        backdrop-filter: saturate(180%) blur(20px);\n   116→        padding: 0 20px;\n   117→        height: 60px;\n   118→        display: flex;\n   119→        align-items: center;\n   120→        justify-content: center;\n   121→        position: sticky;\n   122→        top: 0;\n   123→        z-index: 100;\n   124→        view-transition-name: main-header;\n   125→    }\n   126→    .hn-nav {\n   127→        width: 100%;\n   128→        max-width: 1000px;\n   129→        display: flex;\n   130→        align-items: center;\n   131→        justify-content: space-between;\n   132→    }\n   133→    .hn-logo {\n   134→        font-weight: 900;\n   135→        font-size: 20px;\n   136→        color: var(--accent);\n   137→        view-transition-name: main-logo;\n   138→    }\n   139→    .hn-nav-links { display: flex; gap: 24px; }\n   140→    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n   141→    .hn-nav-links a:hover { color: var(--text); }\n   142→    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n   143→\n   144→    /* --- Main Content --- */\n   145→    .hn-main {\n   146→        max-width: 1000px;\n   147→        margin: 0 auto;\n   148→        padding: 40px 20px;\n   149→        flex: 1;\n   150→        width: 100%;\n   151→        view-transition-name: main-content;\n   152→    }\n   153→    .hn-story-list {\n   154→        display: flex;\n   155→        flex-direction: column;\n   156→        gap: 16px;\n   157→        view-transition-name: story-list;\n   158→    }\n   159→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"32f75d35-15bf-4fb9-8e01-dc46b246b141","timestamp":"2026-02-22T15:23:49.125Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","content":"\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n","numLines":50,"startLine":110,"totalLines":1466}},"sourceToolAssistantUUID":"eaaacc5e-4d1a-4a5b-a018-db162ce6598b"}
{"parentUuid":"32f75d35-15bf-4fb9-8e01-dc46b246b141","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Fz4XcnMUdUWknHbEYSJbmn","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I understand the issue. The header in `SYSTEM_STYLE` uses:\n- `background: var(--header-bg)` — this IS variable-driven\n- `border-bottom: var(--header-border)` — this uses `--header-border` which is only in SYSTEM_STYLE's `:root` default\n- `backdrop-filter: saturate(180%) blur(20px)` — this is hardcoded and makes the header feel \"frosted glass\" always\n\nThe problem is:\n1. **`--header-border` is NOT in the prompt** — the AI doesn't know it can set this variable\n\n\n2. The frosted glass effect from `backdrop-filter` stays constant across all themes, and while the logo and nav link colors do respond to theme variables like `--accent` and `--text`, the AI-generated themes only override `background:` in their `.hn-header` rules, missing the opportunity to customize the border or remove the blur effect entirely.\n3. The presets that stand out visually—like Minimalist with its floating pill-shaped header or Glitch with its distinctive styling—achieve this by also controlling properties like `border-radius`, `margin`, and `top` positioning, which the AI themes don't account for.\n\nThe real blocker is that the current prompt doesn't guide the AI toward these specific header property overrides, so it defaults to the base styles instead of creating something visually distinct. SYSTEM_STYLE defaults to a frosted header effect, but that clashes with darker or solid-colored themes—the AI can override this by setting `backdrop-filter: none`. I should improve the prompt by adding `--header-border` to the variables list since it's already defined in the root styles, then explicitly guide the AI on which header properties to override and show concrete examples like floating pills, full-width borders, clipped shapes, and solid colors. The logo is just \"Y\" in the HTML, so there's room to style it creatively with borders, backgrounds, or text effects. I'm planning to rewrite the header section with clearer guidance on when to use transparent/minimal styles versus solid backgrounds, and making sure the AI knows to disable the backdrop filter for dark themes.","signature":"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"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":819,"cache_read_input_tokens":100375,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":819},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLZgurqEvVpbQW29PiS","type":"assistant","uuid":"3eb9c071-07cf-4572-b20e-999421142e67","timestamp":"2026-02-22T15:24:15.550Z"}
{"parentUuid":"3eb9c071-07cf-4572-b20e-999421142e67","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Fz4XcnMUdUWknHbEYSJbmn","type":"message","role":"assistant","content":[{"type":"text","text":"原因が分かりました。`SYSTEM_STYLE` の `.hn-header` に `backdrop-filter: saturate(180%) blur(20px)` が**ハードコード**されており、AI が `--header-bg` を変えても見た目が「すりガラス」に固定されてしまいます。また `--header-border` 変数は SYSTEM_STYLE にあるのにプロンプトに含まれておらず、ヘッダーの形状変更パターン（floating, clipped, stripe など）の知識も与えていないことが問題です。\n\nプロンプトに **`=== HEADER ===` セクション**を追加し、使えるパターンと変数を明示します："}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":819,"cache_read_input_tokens":100375,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":819},"output_tokens":9,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLZgurqEvVpbQW29PiS","type":"assistant","uuid":"69d93564-7ce1-47c7-8b64-f276d331e5ae","timestamp":"2026-02-22T15:24:18.954Z"}
{"parentUuid":"69d93564-7ce1-47c7-8b64-f276d331e5ae","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01Fz4XcnMUdUWknHbEYSJbmn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017kw5o3R5auo2UTyZmZDCQL","name":"Edit","input":{"replace_all":false,"file_path":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","old_string":"After :root, add component overrides — this is REQUIRED, not optional.\nUse .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,\nclip-paths, gradients, box-shadows, text-shadows, or keyframe animations that\nmake the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;","new_string":"=== HEADER (required override) ===\nThe header MUST be visually transformed to match the theme. Always override .hn-header directly.\nThe base style has backdrop-filter blur — override it explicitly when you want a solid look.\nChoose one of these patterns (or invent a stronger one):\n  Solid dark/color : background:<color>; backdrop-filter:none; border-bottom:<border>;\n  Floating pill    : margin:12px 20px; border-radius:100px; top:12px; backdrop-filter:blur(20px);\n  Bold stripe      : background:var(--accent); backdrop-filter:none; height:50px; border-bottom:4px solid var(--text);\n  Transparent      : background:transparent; backdrop-filter:none; border-bottom:none;\n  Brutalist bar    : background:var(--text); border-bottom:6px solid var(--accent); border-radius:0;\nAlso restyle .hn-logo aggressively: letter-spacing, text-shadow, border, background-color, font-size, etc.\n--header-border can be set as a variable (e.g. --header-border: 3px solid var(--accent);).\n\n=== COMPONENTS (required) ===\nAfter :root, add overrides for .hn-story-item, .hn-header, .hn-logo, .hn-upvote, body.\nUse hover effects, clip-paths, gradients, box-shadows, text-shadows, or animations\nthat make the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":819,"cache_read_input_tokens":100375,"output_tokens":2301,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":819,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYPLZgurqEvVpbQW29PiS","type":"assistant","uuid":"3810469b-656a-48e0-891c-f9b41dd2de08","timestamp":"2026-02-22T15:24:28.354Z"}
{"parentUuid":"3810469b-656a-48e0-891c-f9b41dd2de08","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_017kw5o3R5auo2UTyZmZDCQL","toolUseID":"toolu_017kw5o3R5auo2UTyZmZDCQL","timestamp":"2026-02-22T15:24:28.365Z","uuid":"b971e078-a10d-41bc-8ad5-40604a81b525"}
{"parentUuid":"3810469b-656a-48e0-891c-f9b41dd2de08","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017kw5o3R5auo2UTyZmZDCQL","type":"tool_result","content":"The file /Users/turtlekazu/ReactProjects/acephale/gardener.js has been updated successfully."}]},"uuid":"573d8e70-7ea0-44f7-a3bf-1ad97541e89d","timestamp":"2026-02-22T15:24:28.365Z","toolUseResult":{"filePath":"/Users/turtlekazu/ReactProjects/acephale/gardener.js","oldString":"After :root, add component overrides — this is REQUIRED, not optional.\nUse .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,\nclip-paths, gradients, box-shadows, text-shadows, or keyframe animations that\nmake the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;","newString":"=== HEADER (required override) ===\nThe header MUST be visually transformed to match the theme. Always override .hn-header directly.\nThe base style has backdrop-filter blur — override it explicitly when you want a solid look.\nChoose one of these patterns (or invent a stronger one):\n  Solid dark/color : background:<color>; backdrop-filter:none; border-bottom:<border>;\n  Floating pill    : margin:12px 20px; border-radius:100px; top:12px; backdrop-filter:blur(20px);\n  Bold stripe      : background:var(--accent); backdrop-filter:none; height:50px; border-bottom:4px solid var(--text);\n  Transparent      : background:transparent; backdrop-filter:none; border-bottom:none;\n  Brutalist bar    : background:var(--text); border-bottom:6px solid var(--accent); border-radius:0;\nAlso restyle .hn-logo aggressively: letter-spacing, text-shadow, border, background-color, font-size, etc.\n--header-border can be set as a variable (e.g. --header-border: 3px solid var(--accent);).\n\n=== COMPONENTS (required) ===\nAfter :root, add overrides for .hn-story-item, .hn-header, .hn-logo, .hn-upvote, body.\nUse hover effects, clip-paths, gradients, box-shadows, text-shadows, or animations\nthat make the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --header-border:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;","originalFile":"/**\n * Acephale OS | Gardener.js\n * Hacker News Interface Styling & Data Fetching\n */\n\nconst BASE_URL = 'https://hacker-news.firebaseio.com/v0';\n\nconst GEMINI_SYSTEM_PROMPT = `You are a CSS theme generator for a Hacker News reader app.\nOutput ONLY raw CSS. No explanations, markdown, code fences, or comments.\n\n=== READABILITY (mandatory) ===\nFirst decide: is the theme DARK or LIGHT based on --bg luminance?\n  DARK  bg → --text must be #ddd or lighter  | --subtext must be #999 or lighter\n  LIGHT bg → --text must be #333 or darker   | --subtext must be #666 or darker\n  --card-bg must be a noticeably different shade/hue from --bg (never identical).\n  --more-btn-color must clearly contrast --more-btn-bg (light-on-dark or dark-on-light).\n  --mobile-upvote-color must clearly contrast --mobile-upvote-bg.\n\n=== VARIETY (mandatory) ===\nCommit fully to the prompt's aesthetic. Generic white or light-gray --bg is forbidden.\nPick a bold, on-theme background (deep navy, warm parchment, neon black, terracotta, etc.).\n\nVary these dimensions to match the mood:\n  --font-main:   'Georgia,serif' for editorial | 'Courier New,monospace' for terminal/hacker |\n                 Impact,'Arial Narrow',sans-serif for bold/poster | system-ui for clean\n  --item-radius: 0px = raw/brutalist | 6-10px = modern | 20-40px = playful/bubbly\n  --item-border / --item-shadow: use thick borders for brutalist, glows for neon, none for minimal\n\nAfter :root, add component overrides — this is REQUIRED, not optional.\nUse .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,\nclip-paths, gradients, box-shadows, text-shadows, or keyframe animations that\nmake the aesthetic unmistakable. A theme with only :root variables is incomplete.\n\n=== VARIABLES ===\n:root {\n    --bg:\n    --card-bg:\n    --text:\n    --subtext:\n    --accent:\n    --header-bg:\n    --font-main:\n    --item-radius:\n    --item-border:\n    --item-shadow:\n    --more-btn-bg:\n    --more-btn-color:\n    --mobile-upvote-bg:\n    --mobile-upvote-color:\n}\n\nOutput nothing except the CSS.`;\n\n/**\n * System Core Styles (Layout, Typography Base, Responsive Logic)\n * Themes should override variables in :root or specific classes if needed.\n */\nconst SYSTEM_STYLE = `\n    :root {\n        /* Default Variables (Fallback) */\n        --bg: #ffffff;\n        --text: #333333;\n        --subtext: #888888;\n        --accent: #007aff;\n        --card-bg: #ffffff;\n        --header-bg: rgba(255,255,255,0.9);\n        --header-border: 1px solid rgba(0,0,0,0.1);\n        --font-main: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        \n        /* Component Specific Defaults */\n        --item-padding: 24px;\n        --item-radius: 12px;\n        --item-border: 1px solid rgba(0,0,0,0.05);\n        --item-shadow: none;\n        --item-gap: 20px;\n        \n        /* Mobile Defaults */\n        --mobile-upvote-bg: rgba(0,0,0,0.05);\n        --mobile-upvote-color: inherit;\n        --mobile-upvote-border: none;\n        --mobile-upvote-radius: 8px;\n        --mobile-rank-opacity: 0.5;\n        --mobile-rank-color: inherit;\n\n        /* More Button Defaults */\n        --more-btn-bg: var(--text);\n        --more-btn-color: var(--bg);\n    }\n\n    /* --- Transition Animation --- */\n    ::view-transition-group(*) {\n        animation-duration: 1.2s;\n    }\n\n    /* --- Base Layout --- */\n    body {\n        background: var(--bg);\n        color: var(--text);\n        font-family: var(--font-main);\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n        min-height: 100vh;\n        transition: background 0.5s, color 0.5s;\n    }\n    * { box-sizing: border-box; }\n    ul, ol { list-style: none; padding: 0; margin: 0; }\n    a { text-decoration: none; color: inherit; transition: opacity 0.2s; }\n    button { font-family: inherit; cursor: pointer; }\n\n    /* --- Header --- */\n    .hn-header {\n        background: var(--header-bg);\n        border-bottom: var(--header-border);\n        backdrop-filter: saturate(180%) blur(20px);\n        padding: 0 20px;\n        height: 60px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: sticky;\n        top: 0;\n        z-index: 100;\n        view-transition-name: main-header;\n    }\n    .hn-nav {\n        width: 100%;\n        max-width: 1000px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .hn-logo {\n        font-weight: 900;\n        font-size: 20px;\n        color: var(--accent);\n        view-transition-name: main-logo;\n    }\n    .hn-nav-links { display: flex; gap: 24px; }\n    .hn-nav-links a { font-size: 14px; font-weight: 500; color: var(--subtext); }\n    .hn-nav-links a:hover { color: var(--text); }\n    .hn-auth a { font-size: 13px; font-weight: 600; color: var(--accent); }\n\n    /* --- Main Content --- */\n    .hn-main {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 40px 20px;\n        flex: 1;\n        width: 100%;\n        view-transition-name: main-content;\n    }\n    .hn-story-list {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        view-transition-name: story-list;\n    }\n\n    /* --- Story Item (Desktop Standard) --- */\n    .hn-story-item {\n        background: var(--item-bg, var(--card-bg));\n        border: var(--item-border);\n        border-radius: var(--item-radius);\n        padding: var(--item-padding);\n        box-shadow: var(--item-shadow);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        gap: var(--item-gap);\n        transition: transform 0.2s, box-shadow 0.2s;\n        position: relative;\n    }\n    .hn-story-rank {\n        order: -2;\n        font-size: 16px;\n        color: var(--subtext);\n        width: 30px;\n        text-align: right;\n        font-feature-settings: \"tnum\";\n    }\n    .hn-story-content { flex: 1; min-width: 0; }\n    .hn-story-title {\n        display: block;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text);\n        line-height: 1.3;\n        margin-bottom: 6px;\n    }\n    .hn-story-title:hover { color: var(--accent); }\n    .hn-story-domain { font-size: 13px; color: var(--subtext); font-weight: 400; margin-left: 8px; }\n    .hn-story-meta { font-size: 13px; color: var(--subtext); }\n    \n    /* Standard Desktop Upvote */\n    .hn-upvote {\n        order: -1;\n        background: transparent;\n        border: 1px solid var(--subtext);\n        color: var(--subtext);\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 10px;\n        flex-shrink: 0;\n        transition: 0.2s;\n        opacity: 0.6;\n    }\n    .hn-upvote:hover {\n        border-color: var(--accent);\n        color: var(--accent);\n        opacity: 1;\n    }\n\n    /* --- Load More --- */\n    .hn-load-more {\n        display: block;\n        margin: 60px auto;\n        padding: 12px 40px;\n        background: var(--more-btn-bg);\n        color: var(--more-btn-color);\n        border: none;\n        border-radius: 100px;\n        font-weight: 600;\n        transition: transform 0.2s;\n    }\n    .hn-load-more:hover { transform: scale(1.05); }\n\n    /* --- Footer --- */\n    .hn-footer {\n        padding: 60px 20px;\n        border-top: 1px solid var(--header-border);\n        text-align: center;\n        font-size: 13px;\n        color: var(--subtext);\n        background: var(--bg);\n        view-transition-name: main-footer;\n    }\n    .hn-footer-links {\n        display: flex;\n        justify-content: center;\n        gap: 20px;\n        margin-bottom: 20px;\n    }\n\n    /* --- Control Panel (Glassmorphism) --- */\n    #theme-controls { \n        view-transition-name: theme-ui;\n        position: fixed; \n        bottom: 20px; \n        right: 20px; \n        z-index: 10000; \n        padding: 15px; \n        border-radius: 12px; \n        display: flex; \n        flex-direction: column; \n        gap: 12px; \n        align-items: flex-start; \n        max-width: 350px;\n\n        /* Glass Style */\n        background: color-mix(in srgb, var(--card-bg) 65%, transparent);\n        color: var(--text);\n        border: 1px solid rgba(255, 255, 255, 0.15);\n        border-color: color-mix(in srgb, var(--text) 10%, transparent);\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15), inset 0 0 0 0.5px rgba(255,255,255,0.1);\n        backdrop-filter: saturate(180%) blur(30px);\n        -webkit-backdrop-filter: saturate(180%) blur(30px);\n        transition: all 0.3s;\n    }\n    #theme-controls input {\n        background: var(--bg);\n        color: var(--text);\n        border: 1px solid var(--subtext);\n        padding: 8px 12px;\n        border-radius: 6px;\n        outline: none;\n        flex: 1;\n        opacity: 0.8;\n    }\n    #theme-controls button {\n        background: rgba(0,0,0,0.05);\n        color: var(--text);\n        border: 1px solid rgba(0,0,0,0.1);\n        border-radius: 6px;\n        padding: 6px 12px;\n        font-size: 12px;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n    #theme-controls #generate-btn {\n        background: var(--accent) !important;\n        color: #fff;\n        border: none;\n        font-weight: 600;\n        padding: 8px 16px;\n    }\n    \n    /* Collapsible Logic */\n    #preset-buttons {\n        display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;\n        max-height: 300px; opacity: 1; overflow: hidden;\n        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s ease, margin 0.4s ease;\n    }\n    #preset-buttons.is-collapsed { max-height: 0 !important; opacity: 0 !important; margin-bottom: 0 !important; pointer-events: none; }\n    #presets-icon { display: inline-block; transition: transform 0.3s ease; }\n    .is-collapsed-icon #presets-icon { transform: rotate(-90deg); }\n\n    /* --- Desktop Panel Toggle (Drag Handle) --- */\n    #panel-handle { display: none; }\n    @media (min-width: 769px) {\n        #panel-handle {\n            display: block; position: absolute; top: 0; left: 0;\n            width: 20px; height: 100%;\n            background: transparent;\n            cursor: ew-resize;\n            z-index: 20;\n        }\n        /* Visual cue */\n        #panel-handle::before {\n            content: \"\"; position: absolute; top: 50%; left: 8px; width: 4px; height: 30px;\n            background: currentColor; opacity: 0.15; border-radius: 2px; transform: translateY(-50%);\n            transition: 0.2s;\n        }\n        #panel-handle:hover::before { opacity: 0.4; }\n        \n        #theme-controls { \n            padding-left: 20px; \n            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        }\n        #theme-controls.is-minimized {\n            transform: translateX(calc(100% - 20px));\n        }\n        #theme-controls.is-minimized > *:not(#panel-handle) {\n            opacity: 0; pointer-events: none; transition: opacity 0.2s;\n        }\n    }\n\n    /* --- Mobile Overrides (Unified) --- */\n    .hn-menu-toggle { display: none; background: none; border: none; padding: 10px; width: 44px; height: 44px; color: inherit; z-index: 1001; position: relative; }\n    .hn-menu-toggle span { display: block; width: 24px; height: 2px; background: currentColor; margin: 5px auto; transition: 0.3s; }\n\n    @media (max-width: 768px) {\n        /* Mobile Nav */\n        .hn-menu-toggle { display: block; order: 999; }\n        .hn-nav-links {\n            display: none; flex-direction: column; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n            background: var(--bg); padding: 140px 20px 60px; z-index: 1000; text-align: center;\n            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);\n        }\n        .hn-nav-links.is-open { display: flex; }\n        .hn-nav-links a { font-size: 28px; font-weight: 300; }\n        .hn-auth { display: none; }\n        .hn-header { padding: 0 15px; height: 60px; }\n        .hn-main { padding: 20px 15px; }\n        \n        /* Mobile Story Item */\n        .hn-story-item {\n            padding: 15px;\n            gap: 12px;\n            flex-direction: row;\n            align-items: flex-start;\n        }\n        .hn-story-title { font-size: 17px; line-height: 1.3; }\n        \n        /* Mobile Rank */\n        .hn-story-rank {\n            display: block;\n            width: auto;\n            min-width: 18px;\n            margin-right: 8px;\n            font-size: 14px;\n            \n            /* Reset & Variable Application */\n            position: static;\n            background: var(--mobile-rank-bg, transparent);\n            border: var(--mobile-rank-border, none);\n            padding: var(--mobile-rank-padding, 0);\n            border-radius: var(--mobile-rank-radius, 0);\n            opacity: var(--mobile-rank-opacity, 0.5);\n            color: var(--mobile-rank-color, inherit);\n            font-weight: var(--mobile-rank-font-weight, 400);\n            \n            align-self: flex-start;\n            margin-top: 2px;\n            flex-shrink: 0;\n            white-space: nowrap;\n            text-align: center;\n        }\n\n        /* Mobile Upvote */\n        .hn-upvote {\n            width: 32px;\n            height: 32px;\n            margin-top: 2px;\n            align-self: flex-start;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            opacity: 1; /* Reset opacity */\n            \n            /* Variable Application */\n            background: var(--mobile-upvote-bg);\n            border: var(--mobile-upvote-border);\n            color: var(--mobile-upvote-color);\n            border-radius: var(--mobile-upvote-radius);\n        }\n\n        /* Mobile Control Panel */\n        #theme-controls {\n            bottom: 20px; right: 20px; width: auto;\n            max-width: calc(100vw - 40px);\n            padding: 15px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        }\n        .hn-footer { padding: 40px 20px 160px; }\n        .hn-footer-links { flex-direction: column; gap: 10px; }\n        #preset-buttons { margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; width: 100%; }\n        #presets-toggle { margin-bottom: 2px; }\n        \n        /* Mobile Menu State */\n        .is-open-active .hn-menu-toggle span:nth-child(1) { transform: translateY(7px) rotate(45deg); }\n        .is-open-active .hn-menu-toggle span:nth-child(2) { opacity: 0; }\n        .is-open-active .hn-menu-toggle span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }\n    }\n`;\n\n/**\n * Themes\n * Define variables and minimal specific overrides.\n */\nconst STYLE_PRESETS = {\n    \"Minimalist\": `\n        :root {\n            --bg: #f5f5f7;\n            --card-bg: #ffffff;\n            --text: #1d1d1f;\n            --subtext: #86868b;\n            --accent: #0066cc;\n            --header-bg: rgba(251, 251, 253, 0.8);\n            \n            /* Mobile */\n            --mobile-upvote-bg: #e8e8ed;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-upvote { background: #e8e8ed; border: none; color: var(--text); }\n        .hn-header { \n            background: rgba(255, 255, 255, 0.7); \n            border: 0.5px solid rgba(0,0,0,0.05);\n            backdrop-filter: saturate(180%) blur(20px);\n            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);\n            margin: 12px 20px;\n            border-radius: 100px;\n            height: 50px;\n            top: 12px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 0.2em; \n            font-size: 14px; \n            font-weight: 300;\n            color: #000;\n        }\n        .hn-story-item:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.08); transform: scale(1.01); }\n        #theme-controls #generate-btn { background: var(--accent) !important; }\n    `,\n\n    \"Glitch\": `\n        :root {\n            --bg: #050a0e;\n            --card-bg: rgba(5, 10, 14, 0.9);\n            --text: #fcee0a; /* Yellow */\n            --subtext: #00f0ff; /* Blue */\n            --accent: #ff003c; /* Pink */\n            --header-bg: var(--text);\n            --font-main: sans-serif;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 0;\n\n            /* More Button */\n            --more-btn-bg: var(--text);\n            --more-btn-color: #000;\n        }\n        \n        body { text-transform: uppercase; }\n        body::before {\n            content: \"\"; position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);\n            pointer-events: none; z-index: 1000;\n        }\n        .hn-header { clip-path: polygon(0 0, 100% 0, 100% 70%, 95% 100%, 0 100%); border-bottom: 5px solid var(--subtext); color: #000; }\n        .hn-header.is-open-active { clip-path: none; }\n        .hn-header.is-open-active .hn-menu-toggle { color: var(--text); }\n        .hn-logo { border: 4px solid #000; padding: 0 10px; }\n        .hn-story-item { \n            border: 2px solid var(--subtext);\n            background: rgba(255, 0, 60, 0.05);\n            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);\n        }\n        .hn-story-item:hover { transform: skewX(-2deg); border-color: var(--accent); box-shadow: -10px 10px 0 var(--accent); }\n        .hn-upvote { \n            background: var(--accent); color: #fff; border: none; border-radius: 0; \n            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); \n            padding: 0 10px; width: auto;\n        }\n        /* Override Common Apply Button for visibility */\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Playful\": `\n        :root {\n            --red: #e60012;\n            --blue: #00a0e9;\n            --bg: #eee;\n            --card-bg: #fff;\n            --text: #333;\n            --subtext: #8c8c8c;\n            --accent: var(--blue);\n            --header-bg: var(--red);\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--red);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-border: 3px solid #000;\n            --mobile-upvote-radius: 12px;\n            \n            --mobile-rank-opacity: 1;\n            --mobile-rank-color: #fff;\n            --mobile-rank-bg: var(--blue);\n            --mobile-rank-border: 3px solid #000;\n            --mobile-rank-radius: 12px;\n            --mobile-rank-padding: 2px 8px;\n            --mobile-rank-font-weight: 900;\n            \n            --button-bg: var(--red);\n\n            /* More Button */\n            --more-btn-bg: var(--red);\n            --more-btn-color: #fff;\n        }\n        .hn-header { border-bottom: 12px solid #000; justify-content: center; }\n        .hn-logo { background: #fff; color: var(--red); padding: 5px 20px; border-radius: 100px; border: 4px solid #000; box-shadow: 4px 4px 0 #000; }\n        \n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }\n        .hn-story-item { \n            border: 6px solid #000; border-radius: 40px; box-shadow: 12px 12px 0 #ccc; \n            align-items: center; padding: 30px;\n        }\n        .hn-story-item:hover { transform: translateY(-8px); box-shadow: 12px 20px 0 #bbb; border-color: var(--blue); }\n        .hn-story-rank { \n            position: absolute; top: -20px; left: 20px; background: var(--blue); color: #fff; \n            padding: 5px 15px; border-radius: 20px; border: 5px solid #000; font-weight: 900; \n            width: auto; text-align: center;\n        }\n        .hn-upvote { \n            background: var(--red); color: #fff; border: 4px solid #000; border-radius: 12px; \n            width: 50px; height: 50px; font-weight: 900; opacity: 1;\n        }\n        /* Force Apply Button Red */\n        #theme-controls #generate-btn { background: var(--red) !important; }\n    `,\n\n    \"Glow\": `\n        :root {\n            --bg: #0a0d14;\n            --card-bg: rgba(20, 25, 35, 0.8);\n            --text: #ffffff;\n            --subtext: rgba(255, 255, 255, 0.6);\n            --accent: #0037c1;\n            --header-bg: transparent;\n            --header-border: 1px solid rgba(255,255,255,0.05);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.2);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        body {\n            background-image: radial-gradient(circle at 0% 0%, rgba(0, 55, 193, 0.15) 0%, transparent 50%),\n                              radial-gradient(circle at 100% 100%, rgba(0, 55, 193, 0.1) 0%, transparent 50%);\n        }\n        .hn-story-item { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); border: none; border-left: 2px solid transparent; border-radius: 0; }\n        .hn-story-item:hover { background: linear-gradient(90deg, rgba(0, 55, 193, 0.2), transparent); transform: translateX(20px); border-left: 2px solid var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(0, 55, 193, 0.3); \n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 55, 193, 0.2);\n            margin: 15px 20px;\n            border-radius: 12px;\n            background: rgba(10, 13, 20, 0.8);\n            top: 15px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            text-transform: uppercase; \n            letter-spacing: 4px; \n            text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); \n            font-size: 18px;\n        }\n        .hn-upvote { border-color: rgba(255,255,255,0.2); }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Academic\": `\n        :root {\n            --bg: #fdfaf5;\n            --card-bg: #ffffff;\n            --text: #1b1b1b;\n            --subtext: #666;\n            --accent: #d97757;\n            --header-bg: #fdfaf5;\n            --font-main: serif;\n            \n            --item-border: none;\n            --item-padding: 50px 0;\n            --item-radius: 0;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #999;\n            --mobile-upvote-border: 1.5px solid #ccc;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item { border-bottom: 1px solid rgba(0,0,0,0.08); }\n        .hn-story-title { font-size: 28px; font-weight: 500; }\n        .hn-story-rank { font-size: 24px; font-weight: bold; width: 40px; }\n        .hn-upvote { border: 1.5px solid #ccc; width: 36px; height: 36px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Search\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #fff;\n            --text: #202124;\n            --subtext: #5f6368;\n            --accent: #1a73e8;\n            --header-bg: #fff;\n            --font-main: sans-serif;\n            \n            --item-padding: 16px 0;\n            --item-radius: 0;\n            --item-border: none;\n            --item-shadow: none;\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: #70757a;\n            --mobile-upvote-border: 1px solid #dadce0;\n\n            /* More Button */\n            --more-btn-bg: #f8f9fa;\n            --more-btn-color: #3c4043;\n        }\n        .hn-story-title { color: #1a0dab; font-weight: 400; text-decoration: none; }\n        .hn-story-title:hover { text-decoration: underline; }\n        .hn-upvote { border-radius: 4px; width: auto; height: auto; padding: 2px 6px; border: 1px solid #dadce0; font-size: 11px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Universal\": `\n        :root {\n            --bg: #fff;\n            --card-bg: #f4f4f4;\n            --text: #000;\n            --subtext: #666;\n            --accent: #034EA2;\n            --header-bg: #fff;\n            \n            /* Mobile */\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-upvote-radius: 50%;\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 40px; }\n        .hn-story-item { padding: 30px; border-radius: 40px; }\n        .hn-story-item:hover { background: #e8e8e8; transform: scale(1.02); }\n        .hn-story-title { font-size: 28px; font-weight: 700; margin-bottom: 0; }\n        .hn-upvote { background: var(--accent); color: #fff; border: none; width: 40px; height: 40px; font-weight: 700; opacity: 1; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Intelligence\": `\n        :root {\n            --bg: #0d0d0d;\n            --card-bg: #171717;\n            --text: #ececec;\n            --subtext: #b4b4b4;\n            --accent: #10a37f;\n            --header-bg: rgba(13, 13, 13, 0.8);\n            \n            --item-border: 1px solid rgba(255,255,255,0.1);\n            \n            /* Mobile */\n            --mobile-upvote-bg: transparent;\n            --mobile-upvote-color: var(--subtext);\n            --mobile-upvote-border: 1px solid rgba(255,255,255,0.1);\n\n            /* More Button */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n        }\n        .hn-story-item:hover { border-color: var(--accent); }\n        .hn-header { \n            border: 1px solid rgba(16, 163, 127, 0.3); \n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); \n            background: rgba(13, 13, 13, 0.9);\n            margin: 10px 15px;\n            border-radius: 4px;\n            top: 10px;\n        }\n        .hn-header.is-open-active { margin: 0; top: 0; width: 100%; border-radius: 0; }\n        .hn-logo { \n            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; \n            font-size: 16px; \n            color: var(--accent); \n            display: flex; \n            align-items: center; \n        }\n        .hn-logo::after { \n            content: '_'; \n            margin-left: 4px; \n            animation: blink 1s step-end infinite; \n            color: var(--accent);\n        }\n        @keyframes blink { 50% { opacity: 0; } }\n        .hn-upvote { border-color: rgba(255,255,255,0.1); width: 24px; height: 24px; border-radius: 6px; }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"Ghibli\": `\n        :root {\n            --bg: #fdfaf0; /* 柔らかな生成り色（紙の質感） */\n            --card-bg: #ffffff;\n            --text: #433422; /* 焦茶色の文字 */\n            --subtext: #8c7355; /* 土のような茶色 */\n            --accent: #5d8a66; /* 深い森の緑 */\n            --header-bg: rgba(253, 250, 240, 0.85);\n            --header-border: 1px solid rgba(140, 115, 85, 0.2);\n            --font-main: \"Hiragino Mincho ProN\", \"MS PMincho\", serif; /* 叙情的な明朝体 */\n\n            /* Component Overrides */\n            --item-radius: 20px;\n            --item-border: 1px solid rgba(93, 138, 102, 0.1);\n            --item-shadow: 0 4px 15px rgba(67, 52, 34, 0.05);\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #fff;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #fff;\n            --mobile-rank-color: var(--subtext);\n            --mobile-rank-opacity: 1;\n        }\n        .hn-story-item {\n            background-image: linear-gradient(135deg, #fff 0%, #f9f7f0 100%);\n            border-bottom: 2px solid rgba(140, 115, 85, 0.1);\n        }\n        .hn-story-item:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 25px rgba(93, 138, 102, 0.15);\n            border-color: var(--accent);\n        }\n        .hn-logo {\n            font-style: italic;\n            color: var(--accent);\n            filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1));\n        }\n        .hn-upvote {\n            background: rgba(93, 138, 102, 0.05);\n            border-color: rgba(93, 138, 102, 0.3);\n            color: var(--accent);\n        }\n        #theme-controls #generate-btn { background: var(--accent) !important; color: #fff !important; }\n    `,\n\n    \"8-Bit\": `\n        :root {\n            --bg: #000000; /* 漆黒の背景 */\n            --card-bg: #111111;\n            --text: #00ff00; /* クッパの炎やレトロPCのようなグリーン */\n            --subtext: #008800;\n            --accent: #00ffff; /* シアンのアクセント */\n            --header-bg: #000000;\n            --header-border: 4px solid #00ffff;\n            --font-main: \"Courier New\", Courier, monospace; /* 等幅フォントでデータ感を演出 */\n\n            /* Component Overrides */\n            --item-radius: 0px; /* 角丸を廃止してブロック感を強調 */\n            --item-border: 4px solid #008800;\n            --item-padding: 20px;\n            --item-shadow: 8px 8px 0px #004400; /* ドット絵のような硬い影 */\n\n            /* More & Upvote Colors */\n            --more-btn-bg: var(--accent);\n            --more-btn-color: #000;\n            --mobile-upvote-bg: var(--accent);\n            --mobile-upvote-color: #000;\n            --mobile-rank-color: var(--text);\n            --mobile-rank-opacity: 1;\n        }\n        body {\n            image-rendering: pixelated;\n        }\n        .hn-story-item:hover {\n            border-color: var(--accent);\n            box-shadow: 4px 4px 0px var(--subtext);\n            transform: translate(4px, 4px); /* 押し込み感 */\n        }\n        .hn-upvote {\n            border-radius: 0;\n            border: 2px solid var(--accent);\n            background: #000;\n            color: var(--accent);\n        }\n        .hn-logo {\n            text-shadow: 3px 3px 0px #ff00ff; /* 懐かしの3D赤青メガネ風 */\n        }\n        .hn-load-more {\n            border-radius: 0;\n            border: 4px solid var(--text);\n            text-transform: uppercase;\n        }\n        #theme-controls #generate-btn { background: #ff00ff !important; color: #fff !important; border-radius: 0 !important; }\n    `\n};\n\n/**\n * Data Fetching Logic\n */\nconst HNData = {\n    allStoryIds: [],\n    currentType: 'top',\n\n    setType(type) {\n        if (this.currentType === type) return;\n        this.currentType = type;\n        this.allStoryIds = []; // Clear cache\n    },\n\n    async fetchAllIds() {\n        if (this.allStoryIds.length > 0) return this.allStoryIds;\n        try {\n            const endpoint = this.currentType === 'jobs' ? 'jobstories' : `${this.currentType}stories`;\n            const response = await fetch(`${BASE_URL}/${endpoint}.json`);\n            this.allStoryIds = await response.json();\n            return this.allStoryIds;\n        } catch (error) {\n            console.error(\"Failed to fetch ID list:\", error);\n            return [];\n        }\n    },\n\n    async fetchStoriesBatch(offset, limit = 30) {\n        const ids = await this.fetchAllIds();\n        const batchIds = ids.slice(offset, offset + limit);\n\n        const storyPromises = batchIds.map(async (id) => {\n            const storyRes = await fetch(`${BASE_URL}/item/${id}.json`);\n            return await storyRes.json();\n        });\n\n        return await Promise.all(storyPromises);\n    },\n\n    formatTime(timestamp) {\n        const seconds = Math.floor((new Date() - timestamp * 1000) / 1000);\n        let interval = Math.floor(seconds / 31536000);\n        if (interval > 1) return interval + \" years ago\";\n        interval = Math.floor(seconds / 2592000);\n        if (interval > 1) return interval + \" months ago\";\n        interval = Math.floor(seconds / 86400);\n        if (interval > 1) return interval + \" days ago\";\n        interval = Math.floor(seconds / 3600);\n        if (interval > 1) return interval + \" hours ago\";\n        interval = Math.floor(seconds / 60);\n        if (interval > 1) return interval + \" minutes ago\";\n        return Math.floor(seconds) + \" seconds ago\";\n    }\n};\n\n/**\n * Application Controller\n */\nconst App = {\n    currentOffset: 0,\n    isLoading: false,\n\n    elements: {\n        styleTag: document.getElementById('generated-style'),\n        promptInput: document.getElementById('prompt-input'),\n        generateBtn: document.getElementById('generate-btn'),\n        presetButtons: document.getElementById('preset-buttons'),\n        presetsToggle: document.getElementById('presets-toggle'),\n        presetsIcon: document.getElementById('presets-icon'),\n        listElement: document.querySelector('.hn-story-list'),\n        loadMoreBtn: document.querySelector('.hn-load-more'),\n        menuToggle: document.querySelector('.hn-menu-toggle'),\n        navLinks: document.querySelector('.hn-nav-links'),\n        header: document.querySelector('.hn-header'),\n        themeControls: document.getElementById('theme-controls'),\n        panelHandle: document.getElementById('panel-handle')\n    },\n\n    async init() {\n        this.renderPresetButtons();\n        this.renderSavedThemeButtons();\n        this.renderApiKeySection();\n        this.bindEvents();\n\n        const savedPreset = localStorage.getItem('acephale-theme');\n        const savedCustom = localStorage.getItem('acephale-custom-css');\n        const savedPrompt = localStorage.getItem('acephale-custom-prompt');\n\n        if (savedCustom) {\n            this.applyStyle(savedCustom, null, savedPrompt || 'Custom AI Theme');\n            if (savedPrompt) this.elements.promptInput.value = savedPrompt;\n            const alreadySaved = this.getSavedThemes().some(t => t.css === savedCustom);\n            this.renderSaveButton(!alreadySaved);\n        } else {\n            const themeToApply = (savedPreset && STYLE_PRESETS[savedPreset]) ? savedPreset : 'Minimalist';\n            this.applyStyle(STYLE_PRESETS[themeToApply], themeToApply);\n        }\n\n        await this.loadInitial();\n    },\n\n    renderPresetButtons() {\n        this.elements.presetButtons.innerHTML = '';\n        Object.keys(STYLE_PRESETS).forEach(themeName => {\n            const btn = document.createElement('button');\n            btn.textContent = themeName;\n            btn.style.cssText = `\n                padding: 6px 12px;\n                background: rgba(0,0,0,0.05);\n                border: 1px solid rgba(0,0,0,0.1);\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                color: var(--text);\n                flex-shrink: 0;\n            `;\n            btn.onmouseover = () => { btn.style.background = 'rgba(0,0,0,0.1)'; };\n            btn.onmouseout = () => { btn.style.background = 'rgba(0,0,0,0.05)'; };\n            btn.onclick = () => {\n                this.elements.promptInput.value = themeName;\n                this.applyStyle(STYLE_PRESETS[themeName], themeName);\n                this.togglePresets(true);\n            };\n            this.elements.presetButtons.appendChild(btn);\n        });\n    },\n\n    bindEvents() {\n        this.elements.generateBtn.addEventListener('click', () => this.handleGenerate());\n        this.elements.promptInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') this.handleGenerate();\n        });\n        this.elements.loadMoreBtn.addEventListener('click', () => this.loadMore());\n        this.elements.menuToggle.addEventListener('click', () => this.toggleMenu());\n        \n        if (this.elements.presetsToggle) {\n            this.elements.presetsToggle.addEventListener('click', () => this.togglePresets());\n        }\n\n        if (this.elements.panelHandle) {\n            let isDragging = false;\n            let startX = 0;\n            const threshold = 50;\n\n            const startDrag = (e) => {\n                if (window.innerWidth < 769) return;\n                isDragging = true;\n                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                this.elements.themeControls.style.transition = 'none';\n            };\n\n            const doDrag = (e) => {\n                if (!isDragging) return;\n                const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                if (!isMin && deltaX > 0) {\n                    this.elements.themeControls.style.transform = `translateX(${deltaX}px)`;\n                } else if (isMin && deltaX < 0) {\n                    this.elements.themeControls.style.transform = `translateX(calc(100% - 20px + ${deltaX}px))`;\n                }\n            };\n\n            const endDrag = (e) => {\n                if (!isDragging) return;\n                isDragging = false;\n                this.elements.themeControls.style.transition = '';\n                \n                let clientX = e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX;\n                const deltaX = clientX - startX;\n                const isMin = this.elements.themeControls.classList.contains('is-minimized');\n\n                this.elements.themeControls.style.transform = '';\n\n                if (Math.abs(deltaX) < 10) {\n                    this.elements.themeControls.classList.toggle('is-minimized');\n                } else {\n                    if (!isMin && deltaX > threshold) {\n                        this.elements.themeControls.classList.add('is-minimized');\n                    } else if (isMin && deltaX < -threshold) {\n                        this.elements.themeControls.classList.remove('is-minimized');\n                    }\n                }\n            };\n\n            const handle = this.elements.panelHandle;\n            handle.addEventListener('mousedown', startDrag);\n            handle.addEventListener('touchstart', startDrag, {passive: true});\n            \n            document.addEventListener('mousemove', doDrag);\n            document.addEventListener('touchmove', doDrag, {passive: true});\n            \n            document.addEventListener('mouseup', endDrag);\n            document.addEventListener('touchend', endDrag);\n        }\n        \n        // Handle navigation\n        this.elements.navLinks.addEventListener('click', (e) => {\n            if (e.target.tagName === 'A') {\n                e.preventDefault();\n                const type = e.target.textContent.trim().toLowerCase();\n                \n                if (['new', 'ask', 'show', 'jobs'].includes(type)) {\n                    this.switchFeed(type);\n                } else if (type === 'submit') {\n                    this.toggleMenu(false);\n                    window.open('https://news.ycombinator.com/submit', '_blank');\n                } else {\n                    this.toggleMenu(false);\n                    alert('This feature is currently unavailable in the Generative UI.');\n                }\n            }\n        });\n    },\n\n    togglePresets(collapse) {\n        const shouldCollapse = collapse !== undefined ? collapse : !this.elements.presetButtons.classList.contains('is-collapsed');\n        this.elements.presetButtons.classList.toggle('is-collapsed', shouldCollapse);\n        this.elements.presetsToggle.classList.toggle('is-collapsed-icon', shouldCollapse);\n    },\n\n    toggleMenu(force) {\n        if (!this.elements.menuToggle) return;\n        const shouldOpen = force !== undefined ? force : !this.elements.navLinks.classList.contains('is-open');\n        this.elements.navLinks.classList.toggle('is-open', shouldOpen);\n        this.elements.header.classList.toggle('is-open-active', shouldOpen);\n        document.body.style.overflow = shouldOpen ? 'hidden' : '';\n    },\n\n    async switchFeed(type) {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        \n        // Update HNData\n        HNData.setType(type);\n        \n        // Reset state\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading...</div>';\n        \n        // Close menu (if open)\n        this.toggleMenu(false);\n        \n        // Load\n        await this.loadAndRender();\n        this.isLoading = false;\n    },\n\n    async loadInitial() {\n        this.currentOffset = 0;\n        this.elements.listElement.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Loading stories...</div>';\n        await this.loadAndRender();\n    },\n\n    async loadMore() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        const originalText = this.elements.loadMoreBtn.textContent;\n        this.elements.loadMoreBtn.textContent = 'Loading...';\n        \n        await this.loadAndRender(true);\n        \n        this.elements.loadMoreBtn.textContent = originalText;\n        this.isLoading = false;\n    },\n\n    async loadAndRender(append = false) {\n        const stories = await HNData.fetchStoriesBatch(this.currentOffset);\n        this.renderStories(stories, append);\n        this.currentOffset += stories.length;\n    },\n\n    renderStories(stories, append = false) {\n        if (!append) {\n            this.elements.listElement.innerHTML = '';\n        }\n\n        stories.forEach((story, index) => {\n            if (!story) return;\n            \n            const rank = this.currentOffset + index + 1;\n            const domain = story.url ? new URL(story.url).hostname : '';\n            const domainHtml = domain ? `<span class=\"hn-story-domain\">(${domain})</span>` : '';\n            const timeAgo = HNData.formatTime(story.time);\n            \n            // Escape HTML in user content\n            const title = this.escapeHtml(story.title || '');\n            const author = this.escapeHtml(story.by || '');\n\n            const listItem = document.createElement('li');\n            listItem.className = 'hn-story-item';\n            listItem.innerHTML = `\n                <div class=\"hn-story-rank\">${rank}</div>\n                <div class=\"hn-story-content\">\n                    <div class=\"hn-story-title-row\">\n                        <a href=\"${story.url || '#'}\" class=\"hn-story-title\" target=\"_blank\">${title}</a>\n                        ${domainHtml}\n                    </div>\n                    <div class=\"hn-story-meta\">\n                        <span class=\"hn-story-points\">${story.score} pts</span> • \n                        <span class=\"hn-story-author\">${author}</span> • \n                        <span class=\"hn-story-time\">${timeAgo}</span>\n                    </div>\n                </div>\n                <button class=\"hn-upvote\" aria-label=\"upvote\">▲</button>\n            `;\n            this.elements.listElement.appendChild(listItem);\n        });\n    },\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n\n    getApiKey() {\n        return localStorage.getItem('acephale-gemini-key');\n    },\n\n    saveApiKey(key) {\n        localStorage.setItem('acephale-gemini-key', key.trim());\n    },\n\n    clearApiKey() {\n        localStorage.removeItem('acephale-gemini-key');\n        this.renderApiKeySection();\n    },\n\n    extractCss(text) {\n        let cleaned = text.replace(/^```(?:css)?\\s*/i, '');\n        cleaned = cleaned.replace(/\\s*```\\s*$/, '');\n        return cleaned.trim();\n    },\n\n    async generateTheme(prompt) {\n        const key = this.getApiKey();\n        if (!key) throw new Error('NO_API_KEY');\n\n        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`;\n        const body = {\n            system_instruction: { parts: [{ text: GEMINI_SYSTEM_PROMPT }] },\n            contents: [{ role: 'user', parts: [{ text: `Generate a CSS theme for: ${prompt}` }] }],\n            generationConfig: { temperature: 0.9, maxOutputTokens: 1200 }\n        };\n\n        const response = await fetch(endpoint, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        });\n\n        if (!response.ok) {\n            const status = response.status;\n            let apiMessage = '';\n            try {\n                const errData = await response.json();\n                apiMessage = errData?.error?.message || '';\n                console.error('Gemini API error:', status, errData);\n            } catch (_) {}\n            if (status === 400 || status === 403) throw new Error('INVALID_KEY');\n            if (status === 429) {\n                const e = new Error('RATE_LIMIT');\n                e.detail = apiMessage;\n                throw e;\n            }\n            throw new Error(`API_ERROR:${status}`);\n        }\n\n        const data = await response.json();\n        const rawText = data?.candidates?.[0]?.content?.parts?.[0]?.text;\n        if (!rawText) throw new Error('EMPTY_RESPONSE');\n        return this.extractCss(rawText);\n    },\n\n    renderApiKeySection() {\n        const existing = document.getElementById('api-key-section');\n        if (existing) existing.remove();\n\n        const section = document.createElement('div');\n        section.id = 'api-key-section';\n        section.style.cssText = 'width:100%; display:flex; flex-direction:column; gap:6px;';\n\n        if (this.getApiKey()) {\n            section.innerHTML = `\n                <div style=\"font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini AI: enabled</span>\n                    <button id=\"api-key-clear-btn\" style=\"font-size:10px; background:none; border:none; padding:0; cursor:pointer; opacity:0.7; color:inherit;\">clear</button>\n                </div>`;\n            section.querySelector('#api-key-clear-btn').addEventListener('click', () => this.clearApiKey());\n        } else {\n            section.innerHTML = `\n                <div id=\"api-key-toggle\" style=\"cursor:pointer; font-size:11px; opacity:0.6; display:flex; justify-content:space-between; align-items:center; width:100%; user-select:none;\">\n                    <span style=\"text-transform:uppercase; letter-spacing:1px; font-weight:600;\">Gemini API Key</span>\n                    <span id=\"api-key-icon\" style=\"font-size:10px; display:inline-block; transition:transform 0.3s; transform:rotate(-90deg);\">▼</span>\n                </div>\n                <div id=\"api-key-form\" style=\"display:none; flex-direction:column; gap:6px;\">\n                    <input type=\"password\" id=\"api-key-input\" placeholder=\"AIza...\" style=\"font-size:11px; min-width:0;\">\n                    <button id=\"api-key-save-btn\" style=\"font-size:11px; align-self:flex-end;\">Save Key</button>\n                </div>`;\n            section.querySelector('#api-key-toggle').addEventListener('click', () => {\n                const form = section.querySelector('#api-key-form');\n                const icon = section.querySelector('#api-key-icon');\n                const isOpen = form.style.display !== 'none';\n                form.style.display = isOpen ? 'none' : 'flex';\n                icon.style.transform = isOpen ? 'rotate(-90deg)' : 'rotate(0deg)';\n            });\n            section.querySelector('#api-key-save-btn').addEventListener('click', () => {\n                const val = section.querySelector('#api-key-input').value.trim();\n                if (!val) return;\n                this.saveApiKey(val);\n                this.renderApiKeySection();\n            });\n        }\n\n        this.elements.themeControls.appendChild(section);\n    },\n\n    showGenerateError(err) {\n        let message;\n        switch (err.message) {\n            case 'NO_API_KEY':    message = 'Please add your Gemini API key.'; this.expandApiKeySection(); break;\n            case 'INVALID_KEY':   message = 'Invalid API key. Please check and re-enter.'; this.expandApiKeySection(); break;\n            case 'RATE_LIMIT':    message = err.detail ? `API error: ${err.detail}` : 'Rate limit hit. Please try again in a moment.'; break;\n            case 'EMPTY_RESPONSE':message = 'Gemini returned an empty response. Try rephrasing.'; break;\n            default:              message = `Generation failed: ${err.message}`;\n        }\n        let errEl = document.getElementById('generate-error');\n        if (!errEl) {\n            errEl = document.createElement('div');\n            errEl.id = 'generate-error';\n            errEl.style.cssText = 'font-size:11px; color:#ff3b30; margin-top:-4px; width:100%;';\n            this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', errEl);\n        }\n        errEl.textContent = message;\n        clearTimeout(this._errorTimeout);\n        this._errorTimeout = setTimeout(() => { errEl.textContent = ''; }, 5000);\n    },\n\n    expandApiKeySection() {\n        const form = document.getElementById('api-key-form');\n        const icon = document.getElementById('api-key-icon');\n        if (form && form.style.display === 'none') {\n            form.style.display = 'flex';\n            if (icon) icon.style.transform = 'rotate(0deg)';\n        }\n        this.elements.themeControls.classList.remove('is-minimized');\n        const input = document.getElementById('api-key-input');\n        if (input) setTimeout(() => input.focus(), 300);\n    },\n\n    summarizePrompt(prompt) {\n        const stopWords = new Set(['a', 'an', 'the', 'with', 'for', 'in', 'of', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'that', 'this', 'these', 'those', 'on', 'at', 'to', 'from', 'by', 'as', 'it', 'its', 'very', 'style', 'theme', 'design', 'like', 'inspired', 'feel', 'look', 'make', 'create', 'generate']);\n        const words = prompt.toLowerCase().replace(/[^a-z0-9\\s]/g, '').split(/\\s+/);\n        const word = words.find(w => w.length > 1 && !stopWords.has(w)) || words[0] || 'Custom';\n        return word.charAt(0).toUpperCase() + word.slice(1);\n    },\n\n    getSavedThemes() {\n        try { return JSON.parse(localStorage.getItem('acephale-saved-themes') || '[]'); }\n        catch (_) { return []; }\n    },\n\n    saveCurrentTheme() {\n        const css = localStorage.getItem('acephale-custom-css');\n        const prompt = localStorage.getItem('acephale-custom-prompt') || 'Custom';\n        if (!css) return;\n\n        const baseName = this.summarizePrompt(prompt);\n        const saved = this.getSavedThemes();\n        if (saved.some(t => t.css === css)) return;\n\n        let name = baseName;\n        const existingNames = new Set(saved.map(t => t.name));\n        let i = 2;\n        while (existingNames.has(name)) { name = `${baseName}${i++}`; }\n\n        saved.push({ id: Date.now().toString(), name, css, prompt });\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n        this.renderSaveButton(false);\n    },\n\n    deleteSavedTheme(id) {\n        const saved = this.getSavedThemes().filter(t => t.id !== id);\n        localStorage.setItem('acephale-saved-themes', JSON.stringify(saved));\n        this.renderSavedThemeButtons();\n    },\n\n    renderSavedThemeButtons() {\n        document.querySelectorAll('.saved-theme-btn-wrapper').forEach(el => el.remove());\n\n        this.getSavedThemes().forEach(theme => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'saved-theme-btn-wrapper';\n            wrapper.style.cssText = 'position:relative; display:inline-flex; flex-shrink:0;';\n\n            const btn = document.createElement('button');\n            btn.textContent = theme.name;\n            btn.style.cssText = 'padding:6px 12px; background:rgba(0,0,0,0.05); border:2px solid rgba(0,0,0,0.25); border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; color:var(--text); flex-shrink:0;';\n            btn.addEventListener('mouseover', () => { btn.style.background = 'rgba(0,0,0,0.1)'; });\n            btn.addEventListener('mouseout', () => { btn.style.background = 'rgba(0,0,0,0.05)'; });\n            btn.addEventListener('click', () => {\n                this.elements.promptInput.value = theme.prompt;\n                this.applyStyle(theme.css, null, theme.prompt);\n                this.renderSaveButton(false);\n                this.togglePresets(true);\n            });\n\n            const delBtn = document.createElement('button');\n            delBtn.textContent = '×';\n            delBtn.style.cssText = 'position:absolute; top:-5px; right:-5px; width:15px; height:15px; border-radius:50%; background:rgba(0,0,0,0.35); color:#fff; border:none; font-size:9px; padding:0; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; opacity:0.3; transition:opacity 0.2s;';\n            delBtn.addEventListener('click', e => { e.stopPropagation(); this.deleteSavedTheme(theme.id); });\n            wrapper.addEventListener('mouseenter', () => { delBtn.style.opacity = '1'; });\n            wrapper.addEventListener('mouseleave', () => { delBtn.style.opacity = '0.3'; });\n\n            wrapper.appendChild(btn);\n            wrapper.appendChild(delBtn);\n            this.elements.presetButtons.appendChild(wrapper);\n        });\n    },\n\n    renderSaveButton(show) {\n        const existing = document.getElementById('save-theme-row');\n        if (existing) existing.remove();\n        if (!show) return;\n\n        const row = document.createElement('div');\n        row.id = 'save-theme-row';\n        row.style.cssText = 'width:100%; display:flex; justify-content:flex-end;';\n\n        const btn = document.createElement('button');\n        btn.textContent = 'Save as Preset';\n        btn.style.cssText = 'font-size:11px;';\n        btn.addEventListener('click', () => this.saveCurrentTheme());\n\n        row.appendChild(btn);\n        this.elements.generateBtn.parentElement.insertAdjacentElement('afterend', row);\n    },\n\n    async handleGenerate() {\n        const input = this.elements.promptInput.value.trim();\n        if (!input) return;\n        if (this._isGenerating) return;\n\n        const presetKey = this.matchStyle(input);\n        if (presetKey) {\n            this.applyStyle(STYLE_PRESETS[presetKey], presetKey);\n            this.togglePresets(true);\n            return;\n        }\n\n        if (!this.getApiKey()) {\n            this.expandApiKeySection();\n            return;\n        }\n\n        this._isGenerating = true;\n        const btn = this.elements.generateBtn;\n        const originalText = btn.textContent;\n        btn.textContent = 'Generating...';\n        btn.disabled = true;\n\n        try {\n            const css = await this.generateTheme(input);\n            this.applyStyle(css, null, input);\n            this.togglePresets(true);\n            this.renderSaveButton(true);\n        } catch (err) {\n            this.showGenerateError(err);\n        } finally {\n            btn.textContent = originalText;\n            btn.disabled = false;\n            this._isGenerating = false;\n        }\n    },\n\n    matchStyle(input) {\n        const normalizedInput = input.toLowerCase();\n        for (const key in STYLE_PRESETS) {\n            if (normalizedInput.includes(key.toLowerCase())) return key;\n        }\n        return null;\n    },\n\n    applyStyle(css, themeName, customPrompt = null) {\n        this.toggleMenu(false);\n\n        if (themeName && STYLE_PRESETS[themeName]) {\n            localStorage.setItem('acephale-theme', themeName);\n            localStorage.removeItem('acephale-custom-css');\n            localStorage.removeItem('acephale-custom-prompt');\n            this.renderSaveButton(false);\n        } else if (customPrompt) {\n            localStorage.setItem('acephale-custom-css', css);\n            localStorage.setItem('acephale-custom-prompt', customPrompt);\n            localStorage.removeItem('acephale-theme');\n        }\n\n        const applyFn = () => {\n            this.elements.styleTag.textContent = SYSTEM_STYLE + css;\n        };\n\n        if (!document.startViewTransition) { applyFn(); return; }\n        document.startViewTransition(applyFn);\n    }\n};\n\n// Start the application\ndocument.addEventListener('DOMContentLoaded', () => App.init());\n","structuredPatch":[{"oldStart":26,"oldLines":11,"newStart":26,"newLines":23,"lines":["   --item-radius: 0px = raw/brutalist | 6-10px = modern | 20-40px = playful/bubbly","   --item-border / --item-shadow: use thick borders for brutalist, glows for neon, none for minimal"," ","-After :root, add component overrides — this is REQUIRED, not optional.","-Use .hn-story-item, .hn-logo, .hn-header, .hn-upvote, body to add hover effects,","-clip-paths, gradients, box-shadows, text-shadows, or keyframe animations that","-make the aesthetic unmistakable. A theme with only :root variables is incomplete.","+=== HEADER (required override) ===","+The header MUST be visually transformed to match the theme. Always override .hn-header directly.","+The base style has backdrop-filter blur — override it explicitly when you want a solid look.","+Choose one of these patterns (or invent a stronger one):","+  Solid dark/color : background:<color>; backdrop-filter:none; border-bottom:<border>;","+  Floating pill    : margin:12px 20px; border-radius:100px; top:12px; backdrop-filter:blur(20px);","+  Bold stripe      : background:var(--accent); backdrop-filter:none; height:50px; border-bottom:4px solid var(--text);","+  Transparent      : background:transparent; backdrop-filter:none; border-bottom:none;","+  Brutalist bar    : background:var(--text); border-bottom:6px solid var(--accent); border-radius:0;","+Also restyle .hn-logo aggressively: letter-spacing, text-shadow, border, background-color, font-size, etc.","+--header-border can be set as a variable (e.g. --header-border: 3px solid var(--accent);)."," ","+=== COMPONENTS (required) ===","+After :root, add overrides for .hn-story-item, .hn-header, .hn-logo, .hn-upvote, body.","+Use hover effects, clip-paths, gradients, box-shadows, text-shadows, or animations","+that make the aesthetic unmistakable. A theme with only :root variables is incomplete.","+"," === VARIABLES ==="," :root {","     --bg:"]},{"oldStart":39,"oldLines":6,"newStart":51,"newLines":7,"lines":["     --subtext:","     --accent:","     --header-bg:","+    --header-border:","     --font-main:","     --item-radius:","     --item-border:"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"3810469b-656a-48e0-891c-f9b41dd2de08"}
{"parentUuid":"573d8e70-7ea0-44f7-a3bf-1ad97541e89d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_01DuoWLRAMfe2HHHjgGR379Y","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CRAtAURJ5KQE5YJHeERUyu","name":"Bash","input":{"command":"node --input-type=module <<'EOF'\nimport { readFileSync } from 'fs';\nconst src = readFileSync('/Users/turtlekazu/ReactProjects/acephale/gardener.js', 'utf8');\ntry { new Function(src); console.log('Syntax OK'); }\ncatch (e) { console.error('Syntax error:', e.message); }\nEOF","description":"Syntax check"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2428,"cache_read_input_tokens":101194,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2428},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLcb4xri3c1hDWxBfW2","type":"assistant","uuid":"ab334430-7d6e-4b0a-9b9f-354def34c092","timestamp":"2026-02-22T15:24:33.011Z"}
{"parentUuid":"ab334430-7d6e-4b0a-9b9f-354def34c092","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CRAtAURJ5KQE5YJHeERUyu","type":"tool_result","content":"Syntax OK","is_error":false}]},"uuid":"fe20e806-8114-4d89-b47e-388dde55ae61","timestamp":"2026-02-22T15:24:33.333Z","toolUseResult":{"stdout":"Syntax OK","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"ab334430-7d6e-4b0a-9b9f-354def34c092"}
{"parentUuid":"fe20e806-8114-4d89-b47e-388dde55ae61","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_014Mmf7ABJhhtYKhCeNu6He9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QsfGGpitSX7xP96WRrD9HM","name":"Bash","input":{"command":"git add gardener.js && git commit -m \"$(cat <<'EOF'\nAdd explicit header styling guidance to GEMINI_SYSTEM_PROMPT\n\n- Add === HEADER === section with 5 named patterns (solid, floating pill,\n  bold stripe, transparent, brutalist bar) and backdrop-filter override note\n- Add --header-border to the required variables list\n- Instruct AI to restyle .hn-logo aggressively (letter-spacing, shadow, etc.)\n- Rename former variety section to === COMPONENTS === and keep it required\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n)\"","description":"Commit header prompt improvement"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":180,"cache_read_input_tokens":103622,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":180},"output_tokens":19,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLcwv6CNwdA6wFYppU8","type":"assistant","uuid":"2724e439-df56-4182-9e49-390ccbf7454d","timestamp":"2026-02-22T15:24:38.921Z"}
{"parentUuid":"2724e439-df56-4182-9e49-390ccbf7454d","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QsfGGpitSX7xP96WRrD9HM","type":"tool_result","content":"[main 3cbd30c] Add explicit header styling guidance to GEMINI_SYSTEM_PROMPT\n 1 file changed, 17 insertions(+), 4 deletions(-)","is_error":false}]},"uuid":"634024cb-d5bb-4f7d-a14a-59e0fb79ad4a","timestamp":"2026-02-22T15:24:39.821Z","toolUseResult":{"stdout":"[main 3cbd30c] Add explicit header styling guidance to GEMINI_SYSTEM_PROMPT\n 1 file changed, 17 insertions(+), 4 deletions(-)","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"2724e439-df56-4182-9e49-390ccbf7454d"}
{"parentUuid":"634024cb-d5bb-4f7d-a14a-59e0fb79ad4a","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","message":{"model":"claude-sonnet-4-6","id":"msg_0161v73MXJLn2oky8pdXjMvc","type":"message","role":"assistant","content":[{"type":"text","text":"コミットしました (`3cbd30c`)。変更の要点：\n\n**なぜヘッダーが変わらなかったか**\n- `SYSTEM_STYLE` の `.hn-header` に `backdrop-filter: saturate(180%) blur(20px)` がハードコードされており、`--header-bg` を変えても常にすりガラスになっていた\n- `--header-border` 変数がプロンプトに含まれておらず AI が使えなかった\n\n**今回の改善**\n- `=== HEADER ===` セクションを新設し、`backdrop-filter` を明示的に上書きするよう指示\n- 5種類の具体的なヘッダーパターン（Solid / Floating pill / Bold stripe / Transparent / Brutalist bar）を例示\n- `.hn-logo` のスタイルも積極的に変えるよう指示\n- `--header-border` を変数リストに追加"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":283,"cache_read_input_tokens":103802,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":283},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYPLdRcidqNdGyGWmcSuh","type":"assistant","uuid":"9845e2db-28d4-4b52-bafc-64375ae020cf","timestamp":"2026-02-22T15:24:45.447Z"}
{"parentUuid":"9845e2db-28d4-4b52-bafc-64375ae020cf","isSidechain":false,"userType":"external","cwd":"/Users/turtlekazu/ReactProjects/acephale","sessionId":"f7486446-2d33-4d3a-98e0-500668474095","version":"2.1.50","gitBranch":"main","slug":"idempotent-hugging-pearl","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"entire hooks claude-code stop"},"parentToolUseID":"a19695c9-61db-45fe-a354-bd7de25bda21","toolUseID":"a19695c9-61db-45fe-a354-bd7de25bda21","timestamp":"2026-02-22T15:24:45.564Z","uuid":"2bcc5594-c7f8-4787-a2ae-b1121527690d"}
